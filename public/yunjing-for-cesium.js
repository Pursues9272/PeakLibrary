!function(t,e){"use strict";var n="undefined"!=typeof document?document.currentScript:null;function i(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var r=i(e);class o extends r.Terrain{constructor(t){let e;switch(t.crs){case"gcj02":default:e="China02";break;case"wgs84":e="China84"}const n=`https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/gaus/Terrain/${e}`;super(r.CesiumTerrainProvider.fromUrl(n))}}class s extends r.ImageryLayer{constructor(t){super(new r.UrlTemplateImageryProvider({url:"https://webst0{S}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",minimumLevel:3,maximumLevel:t?.maximumLevel||18,customTags:{S:function(t,e,n,i){return(e+n)%4+1}}}))}}var a,A,u,h,l,c,f,d,g,v,I,p,y,w,C,B,E,m,Q,k,b,_,x,D,S,M,$,R,F,G,L,N,U,T=Object.defineProperty,P=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyNames,O={}.hasOwnProperty,H=(a=function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):a),z=(t,e)=>()=>(t&&(e=t(t=0)),e),K=(t,e)=>{for(var n in e)T(t,n,{get:e[n],enumerable:!0})},V=t=>((t,e,n,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let n of q(e))!O.call(t,n)&&void 0!==n&&T(t,n,{get:()=>e[n],enumerable:!(i=P(e,n))||i.enumerable});return t})(T({},"__esModule",{value:!0}),t),J=z((()=>{A=new Map,u=[],h=(t,e,n)=>{if(!e||"function"!=typeof e.init||"function"!=typeof e.createInferenceSessionHandler)throw new TypeError("not a valid backend");{let i=A.get(t);if(void 0===i)A.set(t,{backend:e,priority:n});else{if(i.priority>n)return;if(i.priority===n&&i.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${n}`)}if(n>=0){let e=u.indexOf(t);-1!==e&&u.splice(e,1);for(let e=0;e<u.length;e++)if(A.get(u[e]).priority<=n)return void u.splice(e,0,t);u.push(t)}}},l=async t=>{let e=A.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let n=!!e.initPromise;try{return n||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(t){return n||(e.error=`${t}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},c=async t=>{let e,n=t.executionProviders||[],i=n.map((t=>"string"==typeof t?t:t.name)),r=0===i.length?u:i,o=[],s=new Set;for(let t of r){let n=await l(t);"string"==typeof n?o.push({name:t,err:n}):(e||(e=n),e===n&&s.add(t))}if(!e)throw new Error(`no available backend found. ERR: ${o.map((t=>`[${t.name}] ${t.err}`)).join(", ")}`);for(let{name:t,err:e}of o)i.includes(t);let a=n.filter((t=>s.has("string"==typeof t?t:t.name)));return[e,new Proxy(t,{get:(t,e)=>"executionProviders"===e?a:Reflect.get(t,e)})]}})),Y=z((()=>{J()})),j=z((()=>{f="1.19.2"})),W=z((()=>{j(),d="warning",g={wasm:{},webgl:{},webgpu:{},versions:{common:f},set logLevel(t){if(void 0!==t){if("string"!=typeof t||-1===["verbose","info","warning","error","fatal"].indexOf(t))throw new Error(`Unsupported logging level: ${t}`);d=t}},get logLevel(){return d}},Object.defineProperty(g,"logLevel",{enumerable:!0})})),X=z((()=>{W(),v=g})),Z=z((()=>{I=(t,e)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=t.dims[3],n.height=t.dims[2];let i=n.getContext("2d");if(null!=i){let r,o;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(r=t.dims[2],o=t.dims[3]):(r=t.dims[3],o=t.dims[2]);let s,a,A=void 0!==e?.format?e.format:"RGB",u=e?.norm;void 0===u||void 0===u.mean?s=[255,255,255,255]:"number"==typeof u.mean?s=[u.mean,u.mean,u.mean,u.mean]:(s=[u.mean[0],u.mean[1],u.mean[2],0],void 0!==u.mean[3]&&(s[3]=u.mean[3])),void 0===u||void 0===u.bias?a=[0,0,0,0]:"number"==typeof u.bias?a=[u.bias,u.bias,u.bias,u.bias]:(a=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(a[3]=u.bias[3]));let h=o*r,l=0,c=h,f=2*h,d=-1;"RGBA"===A?(l=0,c=h,f=2*h,d=3*h):"RGB"===A?(l=0,c=h,f=2*h):"RBG"===A&&(l=0,f=h,c=2*h);for(let e=0;e<o;e++)for(let n=0;n<r;n++){let r=(t.data[l++]-a[0])*s[0],o=(t.data[c++]-a[1])*s[1],A=(t.data[f++]-a[2])*s[2],u=-1===d?255:(t.data[d++]-a[3])*s[3];i.fillStyle="rgba("+r+","+o+","+A+","+u+")",i.fillRect(n,e,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},p=(t,e)=>{let n,i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==i)throw new Error("Can not access image data");{let r,o,s;void 0!==e?.tensorLayout&&"NHWC"===e.tensorLayout?(r=t.dims[2],o=t.dims[1],s=t.dims[3]):(r=t.dims[3],o=t.dims[2],s=t.dims[1]);let a,A,u=void 0!==e&&void 0!==e.format?e.format:"RGB",h=e?.norm;void 0===h||void 0===h.mean?a=[255,255,255,255]:"number"==typeof h.mean?a=[h.mean,h.mean,h.mean,h.mean]:(a=[h.mean[0],h.mean[1],h.mean[2],255],void 0!==h.mean[3]&&(a[3]=h.mean[3])),void 0===h||void 0===h.bias?A=[0,0,0,0]:"number"==typeof h.bias?A=[h.bias,h.bias,h.bias,h.bias]:(A=[h.bias[0],h.bias[1],h.bias[2],0],void 0!==h.bias[3]&&(A[3]=h.bias[3]));let l=o*r;if(void 0!==e&&(void 0!==e.format&&4===s&&"RGBA"!==e.format||3===s&&"RGB"!==e.format&&"BGR"!==e.format))throw new Error("Tensor format doesn't match input tensor dims");let c=4,f=0,d=1,g=2,v=3,I=0,p=l,y=2*l,w=-1;"RGBA"===u?(I=0,p=l,y=2*l,w=3*l):"RGB"===u?(I=0,p=l,y=2*l):"RBG"===u&&(I=0,y=l,p=2*l),n=i.createImageData(r,o);for(let e=0;e<o*r;f+=c,d+=c,g+=c,v+=c,e++)n.data[f]=(t.data[I++]-A[0])*a[0],n.data[d]=(t.data[p++]-A[1])*a[1],n.data[g]=(t.data[y++]-A[2])*a[2],n.data[v]=-1===w?255:(t.data[w++]-A[3])*a[3]}return n}})),tt=z((()=>{it(),y=(t,e)=>{if(void 0===t)throw new Error("Image buffer must be defined");if(void 0===e.height||void 0===e.width)throw new Error("Image height and width must be defined");if("NHWC"===e.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let n,i,{height:r,width:o}=e,s=e.norm??{mean:255,bias:0};n="number"==typeof s.mean?[s.mean,s.mean,s.mean,s.mean]:[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],i="number"==typeof s.bias?[s.bias,s.bias,s.bias,s.bias]:[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let a=void 0!==e.format?e.format:"RGBA",A=void 0!==e.tensorFormat&&void 0!==e.tensorFormat?e.tensorFormat:"RGB",u=r*o,h="RGBA"===A?new Float32Array(4*u):new Float32Array(3*u),l=4,c=0,f=1,d=2,g=3,v=0,I=u,p=2*u,y=-1;"RGB"===a&&(l=3,c=0,f=1,d=2,g=-1),"RGBA"===A?y=3*u:"RBG"===A?(v=0,p=u,I=2*u):"BGR"===A&&(p=0,I=u,v=2*u);for(let e=0;e<u;e++,c+=l,d+=l,f+=l,g+=l)h[v++]=(t[c]+i[0])/n[0],h[I++]=(t[f]+i[1])/n[1],h[p++]=(t[d]+i[2])/n[2],-1!==y&&-1!==g&&(h[y++]=(t[g]+i[3])/n[3]);return new D("float32",h,"RGBA"===A?[1,4,r,o]:[1,3,r,o])},w=async(t,e)=>{let n,i=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,r=typeof ImageData<"u"&&t instanceof ImageData,o=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,s="string"==typeof t,a=e??{},A=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=t=>t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas?t.getContext("2d"):null;if(i){let i=A();i.width=t.width,i.height=t.height;let r=u(i);if(null==r)throw new Error("Can not access image data");{let i=t.height,o=t.width;if(void 0!==e&&void 0!==e.resizedHeight&&void 0!==e.resizedWidth&&(i=e.resizedHeight,o=e.resizedWidth),void 0!==e){if(a=e,void 0!==e.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=i,a.width=o}else a.tensorFormat="RGBA",a.height=i,a.width=o;r.drawImage(t,0,0),n=r.getImageData(0,0,o,i).data}}else{if(!r){if(o){if(void 0===e)throw new Error("Please provide image config with format for Imagebitmap");let i=A();i.width=t.width,i.height=t.height;let r=u(i);if(null!=r){let e=t.height,i=t.width;return r.drawImage(t,0,0,i,e),n=r.getImageData(0,0,i,e).data,a.height=e,a.width=i,y(n,a)}throw new Error("Can not access image data")}if(s)return new Promise(((e,n)=>{let i=A(),r=u(i);if(!t||!r)return n();let o=new Image;o.crossOrigin="Anonymous",o.src=t,o.onload=()=>{i.width=o.width,i.height=o.height,r.drawImage(o,0,0,i.width,i.height);let t=r.getImageData(0,0,i.width,i.height);a.height=i.height,a.width=i.width,e(y(t.data,a))}}));throw new Error("Input data provided is not supported - aborted tensor creation")}{let i,r;if(void 0!==e&&void 0!==e.resizedWidth&&void 0!==e.resizedHeight?(i=e.resizedHeight,r=e.resizedWidth):(i=t.height,r=t.width),void 0!==e&&(a=e),a.format="RGBA",a.height=i,a.width=r,void 0!==e){let e=A();e.width=r,e.height=i;let o=u(e);if(null==o)throw new Error("Can not access image data");o.putImageData(t,0,0),n=o.getImageData(0,0,r,i).data}else n=t.data}}if(void 0!==n)return y(n,a);throw new Error("Input data provided is not supported - aborted tensor creation")},C=(t,e)=>{let{width:n,height:i,download:r,dispose:o}=e;return new D({location:"texture",type:"float32",texture:t,dims:[1,i,n,4],download:r,dispose:o})},B=(t,e)=>{let{dataType:n,dims:i,download:r,dispose:o}=e;return new D({location:"gpu-buffer",type:n??"float32",gpuBuffer:t,dims:i,download:r,dispose:o})},E=(t,e,n)=>new D({location:"cpu-pinned",type:t,data:e,dims:n??[e.length]})})),et=z((()=>{m=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),Q=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),k=!1,b=()=>{if(!k){k=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,n=typeof Float16Array<"u"&&Float16Array.from;t&&(m.set("int64",BigInt64Array),Q.set(BigInt64Array,"int64")),e&&(m.set("uint64",BigUint64Array),Q.set(BigUint64Array,"uint64")),n?(m.set("float16",Float16Array),Q.set(Float16Array,"float16")):m.set("float16",Uint16Array)}}})),nt=z((()=>{it(),_=t=>{let e=1;for(let n=0;n<t.length;n++){let i=t[n];if("number"!=typeof i||!Number.isSafeInteger(i))throw new TypeError(`dims[${n}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${i}`);e*=i}return e},x=(t,e)=>{switch(t.location){case"cpu":return new D(t.type,t.data,e);case"cpu-pinned":return new D({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new D({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new D({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}})),it=z((()=>{Z(),tt(),et(),nt(),D=class{constructor(t,e,n){let i,r;if(b(),"object"==typeof t&&"location"in t)switch(this.dataLocation=t.location,i=t.type,r=t.dims,t.location){case"cpu-pinned":{let e=m.get(i);if(!e)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(t.data instanceof e))throw new TypeError(`buffer should be of type ${e.name}`);this.cpuData=t.data;break}case"texture":if("float32"!==i)throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break;case"gpu-buffer":if("float32"!==i&&"float16"!==i&&"int32"!==i&&"int64"!==i&&"uint32"!==i&&"uint8"!==i&&"bool"!==i)throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,s;if("string"==typeof t)if(i=t,s=n,"string"===t){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");o=e}else{let n=m.get(t);if(void 0===n)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if("float16"===t&&n===Uint16Array)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");o="uint64"===t||"int64"===t?n.from(e,BigInt):n.from(e)}else{if(!(e instanceof n))throw new TypeError(`A ${i} tensor's data must be type of ${n}`);o=e}}else if(s=e,Array.isArray(t)){if(0===t.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let e=typeof t[0];if("string"===e)i="string",o=t;else{if("boolean"!==e)throw new TypeError(`Invalid element type of data array: ${e}.`);i="bool",o=Uint8Array.from(t)}}else{let e=Q.get(t.constructor);if(void 0===e)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);i=e,o=t}if(void 0===s)s=[o.length];else if(!Array.isArray(s))throw new TypeError("A tensor's dims must be a number array");r=s,this.cpuData=o,this.dataLocation="cpu"}let o=_(r);if(this.cpuData&&o!==this.cpuData.length)throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=r,this.size=o}static async fromImage(t,e){return w(t,e)}static fromTexture(t,e){return C(t,e)}static fromGpuBuffer(t,e){return B(t,e)}static fromPinnedBuffer(t,e,n){return E(t,e,n)}toDataURL(t){return I(this,t)}toImageData(t){return p(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return x(this,t)}}})),rt=z((()=>{it(),S=D})),ot=z((()=>{W(),M=(t,e)=>{typeof g.trace>"u"?g.wasm.trace:g.trace},$=(t,e)=>{let n=(new Error).stack?.split(/\r\n|\r|\n/g)||[],i=!1;for(let r=0;r<n.length;r++){if(i&&!n[r].includes("TRACE_FUNC")){let i=`FUNC_${t}::${n[r].trim().split(" ")[1]}`;return e&&(i+=`::${e}`),void M("CPU",i)}n[r].includes("TRACE_FUNC")&&(i=!0)}},R=t=>{(typeof g.trace>"u"?!g.wasm.trace:!g.trace)||$("BEGIN",t)},F=t=>{(typeof g.trace>"u"?!g.wasm.trace:!g.trace)||$("END",t)}})),st=z((()=>{J(),rt(),ot(),G=class t{constructor(t){this.handler=t}async run(t,e,n){R();let i={},r={};if("object"!=typeof t||null===t||t instanceof S||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if("object"==typeof e){if(null===e)throw new TypeError("Unexpected argument[1]: cannot be null.");if(e instanceof S)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(e)){if(0===e.length)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(let t of e){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);i[t]=null}if("object"==typeof n&&null!==n)r=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,s=Object.getOwnPropertyNames(e);for(let n of this.outputNames)if(-1!==s.indexOf(n)){let r=e[n];(null===r||r instanceof S)&&(t=!0,o=!1,i[n]=r)}if(t){if("object"==typeof n&&null!==n)r=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else r=e}}else if(typeof e<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of this.inputNames)if(typeof t[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(o)for(let t of this.outputNames)i[t]=null;let s=await this.handler.run(t,i,r),a={};for(let t in s)if(Object.hasOwnProperty.call(s,t)){let e=s[t];a[t]=e instanceof S?e:new S(e.type,e.data,e.dims)}return F(),a}async release(){return this.handler.dispose()}static async create(e,n,i,r){R();let o,s={};if("string"==typeof e){if(o=e,"object"==typeof n&&null!==n)s=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(o=e,"object"==typeof n&&null!==n)s=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{if(!(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let t=e,a=0,A=e.byteLength;if("object"==typeof n&&null!==n)s=n;else if("number"==typeof n){if(a=n,!Number.isSafeInteger(a))throw new RangeError("'byteOffset' must be an integer.");if(a<0||a>=t.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${t.byteLength}).`);if(A=e.byteLength-a,"number"==typeof i){if(A=i,!Number.isSafeInteger(A))throw new RangeError("'byteLength' must be an integer.");if(A<=0||a+A>t.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${t.byteLength-a}].`);if("object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(t,a,A)}}let[a,A]=await c(s),u=await a.createInferenceSessionHandler(o,A);return F(),new t(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}})),at=z((()=>{st(),L=G})),At=z((()=>{})),ut=z((()=>{})),ht=z((()=>{})),lt=z((()=>{})),ct=z((()=>{J(),rt(),N=class t{constructor(t,e,n){this.handler=t,this.hasOptimizerModel=e,this.hasEvalModel=n}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(e,n){let i=e.evalModel||"",r=e.optimizerModel||"",o=n||{},[s,a]=await c(o);if(s.createTrainingSessionHandler){let n=await s.createTrainingSessionHandler(e.checkpointState,e.trainModel,i,r,a);return new t(n,!!e.optimizerModel,!!e.evalModel)}throw new Error("Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.")}typeNarrowingForRunStep(t,e,n,i,r){let o={},s={};if("object"!=typeof n||null===n||n instanceof S||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof i){if(null===i)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof S)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(0===i.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let t of i){if("string"!=typeof t)throw new TypeError("'fetches' must be a string array or an object.");if(-1===e.indexOf(t))throw new RangeError(`'fetches' contains invalid output name: ${t}.`);o[t]=null}if("object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let t=!1,n=Object.getOwnPropertyNames(i);for(let r of e)if(-1!==n.indexOf(r)){let e=i[r];(null===e||e instanceof S)&&(t=!0,a=!1,o[r]=e)}if(t){if("object"==typeof r&&null!==r)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else s=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let e of t)if(typeof n[e]>"u")throw new Error(`input '${e}' is missing in 'feeds'.`);if(a)for(let t of e)o[t]=null;return[o,s]}convertHandlerReturnTypeToMapOfTensors(t){let e={};for(let n in t)if(Object.hasOwnProperty.call(t,n)){let i=t[n];e[n]=i instanceof S?i:new S(i.type,i.data,i.dims)}return e}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(t,e,n){let[i,r]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,t,e,n),o=await this.handler.runTrainStep(t,i,r);return this.convertHandlerReturnTypeToMapOfTensors(o)}async runOptimizerStep(t){if(!this.hasOptimizerModel)throw new Error("This TrainingSession has no OptimizerModel loaded.");await this.handler.runOptimizerStep(t||{})}async runEvalStep(t,e,n){if(this.hasEvalModel){let[i,r]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,t,e,n),o=await this.handler.runEvalStep(t,i,r);return this.convertHandlerReturnTypeToMapOfTensors(o)}throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(t=!0){return this.handler.getParametersSize(t)}async loadParametersBuffer(t,e=!0){let n=await this.getParametersSize(e);if(t.length!==4*n)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(t,e)}async getContiguousParameters(t=!0){return this.handler.getContiguousParameters(t)}async release(){return this.handler.dispose()}}})),ft=z((()=>{ct(),U=N})),dt={};K(dt,{InferenceSession:()=>L,TRACE:()=>M,TRACE_FUNC_BEGIN:()=>R,TRACE_FUNC_END:()=>F,Tensor:()=>S,TrainingSession:()=>U,env:()=>v,registerBackend:()=>h});var gt=z((()=>{Y(),X(),at(),rt(),At(),ut(),ot(),ht(),lt(),ft()})),vt=z((()=>{})),It={};K(It,{default:()=>wt});var pt,yt,wt,Ct=z((()=>{uh(),dA(),fA(),pt="ort-wasm-proxy-worker",(yt=globalThis.self?.name===pt)&&(self.onmessage=t=>{let{type:e,in:n}=t.data;try{switch(e){case"init-wasm":Tt(n.wasm).then((()=>{_u(n).then((()=>{postMessage({type:e})}),(t=>{postMessage({type:e,err:t})}))}),(t=>{postMessage({type:e,err:t})}));break;case"init-ep":{let{epName:t,env:i}=n;xu(i,t).then((()=>{postMessage({type:e})}),(t=>{postMessage({type:e,err:t})}));break}case"copy-from":{let{buffer:t}=n,i=Mu(t);postMessage({type:e,out:i});break}case"create":{let{model:t,options:i}=n;$u(t,i).then((t=>{postMessage({type:e,out:t})}),(t=>{postMessage({type:e,err:t})}));break}case"release":Ru(n),postMessage({type:e});break;case"run":{let{sessionId:t,inputIndices:i,inputs:r,outputIndices:o,options:s}=n;Gu(t,i,r,o,new Array(o.length).fill(null),s).then((t=>{t.some((t=>"cpu"!==t[3]))?postMessage({type:e,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:e,out:t},Nu([...r,...t]))}),(t=>{postMessage({type:e,err:t})}));break}case"end-profiling":Lu(n),postMessage({type:e})}}catch(t){postMessage({type:e,err:t})}}),wt=yt?null:t=>new Worker(t??kt,{type:"module",name:pt})})),Bt={};K(Bt,{default:()=>Qt});var Et,mt,Qt,kt,bt,_t,xt,Dt,St,Mt,$t,Rt,Ft,Gt,Lt,Nt,Ut,Tt,Pt,qt,Ot,Ht,zt,Kt,Vt,Jt,Yt,jt,Wt,Xt,Zt,te,ee,ne,ie,re,oe,se,ae,Ae,ue,he,le,ce,fe,de,ge,ve,Ie,pe,ye,we,Ce,Be,Ee,me,Qe,ke,be,_e,xe,De,Se,Me,$e,Re,Fe,Ge,Le,Ne,Ue,Te,Pe,qe,Oe,He,ze,Ke,Ve,Je,Ye,je,We,Xe,Ze,tn,en,nn,rn,on,sn,an,An,un,hn,ln,cn,fn,dn,gn,vn,In,pn,yn,wn,Cn,Bn,En,mn,Qn,kn,bn,_n,xn,Dn,Sn,Mn,$n,Rn,Fn,Gn,Ln,Nn,Un,Tn,Pn,qn,On,Hn,zn,Kn,Vn,Jn,Yn,jn,Wn,Xn,Zn,ti,ei,ni,ii,ri,oi,si,ai,Ai,ui,hi,li,ci,fi,di,gi,vi,Ii,pi,yi,wi,Ci,Bi,Ei,mi,Qi,ki,bi,_i,xi,Di,Si,Mi,$i,Ri,Fi,Gi,Li,Ni,Ui,Ti,Pi,qi,Oi,Hi,zi,Ki,Vi,Ji,Yi,ji,Wi,Xi,Zi,tr,er,nr,ir,rr,or,sr,ar,Ar,ur,hr,lr,cr,fr,dr,gr,vr,Ir,pr,yr,wr,Cr,Br,Er,mr,Qr,kr,br,_r,xr,Dr,Sr,Mr,$r,Rr,Fr,Gr,Lr,Nr,Ur,Tr,Pr,qr,Or,Hr,zr,Kr,Vr,Jr,Yr,jr,Wr,Xr,Zr,to,eo,no,io,ro,oo,so,ao,Ao,uo,ho,lo,co,fo,go,vo,Io,po,yo,wo,Co,Bo,Eo,mo,Qo,ko,bo,_o,xo,Do,So,Mo,$o,Ro,Fo,Go,Lo,No,Uo,To,Po,qo,Oo,Ho,zo,Ko,Vo,Jo,Yo,jo,Wo,Xo,Zo,ts,es,ns,is,rs,os,ss,as,As,us,hs,ls,cs,fs,ds,gs,vs,Is,ps,ys,ws,Cs,Bs,Es,ms,Qs,ks,bs,_s,xs,Ds,Ss,Ms,$s,Rs,Fs,Gs,Ls,Ns,Us,Ts,Ps,qs,Os,Hs,zs,Ks,Vs,Js,Ys,js,Ws,Xs,Zs,ta,ea,na,ia,ra,oa,sa,aa,Aa,ua,ha,la,ca,fa,da,ga,va,Ia,pa,ya,wa,Ca,Ba,Ea,ma,Qa,ka,ba,_a,xa,Da,Sa,Ma,$a,Ra,Fa,Ga,La,Na,Ua,Ta,Pa,qa,Oa,Ha,za,Ka,Va,Ja,Ya,ja,Wa,Xa,Za,tA,eA,nA,iA,rA,oA,sA,aA,AA,uA,hA,lA,cA=z((()=>{Et=n&&n.src||new URL("yunjing-for-cesium.js",document.baseURI).href,mt=async function(t={}){function e(){return x.buffer!=M.buffer&&O(),M}function i(){return x.buffer!=M.buffer&&O(),$}function r(){return x.buffer!=M.buffer&&O(),R}function o(){return x.buffer!=M.buffer&&O(),F}function s(){return x.buffer!=M.buffer&&O(),G}function a(){return x.buffer!=M.buffer&&O(),L}function A(){return x.buffer!=M.buffer&&O(),N}function u(){return x.buffer!=M.buffer&&O(),P}var h,l,c=Object.assign({},t),f=new Promise(((t,e)=>{h=t,l=e})),d="object"==typeof window,g="function"==typeof importScripts,v=g&&"em-pthread"==self.name;c.mountExternalData=(t,e)=>{(c.Fb||(c.Fb=new Map)).set(t,e)},c.unmountExternalData=()=>{delete c.Fb};var I=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,shared:!0}).buffer.constructor;let p=()=>{let t=(t,e,n)=>(...i)=>{let r=Oe,o=e?.();i=t(...i);let s=e?.();return o!==s&&(t=s,n(o),e=n=null),Oe!=r?new Promise(((t,e)=>{Ye={resolve:t,reject:e}})):i},e=t=>async(...e)=>{try{if(c.Eb)throw Error("Session already started");let n=c.Eb={bc:e[0],errors:[]},i=await t(...e);if(c.Eb!==n)throw Error("Session mismatch");c.Mb?.flush();let r=n.errors;if(0<r.length){let t=await Promise.all(r);if(t=t.filter((t=>t)),0<t.length)throw Error(t.join("\n"))}return i}finally{c.Eb=null}};c._=t(c._,(()=>c._),(t=>c._=t)),c.tt=e(t(c.tt,(()=>c.tt),(t=>c.tt=t))),c.et=e(t(c.et,(()=>c.et),(t=>c.et=t))),c.nt=t(c.nt,(()=>c.nt),(t=>c.nt=t)),p=void 0};c.jsepInit=(t,e)=>{if(p?.(),"webgpu"===t){[c.Mb,c.Tb,c.Xb,c.Nb,c.Wb,c.jb,c.Yb,c.$b,c.Ub,c.Vb,c.Zb]=e;let t=c.Mb;c.jsepRegisterBuffer=(e,n,i,r)=>t.registerBuffer(e,n,i,r),c.jsepGetBuffer=e=>t.getBuffer(e),c.jsepCreateDownloader=(e,n,i)=>t.createDownloader(e,n,i),c.jsepOnReleaseSession=e=>{t.onReleaseSession(e)},c.jsepOnRunStart=e=>t.onRunStart(e)}};var y,w,C=Object.assign({},c),B=(t,e)=>{throw e},E="";(d||g)&&(g?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),Et&&(E=Et),E=E.startsWith("blob:")?"":E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),g&&(w=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),y=(t,e,n)=>{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?e(i.response):n()},i.onerror=n,i.send(null)});var m,Q=void 0,k=void 0;if(Object.assign(c,C),C=null,v){let t=function(e){try{var n=e.data,i=n.cmd;if("load"===i){let e=[];self.onmessage=t=>e.push(t),self.startWorker=()=>{postMessage({cmd:"loaded"});for(let n of e)t(n);self.onmessage=t};for(let t of n.handlers)c[t]&&!c[t].proxy||(c[t]=(...e)=>{postMessage({Lb:"callHandler",kc:t,args:e})},"print"==t&&(Q=c[t]),"printErr"==t&&(k=c[t]));x=n.wasmMemory,O(),b(n.wasmModule)}else if("run"===i){yi(n.pthread_ptr,0,0,1,0,0),Se(n.pthread_ptr),mt(),yt(),_||(di(),_=!0);try{Qt(n.start_routine,n.arg)}catch(t){if("unwind"!=t)throw t}}else"cancel"===i?vi()&&Ei(-1):"setimmediate"!==n.target&&("checkMailbox"===i?_&&Me():i&&(k(`worker: received unknown command ${i}`),k(n)))}catch(t){throw wi(),t}};var b,_=!1;k=function(...t){t=t.join(" ")},self.alert=function(...t){postMessage({Lb:"alert",text:t.join(" "),mc:vi()})},c.instantiateWasm=(t,e)=>new Promise((t=>{b=n=>{n=new WebAssembly.Instance(n,nt()),e(n),t()}})),self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=t}c.wasmBinary&&(m=c.wasmBinary);var x,D,S,M,$,R,F,G,L,N,U,T,P,q=!1;function O(){var t=x.buffer;c.HEAP8=M=new Int8Array(t),c.HEAP16=R=new Int16Array(t),c.HEAPU8=$=new Uint8Array(t),c.HEAPU16=F=new Uint16Array(t),c.HEAP32=G=new Int32Array(t),c.HEAPU32=L=new Uint32Array(t),c.HEAPF32=N=new Float32Array(t),c.HEAPF64=P=new Float64Array(t),c.HEAP64=U=new BigInt64Array(t),c.HEAPU64=T=new BigUint64Array(t)}if(!v){if(!((x=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0})).buffer instanceof I))throw k("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),Error("bad memory");O()}var H=[],z=[],K=[],V=0,J=null;function Y(){if(0==--V&&J){var t=J;J=null,t()}}function j(t){throw k(t="Aborted("+t+")"),q=!0,S=1,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),l(t),t}var W,X=t=>t.startsWith("data:application/octet-stream;base64,"),Z=t=>t.startsWith("file://");function tt(t){if(t==W&&m)return new Uint8Array(m);if(w)return w(t);throw"both async and sync fetching of the wasm failed"}function et(t,e,n){return function(t){if(!m&&(d||g)){if("function"==typeof fetch&&!Z(t))return fetch(t,{credentials:"same-origin"}).then((e=>{if(!e.ok)throw`failed to load wasm binary file at '${t}'`;return e.arrayBuffer()})).catch((()=>tt(t)));if(y)return new Promise(((e,n)=>{y(t,(t=>e(new Uint8Array(t))),n)}))}return Promise.resolve().then((()=>tt(t)))}(t).then((t=>WebAssembly.instantiate(t,e))).then(n,(t=>{k(`failed to asynchronously prepare wasm: ${t}`),j(t)}))}function nt(){return{a:{M:ot,za:rt,b:bt,$:xt,z:$t,pa:Rt,X:Nt,Z:Ut,qa:Tt,na:Pt,ga:qt,ma:Ot,J:Ht,Y:zt,V:Kt,oa:Vt,W:Jt,va:Wt,D:ie,P:oe,O:fe,C:ge,s:ve,p:Ie,E:pe,y:ke,Q:be,ta:_e,ja:xe,T:$e,aa:Fe,F:Ge,ia:Se,sa:Le,u:Te,B:Xe,o:tn,m:rn,c:Ae,n:sn,k:hn,Aa:ln,r:cn,f:fn,v:dn,l:gn,g:vn,i:In,j:pn,h:yn,e:wn,da:Cn,ea:Qn,fa:kn,ba:bn,ca:_n,S:xn,d:Mn,N:$n,G:Rn,K:Fn,w:Gn,ra:Nn,U:Un,t:Ln,x:Tn,L:Pn,R:qn,ya:Kn,xa:Vn,ka:Wn,la:Xn,it:ft,A:Zn,I:ti,ha:ei,H:ii,a:x,wa:lt,ua:ai,q:Ai}}}var it={849620:(t,e,n,r)=>{if(void 0===c||!c.Fb)return 1;if((t=Mt(t>>>0)).startsWith("./")&&(t=t.substring(2)),!(t=c.Fb.get(t)))return 2;if(r>>>=0,(e>>>=0)+(n>>>=0)>t.byteLength)return 3;try{return i().set(t.subarray(e,e+n),r>>>0),0}catch{return 4}},850121:()=>{c.Ub()},850152:()=>{c.Vb()},850181:()=>{c.Zb()},850206:t=>c.Tb(t),850239:t=>c.Xb(t),850271:(t,e,n)=>{c.Nb(t,e,n,!0)},850310:(t,e,n)=>{c.Nb(t,e,n)},850343:()=>typeof wasmOffsetConverter<"u",850400:t=>{c.jb("Abs",t,void 0)},850451:t=>{c.jb("Neg",t,void 0)},850502:t=>{c.jb("Floor",t,void 0)},850555:t=>{c.jb("Ceil",t,void 0)},850607:t=>{c.jb("Reciprocal",t,void 0)},850665:t=>{c.jb("Sqrt",t,void 0)},850717:t=>{c.jb("Exp",t,void 0)},850768:t=>{c.jb("Erf",t,void 0)},850819:t=>{c.jb("Sigmoid",t,void 0)},850874:(t,e,n)=>{c.jb("HardSigmoid",t,{alpha:e,beta:n})},850953:t=>{c.jb("Log",t,void 0)},851004:t=>{c.jb("Sin",t,void 0)},851055:t=>{c.jb("Cos",t,void 0)},851106:t=>{c.jb("Tan",t,void 0)},851157:t=>{c.jb("Asin",t,void 0)},851209:t=>{c.jb("Acos",t,void 0)},851261:t=>{c.jb("Atan",t,void 0)},851313:t=>{c.jb("Sinh",t,void 0)},851365:t=>{c.jb("Cosh",t,void 0)},851417:t=>{c.jb("Asinh",t,void 0)},851470:t=>{c.jb("Acosh",t,void 0)},851523:t=>{c.jb("Atanh",t,void 0)},851576:t=>{c.jb("Tanh",t,void 0)},851628:t=>{c.jb("Not",t,void 0)},851679:(t,e,n)=>{c.jb("Clip",t,{min:e,max:n})},851748:t=>{c.jb("Clip",t,void 0)},851800:(t,e)=>{c.jb("Elu",t,{alpha:e})},851858:t=>{c.jb("Relu",t,void 0)},851910:(t,e)=>{c.jb("LeakyRelu",t,{alpha:e})},851974:(t,e)=>{c.jb("ThresholdedRelu",t,{alpha:e})},852044:(t,e)=>{c.jb("Cast",t,{to:e})},852102:t=>{c.jb("Add",t,void 0)},852153:t=>{c.jb("Sub",t,void 0)},852204:t=>{c.jb("Mul",t,void 0)},852255:t=>{c.jb("Div",t,void 0)},852306:t=>{c.jb("Pow",t,void 0)},852357:t=>{c.jb("Equal",t,void 0)},852410:t=>{c.jb("Greater",t,void 0)},852465:t=>{c.jb("GreaterOrEqual",t,void 0)},852527:t=>{c.jb("Less",t,void 0)},852579:t=>{c.jb("LessOrEqual",t,void 0)},852638:(t,e,n,i,r)=>{c.jb("ReduceMean",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},852797:(t,e,n,i,r)=>{c.jb("ReduceMax",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},852955:(t,e,n,i,r)=>{c.jb("ReduceMin",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853113:(t,e,n,i,r)=>{c.jb("ReduceProd",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853272:(t,e,n,i,r)=>{c.jb("ReduceSum",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853430:(t,e,n,i,r)=>{c.jb("ReduceL1",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853587:(t,e,n,i,r)=>{c.jb("ReduceL2",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853744:(t,e,n,i,r)=>{c.jb("ReduceLogSum",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},853905:(t,e,n,i,r)=>{c.jb("ReduceSumSquare",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},854069:(t,e,n,i,r)=>{c.jb("ReduceLogSumExp",t,{keepDims:!!e,noopWithEmptyAxes:!!n,axes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},854233:t=>{c.jb("Where",t,void 0)},854286:(t,e,n)=>{c.jb("Transpose",t,{perm:e?Array.from(s().subarray(e>>>0,n>>>0)):[]})},854394:(t,e,n,i)=>{c.jb("DepthToSpace",t,{blocksize:e,mode:Mt(n),format:i?"NHWC":"NCHW"})},854527:(t,e,n,i)=>{c.jb("DepthToSpace",t,{blocksize:e,mode:Mt(n),format:i?"NHWC":"NCHW"})},854660:(t,n,i,r,o,a,A,u,h,l,f,d,g,v,I)=>{c.jb("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:n,dilations:[i],group:r,kernelShape:[o],pads:[a,A],strides:[u],wIsConst:()=>!!e()[l>>>0],outputPadding:f?Array.from(s().subarray(f>>>0,d>>>0)):[],outputShape:g?Array.from(s().subarray(g>>>0,v>>>0)):[],activation:Mt(I)})},855061:(t,n,i,r,o,a,A,u,h,l,f,d,g,v)=>{c.jb("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:n,dilations:Array.from(s().subarray(i>>>0,2+(i>>>0)>>>0)),group:r,kernelShape:Array.from(s().subarray(o>>>0,2+(o>>>0)>>>0)),pads:Array.from(s().subarray(a>>>0,4+(a>>>0)>>>0)),strides:Array.from(s().subarray(A>>>0,2+(A>>>0)>>>0)),wIsConst:()=>!!e()[h>>>0],outputPadding:l?Array.from(s().subarray(l>>>0,f>>>0)):[],outputShape:d?Array.from(s().subarray(d>>>0,g>>>0)):[],activation:Mt(v)})},855626:(t,n,i,r,o,a,A,u,h,l,f,d,g,v,I)=>{c.jb("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:n,dilations:[i],group:r,kernelShape:[o],pads:[a,A],strides:[u],wIsConst:()=>!!e()[l>>>0],outputPadding:f?Array.from(s().subarray(f>>>0,d>>>0)):[],outputShape:g?Array.from(s().subarray(g>>>0,v>>>0)):[],activation:Mt(I)})},856027:(t,n,i,r,o,a,A,u,h,l,f,d,g,v)=>{c.jb("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:n,dilations:Array.from(s().subarray(i>>>0,2+(i>>>0)>>>0)),group:r,kernelShape:Array.from(s().subarray(o>>>0,2+(o>>>0)>>>0)),pads:Array.from(s().subarray(a>>>0,4+(a>>>0)>>>0)),strides:Array.from(s().subarray(A>>>0,2+(A>>>0)>>>0)),wIsConst:()=>!!e()[h>>>0],outputPadding:l?Array.from(s().subarray(l>>>0,f>>>0)):[],outputShape:d?Array.from(s().subarray(d>>>0,g>>>0)):[],activation:Mt(v)})},856592:(t,e)=>{c.jb("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},856683:(t,e,n,i,r,o,s,a,A,u,h,l,f,d,g,v)=>{c.jb("AveragePool",t,{format:v?"NHWC":"NCHW",auto_pad:e,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:[o,s],kernel_shape:[a,A],pads:[u,h,l,f],strides:[d,g]})},856967:(t,e)=>{c.jb("GlobalAveragePool",t,{format:e?"NHWC":"NCHW"})},857058:(t,e,n,i,r,o,s,a,A,u,h,l,f,d,g,v)=>{c.jb("AveragePool",t,{format:v?"NHWC":"NCHW",auto_pad:e,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:[o,s],kernel_shape:[a,A],pads:[u,h,l,f],strides:[d,g]})},857342:(t,e)=>{c.jb("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},857429:(t,e,n,i,r,o,s,a,A,u,h,l,f,d,g,v)=>{c.jb("MaxPool",t,{format:v?"NHWC":"NCHW",auto_pad:e,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:[o,s],kernel_shape:[a,A],pads:[u,h,l,f],strides:[d,g]})},857709:(t,e)=>{c.jb("GlobalMaxPool",t,{format:e?"NHWC":"NCHW"})},857796:(t,e,n,i,r,o,s,a,A,u,h,l,f,d,g,v)=>{c.jb("MaxPool",t,{format:v?"NHWC":"NCHW",auto_pad:e,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:[o,s],kernel_shape:[a,A],pads:[u,h,l,f],strides:[d,g]})},858076:(t,e,n,i,r)=>{c.jb("Gemm",t,{alpha:e,beta:n,transA:i,transB:r})},858180:t=>{c.jb("MatMul",t,void 0)},858234:(t,e,n,i)=>{c.jb("ArgMax",t,{keepDims:!!e,selectLastIndex:!!n,axis:i})},858342:(t,e,n,i)=>{c.jb("ArgMin",t,{keepDims:!!e,selectLastIndex:!!n,axis:i})},858450:(t,e)=>{c.jb("Softmax",t,{axis:e})},858513:(t,e)=>{c.jb("Concat",t,{axis:e})},858573:(t,e,n,i,r)=>{c.jb("Split",t,{axis:e,numOutputs:n,splitSizes:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},858713:t=>{c.jb("Expand",t,void 0)},858767:(t,e)=>{c.jb("Gather",t,{axis:Number(e)})},858838:(t,e)=>{c.jb("GatherElements",t,{axis:Number(e)})},858917:(t,e,n,i,r,o,a,A,u,h,l)=>{c.jb("Resize",t,{antialias:e,axes:n?Array.from(s().subarray(n>>>0,i>>>0)):[],coordinateTransformMode:Mt(r),cubicCoeffA:o,excludeOutside:a,extrapolationValue:A,keepAspectRatioPolicy:Mt(u),mode:Mt(h),nearestMode:Mt(l)})},859263:(t,e,n,i,r,o,a)=>{c.jb("Slice",t,{starts:e?Array.from(s().subarray(e>>>0,n>>>0)):[],ends:i?Array.from(s().subarray(i>>>0,r>>>0)):[],axes:o?Array.from(s().subarray(o>>>0,a>>>0)):[]})},859479:t=>{c.jb("Tile",t,void 0)},859531:(t,e,n)=>{c.jb("InstanceNormalization",t,{epsilon:e,format:n?"NHWC":"NCHW"})},859645:(t,e,n)=>{c.jb("InstanceNormalization",t,{epsilon:e,format:n?"NHWC":"NCHW"})},859759:t=>{c.jb("Range",t,void 0)},859812:(t,e)=>{c.jb("Einsum",t,{equation:Mt(e)})},859893:(t,e,n,i,r)=>{c.jb("Pad",t,{mode:e,value:n,pads:i?Array.from(s().subarray(i>>>0,r>>>0)):[]})},860020:(t,e,n,i,r,o)=>{c.jb("BatchNormalization",t,{epsilon:e,momentum:n,spatial:!!r,trainingMode:!!i,format:o?"NHWC":"NCHW"})},860189:(t,e,n,i,r,o)=>{c.jb("BatchNormalization",t,{epsilon:e,momentum:n,spatial:!!r,trainingMode:!!i,format:o?"NHWC":"NCHW"})},860358:(t,e,n)=>{c.jb("CumSum",t,{exclusive:Number(e),reverse:Number(n)})},860455:(t,e,n,i,r,o,a,A,u)=>{c.jb("Attention",t,{numHeads:e,isUnidirectional:n,maskFilterValue:i,scale:r,doRotary:o,qkvHiddenSizes:a?Array.from(s().subarray(Number(A)>>>0,Number(A)+a>>>0)):[],pastPresentShareBuffer:!!u})},860727:t=>{c.jb("BiasAdd",t,void 0)},860782:t=>{c.jb("BiasSplitGelu",t,void 0)},860843:t=>{c.jb("FastGelu",t,void 0)},860899:(t,n,i,r,o,a,u,h,l,f,d,g,v,I,p,y)=>{c.jb("Conv",t,{format:g?"NHWC":"NCHW",auto_pad:n,dilations:i?Array.from(s().subarray(i>>>0,r>>>0)):[],group:o,kernel_shape:a?Array.from(s().subarray(a>>>0,u>>>0)):[],pads:h?Array.from(s().subarray(h>>>0,l>>>0)):[],strides:f?Array.from(s().subarray(f>>>0,d>>>0)):[],w_is_const:()=>!!e()[v>>>0],activation:Mt(I),activation_params:p?Array.from(A().subarray(p>>>0,y>>>0)):[]})},861395:t=>{c.jb("Gelu",t,void 0)},861447:(t,e,n,i)=>{c.jb("GroupQueryAttention",t,{numHeads:e,kvNumHeads:n,scale:i})},861560:(t,e,n,i)=>{c.jb("LayerNormalization",t,{axis:e,epsilon:n,simplified:!!i})},861671:(t,e,n,i)=>{c.jb("LayerNormalization",t,{axis:e,epsilon:n,simplified:!!i})},861782:(t,e,n,i,r,o)=>{c.jb("MatMulNBits",t,{k:e,n:n,accuracyLevel:i,bits:r,blockSize:o})},861909:(t,e,n,i,r,o)=>{c.jb("MultiHeadAttention",t,{numHeads:e,isUnidirectional:n,maskFilterValue:i,scale:r,doRotary:o})},862068:(t,e)=>{c.jb("QuickGelu",t,{alpha:e})},862132:(t,e,n,i,r)=>{c.jb("RotaryEmbedding",t,{interleaved:!!e,numHeads:n,rotaryEmbeddingDim:i,scale:r})},862271:(t,e,n)=>{c.jb("SkipLayerNormalization",t,{epsilon:e,simplified:!!n})},862373:t=>{c.Yb(t)},862407:(t,e)=>c.$b(t,e,c.Eb.bc,c.Eb.errors),862519:(t,e,n)=>{c.jb("SkipLayerNormalization",t,{epsilon:e,simplified:!!n})}};function rt(t,e,n){return We((async()=>{await c.Wb(t,e,n)}))}function ot(){return typeof wasmOffsetConverter<"u"}function st(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}var at=t=>{t.terminate(),t.onmessage=()=>{}},At=t=>{0==dt.length&&(Ct(),wt(dt[0]));var e=dt.pop();if(!e)return 6;gt.push(e),It[t.Ab]=e,e.Ab=t.Ab;var n={cmd:"run",start_routine:t.cc,arg:t.Pb,pthread_ptr:t.Ab};return e.postMessage(n,t.ic),0},ut=0,ht=(t,e,...n)=>{for(var i=2*n.length,r=_i(),o=bi(8*i),s=o>>>3,a=0;a<n.length;a++){var A=n[a];"bigint"==typeof A?(U[s+2*a]=1n,U[s+2*a+1]=A):(U[s+2*a]=0n,u()[s+2*a+1>>>0]=A)}return t=Ci(t,0,i,o,e),ki(r),t};function lt(t){if(v)return ht(0,1,t);if(S=t,!(0<ut)){for(var e of gt)at(e);for(e of dt)at(e);dt=[],gt=[],It=[],q=!0}B(t,new st(t))}function ct(t){if(v)return ht(1,0,t);ft(t)}var ft=t=>{if(S=t,v)throw ct(t),"unwind";lt(t)},dt=[],gt=[],vt=[],It={},pt=t=>{var e=t.Ab;delete It[e],dt.push(t),gt.splice(gt.indexOf(t),1),t.Ab=0,Bi(e)};function yt(){vt.forEach((t=>t()))}var wt=t=>new Promise((e=>{t.onmessage=n=>{var i=(n=n.data).cmd;if(n.targetThread&&n.targetThread!=vi()){var r=It[n.targetThread];r?r.postMessage(n,n.transferList):k(`Internal error! Worker sent a message "${i}" to target pthread ${n.targetThread}, but that thread no longer exists!`)}else"checkMailbox"===i?Me():"spawnThread"===i?At(n):"cleanupThread"===i?pt(It[n.thread]):"killThread"===i?(n=n.thread,i=It[n],delete It[n],at(i),Bi(n),gt.splice(gt.indexOf(i),1),i.Ab=0):"cancelThread"===i?It[n.thread].postMessage({cmd:"cancel"}):"loaded"===i?(t.loaded=!0,e(t)):"alert"===i?alert(`Thread ${n.threadId}: ${n.text}`):"setimmediate"===n.target?t.postMessage(n):"callHandler"===i?c[n.handler](...n.args):i&&k(`worker sent an unknown command ${i}`)},t.onerror=t=>{throw k(`worker sent an error! ${t.filename}:${t.lineno}: ${t.message}`),t};var n,i=[];for(n of[])c.hasOwnProperty(n)&&i.push(n);t.postMessage({cmd:"load",handlers:i,wasmMemory:x,wasmModule:D})}));function Ct(){var t=new Worker(new URL(n&&n.src||new URL("yunjing-for-cesium.js",document.baseURI).href),{type:"module",workerData:"em-pthread",name:"em-pthread"});dt.push(t)}var Bt=t=>{for(;0<t.length;)t.shift()(c)},mt=()=>{var t=vi(),e=a()[t+52>>>2>>>0];t=a()[t+56>>>2>>>0],Qi(e,e-t),ki(e)},Qt=(t,e)=>{ut=0,t=xi(t,e),0<ut?S=t:Ei(t)};class kt{constructor(t){this.Ib=t-24}}function bt(t,e,n){var i=new kt(t>>>=0);throw e>>>=0,n>>>=0,a()[i.Ib+16>>>2>>>0]=0,a()[i.Ib+4>>>2>>>0]=e,a()[i.Ib+8>>>2>>>0]=n,t}function _t(t,e,n,i){return v?ht(2,1,t,e,n,i):xt(t,e,n,i)}function xt(t,e,n,i){if(t>>>=0,e>>>=0,n>>>=0,i>>>=0,void 0===I)return k("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var r=[];return v&&0===r.length?_t(t,e,n,i):(t={cc:n,Ab:t,Pb:i,ic:r},v?(t.Lb="spawnThread",postMessage(t,r),0):At(t))}var Dt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,St=(t,e,n)=>{var i=(e>>>=0)+n;for(n=e;t[n]&&!(n>=i);)++n;if(16<n-e&&t.buffer&&Dt)return Dt.decode(t.buffer instanceof I?t.slice(e,n):t.subarray(e,n));for(i="";e<n;){var r=t[e++];if(128&r){var o=63&t[e++];if(192==(224&r))i+=String.fromCharCode((31&r)<<6|o);else{var s=63&t[e++];65536>(r=224==(240&r)?(15&r)<<12|o<<6|s:(7&r)<<18|o<<12|s<<6|63&t[e++])?i+=String.fromCharCode(r):(r-=65536,i+=String.fromCharCode(55296|r>>10,56320|1023&r))}}else i+=String.fromCharCode(r)}return i},Mt=(t,e)=>(t>>>=0)?St(i(),t,e):"";function $t(t,e,n){return v?ht(3,1,t,e,n):0}function Rt(t,e){if(v)return ht(4,1,t,e)}var Ft=t=>{for(var e=0,n=0;n<t.length;++n){var i=t.charCodeAt(n);127>=i?e++:2047>=i?e+=2:55296<=i&&57343>=i?(e+=4,++n):e+=3}return e},Gt=(t,e,n,i)=>{if(!(0<i))return 0;var r=n>>>=0;i=n+i-1;for(var o=0;o<t.length;++o){var s=t.charCodeAt(o);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&t.charCodeAt(++o)),127>=s){if(n>=i)break;e[n++>>>0]=s}else{if(2047>=s){if(n+1>=i)break;e[n++>>>0]=192|s>>6}else{if(65535>=s){if(n+2>=i)break;e[n++>>>0]=224|s>>12}else{if(n+3>=i)break;e[n++>>>0]=240|s>>18,e[n++>>>0]=128|s>>12&63}e[n++>>>0]=128|s>>6&63}e[n++>>>0]=128|63&s}}return e[n>>>0]=0,n-r},Lt=(t,e,n)=>Gt(t,i(),e,n);function Nt(t,e){if(v)return ht(5,1,t,e)}function Ut(t,e,n){if(v)return ht(6,1,t,e,n)}function Tt(t,e,n){return v?ht(7,1,t,e,n):0}function Pt(t,e){if(v)return ht(8,1,t,e)}function qt(t,e,n){if(v)return ht(9,1,t,e,n)}function Ot(t,e,n,i){if(v)return ht(10,1,t,e,n,i)}function Ht(t,e,n,i){if(v)return ht(11,1,t,e,n,i)}function zt(t,e,n,i){if(v)return ht(12,1,t,e,n,i)}function Kt(t){if(v)return ht(13,1,t)}function Vt(t,e){if(v)return ht(14,1,t,e)}function Jt(t,e,n){if(v)return ht(15,1,t,e,n)}var Yt,jt,Wt=()=>{j("")},Xt=t=>{for(var e="";i()[t>>>0];)e+=Yt[i()[t++>>>0]];return e},Zt={},te={};function ee(t,e,n={}){if(!("argPackAdvance"in e))throw new TypeError("registerType registeredInstance requires argPackAdvance");return function(t,e,n={}){var i=e.name;if(!t)throw new jt(`type "${i}" must have a positive integer typeid pointer`);if(te.hasOwnProperty(t)){if(n.Rb)return;throw new jt(`Cannot register type '${i}' twice`)}te[t]=e,Zt.hasOwnProperty(t)&&(e=Zt[t],delete Zt[t],e.forEach((t=>t())))}(t,e,n)}var ne=(t,n,A)=>{switch(n){case 1:return A?t=>e()[t>>>0]:t=>i()[t>>>0];case 2:return A?t=>r()[t>>>1>>>0]:t=>o()[t>>>1>>>0];case 4:return A?t=>s()[t>>>2>>>0]:t=>a()[t>>>2>>>0];case 8:return A?t=>U[t>>>3]:t=>T[t>>>3];default:throw new TypeError(`invalid integer width (${n}): ${t}`)}};function ie(t,e,n){n>>>=0,ee(t>>>=0,{name:e=Xt(e>>>0),fromWireType:t=>t,toWireType:function(t,e){if("bigint"!=typeof e&&"number"!=typeof e)throw e=null===e?"null":"object"==(t=typeof e)||"array"===t||"function"===t?e.toString():""+e,new TypeError(`Cannot convert "${e}" to ${this.name}`);return"number"==typeof e&&(e=BigInt(e)),e},argPackAdvance:re,readValueFromPointer:ne(e,n,-1==e.indexOf("u")),Db:null})}var re=8;function oe(t,e,n,r){ee(t>>>=0,{name:e=Xt(e>>>0),fromWireType:function(t){return!!t},toWireType:function(t,e){return e?n:r},argPackAdvance:re,readValueFromPointer:function(t){return this.fromWireType(i()[t>>>0])},Db:null})}var se=[],ae=[];function Ae(t){9<(t>>>=0)&&0==--ae[t+1]&&(ae[t]=void 0,se.push(t))}var ue=t=>{if(!t)throw new jt("Cannot use deleted val. handle = "+t);return ae[t]},he=t=>{switch(t){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let e=se.pop()||ae.length;return ae[e]=t,ae[e+1]=1,e}};function le(t){return this.fromWireType(a()[t>>>2>>>0])}var ce={name:"emscripten::val",fromWireType:t=>{var e=ue(t);return Ae(t),e},toWireType:(t,e)=>he(e),argPackAdvance:re,readValueFromPointer:le,Db:null};function fe(t){return ee(t>>>0,ce)}var de=(t,e)=>{switch(e){case 4:return function(t){return this.fromWireType(A()[t>>>2>>>0])};case 8:return function(t){return this.fromWireType(u()[t>>>3>>>0])};default:throw new TypeError(`invalid float width (${e}): ${t}`)}};function ge(t,e,n){n>>>=0,ee(t>>>=0,{name:e=Xt(e>>>0),fromWireType:t=>t,toWireType:(t,e)=>e,argPackAdvance:re,readValueFromPointer:de(e,n),Db:null})}function ve(t,e,n,i,r){if(t>>>=0,n>>>=0,e=Xt(e>>>0),-1===r&&(r=4294967295),r=t=>t,0===i){var o=32-8*n;r=t=>t<<o>>>o}var s=e.includes("unsigned")?function(t,e){return e>>>0}:function(t,e){return e};ee(t,{name:e,fromWireType:r,toWireType:s,argPackAdvance:re,readValueFromPointer:ne(e,n,0!==i),Db:null})}function Ie(t,n,i){function r(t){var n=a()[t>>>2>>>0];return t=a()[t+4>>>2>>>0],new o(e().buffer,t,n)}var o=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][n];ee(t>>>=0,{name:i=Xt(i>>>0),fromWireType:r,argPackAdvance:re,readValueFromPointer:r},{Rb:!0})}function pe(t,e){t>>>=0;var n="std::string"===(e=Xt(e>>>0));ee(t,{name:e,fromWireType:function(t){var e=a()[t>>>2>>>0],r=t+4;if(n)for(var o=r,s=0;s<=e;++s){var A=r+s;if(s==e||0==i()[A>>>0]){if(o=Mt(o,A-o),void 0===u)var u=o;else u+=String.fromCharCode(0),u+=o;o=A+1}}else{for(u=Array(e),s=0;s<e;++s)u[s]=String.fromCharCode(i()[r+s>>>0]);u=u.join("")}return pi(t),u},toWireType:function(t,e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var r="string"==typeof e;if(!(r||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array))throw new jt("Cannot pass non-string to std::string");var o=n&&r?Ft(e):e.length,s=Ii(4+o+1),A=s+4;if(a()[s>>>2>>>0]=o,n&&r)Lt(e,A,o+1);else if(r)for(r=0;r<o;++r){var u=e.charCodeAt(r);if(255<u)throw pi(A),new jt("String has UTF-16 code units that do not fit in 8 bits");i()[A+r>>>0]=u}else for(r=0;r<o;++r)i()[A+r>>>0]=e[r];return null!==t&&t.push(pi,s),s},argPackAdvance:re,readValueFromPointer:le,Db(t){pi(t)}})}var ye=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,we=(t,e)=>{for(var n=t>>1,s=n+e/2;!(n>=s)&&o()[n>>>0];)++n;if(32<(n<<=1)-t&&ye)return ye.decode(i().slice(t,n));for(n="",s=0;!(s>=e/2);++s){var a=r()[t+2*s>>>1>>>0];if(0==a)break;n+=String.fromCharCode(a)}return n},Ce=(t,e,n)=>{if(n??=2147483647,2>n)return 0;var i=e;n=(n-=2)<2*t.length?n/2:t.length;for(var o=0;o<n;++o){var s=t.charCodeAt(o);r()[e>>>1>>>0]=s,e+=2}return r()[e>>>1>>>0]=0,e-i},Be=t=>2*t.length,Ee=(t,e)=>{for(var n=0,i="";!(n>=e/4);){var r=s()[t+4*n>>>2>>>0];if(0==r)break;++n,65536<=r?(r-=65536,i+=String.fromCharCode(55296|r>>10,56320|1023&r)):i+=String.fromCharCode(r)}return i},me=(t,e,n)=>{if(e>>>=0,n??=2147483647,4>n)return 0;var i=e;n=i+n-4;for(var r=0;r<t.length;++r){var o=t.charCodeAt(r);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++r)),s()[e>>>2>>>0]=o,(e+=4)+4>n)break}return s()[e>>>2>>>0]=0,e-i},Qe=t=>{for(var e=0,n=0;n<t.length;++n){var i=t.charCodeAt(n);55296<=i&&57343>=i&&++n,e+=4}return e};function ke(t,e,n){if(t>>>=0,e>>>=0,n=Xt(n>>>=0),2===e)var i=we,r=Ce,s=Be,A=t=>o()[t>>>1>>>0];else 4===e&&(i=Ee,r=me,s=Qe,A=t=>a()[t>>>2>>>0]);ee(t,{name:n,fromWireType:t=>{for(var n,r=a()[t>>>2>>>0],o=t+4,s=0;s<=r;++s){var u=t+4+s*e;s!=r&&0!=A(u)||(o=i(o,u-o),void 0===n?n=o:(n+=String.fromCharCode(0),n+=o),o=u+e)}return pi(t),n},toWireType:(t,i)=>{if("string"!=typeof i)throw new jt(`Cannot pass non-string to C++ string type ${n}`);var o=s(i),A=Ii(4+o+e);return a()[A>>>2>>>0]=o/e,r(i,A+4,o+e),null!==t&&t.push(pi,A),A},argPackAdvance:re,readValueFromPointer:le,Db(t){pi(t)}})}function be(t,e){ee(t>>>=0,{Sb:!0,name:e=Xt(e>>>0),argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}})}var _e=()=>1;function xe(t){yi(t>>>0,!g,1,!d,131072,!1),yt()}var De=t=>{if(!q)try{if(t(),!(0<ut))try{v?Ei(S):ft(S)}catch(t){t instanceof st||"unwind"==t||B(1,t)}}catch(t){t instanceof st||"unwind"==t||B(1,t)}};function Se(t){t>>>=0,"function"==typeof Atomics.jc&&(Atomics.jc(s(),t>>>2,t).value.then(Me),t+=128,Atomics.store(s(),t>>>2,1))}var Me=()=>{var t=vi();t&&(Se(t),De(mi))};function $e(t,e){(t>>>=0)==e>>>0?setTimeout(Me):v?postMessage({targetThread:t,cmd:"checkMailbox"}):(t=It[t])&&t.postMessage({cmd:"checkMailbox"})}var Re=[];function Fe(t,e,n,i,r){for(e>>>=0,i/=2,Re.length=i,n=r>>>0>>>3,r=0;r<i;r++)Re[r]=U[n+2*r]?U[n+2*r+1]:u()[n+2*r+1>>>0];return(e?it[e]:li[t])(...Re)}function Ge(t){t>>>=0,v?postMessage({cmd:"cleanupThread",thread:t}):pt(It[t])}function Le(t){}var Ne=(t,e)=>{var n=te[t];if(void 0===n)throw t=fi(t),n=Xt(t),pi(t),new jt(`${e} has unknown type ${n}`);return n},Ue=(t,e,n)=>{var i=[];return t=t.toWireType(i,n),i.length&&(a()[e>>>2>>>0]=he(i)),t};function Te(t,e,n){return e>>>=0,n>>>=0,t=ue(t>>>0),e=Ne(e,"emval::as"),Ue(e,n,t)}var Pe=t=>{try{t()}catch(t){j(t)}},qe=0,Oe=null,He=0,ze=[],Ke={},Ve={},Je=0,Ye=null,je=[];function We(t){return function(e){if(!q){if(0===qe){var n=!1,i=!1;t().then(((t=0)=>{if(!q&&(He=t,n=!0,i)){qe=2,Pe((()=>Mi(Oe))),typeof Browser<"u"&&Browser.Jb.Qb&&Browser.Jb.resume(),t=!1;try{var e=(a=s()[Oe+8>>>2>>>0],a=ci[Ve[a]],--ut,a())}catch(a){e=a,t=!0}var r=!1;if(!Oe){var o=Ye;o&&(Ye=null,(t?o.reject:o.resolve)(e),r=!0)}if(t&&!r)throw e}var a})),i=!0,n||(qe=1,Oe=function(){var t=Ii(65548),e=t+12;a()[t>>>2>>>0]=e,a()[t+4>>>2>>>0]=e+65536,e=ze[0];var n=Ke[e];return void 0===n&&(n=Je++,Ke[e]=n,Ve[n]=e),e=n,s()[t+8>>>2>>>0]=e,t}(),typeof Browser<"u"&&Browser.Jb.Qb&&Browser.Jb.pause(),Pe((()=>Di(Oe))))}else 2===qe?(qe=0,Pe($i),pi(Oe),Oe=null,je.forEach(De)):j(`invalid state: ${qe}`);return He}}()}function Xe(t){return t>>>=0,We((()=>(t=ue(t)).then(he)))}var Ze=[];function tn(t,e,n,i){return n>>>=0,i>>>=0,(t=Ze[t>>>0])(null,e=ue(e>>>0),n,i)}var en={},nn=t=>{var e=en[t];return void 0===e?Xt(t):e};function rn(t,e,n,i,r){return n>>>=0,i>>>=0,r>>>=0,(t=Ze[t>>>0])(e=ue(e>>>0),e[n=nn(n)],i,r)}var on=()=>"object"==typeof globalThis?globalThis:Function("","return this")();function sn(t){return 0==(t>>>=0)?he(on()):(t=nn(t),he(on()[t]))}var an=t=>{var e=Ze.length;return Ze.push(t),e},An=(t,e)=>{for(var n=Array(t),i=0;i<t;++i)n[i]=Ne(a()[e+4*i>>>2>>>0],"parameter "+i);return n},un=(t,e)=>Object.defineProperty(e,"name",{value:t});function hn(t,e,n){var i=(e=An(t,e>>>0)).shift();t--;var r="return function (obj, func, destructorsRef, args) {\n",o=0,s=[];0===n&&s.push("obj");for(var a=["retType"],A=[i],u=0;u<t;++u)s.push("arg"+u),a.push("argType"+u),A.push(e[u]),r+=`  var arg${u} = argType${u}.readValueFromPointer(args${o?"+"+o:""});\n`,o+=e[u].argPackAdvance;return r+=`  var rv = ${1===n?"new func":"func.call"}(${s.join(", ")});\n`,i.Sb||(a.push("emval_returnValue"),A.push(Ue),r+="  return emval_returnValue(retType, destructorsRef, rv);\n"),a.push(r+"};\n"),t=function(t){var e=Function;if(!(e instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof e} which is not a function`);var n=un(e.name||"unknownFunctionName",(function(){}));return n.prototype=e.prototype,n=new n,(t=e.apply(n,t))instanceof Object?t:n}(a)(...A),n=`methodCaller<(${e.map((t=>t.name)).join(", ")}) => ${i.name}>`,an(un(n,t))}function ln(t){return t=nn(t>>>0),he(c[t])}function cn(t,e){return e>>>=0,t=ue(t>>>0),e=ue(e),he(t[e])}function fn(t){9<(t>>>=0)&&(ae[t+1]+=1)}function dn(){return he([])}function gn(t){t=ue(t>>>0);for(var e=Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return he(e)}function vn(t){return he(nn(t>>>0))}function In(){return he({})}function pn(t){for(var e=ue(t>>>=0);e.length;){var n=e.pop();e.pop()(n)}Ae(t)}function yn(t,e,n){e>>>=0,n>>>=0,t=ue(t>>>0),e=ue(e),n=ue(n),t[e]=n}function wn(t,e){return e>>>=0,t=(t=Ne(t>>>0,"_emval_take_value")).readValueFromPointer(e),he(t)}function Cn(t,e){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),e>>>=0,t=new Date(1e3*t),s()[e>>>2>>>0]=t.getUTCSeconds(),s()[e+4>>>2>>>0]=t.getUTCMinutes(),s()[e+8>>>2>>>0]=t.getUTCHours(),s()[e+12>>>2>>>0]=t.getUTCDate(),s()[e+16>>>2>>>0]=t.getUTCMonth(),s()[e+20>>>2>>>0]=t.getUTCFullYear()-1900,s()[e+24>>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,s()[e+28>>>2>>>0]=t}var Bn=t=>t%4==0&&(t%100!=0||t%400==0),En=[0,31,60,91,121,152,182,213,244,274,305,335],mn=[0,31,59,90,120,151,181,212,243,273,304,334];function Qn(t,e){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),e>>>=0,t=new Date(1e3*t),s()[e>>>2>>>0]=t.getSeconds(),s()[e+4>>>2>>>0]=t.getMinutes(),s()[e+8>>>2>>>0]=t.getHours(),s()[e+12>>>2>>>0]=t.getDate(),s()[e+16>>>2>>>0]=t.getMonth(),s()[e+20>>>2>>>0]=t.getFullYear()-1900,s()[e+24>>>2>>>0]=t.getDay();var n=(Bn(t.getFullYear())?En:mn)[t.getMonth()]+t.getDate()-1|0;s()[e+28>>>2>>>0]=n,s()[e+36>>>2>>>0]=-60*t.getTimezoneOffset(),n=new Date(t.getFullYear(),6,1).getTimezoneOffset();var i=new Date(t.getFullYear(),0,1).getTimezoneOffset();t=0|(n!=i&&t.getTimezoneOffset()==Math.min(i,n)),s()[e+32>>>2>>>0]=t}function kn(t){t>>>=0;var e=new Date(s()[t+20>>>2>>>0]+1900,s()[t+16>>>2>>>0],s()[t+12>>>2>>>0],s()[t+8>>>2>>>0],s()[t+4>>>2>>>0],s()[t>>>2>>>0],0),n=s()[t+32>>>2>>>0],i=e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=new Date(e.getFullYear(),0,1).getTimezoneOffset(),a=Math.min(o,r);return 0>n?s()[t+32>>>2>>>0]=+(r!=o&&a==i):0<n!=(a==i)&&(r=Math.max(o,r),e.setTime(e.getTime()+6e4*((0<n?a:r)-i))),s()[t+24>>>2>>>0]=e.getDay(),n=(Bn(e.getFullYear())?En:mn)[e.getMonth()]+e.getDate()-1|0,s()[t+28>>>2>>>0]=n,s()[t>>>2>>>0]=e.getSeconds(),s()[t+4>>>2>>>0]=e.getMinutes(),s()[t+8>>>2>>>0]=e.getHours(),s()[t+12>>>2>>>0]=e.getDate(),s()[t+16>>>2>>>0]=e.getMonth(),s()[t+20>>>2>>>0]=e.getYear(),t=e.getTime(),BigInt(isNaN(t)?-1:t/1e3)}function bn(t,e,n,i,r,o,s){return v?ht(16,1,t,e,n,i,r,o,s):-52}function _n(t,e,n,i,r,o){if(v)return ht(17,1,t,e,n,i,r,o)}function xn(t,e,n,i){t>>>=0,e>>>=0,n>>>=0,i>>>=0;var r=(new Date).getFullYear(),o=new Date(r,0,1),A=new Date(r,6,1);r=o.getTimezoneOffset();var u=A.getTimezoneOffset(),h=Math.max(r,u);a()[t>>>2>>>0]=60*h,s()[e>>>2>>>0]=+(r!=u),o=(t=t=>t.toLocaleTimeString(void 0,{hour12:!1,timeZoneName:"short"}).split(" ")[1])(o),A=t(A),u<r?(Lt(o,n,17),Lt(A,i,17)):(Lt(o,i,17),Lt(A,n,17))}var Dn=[],Sn=(t,e)=>{Dn.length=0;for(var n;n=i()[t++>>>0];){var r=105!=n;e+=(r&=112!=n)&&e%8?4:0,Dn.push(112==n?a()[e>>>2>>>0]:106==n?U[e>>>3]:105==n?s()[e>>>2>>>0]:u()[e>>>3>>>0]),e+=r?8:4}return Dn};function Mn(t,e,n){return t>>>=0,e=Sn(e>>>0,n>>>0),it[t](...e)}function $n(t,e,n){return t>>>=0,e=Sn(e>>>0,n>>>0),it[t](...e)}var Rn=()=>{},Fn=()=>Date.now();function Gn(t,e){return k(Mt(t>>>0,e>>>0))}var Ln,Nn=()=>{throw ut+=1,"unwind"};function Un(){return 4294901760}Ln=()=>performance.timeOrigin+performance.now();var Tn=()=>navigator.hardwareConcurrency;function Pn(){return j("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function qn(t){t>>>=0;var e=i().length;if(t<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var o=Math;r=Math.max(t,r);t:{o=(o.min.call(o,4294901760,r+(65536-r%65536)%65536)-x.buffer.byteLength+65535)/65536;try{x.grow(o),O();var s=1;break t}catch{}s=void 0}if(s)return!0}return!1}var On=()=>(j("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Hn={},zn=t=>{t.forEach((t=>{On()}))};function Kn(){var t=Error().stack.toString().split("\n");return"Error"==t[0]&&t.shift(),zn(t),Hn.Ob=On(),Hn.ac=t,Hn.Ob}function Vn(t,e,n){if(t>>>=0,e>>>=0,Hn.Ob==t)var i=Hn.ac;else"Error"==(i=Error().stack.toString().split("\n"))[0]&&i.shift(),zn(i);for(var r=3;i[r]&&On()!=t;)++r;for(t=0;t<n&&i[t+r];++t)s()[e+4*t>>>2>>>0]=On();return t}var Jn,Yn={},jn=()=>{if(!Jn){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",it:"./this.program"};for(t in Yn)void 0===Yn[t]?delete e[t]:e[t]=Yn[t];var n=[];for(t in e)n.push(`${t}=${e[t]}`);Jn=n}return Jn};function Wn(t,n){if(v)return ht(18,1,t,n);t>>>=0,n>>>=0;var i=0;return jn().forEach(((r,o)=>{var s=n+i;for(o=a()[t+4*o>>>2>>>0]=s,s=0;s<r.length;++s)e()[o++>>>0]=r.charCodeAt(s);e()[o>>>0]=0,i+=r.length+1})),0}function Xn(t,e){if(v)return ht(19,1,t,e);t>>>=0,e>>>=0;var n=jn();a()[t>>>2>>>0]=n.length;var i=0;return n.forEach((t=>i+=t.length+1)),a()[e>>>2>>>0]=i,0}function Zn(t){return v?ht(20,1,t):52}function ti(t,e,n,i){return v?ht(21,1,t,e,n,i):52}function ei(t,e,n,i){return v?ht(22,1,t,e,n,i):70}var ni=[null,[],[]];function ii(t,e,n,r){if(v)return ht(23,1,t,e,n,r);e>>>=0,n>>>=0,r>>>=0;for(var o=0,s=0;s<n;s++){var A=a()[e>>>2>>>0],u=a()[e+4>>>2>>>0];e+=8;for(var h=0;h<u;h++){var l=i()[A+h>>>0],c=ni[t];0===l||10===l?((1===t?Q:k)(St(c,0)),c.length=0):c.push(l)}o+=u}return a()[r>>>2>>>0]=o,0}var ri=[31,29,31,30,31,30,31,31,30,31,30,31],oi=[31,28,31,30,31,30,31,31,30,31,30,31],si=(t,n)=>{e().set(t,n>>>0)};function ai(t,e,n,i){function r(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function o(t,e){return r(t,e,"0")}function A(t,e){function n(t){return 0>t?-1:0<t?1:0}var i;return 0===(i=n(t.getFullYear()-e.getFullYear()))&&0===(i=n(t.getMonth()-e.getMonth()))&&(i=n(t.getDate()-e.getDate())),i}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function h(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),i=(Bn(t.getFullYear())?ri:oi)[n];if(!(e>i-t.getDate())){t.setDate(t.getDate()+e);break}e-=i-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=A(e,t)?0>=A(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}t>>>=0,e>>>=0,n>>>=0,i>>>=0;var l=a()[i+40>>>2>>>0];for(var c in i={fc:s()[i>>>2>>>0],ec:s()[i+4>>>2>>>0],Gb:s()[i+8>>>2>>>0],Kb:s()[i+12>>>2>>>0],Hb:s()[i+16>>>2>>>0],Cb:s()[i+20>>>2>>>0],ub:s()[i+24>>>2>>>0],Bb:s()[i+28>>>2>>>0],nc:s()[i+32>>>2>>>0],dc:s()[i+36>>>2>>>0],hc:l?Mt(l):""},n=Mt(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(c,"g"),l[c]);var f,d,g="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),v="January February March April May June July August September October November December".split(" ");for(c in l={"%a":t=>g[t.ub].substring(0,3),"%A":t=>g[t.ub],"%b":t=>v[t.Hb].substring(0,3),"%B":t=>v[t.Hb],"%C":t=>o((t.Cb+1900)/100|0,2),"%d":t=>o(t.Kb,2),"%e":t=>r(t.Kb,2," "),"%g":t=>h(t).toString().substring(2),"%G":h,"%H":t=>o(t.Gb,2),"%I":t=>(0==(t=t.Gb)?t=12:12<t&&(t-=12),o(t,2)),"%j":t=>{for(var e=0,n=0;n<=t.Hb-1;e+=(Bn(t.Cb+1900)?ri:oi)[n++]);return o(t.Kb+e,3)},"%m":t=>o(t.Hb+1,2),"%M":t=>o(t.ec,2),"%n":()=>"\n","%p":t=>0<=t.Gb&&12>t.Gb?"AM":"PM","%S":t=>o(t.fc,2),"%t":()=>"\t","%u":t=>t.ub||7,"%U":t=>o(Math.floor((t.Bb+7-t.ub)/7),2),"%V":t=>{var e=Math.floor((t.Bb+7-(t.ub+6)%7)/7);if(2>=(t.ub+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.ub+371-t.Bb)%7)||3==n&&Bn(t.Cb)||(e=1));else{e=52;var n=(t.ub+7-t.Bb-1)%7;(4==n||5==n&&Bn(t.Cb%400-1))&&e++}return o(e,2)},"%w":t=>t.ub,"%W":t=>o(Math.floor((t.Bb+7-(t.ub+6)%7)/7),2),"%y":t=>(t.Cb+1900).toString().substring(2),"%Y":t=>t.Cb+1900,"%z":t=>(0<=(t=t.dc)?"+":"-")+("0000"+((t=Math.abs(t)/60)/60*100+t%60)).slice(-4),"%Z":t=>t.hc,"%%":()=>"%"},n=n.replace(/%%/g,"\0\0"),l)n.includes(c)&&(n=n.replace(new RegExp(c,"g"),l[c](i)));return f=n=n.replace(/\0\0/g,"%"),d=Array(Ft(f)+1),Gt(f,d,0,d.length),(c=d).length>e?0:(si(c,t),c.length-1)}function Ai(t,e,n,i){return ai(t>>>0,e>>>0,n>>>0,i>>>0)}v||function(){for(var t=c.numThreads-1;t--;)Ct();H.unshift((()=>{var t;V++,t=()=>Y(),v?t():Promise.all(dt.map(wt)).then(t)}))}();for(var ui=Array(256),hi=0;256>hi;++hi)ui[hi]=String.fromCharCode(hi);Yt=ui,jt=c.BindingError=class extends Error{constructor(t){super(t),this.name="BindingError"}},c.InternalError=class extends Error{constructor(t){super(t),this.name="InternalError"}},ae.push(0,1,void 0,1,null,1,!0,1,!1,1),c.count_emval_handles=()=>ae.length/2-5-se.length;var li=[lt,ct,_t,$t,Rt,Nt,Ut,Tt,Pt,qt,Ot,Ht,zt,Kt,Vt,Jt,bn,_n,Wn,Xn,Zn,ti,ei,ii],ci=function(){function t(t,e){return ci=t.exports,ci=function(){var t=ci,e={};for(let[n,i]of Object.entries(t))e[n]="function"==typeof i?(...t)=>{ze.push(n);try{return i(...t)}finally{q||(ze.pop(),Oe&&1===qe&&0===ze.length&&(qe=0,ut+=1,Pe(Si),typeof Fibers<"u"&&Fibers.oc()))}}:i;return e}(),ci=function(){var t=ci,e=t=>e=>t(e)>>>0,n=t=>()=>t()>>>0;return(t=Object.assign({},t)).Ca=e(t.Ca),t.fb=n(t.fb),t.gb=e(t.gb),t.emscripten_main_runtime_thread_id=n(t.emscripten_main_runtime_thread_id),t.sb=e(t.sb),t.tb=n(t.tb),t}(),vt.push(ci.ib),z.unshift(ci.Ba),D=e,Y(),ci}var e=nt();if(V++,c.instantiateWasm)try{return c.instantiateWasm(e,t)}catch(t){k(`Module.instantiateWasm callback failed with error: ${t}`),l(t)}return W||=c.locateFile?X("ort-wasm-simd-threaded.jsep.wasm")?"ort-wasm-simd-threaded.jsep.wasm":c.locateFile?c.locateFile("ort-wasm-simd-threaded.jsep.wasm",E):E+"ort-wasm-simd-threaded.jsep.wasm":new URL("ort-wasm-simd-threaded.jsep.wasm",n&&n.src||new URL("yunjing-for-cesium.js",document.baseURI).href).href,function(t,e){var n=W;return m||"function"!=typeof WebAssembly.instantiateStreaming||X(n)||Z(n)||"function"!=typeof fetch?et(n,t,e):fetch(n,{credentials:"same-origin"}).then((i=>WebAssembly.instantiateStreaming(i,t).then(e,(function(i){return k(`wasm streaming compile failed: ${i}`),k("falling back to ArrayBuffer instantiation"),et(n,t,e)}))))}(e,(function(e){t(e.instance,e.module)})).catch(l),{}}(),fi=t=>(fi=ci.Ca)(t),di=()=>(di=ci.Da)();c.rt=(t,e)=>(c.rt=ci.Ea)(t,e),c.ot=(t,e)=>(c.ot=ci.Fa)(t,e),c.st=(t,e,n,i,r,o,s,a,A,u)=>(c.st=ci.Ga)(t,e,n,i,r,o,s,a,A,u),c.At=(t,e)=>(c.At=ci.Ha)(t,e),c.ut=(t,e,n)=>(c.ut=ci.Ia)(t,e,n),c.ht=(t,e,n)=>(c.ht=ci.Ja)(t,e,n),c.ct=t=>(c.ct=ci.Ka)(t),c._=(t,e,n)=>(c._=ci.La)(t,e,n),c.ft=t=>(c.ft=ci.Ma)(t),c.dt=(t,e,n)=>(c.dt=ci.Na)(t,e,n),c.vt=(t,e)=>(c.vt=ci.Oa)(t,e),c.It=(t,e)=>(c.It=ci.Pa)(t,e),c.yt=t=>(c.yt=ci.Qa)(t),c.wt=(t,e,n,i,r,o)=>(c.wt=ci.Ra)(t,e,n,i,r,o),c.Ct=(t,e,n,i,r)=>(c.Ct=ci.Sa)(t,e,n,i,r),c.Bt=t=>(c.Bt=ci.Ta)(t),c.Et=(t,e,n,i)=>(c.Et=ci.Ua)(t,e,n,i),c.Qt=(t,e,n)=>(c.Qt=ci.Va)(t,e,n),c.kt=t=>(c.kt=ci.Wa)(t),c.bt=t=>(c.bt=ci.Xa)(t),c.nt=(t,e,n)=>(c.nt=ci.Ya)(t,e,n),c._t=(t,e,n,i)=>(c._t=ci.Za)(t,e,n,i),c.xt=t=>(c.xt=ci.Dt)(t),c.St=t=>(c.St=ci.$a)(t),c.et=(t,e,n,i,r)=>(c.et=ci.ab)(t,e,n,i,r),c.tt=(t,e,n,i,r,o,s,a)=>(c.tt=ci.bb)(t,e,n,i,r,o,s,a),c.Mt=t=>(c.Mt=ci.cb)(t),c.$t=(t,e,n)=>(c.$t=ci.db)(t,e,n),c.Rt=t=>(c.Rt=ci.eb)(t);var gi,vi=()=>(vi=ci.fb)(),Ii=c.Ft=t=>(Ii=c.Ft=ci.gb)(t),pi=c.Gt=t=>(pi=c.Gt=ci.hb)(t),yi=(t,e,n,i,r,o)=>(yi=ci.kb)(t,e,n,i,r,o),wi=()=>(wi=ci.lb)(),Ci=(t,e,n,i,r)=>(Ci=ci.mb)(t,e,n,i,r),Bi=t=>(Bi=ci.nb)(t),Ei=t=>(Ei=ci.ob)(t),mi=()=>(mi=ci.pb)(),Qi=(t,e)=>(Qi=ci.qb)(t,e),ki=t=>(ki=ci.rb)(t),bi=t=>(bi=ci.sb)(t),_i=()=>(_i=ci.tb)(),xi=c.dynCall_ii=(t,e)=>(xi=c.dynCall_ii=ci.vb)(t,e),Di=t=>(Di=ci.wb)(t),Si=()=>(Si=ci.xb)(),Mi=t=>(Mi=ci.yb)(t),$i=()=>($i=ci.zb)();function Ri(){0<V||(v?(h(c),v||Bt(z),startWorker(c)):(Bt(H),0<V||gi||(gi=!0,c.calledRun=!0,q||(v||Bt(z),h(c),v||Bt(K)))))}return c.Lt=862621,c.Nt=862843,c.stackSave=()=>_i(),c.stackRestore=t=>ki(t),c.stackAlloc=t=>bi(t),c.UTF8ToString=Mt,c.stringToUTF8=Lt,c.lengthBytesUTF8=Ft,J=function t(){gi||Ri(),gi||(J=t)},Ri(),f},Qt=mt,"em-pthread"===globalThis.self?.name&&mt()})),fA=z((()=>{vt(),kt=(n&&n.src||new URL("yunjing-for-cesium.js",document.baseURI).href)??(typeof document<"u"?document.currentScript?.src:typeof self<"u"?self.location?.href:void 0),bt=typeof location>"u"?void 0:location.origin,_t=(t,e)=>{try{let n=e??kt;return(n?new URL(t,n):new URL(t)).origin===bt}catch{return!1}},xt=async t=>{let e=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},Dt=(Ct(),V(It)).default,St=async()=>{if(!kt)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(_t(kt))return[void 0,Dt()];let t=await xt(kt);return[t,Dt(t)]},Mt=(cA(),V(Bt)).default,$t=async(t,e,n)=>[void 0,Mt]})),dA=z((()=>{fA(),Ft=!1,Gt=!1,Lt=!1,Nt=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Ut=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Tt=async t=>{if(Ft)return Promise.resolve();if(Gt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Lt)throw new Error("previous call to 'initializeWebAssembly()' failed.");Gt=!0;let e=t.initTimeout,n=t.numThreads;if(!Ut())throw new Error("WebAssembly SIMD is not supported in the current environment.");let i=Nt();n>1&&!i&&(typeof self<"u"&&self.crossOriginIsolated,t.numThreads=n=1);let r=t.wasmPaths,o="string"==typeof r?r:void 0,s=r?.mjs,a=s?.href??s,A=r?.wasm,u=A?.href??A,h=t.wasmBinary,[l,c]=await $t(a,o,n>1),f=!1,d=[];if(e>0&&d.push(new Promise((t=>{setTimeout((()=>{f=!0,t()}),e)}))),d.push(new Promise(((t,e)=>{let i={numThreads:n};h?i.wasmBinary=h:(u||o)&&(i.locateFile=(t,e)=>u??(o??e)+t),c(i).then((e=>{Gt=!1,Ft=!0,Rt=e,t(),l&&URL.revokeObjectURL(l)}),(t=>{Gt=!1,Lt=!0,e(t)}))}))),await Promise.race(d),f)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},Pt=()=>{if(Ft&&Rt)return Rt;throw new Error("WebAssembly is not initialized yet.")}})),gA=z((()=>{dA(),qt=(t,e)=>{let n=Pt(),i=n.lengthBytesUTF8(t)+1,r=n.Ft(i);return n.stringToUTF8(t,r,i),e.push(r),r},Ot=(t,e,n,i)=>{if("object"==typeof t&&null!==t){if(n.has(t))throw new Error("Circular reference in options");n.add(t)}Object.entries(t).forEach((([t,r])=>{let o=e?e+t:t;if("object"==typeof r)Ot(r,o+".",n,i);else if("string"==typeof r||"number"==typeof r)i(o,r.toString());else{if("boolean"!=typeof r)throw new Error("Can't handle extra config type: "+typeof r);i(o,r?"1":"0")}}))},Ht=t=>{let e=Pt(),n=e.stackSave();try{let n=e.stackAlloc(8);e.ot(n,n+4);let i=e.HEAP32[n/4],r=e.HEAPU32[n/4+1],o=r?e.UTF8ToString(r):"";throw new Error(`${t} ERROR_CODE: ${i}, ERROR_MESSAGE: ${o}`)}finally{e.stackRestore(n)}}})),vA=z((()=>{dA(),gA(),zt=t=>{let e=Pt(),n=0,i=[],r=t||{};try{if(void 0===t?.logSeverityLevel)r.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===t?.logVerbosityLevel)r.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===t?.terminate&&(r.terminate=!1);let o=0;return void 0!==t?.tag&&(o=qt(t.tag,i)),n=e.Et(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,o),0===n&&Ht("Can't create run options."),void 0!==t?.extra&&Ot(t.extra,"",new WeakSet,((t,r)=>{let o=qt(t,i),s=qt(r,i);0!==e.Qt(n,o,s)&&Ht(`Can't set a run config entry: ${t} - ${r}.`)})),[n,i]}catch(t){throw 0!==n&&e.kt(n),i.forEach((t=>e.Gt(t))),t}}})),IA=z((()=>{dA(),gA(),Kt=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},Vt=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},Jt=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some((t=>"webgpu"===("string"==typeof t?t:t.name)))&&(t.enableMemPattern=!1)},Yt=(t,e,n)=>{for(let i of e){let e="string"==typeof i?i:i.name;switch(e){case"webnn":if(e="WEBNN","string"!=typeof i){let e=i?.deviceType;if(e){let i=qt("deviceType",n),r=qt(e,n);0!==Pt().ht(t,i,r)&&Ht(`Can't set a session config entry: 'deviceType' - ${e}.`)}}break;case"webgpu":if(e="JS","string"!=typeof i){let e=i;if(e?.preferredLayout){if("NCHW"!==e.preferredLayout&&"NHWC"!==e.preferredLayout)throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${e.preferredLayout}`);let i=qt("preferredLayout",n),r=qt(e.preferredLayout,n);0!==Pt().ht(t,i,r)&&Ht(`Can't set a session config entry: 'preferredLayout' - ${e.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${e}`)}let r=qt(e,n);0!==Pt().At(t,r)&&Ht(`Can't append execution provider: ${e}.`)}},jt=t=>{let e=Pt(),n=0,i=[],r=t||{};Jt(r);try{let t=Kt(r.graphOptimizationLevel??"all"),o=Vt(r.executionMode??"sequential"),s="string"==typeof r.logId?qt(r.logId,i):0,a=r.logSeverityLevel??2;if(!Number.isInteger(a)||a<0||a>4)throw new Error(`log serverity level is not valid: ${a}`);let A=r.logVerbosityLevel??0;if(!Number.isInteger(A)||A<0||A>4)throw new Error(`log verbosity level is not valid: ${A}`);let u="string"==typeof r.optimizedModelFilePath?qt(r.optimizedModelFilePath,i):0;if(n=e.st(t,!!r.enableCpuMemArena,!!r.enableMemPattern,o,!!r.enableProfiling,0,s,a,A,u),0===n&&Ht("Can't create session options."),r.executionProviders&&Yt(n,r.executionProviders,i),void 0!==r.enableGraphCapture){if("boolean"!=typeof r.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);let t=qt("enableGraphCapture",i),o=qt(r.enableGraphCapture.toString(),i);0!==e.ht(n,t,o)&&Ht(`Can't set a session config entry: 'enableGraphCapture' - ${r.enableGraphCapture}.`)}if(r.freeDimensionOverrides)for(let[t,o]of Object.entries(r.freeDimensionOverrides)){if("string"!=typeof t)throw new Error(`free dimension override name must be a string: ${t}`);if("number"!=typeof o||!Number.isInteger(o)||o<0)throw new Error(`free dimension override value must be a non-negative integer: ${o}`);let r=qt(t,i);0!==e.ut(n,r,o)&&Ht(`Can't set a free dimension override: ${t} - ${o}.`)}return void 0!==r.extra&&Ot(r.extra,"",new WeakSet,((t,r)=>{let o=qt(t,i),s=qt(r,i);0!==e.ht(n,o,s)&&Ht(`Can't set a session config entry: ${t} - ${r}.`)})),[n,i]}catch(t){throw 0!==n&&e.ct(n),i.forEach((t=>e.Gt(t))),t}}})),pA=z((()=>{Wt=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},Xt=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},Zt=t=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][t],te=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},ee=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},ne=t=>"float32"===t||"float16"===t||"int32"===t||"int64"===t||"uint32"===t||"uint8"===t||"bool"===t,ie=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${t}`)}}})),yA=z((()=>{vt(),re=async t=>{if("string"==typeof t){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let n=e.headers.get("Content-Length"),i=n?parseInt(n,10):0;if(i<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let n,r=e.body.getReader();try{n=new ArrayBuffer(i)}catch(t){if(!(t instanceof RangeError))throw t;{let t=Math.ceil(i/65536);n=new WebAssembly.Memory({initial:t,maximum:t}).buffer}}let o=0;for(;;){let{done:t,value:e}=await r.read();if(t)break;let i=e.byteLength;new Uint8Array(n,o,i).set(e),o+=i}return new Uint8Array(n,0,i)}}return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}})),wA=z((()=>{pA(),ae=(t,e)=>{oe=t,se=e},Ae=(t,e)=>{ee(t)>=ee(oe)&&"function"==typeof e&&e()},ue=(...t)=>{se&&Ae(...t)}})),CA=z((()=>{pA(),he=(t,e)=>new(te(e))(t)})),BA=z((()=>{})),EA=z((()=>{wA(),BA(),le=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),ce=[],fe=t=>16*Math.ceil(t/16),de=t=>{for(let e=0;e<ce.length;e++){let n=ce[e];if(t<=n)return n}return 16*Math.ceil(t/16)},ge=1,ve=()=>ge++,Ie=async(t,e,n,i)=>{let r=fe(n),o=t.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let s=t.getCommandEncoder();t.endComputePass(),s.copyBufferToBuffer(e,0,o,0,r),t.flush(),await o.mapAsync(GPUMapMode.READ);let a=o.getMappedRange();if(i){let t=i();return t.set(new Uint8Array(a,0,n)),t}return new Uint8Array(a.slice(0,n))}finally{o.destroy()}},pe=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersForUploadingPending=[],this.buffersPending=[],this.externalBuffers=new Map,this.capturedPendingBuffers=new Map;for(let[t]of le)ce.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[])}upload(t,e){let n=e.buffer,i=e.byteOffset,r=e.byteLength,o=fe(r),s=this.storageCache.get(t);if(!s)throw new Error("gpu data for uploading does not exist");if(s.originalSize!==r)throw new Error(`inconsistent data size. gpu data size=${s.originalSize}, data size=${r}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),A=a.getMappedRange();new Uint8Array(A).set(new Uint8Array(n,i,r)),a.unmap();let u=this.backend.getCommandEncoder();this.backend.endComputePass(),u.copyBufferToBuffer(a,0,s.gpuData.buffer,0,o),ue("verbose",(()=>`[WebGPU] GpuDataManager.upload(id=${t})`)),this.buffersForUploadingPending.push(a)}memcpy(t,e){let n=this.storageCache.get(t);if(!n)throw new Error("source gpu data for memcpy does not exist");let i=this.storageCache.get(e);if(!i)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==i.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=fe(n.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(n.gpuData.buffer,0,i.gpuData.buffer,0,r)}registerExternalBuffer(t,e,n){let i;if(n){if(i=this.externalBuffers.get(n),void 0===i)throw new Error("previous buffer is not registered");if(t===n)return ue("verbose",(()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, buffer is the same, skip.`)),i;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error("Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!");this.externalBuffers.delete(n)}else i=ve();return this.storageCache.set(i,{gpuData:{id:i,type:0,buffer:t},originalSize:e}),this.externalBuffers.set(t,i),ue("verbose",(()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, registered.`)),i}unregisterExternalBuffer(t){let e=this.externalBuffers.get(t);void 0!==e&&(this.storageCache.delete(e),this.externalBuffers.delete(t),ue("verbose",(()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`)))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n,i=de(t),r=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||o){let t=(r?this.freeBuffers:this.freeUniformBuffers).get(i);n=t&&t.length>0?t.pop():this.backend.device.createBuffer({size:i,usage:e})}else n=this.backend.device.createBuffer({size:i,usage:e});let s={id:ve(),type:0,buffer:n};return this.storageCache.set(s.id,{gpuData:s,originalSize:t}),ue("verbose",(()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${s.id}`)),s}get(t){return this.storageCache.get(t)?.gpuData}release(t){let e=this.storageCache.get(t);if(!e)throw new Error("releasing data does not exist");return ue("verbose",(()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${e.gpuData.id}`)),this.storageCache.delete(t),this.buffersPending.push(e.gpuData.buffer),e.originalSize}async download(t,e){let n=this.storageCache.get(t);if(!n)throw new Error("data does not exist");await Ie(this.backend,n.gpuData.buffer,n.originalSize,e)}refreshPendingBuffers(){for(let t of this.buffersForUploadingPending)t.destroy();if(this.buffersForUploadingPending=[],0!==this.buffersPending.length)if("default"===this.backend.sessionStatus){for(let t of this.buffersPending){let e=le.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(t.size)||[];void 0===e||n.length>=e?t.destroy():n.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(t.size)||[];void 0===e||n.length>=e?t.destroy():n.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach((t=>{t.forEach((t=>{t.destroy()}))})),this.freeUniformBuffers.forEach((t=>{t.forEach((t=>{t.destroy()}))})),this.storageCache.forEach((t=>{t.gpuData.buffer.destroy()})),this.capturedPendingBuffers.forEach((t=>{t.forEach((t=>{t.destroy()}))})),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach((t=>{t.destroy()})),this.capturedPendingBuffers.delete(t))}},ye=(...t)=>new pe(...t)})),mA=z((()=>{we=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map((t=>`${this[t]}`)).join(";")),this.key}},Ce=t=>new we(t)})),QA=z((()=>{Be=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},Ee=class{static calcShape(t,e,n=!1){let i=t.length,r=e.length;if(0===i)return e;if(0===r)return t;let o=Math.max(t.length,e.length),s=new Array(o);if(n){if(i<2||r<2)return;let n=Be.calcMatMulShape([t[i-2],t[i-1]],[e[r-2],e[r-1]]);if(void 0===n)return;[s[o-2],s[o-1]]=n}for(let a=n?3:1;a<=o;a++){let n=i-a<0?1:t[i-a],A=r-a<0?1:e[r-a];if(n!==A&&n>1&&A>1)return;let u=Math.max(n,A);if(n&&A)s[o-a]=Math.max(n,A);else{if(u>1)return;s[o-a]=0}}return s}static isValidBroadcast(t,e){let n=t.length,i=e.length;if(n>i)return!1;for(let r=1;r<=n;r++)if(1!==t[n-r]&&t[n-r]!==e[i-r])return!1;return!0}},me=class t{static size(e){return t.getSizeFromDimensionRange(e,0,e.length)}static convertShape(t,e=4){let n=t.length;if(0===n)return[];let i=new Array(n),r=n-1;for(;r>=0;){if(t[r]%e==0){i[r]=t[r]/e;break}if(e%t[r]!=0)throw new Error("cannot convert shape");i[r]=1,e/=t[r],r--}for(r--;r>=0;r--)i[r]=t[r];return i}static sizeFromDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,n,e.length)}static sizeToDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${e.length} dimensions.`);return t.getSizeFromDimensionRange(e,0,n)}static getSizeFromDimensionRange(t,e,n){let i=1;for(let r=e;r<n;r++){if(t[r]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=t[r]}return i}static computeStrides(t){let e=t.length;if(0===e)return[];if(1===e)return[1];let n=new Array(e);n[e-1]=1,n[e-2]=t[e-1];for(let i=e-3;i>=0;--i)n[i]=n[i+1]*t[i+1];return n}static normalizeAxis(t,e){if(t<-e&&t>=e)throw new Error("unsupported axis for this operation.");return t<0?t+e:t}static normalizeAxes(t,e){return t.map((n=>this.normalizeAxis(n,e??t.length)))}static sortBasedOnPerm(t,e){return e?e.map((e=>t[e])):t.slice().reverse()}static padShape(t,e){let n=t.length;return t.map(((t,i)=>t+e[i]+e[i+n]))}static areEqual(t,e){return t.length===e.length&&t.every(((t,n)=>t===e[n]))}},Qe=class t{static adjustPoolAttributes(t,e,n,i,r,o){if(!t&&n.length!==e.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let t=0;t<e.length-2;t++)t>=n.length?n.push(e[t+2]):n[t]=e[t+2];for(let t=0;t<n.length;t++)if(t<i.length){if(i[t]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let t=0;t<n.length;t++)if(t<r.length){if(r[t]<0)throw new Error("dilations should be greater than or equal to 1")}else r.push(1);for(let t=0;t<2*n.length;t++)if(t<o.length){if(o[t]<0)throw new Error("pad should be greater than or equal to 1")}else o.push(0);for(let t=0;t<n.length;t++){if(n[t]<=0)throw new Error("kernel shapes need to be greater than 0");if(o[t]>=n[t]||o[t+n.length]>=n[t])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,n,i,r,o,s,a){if(a){if(o.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let A=0;A<e.length-2;A++)t.adjustPadAndReturnShape(e[A+(s?1:2)],n[A],i[A],r[A],o,A,A+e.length-2,a)}}static computePoolOutputShape(e,n,i,r,o,s,a){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let A=[n[0],n[1]];return t.computeShapeHelper(e,n,A,i,r,o,s,a),A}static computeConvOutputShape(e,n,i,r,o,s,a){if(e.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let A=[e[0],n[0]];return t.computeShapeHelper(!1,e,A,i,r,o,s,a),A}static computeShapeHelper(e,n,i,r,o,s,a,A){if(e)for(let t=0;t<n.length-2;t++)i.push(1);else for(let e=0;e<n.length-2;e++)i.push(t.adjustPadAndReturnShape(n[e+2],r[e],o[e],s[e],a,e,e+n.length-2,A))}static adjustPadAndReturnShape(t,e,n,i,r,o,s,a){let A=n*(i-1)+1;if(!a||"NOTSET"===a)return Math.floor((t+r[o]+r[s]-A)/e+1);switch(a){case"VALID":return r[o]=0,r[s]=0,Math.floor((t-A)/e+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==n)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let n=((t+e-1)/e-1)*e+i-t;return r[o]=Math.floor("SAME_LOWER"===a?(n+1)/2:n/2),r[s]=n-r[o],Math.floor((t+n-i)/e+1)}default:throw new Error("Unsupported AutoPad type")}}},ke=class{static getShapeOfGemmResult(t,e,n,i,r){if(2!==t.length||2!==n.length)throw new Error("shape need to be of size 2");let o,s,a;e?(o=t[1],s=t[0]):(o=t[0],s=t[1]);let A=-1;if(i?(a=n[0],A=1):(a=n[1],A=0),n[A]!==s)throw new Error("dimension mismatch");if(o<=0||a<=0||s<=0)throw new Error("invalid shape specified");if(r&&!Ee.isValidBroadcast(r,[o,a]))throw new Error("gemm: invalid bias shape for broadcast");return[o,a,s]}},be=-34028234663852886e22,_e=34028234663852886e22})),kA=z((()=>{pA(),QA(),xe=64,De=(t,e)=>{if(3===e)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(t){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(4!==e)throw new Error("bool must be vec4");return["u32","vec4<bool>"];default:throw new Error(`Unknown data type: ${t}`)}},Se=(t,e=1)=>{let n=De(t,e);return"string"==typeof n?n:n[0]},Me=(t,e=1)=>{let n=De(t,e);return"string"==typeof n?n:n[1]},$e=(...t)=>{let e=[];return t.forEach((t=>{0!==t.length&&e.push({type:12,data:t},{type:12,data:me.computeStrides(t)})})),e},Re=t=>t%4==0?4:t%2==0?2:1,Fe=(t="f32",e,n="0")=>e&&1!==e?`vec${e}<${t}>(${n})`:`${t}(${n})`,Ge=(t,e,n)=>"f32"===t?n:1===e?`f32(${n})`:`vec${e}<f32>(${n})`,Le=(t,e)=>4===e?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:2===e?`(${t}.x + ${t}.y)`:3===e?`(${t}.x + ${t}.y + ${t}.z)`:t,Ne=(t,e,n,i)=>t.startsWith("uniforms.")&&n>4?"string"==typeof e?"f16"===i?`${t}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${t}[(${e}) / 4][(${e}) % 4]`:"f16"===i?`${t}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${t}[${Math.floor(e/4)}][${e%4}]`:n>1?`${t}[${e}]`:t,Ue=(t,e,n,i,r)=>{let o="number"==typeof n,s=o?n:n.length,a=[...new Array(s).keys()],A=s<2?"u32":s<=4?`vec${s}<u32>`:`array<u32, ${s}>`,u=De(e,r),h="string"==typeof u?u:u[1],l="string"==typeof u?u:u[0],c={indices:A,value:h,storage:l,tensor:e},f=t=>"string"==typeof t?t:`${t}u`,d={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},g=o?"uniforms.":"",v=`${g}${t}_shape`,I=`${g}${t}_strides`,p="";for(let t=0;t<s-1;t++)p+=`\n    let dim${t} = current / ${Ne(I,t,s)};\n    let rest${t} = current % ${Ne(I,t,s)};\n    indices[${t}] = dim${t};\n    current = rest${t};\n    `;p+=`indices[${s-1}] = current;`;let y=s<2?"":`\n  fn o2i_${t}(offset: u32) -> ${c.indices} {\n    var indices: ${c.indices};\n    var current = offset;\n    ${p}\n    return indices;\n  }`,w=[];if(s>=2)for(let t=s-1;t>=0;t--)w.push(`${Ne(I,t,s)} * (indices[${t}])`);let C=s<2?"":`\n  fn i2o_${t}(indices: ${c.indices}) -> u32 {\n    return ${w.join("+")};\n  }`,B=(...t)=>0===s?"0u":`${c.indices}(${t.map(f).join(",")})`,E=(t,e)=>s<2?`${t}`:`${Ne(t,e,s)}`,m={},Q=(e,n)=>(()=>{if(c.storage===c.value)return`${t}[${e}]=${n};`;if("vec2<u32>"===c.storage&&"i32"===c.value)return`${t}[${e}]=vec2<u32>(u32(${n}), select(0u, 0xFFFFFFFFu, ${n} < 0));`;if("vec2<u32>"===c.storage&&"u32"===c.value)return`${t}[${e}]=vec2<u32>(u32(${n}), 0u);`;if("u32"===c.storage&&"vec4<bool>"===c.value)return`${t}[${e}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${n}));`;throw new Error(`not supported combination of storage type ${c.storage} and value type ${c.value} yet`)})(),k=e=>(()=>{if(c.storage===c.value)return`${t}[${e}]`;if("vec2<u32>"===c.storage&&"i32"===c.value)return`i32(${t}[${e}].x)`;if("vec2<u32>"===c.storage&&"u32"===c.value)return`u32(${t}[${e}].x)`;if("u32"===c.storage&&"vec4<bool>"===c.value)return`vec4<bool>(bool(${t}[${e}] & 0xFFu), bool(${t}[${e}] & 0xFF00u), bool(${t}[${e}] & 0xFF0000u), bool(${t}[${e}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${c.storage} and value type ${c.value} yet`)})(),b=s<2?"":`\n  fn get_${t}ByIndices(indices: ${c.indices}) -> ${h} {\n    return ${k(`i2o_${t}(indices)`)};\n  }`,_=s<2?"":(()=>{let e=a.map((t=>`d${t}: u32`)).join(", "),n=a.map((t=>`d${t}`)).join(", ");return`\n  fn get_${t}(${e}) -> ${h} {\n    return get_${t}ByIndices(${B(n)});\n  }`})(),x=s<2?"":`\n  fn set_${t}ByIndices(indices: ${c.indices}, value: ${h}) {\n    ${Q(`i2o_${t}(indices)`,"value")}\n  }`,D=s<2?"":(()=>{let e=a.map((t=>`d${t}: u32`)).join(", "),n=a.map((t=>`d${t}`)).join(", ");return`\n  fn set_${t}(${e}, value: ${h}) {\n    set_${t}ByIndices(${B(n)}, value);\n  }`})();return{impl:()=>{let t=[],e=!1;return d.offsetToIndices&&(t.push(y),e=!0),d.indicesToOffset&&(t.push(C),e=!0),d.broadcastedIndicesToOffset&&(Object.values(m).forEach((e=>t.push(e))),e=!0),d.set&&(t.push(D),e=!0),d.setByIndices&&(t.push(x),e=!0),d.get&&(t.push(_),e=!0),d.getByIndices&&(t.push(b),e=!0),!o&&e&&t.unshift(`const ${v} = ${c.indices}(${n.join(",")});`,`const ${I} = ${c.indices}(${me.computeStrides(n).join(",")});`),t.join("\n")},type:c,offsetToIndices:e=>(d.offsetToIndices=!0,s<2?e:`o2i_${t}(${e})`),indicesToOffset:e=>(d.indicesToOffset=!0,s<2?e:`i2o_${t}(${e})`),broadcastedIndicesToOffset:(e,n)=>{d.broadcastedIndicesToOffset=!0;let i=`${n.name}broadcastedIndicesTo${t}Offset`;if(i in m)return`${i}(${e})`;let r=[];for(let t=s-1;t>=0;t--){let e=n.indicesGet("outputIndices",t+n.rank-s);r.push(`${E(I,t)} * (${e} % ${E(v,t)})`)}return m[i]=`fn ${i}(outputIndices: ${n.type.indices}) -> u32 {\n             return ${r.length>0?r.join("+"):"0u"};\n           }`,`${i}(${e})`},indices:B,indicesGet:E,indicesSet:(t,e,n)=>s<2?`${t}=${n};`:`${Ne(t,e,s)}=${n};`,set:(...e)=>{if(e.length!==s+1)throw new Error(`indices length must be ${s}`);let n=e[s];if("string"!=typeof n)throw new Error("value must be string");let i=e.slice(0,s).map(f).join(",");return 0===s?Q("0u",n):1===s?Q(i[0],n):(d.set=!0,d.setByIndices=!0,d.indicesToOffset=!0,`set_${t}(${i}, ${n})`)},setByOffset:Q,setByIndices:(e,n)=>s<2?Q(e,n):(d.setByIndices=!0,d.indicesToOffset=!0,`set_${t}ByIndices(${e}, ${n});`),get:(...e)=>{if(e.length!==s)throw new Error(`indices length must be ${s}`);let n=e.map(f).join(",");return 0===s?k("0u"):1===s?k(n[0]):(d.get=!0,d.getByIndices=!0,d.indicesToOffset=!0,`get_${t}(${n})`)},getByOffset:k,getByIndices:e=>s<2?k(e):(d.getByIndices=!0,d.indicesToOffset=!0,`get_${t}ByIndices(${e})`),usage:i,name:t,strides:I,shape:v,rank:s}},Te=(t,e,n,i=1)=>Ue(t,e,n,"input",i),Pe=(t,e,n,i=1)=>Ue(t,e,n,"output",i),qe=(t,e,n,i=1)=>Ue(t,e,n,"internal",i),Oe=class{constructor(t,e){this.normalizedDispatchGroup=t,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${"number"==typeof t?`${t}u`:t}) { return; }`}mainStart(t=xe){let e="number"==typeof t?t:t[0],n="number"==typeof t?1:t[1],i="number"==typeof t?1:t[2];if(e>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||i>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${n}, ${i}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*n*i>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${n}, ${i}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let r=1===this.normalizedDispatchGroup[1]&&1===this.normalizedDispatchGroup[2];return`@compute @workgroup_size(${e}, ${n}, ${i})\n  fn main(${r?"@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_id) local_id : vec3<u32>":"@builtin(global_invocation_id) global_id : vec3<u32>,\n                                             @builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>"}) {\n    ${r?"let global_idx = global_id.x; let local_idx = local_id.x;":`let global_idx = (workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n          workgroup_id.y * num_workgroups[0] + workgroup_id.x) * ${e*n*i}u + local_idx;`}\n  `}appendVariableUniforms(t){0!==t.rank&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if("internal"===t.usage)throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let n="input"===t.usage?"read":"read_write",i=t.type.storage;return`@group(0) @binding(${e}) var<storage, ${n}> ${t.name}: array<${i}>;`}declareVariables(...t){return t.map((t=>this.declareVariable(t,this.variableIndex++))).join("\n")}registerInternalVariable(t){if("internal"!==t.usage)throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach((t=>this.registerInternalVariable(t))),this}registerUniform(t,e,n=1){return this.uniforms.push({name:t,type:e,length:n}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(0===this.uniforms.length)return"";let t=[];for(let{name:e,type:n,length:i}of this.uniforms)if(i&&i>4)"f16"===n?t.push(`@align(16) ${e}:array<mat2x4<${n}>, ${Math.ceil(i/8)}>`):t.push(`${e}:array<vec4<${n}>, ${Math.ceil(i/4)}>`);else{let r=null==i||1===i?n:`vec${i}<${n}>`;t.push(`${e}:${r}`)}return`\n      struct Uniforms { ${t.join(", ")} };\n      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map((t=>t.impl())).join("\n")+this.internalVariables.map((t=>t.impl())).join("\n")}get variablesInfo(){if(0===this.uniforms.length)return;let t=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map((e=>[t(e.type),e.length??1]))}},He=(t,e)=>new Oe(t,e),ze=(t,e)=>{let n=t.length,i=[];for(let r=0;r<n;r++){let o=n-1-r,s=t[o]||1;(e[e.length-1-r]||1)>1&&1===s&&i.unshift(o)}return i}})),bA=z((()=>{pA(),QA(),mA(),kA(),Ke=t=>{if(!t||1!==t.length)throw new Error("Transpose requires 1 input.")},Ve=(t,e)=>e&&e.length!==t?[...new Array(t).keys()].reverse():e,Je=(t,e)=>me.sortBasedOnPerm(t,Ve(t.length,e)),Ye=(t,e,n,i)=>{let r=[];r.push(`fn perm(i: ${i.type.indices}) -> ${n.type.indices} {\n    var a: ${n.type.indices};`);for(let i=0;i<e;++i)r.push(n.indicesSet("a",t[i],`i[${i}]`));return r.push("return a;}"),r.join("\n")},je=(t,e)=>{let n,i=t.dataType,r=t.dims.length,o=Ve(r,e),s=Je(t.dims,o),a=Pe("output",i,s.length),A=Te("a",i,r);if(2===o.length&&1===o[0]&&0===o[1]){let t=a.type.value,e=[16,16,1];n=n=>`\n  ${n.registerUniform("output_size","u32").declareVariables(A,a)}\n  var<workgroup> tile : array<array<${t}, ${e[0]+1}>, ${e[0]}>;\n  ${n.mainStart(e)}\n    var x = workgroup_id.x * ${e[0]}u + local_id.x;\n    var y = workgroup_id.y * ${e[0]}u + local_id.y;\n    let width = uniforms.output_shape[0];\n    let height = uniforms.output_shape[1];\n    if (x < width && y < height) {\n      tile[local_id.y][local_id.x] = ${A.getByOffset("y * width + x")};\n    }\n    workgroupBarrier();\n    x = workgroup_id.y * ${e[0]}u + local_id.x;\n    y = workgroup_id.x * ${e[0]}u + local_id.y;\n    if (x < height && y < width) {\n      ${a.setByOffset("y * height + x","tile[local_id.x][local_id.y]")}\n    }\n  }`}else n=t=>`\n  ${t.registerUniform("output_size","u32").declareVariables(A,a)}\n\n  ${Ye(o,r,A,a)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${a.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${a.setByOffset("global_idx",A.getByIndices("aIndices"))}\n  }`;return{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:t=>{let e=me.size(s);return{outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(e/64)},programUniforms:[{type:12,data:e},...$e(t[0].dims,s)]}},getShaderSource:n}},We=(t,e)=>{Ke(t.inputs),t.compute(je(t.inputs[0],e.perm))},Xe=t=>Ce({perm:t.perm})})),_A=z((()=>{pA(),QA(),kA(),xA(),bA(),Ze={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},tn={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},en={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},nn={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},rn=(t,e)=>{let n=[];for(let i=e-t;i<e;++i)n.push(i);return n},on=(t,e)=>{let n=[],i=t.length;for(let r=0;r<i;r++)-1===e.indexOf(r)&&n.push(t[r]);let r=e.map((e=>t[e]));return[n,r]},sn=(t,e)=>{let n=t.length+e.length,i=[],r=0;for(let o=0;o<n;o++)-1===e.indexOf(o)?i.push(t[r++]):i.push(1);return i},an=(t,e)=>{for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0},An=(t,e)=>{let n=[];if(!an(t,e)){for(let i=0;i<e;++i)-1===t.indexOf(i)&&n.push(i);t.forEach((t=>n.push(t)))}return n},un=(t,e,n,i,r,o,s)=>{let a=n[0].dims,A=me.size(o),u=me.size(s),h=Te("_A",n[0].dataType,a),l=Pe("output",r,o);return{name:t,shaderCache:e,getShaderSource:t=>`\n        ${t.registerUniform("reduceSize","u32").declareVariables(h,l)}\n        \n          var<workgroup> aBestValues : array<f32, 32>;\n       \n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ${t.mainStart(32)}\n\n          let outputIndex = global_idx / 32;\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = f32(${en[i]});\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + 32) {\n           let candidate = f32(${h.getByOffset("offset + k")});\n           bestValue = ${Ze[i]};\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, 32u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ${tn[i]};\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ${l.setByOffset("outputIndex","mean"===i?`${l.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${l.type.storage}(${nn[i]})`)};\n         }\n        }`,getRunData:()=>({outputs:[{dims:o,dataType:r}],dispatchGroup:{x:A},programUniforms:[{type:12,data:u}]})}},hn=(t,e,n,i)=>{let r=1===t.inputs.length?n:mn(t.inputs,n),o=r.axes;0===o.length&&!r.noopWithEmptyAxes&&(o=t.inputs[0].dims.map(((t,e)=>e)));let s=me.normalizeAxes(o,t.inputs[0].dims.length),a=s,A=t.inputs[0],u=An(a,t.inputs[0].dims.length);u.length>0&&(A=t.compute(je(t.inputs[0],u),{inputs:[0],outputs:[-1]})[0],a=rn(a.length,A.dims.length));let[h,l]=on(A.dims,a),c=h;r.keepDims&&(c=sn(h,s)),t.compute(un(e,{hint:r.cacheKey,inputDependencies:["type"]},[A],i,t.inputs[0].dataType,c,l),{inputs:[A]})},ln=(t,e)=>{hn(t,"ReduceMeanShared",e,"mean")},cn=(t,e)=>{hn(t,"ReduceL1Shared",e,"l1")},fn=(t,e)=>{hn(t,"ReduceL2Shared",e,"l2")},dn=(t,e)=>{hn(t,"ReduceLogSumExpShared",e,"logSumExp")},gn=(t,e)=>{hn(t,"ReduceMaxShared",e,"max")},vn=(t,e)=>{hn(t,"ReduceMinShared",e,"min")},In=(t,e)=>{hn(t,"ReduceProdShared",e,"prod")},pn=(t,e)=>{hn(t,"ReduceSumShared",e,"sum")},yn=(t,e)=>{hn(t,"ReduceSumSquareShared",e,"sumSquare")},wn=(t,e)=>{hn(t,"ReduceLogSumShared",e,"logSum")}})),xA=z((()=>{pA(),QA(),mA(),kA(),_A(),Cn=t=>{if(!t||0===t.length||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(2===t.length&&1!==t[1].dims.length)throw new Error("Invalid axes input dims.")},Bn=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],En=(t,e,n,i,r,o,s=!1,a=!1)=>{let A=[],u=n[0].dims,h=u.length,l=me.normalizeAxes(r,h),c=!a&&0===l.length;u.forEach(((t,e)=>{c||l.indexOf(e)>=0?s&&A.push(1):A.push(t)}));let f=A.length,d=me.size(A);return{name:t,shaderCache:e,getShaderSource:t=>{let e=[],r=Te("_A",n[0].dataType,h),a=Pe("output",o,f),A=i(r,a,l),d=A[2];for(let t=0,n=0;t<h;t++)c||l.indexOf(t)>=0?(s&&n++,d=`for(var j${t}: u32 = 0; j${t} < ${u[t]}; j${t}++) {\n                  ${A[2].includes("last_index")?`let last_index = j${t};`:""}\n                  ${r.indicesSet("input_indices",t,`j${t}`)}\n                  ${d}\n                }`):(e.push(`${r.indicesSet("input_indices",t,a.indicesGet("output_indices",n))};`),n++);return`\n\n        ${t.registerUniform("output_size","u32").declareVariables(r,a)}\n\n        ${t.mainStart()}\n          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          var input_indices: ${r.type.indices};\n          let output_indices = ${a.offsetToIndices("global_idx")};\n\n          ${e.join("\n")}\n          ${A[0]}       // init ops for reduce max/min\n          ${A[1]}\n          ${d}\n          ${A[3]}\n          ${4===A.length?a.setByOffset("global_idx","value"):A.slice(4).join("\n")}\n        }`},getRunData:()=>({outputs:[{dims:A,dataType:o}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:[{type:12,data:d},...$e(u,A)]})}},mn=(t,e)=>{let n=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach((t=>n.push(Number(t)))),Ce({axes:n,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},Qn=(t,e,n,i)=>{let r=t.inputs,o=1===r.length?n:mn(r,n);t.compute(En(e,{hint:o.cacheKey,inputDependencies:["rank"]},[r[0]],o.noopWithEmptyAxes&&0===o.axes.length?Bn:i,o.axes,r[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},kn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceLogSum",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"]))},bn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceL1",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""]))},_n=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceL2",e,((t,e)=>[`var t = ${e.type.value}(0); var value = ${e.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"]))},xn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceLogSumExp",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"]))},Dn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceMax",e,((t,e,n)=>{let i=[];for(let e=0;e<t.rank;e++)(n.indexOf(e)>=0||0===n.length)&&i.push(t.indicesSet("input_indices",e,0));return[`${i.join("\n")}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]}))},Sn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceMean",e,((e,n,i)=>{let r=1;for(let n=0;n<e.rank;n++)(i.indexOf(n)>=0||0===i.length)&&(r*=t.inputs[0].dims[n]);return["var sum = f32(0);","",`sum += f32(${e.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${r});`]}))},Mn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceMin",e,((t,e,n)=>{let i=[];for(let e=0;e<t.rank;e++)(n.indexOf(e)>=0||0===n.length)&&i.push(`input_indices[${e}] = 0;`);return[`${i.join("\n")}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]}))},$n=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceProd",e,((t,e)=>[`var value = ${e.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""]))},Rn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceSum",e,((t,e)=>[`var value = ${e.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""]))},Fn=(t,e)=>{Cn(t.inputs),Qn(t,"ReduceSumSquare",e,((t,e)=>[`var t = ${e.type.value}(0); var value = ${e.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""]))},Gn=(t,e,n)=>{if(0===e.length)return n;let i=1,r=1;for(let n=0;n<e.length;n++)-1===e.indexOf(n)?i*=t[n]:r*=t[n];return r<32&&i>1024},Ln=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Sn(t,e):ln(t,e)},Nn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?bn(t,e):cn(t,e)},Un=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?_n(t,e):fn(t,e)},Tn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?xn(t,e):dn(t,e)},Pn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Dn(t,e):gn(t,e)},qn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Mn(t,e):vn(t,e)},On=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?$n(t,e):In(t,e)},Hn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Rn(t,e):pn(t,e)},zn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Fn(t,e):yn(t,e)},Kn=(t,e)=>{Gn(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?kn(t,e):wn(t,e)}})),DA=z((()=>{pA(),mA(),xA(),Vn=t=>{if(!t||0===t.length||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(1!==t[0].dataType)throw new Error("Invalid input type.")},Jn=(t,e)=>{Vn(t.inputs),t.compute(En("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],((t,n,i)=>{let r=[];for(let e=0;e<t.rank;e++)(i.indexOf(e)>=0||0===i.length)&&r.push(`input_indices[${e}] = 0;`);return[`${r.join("\n")}`,`var value = ${t.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {\n         value = ${t.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",n.setByOffset("global_idx","best_index")]}),[e.axis],7,e.keepDims),{inputs:[0]})},Yn=(t,e)=>{Vn(t.inputs),t.compute(En("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],((t,n,i)=>{let r=[];for(let e=0;e<t.rank;e++)(i.indexOf(e)>=0||0===i.length)&&r.push(`input_indices[${e}] = 0;`);return[`${r.join("\n")}`,`var value = ${t.getByIndices("input_indices")};\nvar best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {\n         value = ${t.getByIndices("input_indices")};\n         best_index = i32(last_index);\n       }`,"",n.setByOffset("global_idx","best_index")]}),[e.axis],7,e.keepDims),{inputs:[0]})},jn=t=>Ce(t)})),SA=z((()=>{pA(),BA(),kA(),Wn=(t,e)=>{let n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5];if(s&&a)throw new Error("Attention cannot have both past and relative_position_bias");if(3!==n.dims.length)throw new Error('Input "input" must have 3 dimensions');let A=n.dims[0],u=n.dims[1],h=n.dims[2];if(1!==r.dims.length)throw new Error('Input "bias" is expected to have 1 dimensions');if(2!==i.dims.length)throw new Error('Input "weights" is expected to have 2 dimensions');if(i.dims[0]!==h)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==i.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let l=r.dims[0]/3,c=l,f=c;if(e.qkvHiddenSizes.length>0){if(3!==e.qkvHiddenSizes.length)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let t of e.qkvHiddenSizes)if(t%e.numHeads!=0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");l=e.qkvHiddenSizes[0],c=e.qkvHiddenSizes[1],f=e.qkvHiddenSizes[2]}let d=u;if(l!==c)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==l+c+f)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let g=0;if(s){if(c!==f)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(5!==s.dims.length)throw new Error('Input "past" must have 5 dimensions');if(2!==s.dims[0])throw new Error('Input "past" first dimension must be 2');if(s.dims[1]!==A)throw new Error('Input "past" second dimension must be batch_size');if(s.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(s.dims[4]!==c/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(g=s.dims[3])}let v=d+g;if(o)throw new Error("Mask not supported");if(s)throw new Error("past is not supported");return{batchSize:A,sequenceLength:u,pastSequenceLength:g,kvSequenceLength:d,totalSequenceLength:v,maxSequenceLength:-1,inputHiddenSize:h,hiddenSize:l,vHiddenSize:f,headSize:Math.floor(l/e.numHeads),vHeadSize:Math.floor(f/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:0,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Xn=(t,e,n,i)=>{let r=Re(i),o=64,s=i/r;s<o?o=1:s/8<64&&(o=Math.ceil(s/8));let a=Math.ceil(i/r/o),A=[{type:e.dataType,data:1/i},{type:12,data:s},{type:12,data:a}],u=Se(e.dataType,r),h=Me(1,r);return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${o};${u};${r}`},getShaderSource:t=>{let n=Pe("x",e.dataType,e.dims,r),i=[{name:"d_inv",type:Me(e.dataType)},{name:"d_comp",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`\n  var<workgroup> thread_max: array<f32, ${o}>;\n  var<workgroup> thread_sum: array<f32, ${o}>;\n  ${t.registerUniforms(i).declareVariables(n)}\n  ${t.mainStart([o,1,1])}\n    let local_offset = local_idx * uniforms.elements_per_thread;\n    let offset = workgroup_id.x * uniforms.d_comp + local_offset;\n\n    var thread_max_vector = ${h}(-3.402823e+38f);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < uniforms.d_comp; i++) {\n      thread_max_vector = max(${h}(x[offset + i]), thread_max_vector);\n    }\n    thread_max[local_idx] = ${(()=>{switch(r){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${r}`)}})()};\n    workgroupBarrier();\n\n    var max_value =  f32(-3.402823e+38f);\n    for (var i = 0u; i < ${o}; i++) {\n      max_value = max(thread_max[i], max_value);\n    }\n\n    var sum_vector = ${h}(0);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < uniforms.d_comp; i++) {\n      sum_vector += exp(${h}(x[offset + i]) - max_value);\n    }\n    thread_sum[local_idx] = ${(()=>{switch(r){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${r}`)}})()};\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ${o}; i++) {\n      sum += thread_sum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < uniforms.d_comp; i++) {\n        x[offset + i] = ${n.type.value}(uniforms.d_inv);\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < uniforms.d_comp; i++) {\n        var f32input = ${h}(x[offset + i]);\n        x[offset + i] = ${n.type.value}(exp(f32input - max_value) / sum);\n      }\n    }\n  }`},getRunData:()=>({outputs:[],dispatchGroup:{x:n},programUniforms:A})}},Zn=(t,e,n,i,r,o,s,a)=>{let A=a+o.kvSequenceLength,u=[o.batchSize,o.numHeads,o.sequenceLength,A],h=void 0===o.kvNumHeads&&t.outputCount>1,l=h?[o.batchSize,o.numHeads,A,o.headSize]:void 0,c=0===s.scale?1/Math.sqrt(o.headSize):s.scale,f=Re(o.headSize),d=o.headSize/f,g={x:Math.ceil(A/12),y:Math.ceil(o.sequenceLength/12),z:o.batchSize*o.numHeads},v=[{type:12,data:o.sequenceLength},{type:12,data:d},{type:12,data:A},{type:12,data:o.numHeads},{type:1,data:c},{type:12,data:a},{type:12,data:o.kvSequenceLength}],I=["type","type"];i&&I.push("type"),r&&I.push("type");let p=[{dims:u,dataType:e.dataType,gpuDataType:0}];return h&&p.push({dims:l,dataType:e.dataType,gpuDataType:0}),{name:"AttentionProbs",shaderCache:{hint:`${f};${void 0!==r};${void 0!==i};${t.outputCount}`,inputDependencies:I},getRunData:()=>({outputs:p,dispatchGroup:g,programUniforms:v}),getShaderSource:t=>{let o=Te("q",e.dataType,e.dims,f),s=[o,Te("key",n.dataType,n.dims,f)];if(i){let t=Te("past_key",i.dataType,i.dims,f);s.push(t)}r&&s.push(Te("relative_position_bias",r.dataType,r.dims));let a=Pe("output",e.dataType,u),A=[a];h&&A.push(Pe("present_key",e.dataType,l,f));let c=Me(1,f);return`\n  const TILE_SIZE = 12u;\n\n  var<workgroup> tileQ: array<${o.type.storage}, 144>;\n  var<workgroup> tileK: array<${o.type.storage}, 144>;\n  ${t.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"}]).declareVariables(...s,...A)}\n  ${t.mainStart([12,12,1])}\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let qOffset = uniforms.M * uniforms.K * headIdx + m * uniforms.K;\n    ${i&&h?"\n    let kOffset = uniforms.kv_sequence_length * uniforms.K * headIdx;\n    let pastKeyOffset = uniforms.past_sequence_length * uniforms.K * headIdx;":"\n    let kOffset = uniforms.N * uniforms.K * headIdx + n * uniforms.K;"}\n    ${h?"let presentKeyOffset = headIdx * uniforms.N * uniforms.K;":""}\n    var value = ${c}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n      ${i&&h?"\n              if (n + local_id.y < uniforms.past_sequence_length) {\n                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n              } else {\n                tileK[idx] =\n                         key[kOffset + (n + local_id.y - uniforms.past_sequence_length) * uniforms.K + w + local_id.x];\n              }":"tileK[idx] = key[kOffset + local_id.y * uniforms.K + w + local_id.x];"}\n      ${h?"present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];":""}\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {\n        value += ${c}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = headIdx * uniforms.M * uniforms.N;\n    if (global_id.y < uniforms.M && global_id.x < uniforms.N) {\n      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;\n      var sum: f32 = ${(()=>{switch(f){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${f}`)}})()};\n        output[outputIdx] = ${a.type.value} (sum * uniforms.alpha) + ${r?"relative_position_bias[outputIdx]":"0.0"};\n    }\n  }`}}},ti=(t,e,n,i,r,o)=>{let s=o+r.kvSequenceLength,a=r.nReps?r.nReps:1,A=r.vHiddenSize*a,u=null==r.kvNumHeads&&t.outputCount>1,h=u?[r.batchSize,r.numHeads,s,r.headSize]:void 0,l=[r.batchSize,r.sequenceLength,A],c={x:Math.ceil(r.vHeadSize/12),y:Math.ceil(r.sequenceLength/12),z:r.batchSize*r.numHeads},f=[{type:12,data:r.sequenceLength},{type:12,data:s},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:A},{type:12,data:o},{type:12,data:r.kvSequenceLength}],d=i?["type","type","type"]:["type","type"],g=[{dims:l,dataType:e.dataType,gpuDataType:0}];return u&&g.push({dims:h,dataType:e.dataType,gpuDataType:0}),{name:"AttentionScore",shaderCache:{hint:`${void 0!==i};${t.outputCount}`,inputDependencies:d},getRunData:()=>({outputs:g,dispatchGroup:c,programUniforms:f}),getShaderSource:t=>{let r=Te("probs",e.dataType,e.dims),o=[r,Te("v",n.dataType,n.dims)];i&&o.push(Te("past_value",i.dataType,i.dims));let s=[Pe("output",e.dataType,l)];return u&&s.push(Pe("present_value",e.dataType,h)),`\n  const TILE_SIZE = 12u;\n  var<workgroup> tileQ: array<${r.type.value}, 144>;\n  var<workgroup> tileK: array<${r.type.value}, 144>;\n  ${t.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"}]).declareVariables(...o,...s)}\n  ${t.mainStart([12,12,1])}\n   let headIdx = workgroup_id.z;\n   let m = global_id.y;\n   let n = global_id.x;\n\n   let offsetA = headIdx * (uniforms.M * uniforms.K) + m * uniforms.K;\n   ${i&&u?"\n    let pastValueOffset = headIdx * uniforms.N * uniforms.past_sequence_length + n;\n    let vOffset = headIdx * uniforms.N * uniforms.kv_sequence_length + n;\n      ":"\n   let offsetB = headIdx * uniforms.N * uniforms.K + n;\n            "}\n    ${u?"let presentValueOffset = headIdx * uniforms.N * uniforms.K + n;":""}\n   var value = ${r.type.storage}(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n        ${i&&u?"\n        if (w + local_id.y < uniforms.past_sequence_length) {\n          tileK[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];\n        } else {\n          tileK[idx] = v[vOffset + (w + local_id.y - uniforms.past_sequence_length) * uniforms.N];\n        }\n      ":"\n        tileK[idx] = v[offsetB + (w + local_id.y) * uniforms.N];\n      "}\n        ${u?"present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileK[idx];":""}\n      }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let currentBatchHeadNumber = workgroup_id.z % uniforms.num_heads;\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + currentBatchHeadNumber * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }`}}},ei=(t,e,n,i,r,o,s,a,A,u,h)=>{let l=t.outputCount,c=void 0!==u.kvNumHeads||l>1?u.pastSequenceLength:0,f=c+u.kvSequenceLength,d=void 0===u.kvNumHeads&&l>1&&s?[e,n,s]:[e,n];A&&d.push(A);let g=t.compute(Zn(t,e,n,l>1?s:void 0,A,u,h,c),{inputs:d,outputs:void 0===u.kvNumHeads&&l>1?[-1,1]:[-1]})[0];t.compute(Xn(0,g,u.batchSize*u.numHeads*u.sequenceLength,f),{inputs:[g],outputs:[]});let v=void 0===u.kvNumHeads&&l>1&&a?[g,i,a]:[g,i];t.compute(ti(t,g,i,l>1&&a?a:void 0,u,c),{inputs:v,outputs:void 0===u.kvNumHeads&&l>1?[0,2]:[0]})},ni=(t,e)=>{let n=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],i=e.sequenceLength,r=e.inputHiddenSize,o=e.headSize,s={x:Math.ceil(e.headSize/12),y:Math.ceil(e.sequenceLength/12),z:e.batchSize*e.numHeads},a=[t.inputs[0],t.inputs[1],t.inputs[2]],A=[{type:12,data:i},{type:12,data:r},{type:12,data:o},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}];return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:s,programUniforms:A}),getShaderSource:t=>{let e=Pe("output_q",a[0].dataType,n),i=Pe("output_k",a[0].dataType,n),r=Pe("output_v",a[0].dataType,n),o=Te("input",a[0].dataType,a[0].dims),s=Te("weight",a[1].dataType,a[1].dims),A=Te("bias",a[2].dataType,a[2].dims),u=o.type.storage;return`\n  const TILE_SIZE = 12u;\n  var<workgroup> tileInput: array<${u}, 144>;\n  var<workgroup> tileWeightQ: array<${u}, 144>;\n  var<workgroup> tileWeightK: array<${u}, 144>;\n  var<workgroup> tileWeightV: array<${u}, 144>;\n  ${t.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}]).declareVariables(o,s,A,e,i,r)}\n  ${t.mainStart([12,12,1])}\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = global_id.y;\n    let n = global_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ${u}(0);\n    var valueK = ${u}(0);\n    var valueV = ${u}(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }`}},{inputs:a,outputs:[-1,-1,-1]})},ii=(t,e)=>{let n=Wn(t.inputs,e),[i,r,o]=ni(t,n);return ei(t,i,r,o,t.inputs[4],void 0,void 0,void 0,t.inputs[5],n,e)}})),MA=z((()=>{gt(),pA(),QA(),mA(),kA(),ri=(t,e)=>{if(!t||5!==t.length)throw new Error("BatchNormalization requires 5 inputs");let n=(t,e,n)=>{let i=e.length;if(i!==t.length)throw new Error(`${n}: num dimensions != ${i}`);e.forEach(((e,i)=>{if(e!==t[i])throw new Error(`${n}: dim[${i}] do not match`)}))};if(t[0].dims.length>1){let i="NHWC"===e.format?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);n(t[1].dims,i,"Invalid input scale"),n(t[2].dims,i,"Invalid input B"),n(t[3].dims,i,"Invalid input mean"),n(t[4].dims,i,"Invalid input var")}else n(t[1].dims,[1],"Invalid input scale"),n(t[2].dims,[1],"Invalid input B"),n(t[3].dims,[1],"Invalid input mean"),n(t[4].dims,[1],"Invalid input var")},oi=(t,e)=>{let{epsilon:n,spatial:i,format:r}=e,o=t[0].dims,s=i?Re(o[o.length-1]):1,a="NHWC"===r&&o.length>1?s:1,A=me.size(o)/s,u=i,h=u?o.length:o,l=Te("x",t[0].dataType,t[0].dims,s),c=Te("scale",t[1].dataType,t[1].dims,a),f=Te("bias",t[2].dataType,t[2].dims,a),d=Te("inputMean",t[3].dataType,t[3].dims,a),g=Te("inputVar",t[4].dataType,t[4].dims,a),v=Pe("y",t[0].dataType,h,s);return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${i}_${s}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:t=>`\n  const epsilon = ${n};\n  ${t.registerUniform("outputSize","u32").declareVariables(l,c,f,d,g,v)}\n  ${t.mainStart()}\n  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n    var outputIndices = ${v.offsetToIndices(`global_idx * ${s}`)};\n    ${(()=>{let t="";if(i)t=`let cOffset = ${1===o.length?"0u":"NHWC"===r?`outputIndices[${o.length-1}] / ${s}`:"outputIndices[1]"};`;else if("NCHW"===r)t=`\n            ${v.indicesSet("outputIndices","0","0")}\n            let cOffset = ${v.indicesToOffset("outputIndices")};`;else{t=`var cIndices = ${c.type.indices}(0);\n                       cIndices[0] = outputIndices[${o.length-1}];`;for(let e=1;e<c.rank;e++)t+=`cIndices[${e}] = outputIndices[${e}];`;t+=`let cOffset = ${c.indicesToOffset("cIndices")};`}return t})()}\n    let scale = ${c.getByOffset("cOffset")};\n    let bias = ${f.getByOffset("cOffset")};\n    let inputMean = ${d.getByOffset("cOffset")};\n    let inputVar = ${g.getByOffset("cOffset")};\n    let x = ${l.getByOffset("global_idx")};\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ${v.setByOffset("global_idx","value")}\n  }`,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:u?[{type:12,data:A},...$e(o)]:[{type:12,data:A}]})}},si=t=>Ce(t),ai=(t,e)=>{let{inputs:n,outputCount:i}=t,r=si({...e,outputCount:i});if(v.webgpu.validateInputContent&&ri(n,r),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(oi(n,r))}})),$A=z((()=>{QA(),kA(),Ai=t=>{if(3!==t[0].dims.length)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(1!==t[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},ui=t=>{let e=t[0].dims,n=t[0].dims[2],i=me.size(e)/4,r=t[0].dataType,o=Te("input",r,e,4),s=Te("bias",r,[n],4),a=Te("residual",r,e,4),A=Pe("output",r,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:t=>`\n  const channels = ${n}u / 4;\n  ${t.declareVariables(o,s,a,A)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes(i)}\n    let value = ${o.getByOffset("global_idx")}\n      + ${s.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};\n    ${A.setByOffset("global_idx","value")}\n  }`}},hi=t=>{Ai(t.inputs),t.compute(ui(t.inputs))}})),RA=z((()=>{pA(),QA(),mA(),kA(),li=(t,e,n,i,r,o)=>{let s=Math.ceil(e/4),a="";a="string"==typeof r?`${r}(a)`:r("a");let A=Te("inputData",n,[s],4),u=Pe("outputData",i,[s],4);return`\n      ${t.registerUniform("vec_size","u32").declareVariables(A,u)}\n\n  ${o??""}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n\n    let a = ${A.getByOffset("global_idx")};\n    ${u.setByOffset("global_idx",a)}\n  }`},ci=(t,e,n,i,r,o=t.dataType)=>({name:e,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:e=>li(e,me.size(t.dims),t.dataType,o,n,i),getRunData:e=>({outputs:[{dims:t.dims,dataType:o}],dispatchGroup:{x:Math.ceil(me.size(e[0].dims)/64/4)},programUniforms:[{type:12,data:Math.ceil(me.size(t.dims)/4)}]})}),fi=t=>{t.compute(ci(t.inputs[0],"Abs","abs"))},di=t=>{t.compute(ci(t.inputs[0],"Acos","acos"))},gi=t=>{t.compute(ci(t.inputs[0],"Acosh","acosh"))},vi=t=>{t.compute(ci(t.inputs[0],"Asin","asin"))},Ii=t=>{t.compute(ci(t.inputs[0],"Asinh","asinh"))},pi=t=>{t.compute(ci(t.inputs[0],"Atan","atan"))},yi=t=>{t.compute(ci(t.inputs[0],"Atanh","atanh"))},wi=t=>Ce(t),Ci=(t,e)=>{let n;switch(e.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(ci(t.inputs[0],"Cast",n,void 0,e.cacheKey,e.to))},Bi=t=>{let e=t.length>=2&&0!==t[1].data?t[1].getFloat32Array()[0]:be,n=t.length>=3&&0!==t[2].data?t[2].getFloat32Array()[0]:_e;return Ce({min:e,max:n})},Ei=(t,e)=>{let n=1===t.inputs.length?e:Bi(t.inputs),i=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"Clip",(t=>`clamp(${t}, clip_min_, clip_max_)`),`\n    const clip_min_: vec4<${i}> = vec4(${i}(${n.min}));\n    const clip_max_: vec4<${i}> = vec4(${i}(${n.max}));\n`,n.cacheKey),{inputs:[0]})},mi=t=>{t.compute(ci(t.inputs[0],"Ceil","ceil"))},Qi=t=>{t.compute(ci(t.inputs[0],"Cos","cos"))},ki=t=>{t.compute(ci(t.inputs[0],"Cosh","cosh"))},bi=t=>Ce(t),_i=(t,e)=>{let n=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"Elu",(t=>`elu_vf32(${t})`),`\n  const elu_alpha_ = ${n}(${e.alpha});\n\n  fn elu_f32(a: ${n}) -> ${n} {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }`,e.cacheKey))},xi=(t="f32")=>`\nconst r0: ${t} = 0.3275911;\nconst r1: ${t} = 0.254829592;\nconst r2: ${t} = -0.284496736;\nconst r3: ${t} = 1.421413741;\nconst r4: ${t} = -1.453152027;\nconst r5: ${t} = 1.061405429;\n\nfn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}`,Di=t=>{let e=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"Erf",(t=>`erf_vf32(${t})`),xi(e)))},Si=t=>{t.compute(ci(t.inputs[0],"Exp","exp"))},Mi=t=>{t.compute(ci(t.inputs[0],"Floor","floor"))},$i=t=>{let e=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"Gelu",(t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`),xi(e)))},Ri=(t,e)=>{let n=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"LeakyRelu",(t=>`select(leaky_relu_alpha_ * ${t}, ${t}, ${t} >= vec4<${n}>(0.0))`),`const leaky_relu_alpha_ = ${n}(${e.alpha});`,e.cacheKey))},Fi=t=>{t.compute(ci(t.inputs[0],"Not",(t=>`!${t}`)))},Gi=t=>{t.compute(ci(t.inputs[0],"Neg",(t=>`-${t}`)))},Li=t=>{t.compute(ci(t.inputs[0],"Reciprocal",(t=>`1.0/${t}`)))},Ni=t=>{let e=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"Relu",(t=>`select(vec4<${e}>(0.0), ${t}, ${t} > vec4<${e}>(0.0))`)))},Ui=t=>{t.compute(ci(t.inputs[0],"Sigmoid",(t=>`(1.0 / (1.0 + exp(-${t})))`)))},Ti=t=>Ce(t),Pi=(t,e)=>{let n=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"HardSigmoid",(t=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${e.alpha} * ${t} + vec4<${n}>(${e.beta})))`),void 0,e.cacheKey))},qi=t=>{t.compute(ci(t.inputs[0],"Sin","sin"))},Oi=t=>{t.compute(ci(t.inputs[0],"Sinh","sinh"))},Hi=t=>{t.compute(ci(t.inputs[0],"Sqrt","sqrt"))},zi=t=>{t.compute(ci(t.inputs[0],"Tan","tan"))},Ki=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,Vi=t=>{t.compute(ci(t.inputs[0],"Tanh",Ki))},Ji=(t="f32")=>`\nconst fast_gelu_a: ${t} = 0.5;\nconst fast_gelu_b: ${t} = 0.7978845608028654;\nconst fast_gelu_c: ${t} = 0.035677408136300125;\n\nfn tanh_v(v: vec4<${t}>) -> vec4<${t}> {\n  return ${Ki("v")};\n}\n`,Yi=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,ji=t=>{let e=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"FastGelu",Yi,Ji(e),void 0,t.inputs[0].dataType))},Wi=(t,e)=>{let n=Me(t.inputs[0].dataType);return t.compute(ci(t.inputs[0],"ThresholdedRelu",(t=>`select(vec4<${n}>(0.0), ${t}, ${t} > thresholded_relu_alpha_)`),`const thresholded_relu_alpha_ = vec4<${n}>(${e.alpha});`,e.cacheKey)),0},Xi=t=>{t.compute(ci(t.inputs[0],"Log","log"))},Zi=(t,e)=>`\nconst alpha = vec4<${t}>(${e});\nconst one = ${t}(1.0);\nconst zero = ${t}(0.0);\n\nfn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {\n  let v = x *alpha;\n  var x1 : vec4<${t}>;\n  for (var i = 0; i < 4; i = i + 1) {\n    if (v[i] >= zero) {\n      x1[i] = one / (one + exp(-v[i]));\n    } else {\n      x1[i] = one - one / (one + exp(v[i]));\n    }\n  }\n  return x * x1;\n}\n`,tr=t=>`quick_gelu_impl(${t})`,er=(t,e)=>{let n=Me(t.inputs[0].dataType);t.compute(ci(t.inputs[0],"QuickGelu",tr,Zi(n,e.alpha),e.cacheKey,t.inputs[0].dataType))}})),FA=z((()=>{QA(),kA(),RA(),nr=t=>{if(3!==t[0].dims.length)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(1!==t[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},ir=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let n=Te("input",t[0].dataType,t[0].dims,4),i=Te("bias",t[0].dataType,[t[0].dims[2]],4),r=Pe("output",t[0].dataType,e,4),o=me.size(e)/4,s=Se(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:e=>`\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ${t[0].dims[2]/4/2}u;\n\n  ${e.declareVariables(n,i,r)}\n\n  ${xi(s)}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes(o)}\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ${r.setByOffset("global_idx","valueLeft * geluRight")}\n  }`}},rr=t=>{nr(t.inputs),t.compute(ir(t.inputs))}})),GA=z((()=>{pA(),QA(),kA(),or=(t,e,n,i,r,o,s,a,A,u,h,l)=>{let c,f;"string"==typeof a?c=f=(t,e)=>`${a}((${t}),(${e}))`:"function"==typeof a?c=f=a:(c=a.scalar,f=a.vector);let d,g=Pe("outputData",h,i.length,4),v=Te("aData",A,e.length,4),I=Te("bData",u,n.length,4);if(r)if(o){let t=1===me.size(e),i=1===me.size(n),r=e.length>0&&e[e.length-1]%4==0,o=n.length>0&&n[n.length-1]%4==0;d=t||i?g.setByOffset("global_idx",f(t?`${v.type.value}(${v.getByOffset("0")}.x)`:v.getByOffset("global_idx"),i?`${I.type.value}(${I.getByOffset("0")}.x)`:I.getByOffset("global_idx"))):`\n            let outputIndices = ${g.offsetToIndices("global_idx * 4u")};\n            let offsetA = ${v.broadcastedIndicesToOffset("outputIndices",g)};\n            let offsetB = ${I.broadcastedIndicesToOffset("outputIndices",g)};\n            ${g.setByOffset("global_idx",f(s||r?v.getByOffset("offsetA / 4u"):`${v.type.value}(${v.getByOffset("offsetA / 4u")}[offsetA % 4u])`,s||o?I.getByOffset("offsetB / 4u"):`${I.type.value}(${I.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}\n          `}else d=g.setByOffset("global_idx",f(v.getByOffset("global_idx"),I.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let t=(t,e,n="")=>{let i=`aData[indexA${e}][componentA${e}]`,r=`bData[indexB${e}][componentB${e}]`;return`\n            let outputIndices${e} = ${g.offsetToIndices(`global_idx * 4u + ${e}u`)};\n            let offsetA${e} = ${v.broadcastedIndicesToOffset(`outputIndices${e}`,g)};\n            let offsetB${e} = ${I.broadcastedIndicesToOffset(`outputIndices${e}`,g)};\n            let indexA${e} = offsetA${e} / 4u;\n            let indexB${e} = offsetB${e} / 4u;\n            let componentA${e} = offsetA${e} % 4u;\n            let componentB${e} = offsetB${e} % 4u;\n            ${t}[${e}] = ${n}(${c(i,r)});\n          `};d=9===h?`\n            var data = vec4<u32>(0);\n            ${t("data",0,"u32")}\n            ${t("data",1,"u32")}\n            ${t("data",2,"u32")}\n            ${t("data",3,"u32")}\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`\n            ${t("outputData[global_idx]",0)}\n            ${t("outputData[global_idx]",1)}\n            ${t("outputData[global_idx]",2)}\n            ${t("outputData[global_idx]",3)}\n          `}return`\n        ${t.registerUniform("vec_size","u32").declareVariables(v,I,g)}\n\n        ${l??""}\n\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${d}\n      }`},sr=(t,e,n,i,r,o,s=n.dataType)=>{let a=!me.areEqual(n.dims,i.dims),A=n.dims,u=me.size(n.dims),h=!1,l=!1,c=[a];if(a){let t=Ee.calcShape(n.dims,i.dims,!1);if(!t)throw new Error("Can't perform binary op on the given tensors");A=t,u=me.size(A);let e=1===me.size(n.dims),r=1===me.size(i.dims),o=n.dims.length>0&&n.dims[n.dims.length-1]%4==0,s=i.dims.length>0&&i.dims[i.dims.length-1]%4==0;c.push(e),c.push(r),c.push(o),c.push(s);let a=1;for(let t=1;t<A.length;t++){let e=n.dims[n.dims.length-t]??1;if(e!==(i.dims[i.dims.length-t]??1))break;a*=e}a%4==0?(l=!0,h=!0):(e||r||o||s)&&(h=!0)}else h=!0;return c.push(h),{name:t,shaderCache:{hint:e+c.map((t=>t.toString())).join("_"),inputDependencies:["rank","rank"]},getShaderSource:t=>or(t,n.dims,i.dims,A,h,a,l,r,n.dataType,i.dataType,s,o),getRunData:()=>({outputs:[{dims:A,dataType:s}],dispatchGroup:{x:Math.ceil(u/64/4)},programUniforms:[{type:12,data:Math.ceil(me.size(A)/4)},...$e(n.dims,i.dims,A)]})}},ar=(t,e,n,i,r,o)=>{t.compute(sr(e,r??"",t.inputs[0],t.inputs[1],n,i,o))},Ar=t=>{ar(t,"Add",((t,e)=>`${t}+${e}`))},ur=t=>{ar(t,"Div",((t,e)=>`${t}/${e}`))},hr=t=>{ar(t,"Equal",{scalar:(t,e)=>`u32(${t}==${e})`,vector:(t,e)=>`vec4<u32>(${t}==${e})`},void 0,void 0,9)},lr=t=>{ar(t,"Mul",((t,e)=>`${t}*${e}`))},cr=t=>{let e=Te("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;ar(t,"Pow",{scalar:(t,e)=>`pow_custom(${t},${e})`,vector:(t,e)=>`pow_vector_custom(${t},${e})`},`\n    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {\n      if (b == ${e}(0.0)) {\n        return ${e}(1.0);\n      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {\n        return ${e}(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${"i32"===e?"round":""}(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {\n      // TODO: implement vectorized pow\n      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      `)},fr=t=>{ar(t,"Sub",((t,e)=>`${t}-${e}`))},dr=t=>{ar(t,"Greater",{scalar:(t,e)=>`u32(${t}>${e})`,vector:(t,e)=>`vec4<u32>(${t}>${e})`},void 0,void 0,9)},gr=t=>{ar(t,"Less",{scalar:(t,e)=>`u32(${t}<${e})`,vector:(t,e)=>`vec4<u32>(${t}<${e})`},void 0,void 0,9)},vr=t=>{ar(t,"GreaterOrEqual",{scalar:(t,e)=>`u32(${t}>=${e})`,vector:(t,e)=>`vec4<u32>(${t}>=${e})`},void 0,void 0,9)},Ir=t=>{ar(t,"LessOrEqual",{scalar:(t,e)=>`u32(${t}<=${e})`,vector:(t,e)=>`vec4<u32>(${t}<=${e})`},void 0,void 0,9)}})),LA=z((()=>{pA(),QA(),mA(),kA(),pr=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");let n=t[0],i=n.dataType,r=n.dims.length;t.forEach(((t,o)=>{if(0!==o){if(t.dataType!==i)throw new Error("input tensors should be one type");if(t.dims.length!==r)throw new Error("input tensors should have the same shape");t.dims.forEach(((t,i)=>{if(i!==e&&t!==n.dims[i])throw new Error("non concat dimensions must match")}))}}))},yr=(t,e)=>`\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ${t}u>(${e});\n    for (var i: u32 = 0u; i < ${t}; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ${t}u;\n  }`,wr=(t,e)=>{let n=t.length,i=[];for(let r=0;r<n;++r){let o=e.setByOffset("global_idx",t[r].getByIndices("indices"));1===n?i.push(o):0===r?i.push(`if (inputIndex == ${r}u) { ${o} }`):r===n-1?i.push(`else { ${o} }`):i.push(`else if (inputIndex == ${r}) { ${o} }`)}return i.join("\n")},Cr=(t,e,n,i)=>{let r=me.size(n),o=new Array(t.length),s=new Array(t.length),a=0,A=[],u=[],h=[{type:12,data:r}];for(let n=0;n<t.length;++n)a+=t[n].dims[e],o[n]=a,u.push(t[n].dims.length),s[n]=Te(`input${n}`,i,u[n]),A.push("rank"),h.push({type:12,data:o[n]});for(let e=0;e<t.length;++e)h.push(...$e(t[e].dims));h.push(...$e(n));let l=Pe("output",i,n.length),c=l.indicesGet("indices",e),f=Array.from(Array(o.length).keys()).map((t=>`uniforms.sizeInConcatAxis${t}`)).join(",");return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:n,dataType:i}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:h}),getShaderSource:e=>`\n\n  ${(()=>{e.registerUniform("outputSize","u32");for(let n=0;n<t.length;n++)e.registerUniform(`sizeInConcatAxis${n}`,"u32");return e.declareVariables(...s,l)})()}\n\n  ${yr(o.length,f)}\n\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n    var indices = ${l.offsetToIndices("global_idx")};\n\n    let inputIndex = calculateInputIndex(${c});\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ${o.length}u>(${f});\n      ${c} -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ${wr(s,l)}\n  }`}},Br=(t,e)=>{let n=t.inputs,i=n[0].dims,r=me.normalizeAxis(e.axis,i.length);pr(n,r);let o=i.slice();o[r]=n.reduce(((t,e)=>t+(e.dims.length>r?e.dims[r]:0)),0);let s=n.filter((t=>me.size(t.dims)>0));t.compute(Cr(s,r,o,n[0].dataType),{inputs:s})},Er=t=>Ce({axis:t.axis})})),NA=z((()=>{pA(),QA(),mr=(t,e,n="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${n}(uniforms.clip_min)), ${e}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return"let e2x = exp(-2.0 * abs(value));\n              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);\n        ";case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},Qr=(t,e)=>{"Clip"===t.activation?e.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):"HardSigmoid"===t.activation?e.push({type:1,data:t.alpha},{type:1,data:t.beta}):"LeakyRelu"===t.activation&&e.push({type:1,data:t.alpha})},kr=(t,e)=>{"Clip"===t.activation?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):"HardSigmoid"===t.activation?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):"LeakyRelu"===t.activation&&e.push({name:"alpha",type:"f32"})},br=t=>{let e=t?.activation||"";if("HardSigmoid"===e){let[n,i]=t?.activation_params||[.2,.5];return{activation:e,alpha:n,beta:i}}if("Clip"===e){let[n,i]=t?.activation_params||[be,_e];return{activation:e,clipMax:i,clipMin:n}}if("LeakyRelu"===e){let[n]=t?.activation_params||[.01];return{activation:e,alpha:n}}return{activation:e}}})),UA=z((()=>{_r=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},xr=t=>`\n      ${t?"value = value + getBiasByOutputCoords(coords);":""}\n      `})),TA=z((()=>{Dr=t=>`\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));\n}\n`})),PA=z((()=>{pA(),QA(),kA(),NA(),UA(),Sr=(t,e)=>t?`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});\n        `:`\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol${e?", batchIndices":""});\n        `,Mr=(t,e)=>t?`\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ${3===e?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ${3===e?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}\n        }`:`\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ${3===e?"":"acc[i] = BCached3 * ACached.w + acc[i];"}\n        }`,$r=(t,e,n="f32",i,r=!1,o=32,s=!1,a=32)=>{let A=e[1]*t[1],u=e[0]*t[0],h=r?A:o,l=r?o:A,c=h/e[0],f=o/e[1];if((!r||4!==c||4!==t[1])&&(r||3!==c&&4!==c)||h%e[0]!=0||o%e[1]!=0||4!==t[0])throw new Error(`If transposeA ${r} is true, innerElementSize ${c} and workPerThread[1] ${t[1]} must be 4.\n      Otherwise, innerElementSize ${c} must be 3 or 4.\n  tileAWidth ${h} must be divisible by workgroupSize[0]${e[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`\nvar<workgroup> mm_Asub: array<array<vec${c}<${n}>, ${h/c}>, ${l}>;\nvar<workgroup> mm_Bsub: array<array<vec4<${n}>, ${u/t[0]}>, ${o}>;\n\nconst rowPerThread = ${t[1]};\nconst colPerThread = ${t[0]};\nconst innerElementSize = ${c};\nconst tileInner = ${o};\n\n@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ${s?"0":"i32(globalId.z)"};\n  ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}\n  let globalRowStart = i32(workgroupId.y) * ${A};\n\n  let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};\n  var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};\n\n  var acc: array<vec4<${n}>, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ${f};\n  for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ${Sr(r,i)}\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${i?", batchIndices":""});\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ${3===c?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}\n\n          ${Mr(r,c)}\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}`},Rr=(t,e)=>t?`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol${e?", batchIndices":""});\n            `:`\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol${e?", batchIndices":""});\n            `,Fr=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Gr=(t,e,n="f32",i,r=!1,o=32,s=!1,a=32,A=!1)=>{let u=t[1]*e[1],h=t[0]*e[0],l=r?u:o,c=r?o:u;if(c%e[1]!=0||l%e[0]!=0||o%e[1]!=0)throw new Error(`tileAHight ${c} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${l} must be divisible by workgroupSize[0]${e[0]}, tileInner ${o} must be divisible by workgroupSize[1]${e[1]}`);let f=c/e[1],d=l/e[0],g=o/e[1],v=A?`\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ${u};\n    let globalColStart = i32(workgroupId.x) * ${h};\n\n    // Loop over shared dimension.\n    for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ${c}; inputRow = inputRow + ${e[1]}) {\n        for (var inputCol = localCol; inputCol < ${l}; inputCol = inputCol + ${e[0]}) {\n          ${Rr(r,i)}\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${e[1]}) {\n            for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${e[0]}) {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol${i?", batchIndices":""});\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<${n}, colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ${r?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ${e[1]};\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ${e[0]};\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    `:`\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ${u};\n\nlet tileRowA = i32(localId.y) * ${f};\nlet tileColA = i32(localId.x) * ${d};\nlet tileRowB = i32(localId.y) * ${g};\n// Loop over shared dimension.\nfor (var t = 0; t < num_tiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ${d}; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ${Rr(r,i)}\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ${g}; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol${i?", batchIndices":""});\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<${n}, colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ${Fr(r)}\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n`;return`\n  var<workgroup> mm_Asub : array<array<${n}, ${l}>, ${c}>;\n  var<workgroup> mm_Bsub : array<array<${n}, ${h}>, ${o}>;\n  const rowPerThread = ${t[1]};\n  const colPerThread = ${t[0]};\n  const tileInner = ${o};\n\n@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ${s?"0":"i32(globalId.z)"};\n    ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}\n    let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};\n    var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};\n\n    var acc : array<array<${n}, colPerThread>, rowPerThread>;\n    ${v}\n  }\n`},Lr=(t,e,n,i,r,o=!1)=>{let[s,a,A]=r,[u,h,l,c]=i,f=ze(s,A),d=ze(a,A),g=Se(i[0].type.tensor);return`\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${u.type.indices}) -> ${_r(t,g)} {\n      var value = ${_r(t,g)}(0.0);\n      let col = colIn * ${t};\n      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)\n      {\n        ${(()=>{let t=h.rank,e=u.rank,n=`var aIndices: ${h.type.indices};`;for(let i=t-2-1,r=e-1;i>=0;i--,r--)n+=`\naIndices[${i}] = ${e>1?`batchIndices[${r}]`:"batchIndices"};`;return f.forEach((t=>{n+=`\naIndices[${t}] = 0;`})),n+=`\naIndices[${t-2}] = u32(row);\n                   aIndices[${t-1}] = u32(colIn);`,n})()}\n        value = ${h.getByIndices("aIndices")};\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${u.type.indices}) -> ${_r(t,g)} {\n      var value = ${_r(t,g)}(0.0);\n      let col = colIn * ${t};\n      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)\n      {\n        ${(()=>{let t=l.rank,e=u.rank,n=`var bIndices: ${l.type.indices};`;for(let i=t-2-1,r=e-1;i>=0;i--,r--)n+=`\nbIndices[${i}] = ${e>1?`batchIndices[${r}]`:"batchIndices"};`;return d.forEach((t=>{n+=`\nbIndices[${t}] = 0;`})),n+=`\nbIndices[${t-2}] = u32(row);\n                   bIndices[${t-1}] = u32(colIn);`,n})()}\n        value = ${l.getByIndices("bIndices")};\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${_r(t,g)}) {\n      let col = colIn * ${t};\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ${e?`value = value + ${o?"bias[colIn]":`${_r(t,g)}(bias[row])`};`:""}\n        ${n}\n        ${c.setByIndices("vec3<u32>(coords)","value")}\n      }\n    }\n    `},Nr=(t,e,n,i,r=!1)=>{let o=t[0].dims,s=t[1].dims,a=o.slice(0,-2),A=s.slice(0,-2),u=i?i.slice(0,-2):n.slice(0,-2),h=me.size(u),l=o[o.length-2],c=o[o.length-1],f=s[s.length-1],d=c%4==0&&f%4==0,g=l<=8?[4,1,1]:[4,4,1],v=[8,8,1],I=[Math.ceil(f/v[0]/g[0]),Math.ceil(l/v[1]/g[1]),Math.ceil(h/v[2]/g[2])],p=d?4:1,y=[...a,l,c/p],w=y.length,C=[...A,c,f/p],B=C.length,E=[h,l,f/p],m=[{type:6,data:l},{type:6,data:f},{type:6,data:c}];Qr(e,m),m.push(...$e(u,y,C));let Q=["rank","rank"],k=t.length>2;return k&&(m.push(...$e(t[2].dims)),Q.push("rank")),m.push(...$e(E)),{name:"MatMul",shaderCache:{hint:`${g};${e.activation};${d};${r}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:I[0],y:I[1],z:I[2]},programUniforms:m}),getShaderSource:n=>{let i=u.length,o=qe("batchDims",t[0].dataType,i,1),s=Se(t[0].dataType),h=Te("a",t[0].dataType,w,p),l=Te("b",t[1].dataType,B,p),c=Pe("result",t[0].dataType,E.length,p),f=[h,l];if(k){let e=r?p:1;f.push(Te("bias",t[2].dataType,t[2].dims.length,e))}let I=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];kr(e,I);let y=Se(c.type.tensor),C=mr(e,c.type.value,y),m=Lr(p,k,C,[o,h,l,c],[a,A,u],r);return`\n  ${n.registerUniforms(I).registerInternalVariables(o).declareVariables(...f,c)}\n  ${m}\n  ${d?$r(g,v,s,o):Gr(g,v,s,o)}\n                   `}}}})),qA=z((()=>{pA(),wA(),kA(),NA(),UA(),TA(),PA(),Ur=(t,e,n,i,r=!1,o,s=4,a=4,A=4,u="f32")=>{let h=t?"\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    ":"\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    ",l=t?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",c=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",f=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",d=t?"row":"col",g=t?"col":"row",v=`\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n    let outRow = ${d} / outWidth;\n    let outCol = ${d} % outWidth;\n\n    let WRow = ${g} / (i32(uniforms.w_shape[1]) * inChannels);\n    let WCol = ${g} / inChannels % i32(uniforms.w_shape[1]);\n    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];\n    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];\n    let xCh = ${g} % inChannels;\n    var resData = ${_r(s,u)}(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the 'same' padding type.\n    if (xRow >= 0 && xRow < ${c} && xCol >= 0 && xCol < ${f}) {\n      ${h}\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ${(t=>{switch(t){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${t} is not supported.`)}})(s)}\n    }\n    return resData;`,I=t?e&&i?`\n    let col = colIn * ${s};\n    ${v}`:`\n    let col = colIn * ${s};\n    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {\n      ${v}\n    }\n    return ${_r(s,u)}(0.0);`:i&&n?`\n    let col = colIn * ${s};\n    ${v}`:`\n    let col = colIn * ${s};\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ${v}\n    }\n    return ${_r(s,u)}(0.0);`,p=`${(t=>{switch(t){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${t} is not supported.`)}})(a)}`,y=_r(A,u),w=_r(t?s:a,u),C=_r(t?a:s,u),B=mr(o,y,u);return`\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${w} {\n      ${t?I:p}\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${C} {\n      ${t?p:I}\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${y}) {\n      let col = colIn * ${A};\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)\n      {\n      var value = valueIn;\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${l}\n      ${xr(r)}\n      ${B}\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }`},Tr=(t,e,n,i,r,o,s,a)=>{let A="NHWC"===e.format,u=A?t[0].dims[3]:t[0].dims[1],h=n[0],l=A?n[2]:n[3],c=A?n[1]:n[2],f=A?n[3]:n[1],d=A&&(u%4==0||u%3==0)&&f%4==0,g=A?f:l*c,v=A?l*c:f,I=[8,8,1],p=i<=8?[4,1,1]:[4,4,1],y=[Math.ceil(g/I[0]/p[0]),Math.ceil(v/I[1]/p[1]),Math.ceil(h/I[2]/p[2])];ue("verbose",(()=>`[conv2d_mm_webgpu] dispatch = ${y}`));let w=d?A&&u%4!=0?3:4:1,C=I[1]*p[1],B=I[0]*p[0],E=Math.max(I[0]*w,I[1]),m=i%C==0,Q=r%B==0,k=o%E==0,b=d?[w,4,4]:[1,1,1],_=[{type:6,data:i},{type:6,data:r},{type:6,data:o},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];Qr(e,_),_.push(...$e(t[0].dims,t[1].dims));let x=["rank","rank"];return s&&(_.push(...$e(t[2].dims)),x.push("rank")),_.push(...$e(n)),{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${w};${d};${m};${Q};${k};${C};${B};${E}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:_}),getShaderSource:i=>{let r=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];kr(e,r);let o=d?4:1,u=Se(t[0].dataType),h=`\n      fn setOutputAtIndex(flatIndex : i32, value : ${d?`vec4<${u}>`:u}) {\n        result[flatIndex] = ${d?`vec4<${u}>`:u}(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${d?`vec4<${u}>`:u}) {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ${d?"/ 4":""}, value);\n      }`,l=[Te("x",t[0].dataType,t[0].dims.length,3===w?1:w),Te("w",t[1].dataType,t[1].dims.length,o)],c=Pe("result",t[0].dataType,n.length,o);if(s){let e=Te("bias",t[2].dataType,t[2].dims.length,o);l.push(e),h+=`\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${d?`vec4<${u}>`:u} {\n          return bias[coords.${A?"w":"y"}${d?"/ 4":""}];\n        }`}return`\n        ${Dr("uniforms.result_strides")}\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ${i.registerUniforms(r).declareVariables(...l,c)}\n        ${h}\n        ${Ur(A,m,Q,k,s,e,b[0],b[1],b[2],u)}\n        ${d?$r(p,I,u,void 0,!A,E):Gr(p,I,u,void 0,!A,E,!1,void 0,a)}`}}}})),OA=z((()=>{pA(),wA(),QA(),kA(),NA(),UA(),Pr=t=>{let e=1;for(let n=0;n<t.length;n++)e*=t[n];return e},qr=t=>"number"==typeof t?[t,t,t]:t,Or=(t,e)=>e<=1?t:t+(t-1)*(e-1),Hr=(t,e,n,i=1)=>{let r=Or(e,i);return Math.floor((t[0]*(n-1)-n+r)/2)},zr=(t,e,n,i,r)=>{null==r&&(r=Hr(t,e[0],i[0]));let o=[0,0,0,n];for(let n=0;n<3;n++)t[n]+2*r>=e[n]&&(o[n]=Math.trunc((t[n]-e[n]+2*r)/i[n]+1));return o},Kr=(t,e,n,i,r,o,s,a,A,u)=>{let h,l,c,f;if("VALID"===t&&(t=0),"number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t};let d=zr([e,n,i,1],[a,A,u],1,[r,o,s],t);l=d[0],c=d[1],f=d[2]}else if(Array.isArray(t)){if(!t.every(((t,e,n)=>t===n[0])))throw Error(`Unsupported padding parameter: ${t}`);h={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let d=zr([e,n,i,1],[a,A,u],1,[r,o,s],t[0]);l=d[0],c=d[1],f=d[2]}else{if("SAME_UPPER"!==t)throw Error(`Unknown padding parameter: ${t}`);{l=Math.ceil(e/r),c=Math.ceil(n/o),f=Math.ceil(i/s);let t=(l-1)*r+a-e,d=(c-1)*o+A-n,g=(f-1)*s+u-i,v=Math.floor(t/2),I=t-v,p=Math.floor(d/2),y=d-p,w=Math.floor(g/2);h={top:p,bottom:y,left:w,right:g-w,front:v,back:I}}}return{padInfo:h,outDepth:l,outHeight:c,outWidth:f}},Vr=(t,e,n,i,r,o=!1,s="channelsLast")=>{let a,A,u,h,l;if("channelsLast"===s)[a,A,u,h,l]=t;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[a,l,A,u,h]=t}let[c,,f,d,g]=e,[v,I,p]=qr(n),[y,w,C]=qr(i),B=Or(f,y),E=Or(d,w),m=Or(g,C),{padInfo:Q,outDepth:k,outHeight:b,outWidth:_}=Kr(r,A,u,h,v,I,p,B,E,m),x=o?c*l:c,D=[0,0,0,0,0];return"channelsFirst"===s?D=[a,x,k,b,_]:"channelsLast"===s&&(D=[a,k,b,_,x]),{batchSize:a,dataFormat:s,inDepth:A,inHeight:u,inWidth:h,inChannels:l,outDepth:k,outHeight:b,outWidth:_,outChannels:x,padInfo:Q,strideDepth:v,strideHeight:I,strideWidth:p,filterDepth:f,filterHeight:d,filterWidth:g,effectiveFilterDepth:B,effectiveFilterHeight:E,effectiveFilterWidth:m,dilationDepth:y,dilationHeight:w,dilationWidth:C,inShape:t,outShape:D,filterShape:e}},Jr=(t,e,n,i,r,o)=>{let s="channelsLast"===o;s?t[0].dims[3]:t[0].dims[1];let a={x:n.map(((t,e)=>e))},A=[Math.ceil(Pr(a.x.map((t=>n[t])))/64),1,1];ue("verbose",(()=>`[conv3d_naive_webgpu] dispatch = ${A}`));let u=[{type:12,data:me.size(n)},{type:12,data:i},{type:12,data:r},{type:12,data:e.strides},{type:12,data:e.dilations}];Qr(e,u),u.push(...$e(t[0].dims,t[1].dims));let h=["rank","rank"],l=3===t.length;return l&&(u.push(...$e(t[2].dims)),h.push("rank")),u.push(...$e(n)),{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${s};1;${l}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:A[0],y:A[1],z:A[2]},programUniforms:u}),getShaderSource:o=>{let a=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:i.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];kr(e,a);let A=Se(t[0].dataType),u=Te("x",t[0].dataType,t[0].dims.length,1),h=Te("W",t[1].dataType,t[1].dims.length,1),c=[u,h],f=Pe("result",t[0].dataType,n.length,1),d="";if(l){let e=Te("bias",t[2].dataType,t[2].dims.length,1);c.push(e),d+=`\n        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${A} {\n          return bias[${Ne("coords",s?4:1,5)}];\n        }`}let g=_r(1,A),v=mr(e,g,A);return`\n            ${d}\n            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ${u.getByIndices("aIndices")};\n            }\n            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ${h.getByIndices("aIndices")};\n            }\n          ${o.registerUniforms(a).declareVariables(...c,f)}\n          ${o.mainStart()}\n          ${o.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n              let coords = ${f.offsetToIndices("global_idx")};\n              let batch = ${Ne("coords",0,u.rank)};\n              let d2 = ${Ne("coords",s?u.rank-1:1,u.rank)};\n              let xFRCCorner = vec3<u32>(${Ne("coords",s?1:2,u.rank)},\n              ${Ne("coords",s?2:3,u.rank)},\n              ${Ne("coords",s?3:4,u.rank)}) * uniforms.strides - uniforms.pads;\n              let xFCorner = xFRCCorner.x;\n              let xRCorner = xFRCCorner.y;\n              let xCCorner = xFRCCorner.z;\n              let xShapeY = ${Ne("uniforms.x_shape",s?1:2,u.rank)};\n              let xShapeZ = ${Ne("uniforms.x_shape",s?2:3,u.rank)};\n              let xShapeW = ${Ne("uniforms.x_shape",s?3:4,u.rank)};\n              let xShapeU = ${Ne("uniforms.x_shape",s?4:1,u.rank)};\n              let inputDepthNearestVec4 = (xShapeU / 4) * 4;\n              let inputDepthVec4Remainder = xShapeU % 4;\n\n              var value = 0.0;\n              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {\n                let xF = xFCorner + wF * uniforms.dilations[0];\n                if (xF < 0 || xF >= xShapeY) {\n                  continue;\n                }\n\n                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {\n                  let xR = xRCorner + wR * uniforms.dilations[1];\n                  if (xR < 0 || xR >= xShapeZ) {\n                    continue;\n                  }\n\n                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {\n                    let xC = xCCorner + wC * uniforms.dilations[2];\n                    if (xC < 0 || xC >= xShapeW) {\n                      continue;\n                    }\n\n                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {\n                      ${s?"let xValues = vec4<f32>(\n                               getX(batch, xF, xR, xC, d1),\n                               getX(batch, xF, xR, xC, d1 + 1),\n                               getX(batch, xF, xR, xC, d1 + 2),\n                               getX(batch, xF, xR, xC, d1 + 3));\n                            ":"let xValues = vec4<f32>(\n                               getX(batch, d1, xF, xR, xC),\n                               getX(batch, d1 + 1, xF, xR, xC),\n                               getX(batch, d1 + 2, xF, xR, xC),\n                               getX(batch, d1 + 3, xF, xR, xC));\n                            "}\n                            let wValues = vec4<f32>(\n                              getW(d2, d1, wF, wR, wC),\n                              getW(d2, d1 + 1, wF, wR, wC),\n                              getW(d2, d1 + 2, wF, wR, wC),\n                              getW(d2, d1 + 3, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                    if (inputDepthVec4Remainder == 1) {\n                        ${s?"value += getX(batch, xF, xR, xC, inputDepthNearestVec4)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);":"value += getX(batch, inputDepthNearestVec4, xF, xR, xC)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);"}\n                    } else if (inputDepthVec4Remainder == 2) {\n                      ${s?"let xValues = vec2<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));\n                      ":"let xValues = vec2<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));\n                    "}\n                    let wValues = vec2<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    } else if (inputDepthVec4Remainder == 3) {\n                      ${s?"let xValues = vec3<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));\n                      ":"let xValues = vec3<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));\n                    "}\n                    let wValues = vec3<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                  }\n                }\n              }\n              ${l?"value = value + getBiasByOutputCoords(coords)":""};\n              ${v}\n              result[global_idx] = f32(value);\n          }`}}}})),HA=z((()=>{pA(),QA(),kA(),KA(),NA(),Yr=(t,e,n)=>{let i=t.length>2,r=i?"value += b[output_channel];":"",o=t[0].dims,s=t[1].dims,a=s[0]/e.group,A="NHWC"===e.format,u=to(o,s,e.dilations,e.pads,e.strides,A),h=me.size(u),l=[{type:12,data:h},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:a}];Qr(e,l),l.push(...$e(o,s));let c=["rank","rank"];return i&&(l.push(...$e(t[2].dims)),c.push("rank")),l.push(...$e(u)),{name:"GroupedConv",shaderCache:{hint:e.cacheKey,inputDependencies:c},getRunData:()=>({outputs:[{dims:n?n(u):u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:l}),getShaderSource:n=>{let a=Pe("output",t[0].dataType,u.length),h=Se(a.type.tensor),l=mr(e,a.type.value,h),c=Te("x",t[0].dataType,o.length),f=Te("w",t[1].dataType,s.length),d=[c,f];i&&d.push(Te("b",t[2].dataType,t[2].dims.length));let g=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];return kr(e,g),`\n  ${n.registerUniforms(g).declareVariables(...d,a)}\n\n  ${n.mainStart()}\n    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let outputIndices = ${a.offsetToIndices("global_idx")};\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[${A?3:1}];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${A?1:2}], outputIndices[${A?2:3}]) * uniforms.strides - uniforms.pads;\n    let group_id: u32 = output_channel / uniforms.output_channels_per_group;\n\n    var value: ${a.type.value} = ${a.type.value}(0);\n    for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {\n      let input_channel = group_id * uniforms.w_shape[1] + wInChannel;\n      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n        if (xHeight < 0u || xHeight >= uniforms.x_shape[${A?1:2}]) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n          if (xWidth < 0u || xWidth >= uniforms.x_shape[${A?2:3}]) {\n            continue;\n          }\n\n          let xVal = ${A?c.get("batch","xHeight","xWidth","input_channel"):c.get("batch","input_channel","xHeight","xWidth")};\n          let wVal = ${f.get("output_channel","wInChannel","wHeight","wWidth")};\n          value += xVal*wVal;\n        }\n      }\n    }\n    ${r}\n    ${l}\n    ${a.setByOffset("global_idx","value")}\n  }`}}},jr=(t,e,n)=>{let i=t.length>2,r=Re(n[3]),o=Re(n[2]),s=me.size(n)/r/o,a=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/r],A=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/r],u=[n[0],n[1],n[2],n[3]/r],h=[{type:12,data:s},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];Qr(e,h),h.push(...$e(a,A,u));let l=(o-1)*e.strides[1]+A[1];return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${r};${o};${l};${A[0]};${A[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:h}),getShaderSource:n=>{let s=Pe("output",t[0].dataType,u.length,r),h=Se(s.type.tensor),c=mr(e,s.type.value,h),f=Te("x",t[0].dataType,a.length,r),d=Te("w",t[1].dataType,A.length,r),g=[f,d];i&&g.push(Te("b",t[2].dataType,t[2].dims,r));let v=i?"value += b[output_channel];":"",I=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return kr(e,I),`\n  ${n.registerUniforms(I).declareVariables(...g,s)}\n  ${n.mainStart()}\n    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let width0 = uniforms.output_shape[3];\n    let output_channel = global_idx % width0;\n    var index1 = global_idx / width0;\n    let width1 = uniforms.output_shape[2] / ${o}u;\n    let col = (index1 % width1) * ${o}u;\n    index1 = index1 / width1;\n    let row = index1 % uniforms.output_shape[1];\n    let batch = index1 / uniforms.output_shape[1];\n\n    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;\n\n    var x_vals: array<${f.type.value}, ${l}>;\n    var values: array<${s.type.value}, ${o}>;\n    let input_channel = output_channel;\n    // Use constant instead of uniform can give better performance for w's height/width.\n    for (var w_height: u32 = 0u; w_height < ${A[0]}; w_height++) {\n      let x_height = x_corner.x + i32(w_height);\n      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {\n        for (var i = 0; i < ${l}; i++) {\n          let x_width = x_corner.y + i;\n          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {\n            x_vals[i] = ${f.get("batch","u32(x_height)","u32(x_width)","input_channel")};\n          } else {\n            x_vals[i] = ${f.type.value}(0);\n          }\n        }\n        for (var w_width: u32 = 0u; w_width < ${A[1]}; w_width++) {\n          let w_val = ${d.get("w_height","w_width","0","output_channel")};\n          for (var i = 0u; i < ${o}u; i++) {\n            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);\n          }\n        }\n      }\n    }\n\n    for (var i = 0u; i < ${o}u; i++) {\n      var value = values[i];\n      ${v}\n      ${c}\n      ${s.set("batch","row","col + i","output_channel","value")};\n    }\n  }`}}}})),zA=z((()=>{pA(),QA(),PA(),kA(),NA(),Wr=(t,e,n,i,r=!1)=>{let o=t[0].dims,s=t[1].dims,a=o[o.length-2],A=s[s.length-1],u=o[o.length-1],h=Re(A),l=Re(u),c=Re(a),f=me.size(n)/h/c,d=t.length>2,g=i?i.slice(0,-2):n.slice(0,-2),v=[me.size(g),a,A],I=[{type:12,data:f},{type:12,data:a},{type:12,data:A},{type:12,data:u}];return Qr(e,I),I.push(...$e(g,o,s)),d&&I.push(...$e(t[2].dims)),I.push(...$e(v)),{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${h};${l};${c};${r}`,inputDependencies:d?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:I}),getShaderSource:i=>{let a=qe("batch_dims",t[0].dataType,g.length),A=Te("a",t[0].dataType,o.length,l),u=Te("b",t[1].dataType,s.length,h),f=Pe("output",t[0].dataType,v.length,h),I=Se(f.type.tensor),p=mr(e,f.type.value,I),y=[A,u],w="";if(d){let e=r?h:1;y.push(Te("bias",t[2].dataType,t[2].dims.length,e)),w=r?`value += bias[col / ${e}];`:`value += ${f.type.value}(bias[row + i]);`}let C=o.slice(0,-2),B=s.slice(0,-2),E=ze(C,g),m=ze(B,g),Q=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];kr(e,Q);let k=(t,e)=>{let n=t.rank,i=t.name;if(2===n)return`var ${i}_indices = ${t.type.indices}(0u, 0u);`;let r=a.rank,o=`var ${i}_indices: ${t.type.indices};`;for(let t=n-2-1,e=r-1;t>=0;t--,e--)o+=`\n${i}_indices[${t}] = ${r>1?`batch_indices[${e}]`:"batch_indices"};`;return e.forEach((t=>{o+=`\n${i}_indices[${t}] = 0;`})),o+=`${i}_indices[${n-2}] = 0u;\n                     ${i}_indices[${n-1}] = 0u;`,o};return`\n  ${i.registerUniforms(Q).registerInternalVariables(a).declareVariables(...y,f)}\n  ${i.mainStart()}\n    ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let col = (global_idx % (uniforms.N / ${h})) * ${h};\n    var index1 = global_idx / (uniforms.N / ${h});\n    let stride1 = uniforms.M / ${c};\n    let row = (index1 % stride1) * ${c};\n    let batch = index1 / stride1;\n\n    ${2===n.length?"":`let batch_indices = ${a.offsetToIndices("batch")};`}\n    ${k(A,E)}\n    let a_offset = ${A.indicesToOffset("a_indices")};\n    ${k(u,m)}\n    let b_offset = ${u.indicesToOffset("b_indices")};\n    var values: array<${f.type.value}, ${c}>;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ${l}) {\n      ${(()=>{let t=`var a_data: ${A.type.value};`;for(let e=0;e<l;e++)t+=`\n              let b_data${e} = b[(b_offset + (k + ${e}) * uniforms.N + col) / ${h}];`;for(let e=0;e<c;e++){t+=`a_data = a[(a_offset + (row + ${e}) * uniforms.K + k) / ${l}];`;for(let n=0;n<l;n++)t+=`\n            values[${e}] = fma(${u.type.value}(a_data${1===l?"":`[${n}]`}), b_data${n}, values[${e}]);\n`}return t})()}\n    }\n    for (var i = 0u; i < ${c}u; i++) {\n      var value = values[i];\n      ${w}\n      ${p}\n      let cur_indices = ${f.type.indices}(batch, row + i, col);\n      let offset = ${f.indicesToOffset("cur_indices")};\n      ${f.setByOffset(`offset / ${h}`,"value")};\n    }\n  }\n  `}}},Xr=t=>{if(!t||2!==t.length)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},Zr=t=>{Xr(t.inputs);let e=Ee.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let n=e[e.length-1],i=t.inputs[0].dims[t.inputs[0].dims.length-1];n<8&&i<8?t.compute(Wr(t.inputs,{activation:""},e)):t.compute(Nr(t.inputs,{activation:""},e))}})),KA=z((()=>{QA(),qA(),OA(),PA(),HA(),NA(),zA(),bA(),to=(t,e,n,i,r,o)=>{let s=t[0],a=t.slice(o?1:2,o?3:4),A=a.length,u=e[0],h=e.slice(2).map(((t,e)=>t+(t-1)*(n[e]-1))),l=a.map(((t,e)=>t+i[e]+i[e+A])).map(((t,e)=>Math.floor((t-h[e]+r[e])/r[e])));return l.splice(0,0,s),l.splice(o?3:1,0,u),l},eo=[2,3,1,0],no=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===e.format?t[0].dims.length-1:1]!==t[1].dims[1]*e.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===t.length&&(1!==t[2].dims.length||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let n=t[0].dims.length-2;if(e.dilations.length!==n)throw new Error(`dilations should be ${n}D`);if(e.strides.length!==n)throw new Error(`strides should be ${n}D`);if(e.pads.length!==2*n)throw new Error(`pads should be ${2*n}D`);if(0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},io=(t,e)=>{let n=t.kernelShape.slice();for(let t=2;t<e[1].dims.length;++t)0===n[t-2]&&(n[t-2]=e[1].dims[t]);let i=t.pads.slice();Qe.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,n,i,"NHWC"===t.format,t.autoPad);let r=Object.assign({},t);return Object.assign(r,{kernelShape:n,pads:i}),r},ro=t=>{let e=br(t),n=t.format;return{autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],format:n,dilations:t.dilations,group:t.group,kernelShape:t.kernel_shape,pads:t.pads,strides:t.strides,wIsConst:t.w_is_const(),...e,cacheKey:`${t.format};${e.activation};`}},oo=(t,e,n)=>{let i=io(n,e),r="NHWC"===n.format;if(1!==n.group){if(!t.adapterInfo.isArchitecture("ampere")&&r&&e[1].dims[0]===n.group&&1===e[1].dims[1]&&1===n.dilations[0]&&1===n.dilations[1]){let o=to(e[0].dims,e[1].dims,n.dilations,i.pads,n.strides,r),s=t.kernelCustomData.wT??t.compute(je(e[1],eo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=s);let a=[e[0],s];3===e.length&&a.push(e[2]),t.compute(jr(a,i,o),{inputs:a})}else t.compute(Yr(e,i));return}let o=3===e.length,s=e[0].dims[r?1:2],a=e[0].dims[r?2:3],A=e[0].dims[r?3:1],u=e[1].dims[2],h=e[1].dims[3],l=to(e[0].dims,e[1].dims,n.dilations,i.pads,n.strides,r),c=l[r?1:2],f=l[r?2:3],d=l[r?3:1],g=r&&u===s&&h===a&&0===n.pads[0]&&0===n.pads[1];if(g||1===u&&1===h&&1===n.dilations[0]&&1===n.dilations[1]&&1===n.strides[0]&&1===n.strides[1]&&0===n.pads[0]&&0===n.pads[1]){let u,h,v,I=l[0],p=[];if(r){let i=t.kernelCustomData.wT??t.compute(je(e[1],eo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=i),g){let t=s*a*A;u=e[0].reshape([1,I,t]),h=i.reshape([1,t,d]),v=[1,I,d]}else u=e[0].reshape([I,s*a,A]),h=i.reshape([1,A,d]),v=[I,c*f,d];p.push(u),p.push(h)}else u=e[0].reshape([I,A,s*a]),h=e[1].reshape([1,d,A]),v=[I,d,c*f],p.push(h),p.push(u);o&&p.push(e[2]);let y=v[2],w=p[0].dims[p[0].dims.length-1];return void(y<8&&w<8?t.compute(Wr(p,i,l,v,r),{inputs:p}):t.compute(Nr(p,i,l,v,r),{inputs:p}))}let v=t.kernelCustomData.wT??t.compute(je(e[1],eo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=v);let I=[e[0],v];o&&I.push(e[2]);let p=r?c*f:d,y=r?d:c*f,w=u*h*A;t.compute(Tr(I,i,l,p,y,w,o,!0),{inputs:I})},so=(t,e)=>{let n="NHWC"===e.format,i=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===t.inputs.length&&i.push(t.inputs[2]);let r=[0,e.pads[0],0,e.pads[1]],o=[1].concat(e.strides),s=[1].concat(e.dilations),a=[1].concat(e.kernelShape),A=io({...e,pads:r,strides:o,dilations:s,kernelShape:a},i);t.compute(Yr(i,A,(t=>n?[t[0],t[2],t[3]]:[])))},ao=(t,e,n)=>{let i="NHWC"===n.format?"channelsLast":"channelsFirst",r=io(n,e),o="NOTSET"===n.autoPad?n.pads:n.autoPad,s=Vr(e[0].dims,e[1].dims,n.strides,n.dilations,o,!1,i);t.compute(Jr(e,r,s.outShape,[s.filterDepth,s.filterHeight,s.filterWidth],[s.padInfo.front,s.padInfo.top,s.padInfo.left],i))},Ao=(t,e)=>{no(t.inputs,e),3===t.inputs[0].dims.length?so(t,e):5===t.inputs[0].dims.length?ao(t,t.inputs,e):oo(t,t.inputs,e)}})),VA=z((()=>{pA(),wA(),kA(),NA(),UA(),TA(),PA(),uo=(t,e=!1,n,i,r=4)=>{let o=t?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",s=t?"row":"col",a=t?"col":"row",A=`\n      let inChannels = ${t?"i32(uniforms.x_shape[3])":"i32(uniforms.x_shape[1])"};\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      let outRow = ${s} / outWidth;\n      let outCol = ${s} % outWidth;\n\n      let WRow = ${a} / (uniforms.filter_dims[1] * inChannels);\n      let WCol = ${a} / inChannels % uniforms.filter_dims[1];\n      let xR = f32(outRow - uniforms.pads[0] + uniforms.dilations[0] * WRow) / f32(uniforms.strides[0]);\n      let xC = f32(outCol - uniforms.pads[1] + uniforms.dilations[1] * WCol) / f32(uniforms.strides[1]);\n      if (xR < 0.0 || xR >= f32(${t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])"}) || fract(xR) > 0.0) {\n        return ${i}(0.0);\n      }\n      if (xC < 0.0 || xC >= f32(${t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])"}) || fract(xC) > 0.0) {\n        return ${i}(0.0);\n      }\n      let iXR = i32(xR);\n      let iXC = i32(xC);\n      let xCh = ${a} % inChannels;\n      ${t?"\n      let coord = vec4<i32>(batch, iXR, iXC, xCh);\n      ":"\n      let coord = vec4<i32>(batch, xCh, iXR, iXC);\n      "}\n      return x[getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape))/${r}];`,u=t?`\n      let col = colIn * ${r};\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {\n        ${A}\n      }\n      return ${i}(0.0);`:`\n      let col = colIn * ${r};\n      if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n        ${A}\n      }\n      return ${i}(0.0);`,h=`\n      let col = colIn * ${r};\n      let inChannels = ${t?"i32(uniforms.x_shape[3])":"i32(uniforms.x_shape[1])"};\n      let coordX = uniforms.filter_dims[0] - 1 - row / (uniforms.filter_dims[1] * inChannels);\n      let coordY = uniforms.filter_dims[1] - 1 - (row / inChannels) % uniforms.filter_dims[1];\n      if (${t?"row < uniforms.dim_inner && col < uniforms.dim_b_outer":"row < uniforms.dim_inner && col < uniforms.dim_a_outer"}  && coordX >= 0 && coordY >= 0) {\n        let rowInner = row % inChannels;\n        let coord = vec4<i32>(coordX, coordY, col, rowInner);\n        ${(t=>{switch(t){case 1:return"return w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];";case 4:return`\n            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);\n            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);\n            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);\n            let v0 = w[getIndexFromCoords4D(coord, vec4<i32>(uniforms.w_shape))];\n            let v1 = w[getIndexFromCoords4D(coord1, vec4<i32>(uniforms.w_shape))];\n            let v2 = w[getIndexFromCoords4D(coord2, vec4<i32>(uniforms.w_shape))];\n            let v3 = w[getIndexFromCoords4D(coord3, vec4<i32>(uniforms.w_shape))];\n            return ${i}(v0, v1, v2, v3);\n            `;default:throw new Error(`innerElementSize ${t} is not supported.`)}})(r)}\n      }\n      return ${i}(0.0);\n      `,l=mr(n,i);return`\n  fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${i} {\n    ${t?u:h}\n  }\n\n  fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${i} {\n    ${t?h:u}\n  }\n\n  fn mm_write(batch: i32, row : i32, colIn : i32, valueInput : ${i}) {\n    let col = colIn * ${r};\n    if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {\n      var value = valueInput;\n      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};\n      ${o}\n      ${xr(e)}\n      ${l}\n      result[getIndexFromCoords4D(coords, vec4<i32>(uniforms.result_shape))/${r}] = value;\n    }\n  }`},ho=(t,e,n,i,r,o,s,a)=>{let A="NHWC"===e.format,u=A?t[0].dims[3]:t[0].dims[1],h=n[0],l=A?n[2]:n[3],c=A?n[1]:n[2],f=A?n[3]:n[1],d=A&&u%4==0&&u%3&&f%4==0,g=A?f:l*c,v=A?l*c:f,I=[8,8,1],p=i<=8?[4,1,1]:[4,4,1],y=[Math.ceil(g/I[0]/p[0]),Math.ceil(v/I[1]/p[1]),Math.ceil(h/I[2]/p[2])];ue("verbose",(()=>`[conv_backprop_mm_webgpu] dispatch = ${y}`));let w=d?4:1,C=Math.max(I[0]*w,I[1]),B=d?4:1,E=[e.kernelShape[A?1:2],e.kernelShape[A?2:3]],m=[E[0]+(e.dilations[0]<=1?0:(E[0]-1)*(e.dilations[0]-1)),E[1]+(e.dilations[1]<=1?0:(E[1]-1)*(e.dilations[1]-1))],Q=[m[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),m[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],k=[{type:6,data:i},{type:6,data:r},{type:6,data:o},{type:6,data:e.strides},{type:6,data:e.dilations},{type:6,data:E},{type:6,data:Q}];Qr(e,k),k.push(...$e(t[0].dims,t[1].dims));let b=["rank","rank"];return s&&(k.push(...$e(t[2].dims)),b.push("rank")),k.push(...$e(n)),{name:"Conv2DTransposeMatMul",shaderCache:{hint:`${e.cacheKey};${p};${I};${d}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:k}),getShaderSource:i=>{let r=Te("x",t[0].dataType,t[0].dims.length,B),o=Te("w",t[1].dataType,t[1].dims.length,1),u=Pe("result",t[0].dataType,n.length,B),h=[r,o],l="";if(s){let e=Te("bias",t[2].dataType,t[2].dims.length,B);h.push(e),l+=`\n          fn getBiasByOutputCoords(coords : vec4<i32>) -> ${e.type.value} {\n            return bias[coords.${A?"w":"y"}${d?"/ 4":""}];\n          }`}let c=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"strides",type:"i32",length:2},{name:"dilations",type:"i32",length:2},{name:"filter_dims",type:"i32",length:E.length},{name:"pads",type:"i32",length:Q.length}];kr(e,c);let f=Se(t[0].dataType,1);if("f16"!==f&&"f32"!==f)throw new Error(`elemType ${f} is not supported.`);return`\n        ${Dr("uniforms.result_strides")}\n        ${i.registerUniforms(c).declareVariables(...h,u)};\n        ${l}\n        ${uo(A,s,e,r.type.value,w)}\n        ${d?$r(p,I,f,void 0,!A,C):Gr(p,I,f,void 0,!A,C,!1,void 0,a)}`}}}})),JA=z((()=>{pA(),wA(),QA(),kA(),lo=(t,e,n,i,r,o=!1,s,a,A=!1)=>{let u=A?1:2,h=A?2:3,l=A?3:1,c=o?2:1,f=`\n  fn setOutputAtIndex(flatIndex : u32, value : ${o?`vec4<${s}>`:s}) {\n    result[flatIndex] = ${o?`vec4<${s}>`:s}(value);\n  }`;i&&(f+=`\n    fn getBiasByOutputCoords(coords : vec4<u32>) -> ${o?`vec4<${s}>`:s} {\n      return bias[coords.${A?"w":"y"}${o?"/ 4":""}];\n    }`);let d=o?4:1,g=Te("W",e[1].dataType,e[1].dims.length,d),v=Te("Dy",e[0].dataType,e[0].dims.length,d),I=[v,g];i&&I.push(Te("bias",e[2].dataType,[n[l]].length,d));let p=Pe("result",e[0].dataType,n.length,d),y=`{\n        let batch: u32 = ${r?"global_id.z":"workgroup_id.z"} / uniforms.result_shape[1];\n        let r = ${r?"global_id.z":"workgroup_id.z"} % uniforms.result_shape[1];\n        let c = ${r?"global_id.y":"workgroup_id.y"} * ${c};\n        let d1: u32 = ${r?"global_id.x":"workgroup_id.x"} * 4;\n\n        let dyCorner = vec2<i32>(i32(r), i32(c)) - vec2<i32>(uniforms.pads);\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        var dotProd: array<vec4<${s}>, ${c}>;\n        for (var i = 0; i < ${c}; i++) {\n          dotProd[i] = vec4<${s}>(0.0);\n        }\n        for (var wR: u32 = 0; wR < uniforms.filter_dims[0]; wR = wR + 1) {\n          var dyR = (${s}(dyCorner.x) + ${s}(wR)) / ${s}(uniforms.strides.x);\n          let wRPerm = uniforms.filter_dims[0] - 1 - wR;\n          if (dyR < 0.0 || dyR >= ${s}(uniforms.Dy_shape[1]) ||\n              fract(dyR) > 0.0 || wRPerm < 0) {\n            continue;\n          }\n          let idyR: u32 = u32(dyR);\n\n          for (var wC: u32 = 0; wC < uniforms.filter_dims[1]; wC = wC + 1) {\n            let dyC = (${s}(dyCorner.y) + ${s}(wC)) / ${s}(uniforms.strides.y);\n            let dyC2 = (${s}(dyCorner.y) + 1.0 + ${s}(wC)) / ${s}(uniforms.strides.y);\n            let wCPerm = uniforms.filter_dims[1] - 1 - wC;\n            if (wCPerm < 0) {\n              continue;\n            }\n            var bDyCVal = true;\n            var bDyCVal2 = true;\n            if (dyC < 0.0 || dyC >= ${s}(uniforms.Dy_shape[2]) ||\n                fract(dyC) > 0.0) {\n              bDyCVal = false;\n            }\n            if (dyC2 < 0.0 || dyC2 >= ${s}(uniforms.Dy_shape[2]) ||\n                fract(dyC2) > 0.0) {\n              bDyCVal2 = false;\n            }\n\n            let idyC: u32 = u32(dyC);\n            let idyC2: u32 = u32(dyC2);\n            if (bDyCVal && bDyCVal2) {\n              let d2Length = uniforms.Dy_shape[3];\n              for (var d2 :u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${v.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${s}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n\n                xValue =  ${v.get("batch","idyR","idyC2","d2")};\n\n                dotProd[1] = dotProd[1] + vec4<${s}>(dot(xValue, wValue0),\n                                                    dot(xValue, wValue1),\n                                                    dot(xValue, wValue2),\n                                                    dot(xValue, wValue3));\n              }\n            } else if (bDyCVal) {\n              let d2Length = uniforms.Dy_shape[${l}];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${v.get("batch","idyR","idyC","d2")};\n                let tmpval = vec4<${s}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[0] = dotProd[0] + tmpval;\n              }\n            } else if (bDyCVal2) {\n              let d2Length = uniforms.Dy_shape[3];\n              for (var d2: u32 = 0; d2 < d2Length; d2 = d2 + 4) {\n                let wValue0 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1","d2")};\n                let wValue1 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 1","d2")};\n                let wValue2 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 2","d2")};\n                let wValue3 = ${g.get("u32(wRPerm)","u32(wCPerm)","d1 + 3","d2")};\n\n                var xValue = ${v.get("batch","idyR","idyC2","d2")};\n                let tmpval = vec4<${s}>(dot(xValue, wValue0),\n                                      dot(xValue, wValue1),\n                                      dot(xValue, wValue2),\n                                      dot(xValue, wValue3));\n                dotProd[1] = dotProd[1] + tmpval;\n              }\n            }\n          }\n        }\n\n        for (var i: u32 = 0; i < ${c}; i = i + 1) {\n          let value = dotProd[i] + ${i?"bias[c+i]":`vec4<${s}>(0.0)`};\n          ${p.set("batch","r","c + i","d1","value")};\n        }\n      }`,w=`\n          let outputIndices = ${p.offsetToIndices("global_idx")};\n          let batch = ${p.indicesGet("outputIndices",0)};\n          let d1 = ${p.indicesGet("outputIndices",l)};\n          let r = ${p.indicesGet("outputIndices",u)};\n          let c = ${p.indicesGet("outputIndices",h)};\n          let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;\n          let dyRCorner = dyCorner.x;\n          let dyCCorner = dyCorner.y;\n          let groupId = d1 / uniforms.output_channels_per_group;\n          let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;\n          // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n          // ? = to be determined. : = across all values in that axis.\n          var dotProd = ${s}(0.0);\n          for (var wR: u32 = 0; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {\n            if (wR % uniforms.dilations.x != 0) {\n              continue;\n            }\n            let dyR = (${s}(dyRCorner) + ${s}(wR)) / ${s}(uniforms.strides[0]);\n            let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;\n            if (dyR < 0.0 || dyR >= ${s}(uniforms.Dy_shape[${u}]) || fract(dyR) > 0.0 ||\n                wRPerm < 0) {\n              continue;\n            }\n            let idyR: u32 = u32(dyR);\n\n            for (var wC: u32 = 0; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {\n              if (wC % uniforms.dilations.y != 0) {\n                continue;\n              }\n              let dyC = (${s}(dyCCorner) + ${s}(wC)) / ${s}(uniforms.strides.y);\n              let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;\n              if (dyC < 0.0 || dyC >= ${s}(uniforms.Dy_shape[${h}]) ||\n                  fract(dyC) > 0.0 || wCPerm < 0) {\n                continue;\n              }\n              let idyC: u32 = u32(dyC);\n              var inputChannel = groupId * uniforms.input_channels_per_group;\n              for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group; d2 = d2 + 1) {\n                let xValue = ${A?v.get("batch","idyR","idyC","inputChannel"):v.get("batch","inputChannel","idyR","idyC")};\n                let wValue = ${g.get("inputChannel","wOutChannel","u32(wRPerm)","u32(wCPerm)")};\n                dotProd = dotProd + xValue * wValue;\n                inputChannel = inputChannel + 1;\n              }\n            }\n          }\n          let value = dotProd + ${i?"bias[d1]":`${s}(0.0)`};\n          ${p.setByOffset("global_idx","value")};\n        `;return`\n  ${t.registerUniforms(a).declareVariables(...I,p)}\n  ${f}\n\n    ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};\n  ${o?y:w}}`},co=(t,e,n)=>{let i=t.length>2,r=e.outputShape,o=me.size(r),s=[Math.ceil(o/64),1,1];ue("verbose",(()=>`[conv2d_backprop_webgpu] dispatch = ${s}`));let a="NHWC"===e.format,A=["rank","rank"],u=[e.strides[0],e.strides[1]],h=[e.kernelShape[a?1:2],e.kernelShape[a?2:3]],l=[e.dilations[0],e.dilations[1]],c=[h[0]+(e.dilations[0]<=1?0:(e.kernelShape[a?1:2]-1)*(e.dilations[0]-1)),h[1]+(e.dilations[1]<=1?0:(e.kernelShape[a?2:3]-1)*(e.dilations[1]-1))],f=[c[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),c[1]-1-Math.floor(e.pads[1]+e.pads[3])/2],d=e.group,g=t[1].dims,v=g[0]/d,I=g[1],p=[{type:12,data:o},{type:12,data:u},{type:12,data:h},{type:12,data:l},{type:12,data:c},{type:6,data:f},{type:12,data:v},{type:12,data:I},...$e(t[0].dims,t[1].dims)];i&&(p.push(...$e(t[2].dims)),A.push("rank")),p.push(...$e(r));let y=1===s[1]&&1===s[2];return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};`,inputDependencies:A},getRunData:()=>({dispatchGroup:{x:s[0],y:s[1],z:s[2]},outputs:[{dims:n?n(r):r,dataType:t[0].dataType}],programUniforms:p}),getShaderSource:e=>{let n=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:u.length},{name:"filter_dims",type:"u32",length:h.length},{name:"dilations",type:"u32",length:h.length},{name:"effective_filter_dims",type:"u32",length:c.length},{name:"pads",type:"i32",length:f.length},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],o=Se(t[0].dataType);return`${lo(e,t,r,i,y,!1,o,n,a)}`}}}})),YA=z((()=>{VA(),JA(),NA(),bA(),fo=(t,e,n,i,r,o)=>(t-1)*e+n+(i-1)*r+1-o,go=(t,e,n,i,r)=>{let o=Math.floor(t/2);"SAME_UPPER"===e?(n[i]=o,n[r]=t-o):"SAME_LOWER"===e&&(n[i]=t-o,n[r]=o)},vo=(t,e,n,i,r,o,s,a,A,u)=>{let h=t.length-2,l=0===u.length;if(0===A.length)for(let t=0;t<h;++t)A.push(0);let c=t[0],f=e[a?3:1]*r;for(let r=0,c=t.length-h-(a?1:0);r<h;++r,++c){let a=t[c],f=l?a*s[r]:u[r],d=fo(a,s[r],o[r],e[c],n[r],f);go(d,i,o,r,r+h),l&&u.push(s[r]*(a-1)+A[r]+(e[c]-1)*n[r]+1-o[r]-o[r+h])}u.splice(0,0,c),u.splice(a?3:1,0,f)},Io=(t,e)=>{let n=t.kernelShape.slice();if(0===t.kernelShape.length||0===t.kernelShape.reduce(((t,e)=>t*e),1)){n.length=0;for(let t=2;t<e[1].dims.length;++t)n.push(e[1].dims[t])}let i="NHWC"===t.format;n.splice(0,0,e[1].dims[0]),n.splice(i?3:1,0,e[1].dims[1]);let r=t.pads.slice(),o=t.outputShape.slice(),s=t.outputPadding.slice(),a=e[0].dims,A=t.dilations.slice();if(0===A.reduce(((t,e)=>t+e),0)){let t=e[0].dims.length-2;A=new Array(t).fill(1)}let u=t.strides.slice();if(0===u.reduce(((t,e)=>t+e),0)){let t=e[0].dims.length-2;u=new Array(t).fill(1)}vo(a,n,A,t.autoPad,t.group,r,u,i,s,o);let h=Object.assign({},t);return Object.assign(h,{kernelShape:n,pads:r,outputPadding:s,outputShape:o,dilations:A,strides:u}),h},po=t=>{let e=br(t),n=t.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],r=t.dilations,o=t.group,s=t.kernelShape,a=t.pads,A=t.strides,u=t.wIsConst();return{autoPad:i,format:n,dilations:r,group:o,kernelShape:s,outputPadding:t.outputPadding,outputShape:t.outputShape,pads:a,strides:A,wIsConst:u,...e,cacheKey:`${t.format};${e.activation};`}},yo=(t,e)=>{if(!t||2!==t.length&&3!==t.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length&&3!==t[0].dims.length)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===e.format?t[0].dims.length-1:1]!==t[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let n=t[1].dims[1]*e.group;if(3===t.length&&(1!==t[2].dims.length||t[2].dims[0]!==n))throw new Error("invalid bias");let i=t[0].dims.length-2;if(e.dilations.reduce(((t,e)=>t+e),0)>0&&e.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(e.strides.reduce(((t,e)=>t+e),0)>0&&e.strides.length!==i)throw new Error(`strides should be ${i}D`);if(e.pads.reduce(((t,e)=>t+e),0)>0&&e.pads.length!==2*i)throw new Error(`pads should be ${2*i}D`);if(e.outputPadding.length!==i&&0!==e.outputPadding.length)throw new Error(`output_padding should be ${i}D`);if(e.kernelShape.reduce(((t,e)=>t+e),0)>0&&0!==e.kernelShape.length&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(0!==e.outputShape.length&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},wo=[2,3,1,0],Co=(t,e,n)=>{let i=Io(n,e),r="NHWC"===n.format,o=i.outputShape,s=o[r?3:1],a=e[0].dims[r?3:1];if(1!==i.group||1===s&&1===a)return void t.compute(co(e,i));let A=o[r?1:2],u=o[r?2:3],h=r?A*u:s,l=r?s:A*u,c=e[1].dims[2]*e[1].dims[3]*a,f=t.kernelCustomData.wT??t.compute(je(e[1],wo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=f);let d=[e[0],f],g=3===e.length;g&&(r||1!==e[2].dims.length?d.push(e[2]):d.push(e[2].reshape([e[2].dims[0],1,1]))),t.compute(ho(d,i,o,h,l,c,g,!0),{inputs:d})},Bo=(t,e)=>{let n="NHWC"===e.format,i=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===t.inputs.length&&i.push(t.inputs[2]);let r=e.kernelShape;(0===r.length||0===r[0])&&(r=[t.inputs[1].dims[2]]);let o=e.dilations;(0===o.length||0===o[0])&&(o=[1]);let s=e.strides;(0===s.length||0===s[0])&&(s=[1]);let a=e.pads;0===a.length&&(a=[0,0]),a=[0,a[0],0,a[1]],s=[1].concat(s),o=[1].concat(o),r=[1].concat(r);let A=Io({...e,pads:a,strides:s,dilations:o,kernelShape:r},i);t.compute(co(i,A,(t=>n?[t[0],t[2],t[3]]:[t[0],t[1],t[3]])))},Eo=(t,e)=>{yo(t.inputs,e),3===t.inputs[0].dims.length?Bo(t,e):Co(t,t.inputs,e)}})),jA=z((()=>{pA(),QA(),mA(),kA(),mo=(t,e,n,i)=>{let r=me.size(e),o=e.length,s=Te("input",t,o),a=Pe("output",t,o),A=6===n.dataType?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),u=me.normalizeAxis(A,o);return{name:"CumSum",shaderCache:{hint:i.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:u},...$e(e,e)]}),getShaderSource:t=>{let e=` i32(${s.indicesGet("inputIndices","uniforms.axis")}) `,n=Ne("uniforms.input_shape","uniforms.axis",o),r=i.reverse?e+(i.exclusive?" + 1":""):"0",A=i.reverse?n:e+(i.exclusive?"":" + 1");return`\n                ${t.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(s,a)}\n                ${t.mainStart()}\n                  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n                  var inputIndices = ${a.offsetToIndices("global_idx")};\n                  var sum = ${a.type.value}(0);\n                  let first : i32 = ${r};\n                  let last : i32 = ${A};\n                  for (var i : i32 = first; i < last; i++) {\n                    ${s.indicesSet("inputIndices","uniforms.axis","u32(i)")};\n                    sum = sum + ${s.getByIndices("inputIndices")};\n                  }\n                  ${a.setByOffset("global_idx","sum")};\n                }`}}},Qo=(t,e)=>{let n=t.inputs[0].dims,i=t.inputs[0].dataType,r=t.inputs[1];t.compute(mo(i,n,r,e),{inputs:[0]})},ko=t=>{let e=1===t.exclusive,n=1===t.reverse;return Ce({exclusive:e,reverse:n})}})),WA=z((()=>{pA(),QA(),mA(),kA(),bo=t=>{if(!t||1!==t.length)throw new Error("DepthToSpace requires 1 input.");if(4!==t[0].dims.length)throw new Error("DepthToSpace requires 4D input.")},_o=(t,e,n,i)=>{let r=[];r.push(`fn perm(i: ${i.type.indices}) -> ${n.type.indices} {\n    var a: ${n.type.indices};`);for(let i=0;i<e;++i)r.push(n.indicesSet("a",t[i],`i[${i}]`));return r.push("return a;}"),r.join("\n")},xo=(t,e)=>{let n,i,r,o,s,a,A="NHWC"===e.format,u=e.blocksize,h="DCR"===e.mode;A?([n,i,r,o]=t.dims,s=h?[n,i,r,u,u,o/u**2]:[n,i,r,o/u**2,u,u],a=h?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,i,r,o]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],s=h?[n,u,u,o/u**2,i,r]:[n,o/u**2,u,u,i,r],a=h?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let l=t.reshape(s),c=l.dims.length,f=t.dataType,d=Te("a",f,c),g=Pe("output",f,c);return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:t=>{let e=A?[n,i*u,r*u,o/u**2]:[n,o/u**2,i*u,r*u],s=me.size(e),h=l.dims,c=me.sortBasedOnPerm(h,a);return{outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},...$e(h,c)]}},getShaderSource:t=>`\n  ${t.registerUniform("output_size","u32").declareVariables(d,g)}\n\n  ${_o(a,c,d,g)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let indices = ${g.offsetToIndices("global_idx")};\n    let aIndices = perm(indices);\n\n    ${g.setByOffset("global_idx",d.getByIndices("aIndices"))}\n  }`}},Do=(t,e)=>{bo(t.inputs),t.compute(xo(t.inputs[0],e))},So=t=>Ce({blocksize:t.blocksize,mode:t.mode,format:t.format})})),XA=z((()=>{pA(),QA(),mA(),kA(),Ro="^"+($o="("+(Mo="[a-zA-Z]|\\.\\.\\.")+")+")+"$",Fo="^("+$o+",)*"+$o+"$",Go=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let n=this.symbolToIndices.get(t);void 0===n?n=[e]:n.push(e),this.symbolToIndices.set(t,n)}},Lo=class{constructor(t,e){this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,i]=e.includes("->")?e.split("->",2):[e,""];if(!n.match(RegExp(Fo)))throw new Error("Invalid LHS term");if(n.split(",").forEach(((e,n)=>{let i=t[n].dims.slice();if(!e.match(RegExp(Ro)))throw new Error("Invalid LHS term");let r=this.processTerm(e,!0,i,n);this.lhs.push(r)})),""===i)i+=[...this.symbolToInfo.entries()].filter((([t,e])=>1===e.count||"..."===t)).map((([t])=>t)).join("");else if(!i.match(RegExp($o)))throw new Error("Invalid RHS");i.match(RegExp(Mo,"g"))?.forEach((t=>{if("..."===t)this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let e=this.symbolToInfo.get(t);if(void 0===e)throw new Error("Invalid RHS symbol");this.outputDims.push(e.dimValue)}})),this.rhs=this.processTerm(i,!1,this.outputDims)}addSymbol(t,e,n){let i=this.symbolToInfo.get(t);if(void 0!==i){if(i.dimValue!==e&&1!==i.count)throw new Error("Dimension mismatch");i.count++,i.inputIndices.push(n)}else i={count:1,dimValue:e,inputIndices:[n]};this.symbolToInfo.set(t,i)}processTerm(t,e,n,i=-1){let r=n.length,o=!1,s=[],a=0;if(!t.match(RegExp(Ro))&&!e&&""!==t)throw new Error("Invalid LHS term");let A=t.match(RegExp(Mo,"g")),u=new Go(i);return A?.forEach(((t,h)=>{if("..."===t){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let t=r-A.length+1;if(t<0)throw new Error("Ellipsis out of bounds");if(s=n.slice(a,a+t),this.hasEllipsis){if(this.ellipsisDims.length!==s.length||this.ellipsisDims.toString()!==s.toString())throw new Error("Ellipsis dimensions mismatch")}else{if(!e)throw new Error("Ellipsis must be specified in the LHS");this.hasEllipsis=!0,this.ellipsisDims=s}for(let t=0;t<s.length;t++){let e=String.fromCharCode("0".charCodeAt(0)+t);u.addSymbol(e,h+t),this.addSymbol(e,n[a++],i)}}else u.addSymbol(t,h+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(t,n[a++],i)})),u}},No=t=>t+"_max",Uo=(t,e,n,i)=>{let r=t.map((t=>t.length)).map(((t,n)=>Te(`input${n}`,e,t))),o=me.size(i),s=Pe("output",e,i.length),a=[...n.symbolToInfo.keys()].filter((t=>!n.rhs.symbolToIndices.has(t)));return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:t.map((()=>"rank"))},getRunData:()=>{let r=a.filter((t=>n.symbolToInfo.has(t))).map((t=>({type:12,data:n.symbolToInfo.get(t)?.dimValue||0})));r.push({type:12,data:o});let s=t.map(((t,e)=>[...$e(t)])).reduce(((t,e)=>t.concat(e)),r);return s.push(...$e(i)),{outputs:[{dims:i,dataType:e}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:s}},getShaderSource:t=>{let e=[],i=[],o=[],A=[],u=[],h=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach(((t,a)=>{if(n.rhs.symbolToIndices.has(a)){let i=n.rhs.symbolToIndices.get(a)?.[0];void 0!==i&&n.lhs.forEach(((n,o)=>{if(t.inputIndices.includes(o)){let t=n.symbolToIndices.get(a);if(void 0===t)throw new Error("Invalid symbol error");t.forEach((t=>{e.push(`${r[o].indicesSet(`input${o}Indices`,t,s.indicesGet("outputIndices",i))}`)}))}}))}else n.lhs.forEach(((e,n)=>{if(t.inputIndices.includes(n)){let t=e.symbolToIndices.get(a);if(void 0===t)throw new Error("Invalid symbol error");t.forEach((t=>{i.push(`${r[n].indicesSet(`input${n}Indices`,t,`${a}`)}`)})),u.push(`prod *= ${r[n].getByIndices(`input${n}Indices`)};`)}})),o.push(`for(var ${a}: u32 = 0; ${a} < uniforms.${No(a)}; ${a}++) {`),A.push("}")}));let l=h?[...e,`let sum = ${r.map(((t,e)=>t.getByIndices(`input${e}Indices`))).join(" * ")};`]:[...e,"var sum = 0.0;",...o,...i,"var prod = 1.0;",...u,"sum += prod;",...A];return`\n            ${t.registerUniforms(a.map((t=>({name:`${No(t)}`,type:"u32"})))).registerUniform("outputSize","u32").declareVariables(...r,s)}\n\n            ${t.mainStart()}\n            ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n            var outputIndices = ${s.offsetToIndices("global_idx")};\n            ${r.map(((t,e)=>`var input${e}Indices: ${r[e].type.indices};`)).join("\n")}\n            ${l.join("\n")};\n            ${s.setByOffset("global_idx","sum")};\n          }`}}},To=(t,e)=>{let n=new Lo(t.inputs,e.equation),i=n.outputDims,r=t.inputs.map(((t,e)=>t.dims));t.compute(Uo(r,t.inputs[0].dataType,n,i))},Po=t=>{let e=t.equation.replace(/\s+/g,"");return Ce({equation:e})}})),ZA=z((()=>{pA(),QA(),kA(),qo=t=>{if(!t||2!==t.length)throw new Error("Expand requires 2 input.");let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),i=n.length<e.length?0:n.length-e.length,r=e.length<n.length?0:e.length-n.length;for(;i<n.length&&r<e.length;++i,++r)if(n[i]!==e[r]&&1!==n[i]&&1!==e[r])throw new Error("Expand requires shape to be broadcastable to input")},Oo=(t,e)=>{let n=t.length-e.length,i=[];for(let e=0;e<n;++e)i.push(t[e]);for(let r=0;r<e.length;++r)i.push(1===e[r]?t[r+n]:e[r]);return i},Ho=(t,e)=>t.length>e.length?Oo(t,e):Oo(e,t),zo=t=>{let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),i=Ho(e,n),r=t[0].dataType,o=9===r?4:1,s=Math.ceil(me.size(i)/o),a=[{type:12,data:s},...$e(e,i)];return{name:"Expand",shaderCache:{hint:`${i.length}`,inputDependencies:["rank"]},getShaderSource:t=>{let n,s=Te("input",r,e.length,o),a=Pe("output",r,i.length,o);if(9===r){let t=(t,e,n="")=>`\n          let outputIndices${e} = ${a.offsetToIndices(`outputOffset + ${e}u`)};\n          let offset${e} = ${s.broadcastedIndicesToOffset(`outputIndices${e}`,a)};\n          let index${e} = offset${e} / 4u;\n          let component${e} = offset${e} % 4u;\n          ${t}[${e}] = ${n}(${s.getByOffset(`index${e}`)}[component${e}]);\n        `;n=`\n        let outputOffset = global_idx * ${o};\n        var data = vec4<u32>(0);\n        ${t("data",0,"u32")}\n        ${t("data",1,"u32")}\n        ${t("data",2,"u32")}\n        ${t("data",3,"u32")}\n        ${a.setByOffset("global_idx","data")}\n      }`}else n=`\n        let outputIndices = ${a.offsetToIndices("global_idx")};\n        let inputOffset = ${s.broadcastedIndicesToOffset("outputIndices",a)};\n        ${a.setByOffset("global_idx",s.getByOffset("inputOffset"))}\n      }`;return`\n    ${t.registerUniform("vec_size","u32").declareVariables(s,a)}\n    ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n    ${n}`},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:a})}},Ko=t=>{qo(t.inputs),t.compute(zo(t.inputs),{inputs:[0]})}})),tu=z((()=>{pA(),QA(),kA(),RA(),Vo=t=>{let e=t[0].dataType,n=me.size(t[0].dims),i=me.size(t[1].dims),r=i%4==0;return{name:"FastGeluWithBias",shaderCache:{hint:`${r}`,inputDependencies:["type","type"]},getShaderSource:t=>{let n=Te("x",e,[1],4),i=Te("bias",e,[1],4),o=Pe("y",e,[1],4),s=t=>`\n      let bias${t}_offset: u32 = (global_idx * 4 + ${t}) % uniforms.bias_size;\n      let bias${t} = ${i.getByOffset(`bias${t}_offset / 4`)}[bias${t}_offset % 4];`,a=r?`\n      let bias = ${i.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${s(0)}${s(1)}${s(2)}${s(3)}\n      let bias = ${n.type.value}(bias0, bias1, bias2, bias3);`;return`${t.registerUniforms([{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}]).declareVariables(n,i,o)}\n\n    ${Ji(Me(e))}\n\n    ${t.mainStart(xe)}\n      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}\n\n      let x = ${n.getByOffset("global_idx")};\n      ${a}\n      let x_in = x + bias;\n      ${o.setByOffset("global_idx",Yi("x_in"))}\n    }`},getRunData:t=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:i}],dispatchGroup:{x:Math.ceil(n/xe/4)}})}},Jo=t=>{t.inputs.length<2||0===me.size(t.inputs[1].dims)?ji(t):t.compute(Vo(t.inputs))}})),eu=z((()=>{pA(),QA(),mA(),kA(),Yo=t=>{if(!t||2!==t.length)throw new Error("Gather requires 2 inputs.")},jo=(t,e)=>{let n=t[0].dims,i=t[1].dims,r=n.length,o=me.normalizeAxis(e.axis,r),s=n.slice(0);s.splice(o,1,...i);let a=n[o],A=9===t[0].dataType?4:1,u=Math.ceil(me.size(s)/A),h=[{type:12,data:u},{type:6,data:a},{type:12,data:o},...$e(t[0].dims,t[1].dims,s)];return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:e=>{let n,a=Te("data",t[0].dataType,t[0].dims.length,A),u=Te("inputIndices",t[1].dataType,t[1].dims.length),h=Pe("output",t[0].dataType,s.length,A),l=t=>{let e=i.length,n=`var indicesIndices${t}  = ${u.type.indices}(0);`;for(let i=0;i<e;i++)n+=`${e>1?`indicesIndices${t}[${i}]`:`indicesIndices${t}`} = ${s.length>1?`outputIndices${t}[uniforms.axis + ${i}]`:`outputIndices${t}`};`;n+=`\n          var idx${t} = ${u.getByIndices(`indicesIndices${t}`)};\n          if (idx${t} < 0) {\n            idx${t} = idx${t} + uniforms.axisDimLimit;\n          }\n          var dataIndices${t} : ${a.type.indices};\n        `;for(let i=0,a=0;i<r;i++)i===o?(n+=`${r>1?`dataIndices${t}[${i}]`:`dataIndices${t}`} = u32(idx${t});`,a+=e):(n+=`${r>1?`dataIndices${t}[${i}]`:`dataIndices${t}`} = ${s.length>1?`outputIndices${t}[${a}]`:`outputIndices${t}`};`,a++);return n};if(9===t[0].dataType){let t=(t,e,n="")=>`\n          let outputIndices${e} = ${h.offsetToIndices(`outputOffset + ${e}u`)};\n          ${l(e)};\n          let offset${e} = ${a.indicesToOffset(`dataIndices${e}`)};\n          let index${e} = offset${e} / 4u;\n          let component${e} = offset${e} % 4u;\n          ${t}[${e}] = ${n}(${a.getByOffset(`index${e}`)}[component${e}]);\n        `;n=`\n        let outputOffset = global_idx * ${A};\n        var value = vec4<u32>(0);\n        ${t("value",0,"u32")}\n        ${t("value",1,"u32")}\n        ${t("value",2,"u32")}\n        ${t("value",3,"u32")}\n        ${h.setByOffset("global_idx","value")}\n      `}else n=`\n      let outputIndices = ${h.offsetToIndices("global_idx")};\n      ${l("")};\n      let value = ${a.getByIndices("dataIndices")};\n      ${h.setByOffset("global_idx","value")};\n      `;return`\n      ${e.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(a,u,h)}\n      ${e.mainStart()}\n        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        ${n}\n      }`}}},Wo=t=>Ce({axis:t.axis}),Xo=(t,e)=>{let n=t.inputs;Yo(n),t.compute(jo(t.inputs,e))}})),nu=z((()=>{pA(),QA(),mA(),kA(),Zo=t=>{if(!t||2!==t.length)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error("GatherElements requires that the data input and\n                     indices input tensors be of same rank.")},ts=(t,e)=>{let n=t[0].dims,i=t[0].dataType,r=n.length,o=t[1].dims,s=t[1].dataType,a=me.normalizeAxis(e.axis,r),A=n[a],u=o.slice(0),h=me.size(u),l=Te("input",i,r),c=Te("indicesInput",s,o.length),f=Pe("output",i,u.length),d=[{type:12,data:h},{type:6,data:A},{type:12,data:a}];return d.push(...$e(n,o,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:d}),getShaderSource:t=>`\n      ${t.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(l,c,f)}\n      ${t.mainStart()}\n      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n      let outputIndices = ${f.offsetToIndices("global_idx")};\n\n      var idx = ${c.getByOffset("global_idx")};\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ${l.type.indices}(outputIndices);\n      ${l.indicesSet("inputIndices","uniforms.axis","u32(idx)")};\n      let value = ${l.getByIndices("inputIndices")};\n\n      ${f.setByOffset("global_idx","value")};\n  }`}},es=t=>Ce({axis:t.axis}),ns=(t,e)=>{let n=t.inputs;Zo(n),t.compute(ts(t.inputs,e))}})),iu=z((()=>{pA(),QA(),kA(),is=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(3===t.length&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||3===t.length&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},rs=(t,e)=>{let n=t[0].dims.slice(),i=t[1].dims.slice(),[r,o,s]=ke.getShapeOfGemmResult(n,e.transA,i,e.transB,3===t.length?t[2].dims:void 0),a=[r,o];if(!a)throw new Error("Can't use gemm on the given tensors");let A=me.size(a),u=[{type:12,data:A},{type:12,data:r},{type:12,data:o},{type:12,data:s},{type:1,data:e.alpha},{type:1,data:e.beta}],h=["type","type"];return 3===t.length&&(u.push(...$e(t[2].dims)),h.push("rank")),u.push(...$e(a)),{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:u}),getShaderSource:n=>{let i="";e.transA&&e.transB?i="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?i="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?i="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(i="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let r=1===e.alpha?"":"value *= uniforms.alpha;",o=Te("a",t[0].dataType,t[0].dims),s=Te("b",t[1].dataType,t[1].dims),A=o.type.value,u=null,h=[o,s];3===t.length&&(u=Te("c",t[2].dataType,t[2].dims.length),h.push(u));let l=Pe("output",t[0].dataType,a.length);return h.push(l),`\n  ${n.registerUniforms([{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}]).declareVariables(...h)}\n\n  ${n.mainStart()}\n    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n    let m = global_idx / uniforms.N;\n    let n = global_idx % uniforms.N;\n\n    var value = ${A}(0);\n    for (var k: u32 = 0u; k < uniforms.K; k++) {\n      ${i}\n    }\n\n    ${r}\n    ${null!=u?`let cOffset = ${u.broadcastedIndicesToOffset("vec2(m, n)",l)}; value += ${A}(uniforms.beta) * ${u.getByOffset("cOffset")};`:""}\n    output[global_idx] = value;\n  }`}}},os=t=>({transA:t.transA,transB:t.transB,alpha:t.alpha,beta:t.beta,cacheKey:`${t.transA};${t.transB};${1===t.alpha}`}),ss=(t,e)=>{is(t.inputs),t.compute(rs(t.inputs,e))}})),ru=z((()=>{pA(),QA(),mA(),BA(),SA(),kA(),bA(),as=(t,e)=>t.length>e&&t[e].dims.length>0&&me.size(t[e].dims)>0?t[e]:void 0,As=(t,e)=>{let n=t[0],i=as(t,1),r=as(t,2),o=as(t,3),s=as(t,4),a=as(t,5),A=as(t,6),u=as(t,7);if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let h,l=n.dims[0],c=n.dims[1],f=3===n.dims.length?n.dims[2]:e.numHeads*n.dims[4],d=c,g=0,v=0,I=Math.floor(f/e.numHeads);if(A&&u){if(4!==A.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(A.dims[0]!==l||A.dims[1]!==e.numHeads||A.dims[3]!==I)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==l||u.dims[1]!==e.numHeads||u.dims[3]!==I)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(A.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(4!==u.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');g=A.dims[2],v=A.dims[2]}else if(A||u)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');if(i){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===i.dims.length){if(i.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');h=2,d=i.dims[1]}else if(5===i.dims.length){if(i.dims[2]!==e.numHeads||2!==i.dims[3]||i.dims[4]!==I)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');h=5,d=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==I)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');h=0,d=i.dims[2]}}else{if(3!==n.dims.length&&5!==n.dims.length)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===n.dims.length&&(n.dims[2]!==e.numHeads||3!==n.dims[3]))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');h=3}if(o){if(1!==o.dims.length)throw new Error('Input "bias" is expected to have 1 dimension');if(r&&5===n.dims.length&&2===n.dims[3])throw new Error("bias is not allowed for packed kv.")}let p=0;if(s){p=8;let t=s.dims;throw 1===t.length?t[0]===l?p=1:t[0]===3*l+2&&(p=3):2===t.length&&t[0]===l&&t[1]===d&&(p=5),8===p?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, kv_sequence_length)'):new Error("Mask not supported")}let y=!1,w=f;if(r){if(3!==r.dims.length&&4!==r.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===r.dims.length){if(d!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');w=r.dims[2]}else{if(d!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');w=r.dims[1]*r.dims[3],y=!0}}let C=g+d;if(s)throw new Error("Key padding mask is not supported");if(a){if(4!==a.dims.length)throw new Error('Input "relative_position_bias" is expected to have 4 dimensions');if(a.dims[0]!==l&&1!==a.dims[0]||a.dims[1]!==e.numHeads||a.dims[2]!==c||a.dims[3]!==C)throw new Error('Input "relative_position_bias" shape (batch_size, 1, sequence_length, kv_sequence_length)')}return{batchSize:l,sequenceLength:c,pastSequenceLength:g,kvSequenceLength:d,totalSequenceLength:C,maxSequenceLength:v,inputHiddenSize:0,hiddenSize:f,vHiddenSize:w,headSize:I,vHeadSize:Math.floor(w/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:p,scale:e.scale,broadcastResPosBias:!1,passPastInKv:y,qkvFormat:h}},us=t=>Ce({...t}),hs=Ce({perm:[0,2,1,3]}),ls=(t,e,n,i,r,o,s)=>{let a=[i,r,o],A=me.size(a),u=[{type:12,data:A},{type:12,data:s},{type:12,data:o}];return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:u}),getShaderSource:t=>{let i=Pe("qkv_with_bias",e.dataType,a),r=Te("qkv",e.dataType,a),o=Te("bias",n.dataType,a);return`\n  ${t.registerUniforms([{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}]).declareVariables(r,o,i)}\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }`}},{inputs:[e,n],outputs:[-1]})[0]},cs=(t,e,n,i,r,o,s,a)=>{let A=o;if(s){if(1===i)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return A=ls(t,o,s,e,i,n*r,a),A=A.reshape([e,i,n,r]),t.compute(je(A,hs.perm),{inputs:[A],outputs:[-1]})[0]}return 3===o.dims.length&&(A=o.reshape([e,i,n,r])),t.compute(je(A,hs.perm),{inputs:[A],outputs:[-1]})[0]},fs=(t,e)=>{let n=As(t.inputs,e),i=t.inputs[0],r=as(t.inputs,1),o=as(t.inputs,2),s=as(t.inputs,3),a=as(t.inputs,4),A=as(t.inputs,5),u=as(t.inputs,6),h=as(t.inputs,7);if(5===i.dims.length)throw new Error("Packed QKV is not implemented");if(5===r?.dims.length)throw new Error("Packed KV is not implemented");let l=r&&o&&4===r.dims.length&&4===o.dims.length,c=cs(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,i,s,0);if(l)return ei(t,c,r,o,a,void 0,u,h,A,n,e);if(!r||!o)throw new Error("key and value must be provided");let f=cs(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,r,s,n.hiddenSize),d=cs(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,o,s,2*n.hiddenSize);ei(t,c,f,d,a,void 0,u,h,A,n,e)}})),ou=z((()=>{pA(),QA(),kA(),ds=t=>Array.from(t.getBigInt64Array(),Number),gs=t=>{if(!t||2!==t.length)throw new Error("Tile requires 2 inputs.");if(1!==t[0].dataType&&10!==t[0].dataType&&6!==t[0].dataType&&12!==t[0].dataType)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(7!==t[1].dataType)throw new Error("Tile `repeats` input should be of int64 data type");if(1!==t[1].dims.length)throw new Error("Tile `repeats` input should be 1-D");if(ds(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},vs=(t,e)=>{let n=[];for(let i=0;i<t.length;++i)n.push(t[i]*e[i]);return n},Is=(t,e)=>{let n=t[0].dims,i=e??ds(t[1]),r=vs(n,i),o=me.size(r),s=t[0].dataType,a=Te("input",s,n.length),A=Pe("output",s,r.length);return{name:"Tile",shaderCache:{hint:`${i}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...$e(t[0].dims,r)]}),getShaderSource:t=>`\n      const inputShape = ${a.indices(...n)};\n      ${t.registerUniform("output_size","u32").declareVariables(a,A)}\n      ${t.mainStart()}\n      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n      let output_indices = ${A.offsetToIndices("global_idx")};\n      var input_indices: ${a.type.indices};\n      for (var i = 0; i < ${n.length}; i++) {\n        let input_dim_i = ${a.indicesGet("uniforms.input_shape","i")};\n        let input_dim_value = ${A.indicesGet("output_indices","i")}  % input_dim_i;\n\n        ${a.indicesSet("input_indices","i","input_dim_value")}\n      }\n      ${A.setByOffset("global_idx",a.getByIndices("input_indices"))}\n    }`}},ps=t=>{gs(t.inputs),t.compute(Is(t.inputs),{inputs:[0]})}})),su=z((()=>{pA(),QA(),mA(),SA(),kA(),ru(),ou(),bA(),ys=(t,e)=>{let n=t[0],i=t[1],r=t[2],o=t[3],s=t[4];if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let a,A=n.dims[0],u=n.dims[1],h=3===n.dims.length?n.dims[2]:e.numHeads*n.dims[4],l=u,c=0,f=0,d=Math.floor(h/e.numHeads),g=o&&0!==o.dims.length,v=s&&0!==s.dims.length;if(g&&v){if(4!==o.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(4!==s.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');c=o.dims[1],f=o.dims[1]}else if(g||v)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');if(i){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===i.dims.length){if(n.dims[2]%i.dims[2]!=0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');a=2,l=i.dims[1]}else if(5===i.dims.length){if(i.dims[2]!==e.numHeads||2!==i.dims[3]||i.dims[4]!==d)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');a=5,l=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==d)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');a=0,l=i.dims[2]}}else{if(3!==n.dims.length&&5!==n.dims.length)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===n.dims.length&&(n.dims[2]!==e.numHeads||3!==n.dims[3]))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');a=3}let I=!1,p=h;if(r){if(3!==r.dims.length&&4!==r.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===r.dims.length){if(l!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');p=r.dims[2]}else{if(l!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');p=r.dims[1]*r.dims[3],I=!0}}return{batchSize:A,sequenceLength:u,pastSequenceLength:c,kvSequenceLength:l,totalSequenceLength:c+l,maxSequenceLength:f,inputHiddenSize:0,hiddenSize:h,vHiddenSize:p,headSize:d,vHeadSize:Math.floor(p/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:0,scale:e.scale,broadcastResPosBias:!1,passPastInKv:I,qkvFormat:a,isPastkvBSNH:!0}},ws=(t,e,n,i)=>{let r=[i.batchSize,i.totalSequenceLength,i.kvNumHeads,i.headSize],o=me.size(r)/4,s=i.totalSequenceLength,a=Pe("present_kv",n,r.length,4),A=Te("new_kv",t.dataType,t.dims.length,4),u=e?Te("past_kv",e.dataType,e.dims.length,4):void 0,h=Math.ceil(i.headSize/4),l={x:s,y:t.dims[0],z:1},c=e?["rank","rank"]:["rank"],f=[{type:12,data:o},{type:12,data:i.pastSequenceLength},{type:12,data:i.kvSequenceLength},{type:12,data:i.totalSequenceLength}],d=[A];u?(f.push(...$e(t.dims),...$e(e.dims),...$e(r)),d.push(u)):f.push(...$e(t.dims),...$e(r));let g=[{name:"output_size",type:"u32"},{name:"past_seqlen",type:"u32"},{name:"new_seqlen",type:"u32"},{name:"present_seqlen",type:"u32"}],v="      let new_batch_stride = uniforms.new_seqlen * num_heads * H;\n        let new_row_stride = num_heads * H;\n        let new_head_stride = H;\n        let in_offset = b * new_batch_stride + (s - past_seqlen) * new_row_stride + n * new_head_stride + h;\n        present_kv[out_offset] = new_kv[in_offset];",I=e?`if (s < past_seqlen) {\n              let past_batch_stride = uniforms.past_seqlen * num_heads * H;\n        var past_head_stride = uniforms.past_seqlen * H;\n        if (is_bsnh) {\n          past_head_stride = H;\n        }\n        let in_offset = b * past_batch_stride + s * row_stride + n * past_head_stride + h;\n        present_kv[out_offset] = past_kv[in_offset];\n        } else if (s < past_seqlen + uniforms.new_seqlen) {\n        ${v}\n        }`:`if (s < past_seqlen + uniforms.new_seqlen) {\n          ${v}\n        }`;return{name:"ConcatPastNew",shaderCache:{hint:`${i.kvNumHeads}${h}${!!e}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:r,dataType:n}],dispatchGroup:l,programUniforms:f}),getShaderSource:t=>`\n\n  ${t.registerUniforms(g).declareVariables(...d,a)}\n  ${t.mainStart([h,i.kvNumHeads,1])}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n    var indices = ${a.offsetToIndices("global_idx")};\n    let h = local_id.x;\n    let n = local_id.y;\n    let s = workgroup_id.x;\n    let b = workgroup_id.y;\n    let num_heads = ${i.kvNumHeads}u;\n    let H = ${h}u;\n\n    let present_seqlen = uniforms.present_seqlen;\n    let present_batch_stride = present_seqlen * num_heads * H;\n    var row_stride = H;\n    let is_bsnh = ${i.isPastkvBSNH};\n\n    if (is_bsnh) {\n      row_stride = num_heads * H;\n    }\n    var present_head_stride = present_seqlen * H;\n    if (is_bsnh) {\n      present_head_stride = H;\n    }\n\n    let past_seqlen = uniforms.past_seqlen;\n\n    let out_offset = b * present_batch_stride + s * row_stride + n * present_head_stride + h;\n    ${I}\n  }`}},Cs=t=>Ce({...t}),Bs=Ce({perm:[0,2,1,3]}),Es=(t,e,n,i,r)=>{let o=e,s=i.kvNumHeads,a=i.nReps;return 3===e.dims.length&&0!==i.kvSequenceLength&&(o=e.reshape([i.batchSize,i.kvSequenceLength,s,i.headSize])),o=n?t.compute(ws(o,n,o.dataType,i),{inputs:[o,n],outputs:[i.isPastkvBSNH?r:-1]})[0]:t.compute(ws(o,void 0,o.dataType,i),{inputs:[o],outputs:[i.isPastkvBSNH?r:-1]})[0],1!==a&&(o=t.compute(Is([o],[1,1,1,a]),{inputs:[o],outputs:[-1]})[0],o=o.reshape([i.batchSize,i.totalSequenceLength,s*a,i.headSize])),t.compute(je(o,Bs.perm),{inputs:[o],outputs:[-1]})[0]},ms=(t,e)=>{let n=ys(t.inputs,e);if(5===t.inputs[0].dims.length)throw new Error("Packed QKV is not implemented");if(5===t.inputs[1]?.dims.length)throw new Error("Packed KV is not implemented");let i=cs(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,t.inputs[0],void 0,0),r=t.inputs[3]&&0!==t.inputs[3].dims.length?t.inputs[3]:void 0,o=t.inputs[4]&&0!==t.inputs[4].dims.length?t.inputs[4]:void 0,s=Es(t,t.inputs[1],r,n,1),a=Es(t,t.inputs[2],o,n,2);ei(t,i,s,a,void 0,void 0,void 0,void 0,void 0,n,e)}})),au=z((()=>{pA(),QA(),kA(),Qs=(t,e)=>{let n=t[0].dims,i=n,r=me.sizeToDimension(n,2),o=me.sizeFromDimension(n,2),s=Re(o),a=o/s,A=[n[0],n[1],a],u=[{type:12,data:o},{type:12,data:a}];return u.push(...$e(A,A)),{name:"InstanceNormalization",shaderCache:{hint:`${e.epsilon};${s}`,inputDependencies:["rank","type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:r},programUniforms:u}),getShaderSource:n=>{let i=Te("x",t[0].dataType,A.length,s),r=Te("scale",t[1].dataType,t[1].dims),o=Te("bias",t[2].dataType,t[2].dims),a=Pe("output",t[0].dataType,A.length,s),u=[i,r,o,a],h=i.type.value,l=1===s?"f32":`vec${s}<f32>`;return`\n  var<workgroup> meanShared : f32;\n  var<workgroup> squaredNormShared : f32;\n  var<workgroup> workgroupShared : array<${l}, 64>;\n  const workgroupSize = 64u;\n  ${n.registerUniforms([{name:"normSize",type:"u32"},{name:"normPackedSize",type:"u32"}]).declareVariables(...u)}\n  ${n.mainStart(64)}\n    let norm = global_idx / workgroupSize;\n    let batch = norm / uniforms.x_shape[1];\n    let channel = norm % uniforms.x_shape[1];\n    let localIndex = local_id.x;\n\n    // initialize workgroup memory\n    var initial = ${l}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      initial = initial + ${l}(${i.get("batch","channel","h")});\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the mean of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      meanShared = ${Le("workgroupShared[0]",s)} / f32(uniforms.normSize);\n    }\n    workgroupBarrier();\n\n    // reinitialize workgroup memory.\n    initial = ${l}(0);\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let deviation =  ${l}(${i.get("batch","channel","h")}) - ${l}(meanShared);\n      initial = initial + deviation * deviation;\n    }\n    workgroupShared[localIndex] = initial;\n    workgroupBarrier();\n\n    // Calculate the sum of square of deviation of current channel data.\n    for (var currSize = workgroupSize >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (localIndex < currSize) {\n        workgroupShared[localIndex] = workgroupShared[localIndex] + workgroupShared[localIndex + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (localIndex == 0) {\n      squaredNormShared = ${Le("workgroupShared[0]",s)};\n    }\n    workgroupBarrier();\n\n    let invStdDev = inverseSqrt(squaredNormShared / f32(uniforms.normSize) + f32(${e.epsilon}));\n    let channelScale = invStdDev * f32(${r.getByOffset("channel")});\n    let channelShift = f32(${o.getByOffset("channel")}) - meanShared * channelScale;\n    for (var h = localIndex; h < uniforms.normPackedSize; h += workgroupSize) {\n      let value = ${i.get("batch","channel","h")} * ${h}(${l}(channelScale)) + ${h}(${l}(channelShift));\n      ${a.set("batch","channel","h","value")};\n    }\n  }`}}},ks=(t,e,n,i,r,o,s,a)=>{let A=Re(s),u=1===A?"vec2f":`mat2x${A}f`,h=1===A?"f32":`vec${A}f`,l=(t,e)=>`${u}(${t}, ${e})`,c=r*s/A,f=[{type:12,data:Math.ceil(o/64)},{type:12,data:o},{type:12,data:Math.floor(s/A)},{type:12,data:Math.floor(o*s/A)}],d=t.compute({name:"InstanceNormComputeMean",shaderCache:{hint:`${A}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:[r,s,64,2],dataType:1}],dispatchGroup:{x:r*s/A},programUniforms:f}),getShaderSource:t=>{let n=Te("input",e.dataType,e.dims,A);return`\n  ${t.declareVariables(n)}\n  @group(0) @binding(1) var<storage, read_write> output : array<${u}>;\n  struct Uniforms {wg_size:u32, H:u32, C:u32, image_size:u32};\n  @group(0) @binding(2) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart(64)}\n    let currentImageNumber = global_idx / 64 / uniforms.C;\n    let currentChannelNumber = (global_idx / 64) % uniforms.C;\n    let wgOffset = local_id.x * uniforms.wg_size;\n    if (wgOffset >= uniforms.H) {\n        return;\n    }\n    let wgMax = min(wgOffset + uniforms.wg_size, uniforms.H);\n\n    let offset = currentImageNumber * uniforms.image_size + currentChannelNumber;\n    var sum = ${Fe("f32",A)};\n    var squaredSum = ${Fe("f32",A)};\n    for (var i: u32 = wgOffset; i < wgMax; i++) {\n        let value = ${h}(input[offset + i * uniforms.C]);\n        sum += value;\n        squaredSum += value * value;\n    }\n    output[global_idx] = ${l("sum","squaredSum")};\n  }`}},{inputs:[e],outputs:[-1]})[0],g=[{type:12,data:c},{type:12,data:o},{type:12,data:Math.floor(s/A)},{type:12,data:Math.floor(64*s/A)}];return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${A};${a}`,inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:[r,s,2],dataType:1}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:g}),getShaderSource:t=>{let e=Te("scale",n.dataType,n.dims,A),r=Te("bias",i.dataType,i.dims,A);return`\n  @group(0) @binding(0) var<storage, read> input : array<${u}>;\n  @group(0) @binding(1) var<storage, read> scale : array<${e.type.storage}>;\n  @group(0) @binding(2) var<storage, read> bias : array<${r.type.storage}>;\n  @group(0) @binding(3) var<storage, read_write> output : array<${u}>;\n  struct Uniforms {units_of_work : u32, H: u32, C : u32, image_size : u32};\n  @group(0) @binding(4) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.units_of_work")}\n    let currentImageNumber = global_idx / uniforms.C;\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let offset = currentImageNumber * uniforms.image_size;\n    var sum = ${Fe("f32",A)};\n    var squaredSum = ${Fe("f32",A)};\n    for (var i: u32 = 0; i < min(64, uniforms.H); i++) {\n        let value = input[offset + i + currentChannelNumber * 64];\n        sum += value[0];\n        squaredSum += value[1];\n    }\n    sum = sum / f32(uniforms.H);\n    squaredSum = squaredSum / f32(uniforms.H);\n    let invStdDev = inverseSqrt(squaredSum - sum * sum + f32(${a}));\n    let channelScale = invStdDev * ${h}(scale[currentChannelNumber]);\n    let channelShift = ${h}(bias[currentChannelNumber]) - sum * channelScale;\n\n    output[global_idx] = ${l("channelScale","channelShift")};\n  }`}},{inputs:[d,n,i],outputs:[-1]})[0]},bs=(t,e,n)=>{let i=e[0].dims,r=i,o=i[0],s=i[i.length-1],a=me.sizeFromDimension(i,1)/s,A=Re(s),u=me.size(r)/A,h=[{type:12,data:a},{type:12,data:Math.floor(s/A)}],l=ks(t,e[0],e[1],e[2],o,a,s,n.epsilon);t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${A}`,inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:t=>{let n=Se(e[0].dataType),i=1===A?"vec2f":`mat2x${A}f`,o=1===A?n:`vec${A}<${n}>`,s=Te("input",e[0].dataType,e[0].dims,A),a=Pe("output",e[0].dataType,r,A);return`\n  @group(0) @binding(0) var<storage, read> input : array<${s.type.storage}>;\n  @group(0) @binding(1) var<storage, read> scaleInput : array<${i}>;\n  @group(0) @binding(2) var<storage, read_write> output : array<${a.type.storage}>;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ${t.mainStart()}\n    let currentImageNumber = global_idx / (uniforms.C * uniforms.H);\n    let currentChannelNumber = global_idx % uniforms.C;\n\n    let scaleOffset = currentImageNumber * uniforms.C + currentChannelNumber;\n    let scale = scaleInput[scaleOffset];\n    output[global_idx] = fma(input[global_idx], ${o}(scale[0]), ${o}(scale[1]));\n  }`}},{inputs:[e[0],l]})},_s=(t,e)=>{"NHWC"===e.format?bs(t,t.inputs,e):t.compute(Qs(t.inputs,e))}})),Au=z((()=>{pA(),QA(),kA(),xs=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},Ds=(t,e,n)=>{let i=e.simplified,r=t[0].dims,o=t[1],s=!i&&t[2],a=r,A=me.normalizeAxis(e.axis,r.length),u=me.sizeToDimension(r,A),h=me.sizeFromDimension(r,A),l=me.size(o.dims),c=s?me.size(s.dims):0;if(l!==h||s&&c!==h)throw new Error(`Size of X.shape()[axis:] == ${h}.\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ${l} and bias size of ${c}`);let f=[];for(let t=0;t<r.length;++t)t<A?f.push(r[t]):f.push(1);let d=Re(h),g=["type","type"],v=[{type:12,data:u},{type:1,data:h},{type:12,data:Math.floor(h/d)},{type:1,data:e.epsilon}];s&&g.push("type");let I=n>1,p=n>2,y=[{dims:a,dataType:t[0].dataType}];return I&&y.push({dims:f,dataType:1}),p&&y.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${d};${n};${i}`,inputDependencies:g},getRunData:()=>({outputs:y,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:v}),getShaderSource:e=>{let n=Se(t[0].dataType),r=[Te("x",t[0].dataType,t[0].dims,d),Te("scale",o.dataType,o.dims,d)];return s&&r.push(Te("bias",s.dataType,s.dims,d)),r.push(Pe("output",t[0].dataType,a,d)),I&&r.push(Pe("mean_data_output",1,f)),p&&r.push(Pe("inv_std_output",1,f)),`\n  ${e.registerUniforms([{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...r)}\n  ${e.mainStart()}\n    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var mean_vector = ${Fe("f32",d)};\n    var mean_square_vector = ${Fe("f32",d)};\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ${Ge(n,d,"x[h + offset]")};\n      mean_vector += value;\n      mean_square_vector += value * value;\n    }\n    let mean = ${Le("mean_vector",d)} / uniforms.norm_size;\n    let inv_std_dev = inverseSqrt(${Le("mean_square_vector",d)} / uniforms.norm_size ${i?"":"- mean * mean"} + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ${Ge(n,d,"x[j + offset]")};\n      let f32scale = ${Ge(n,d,"scale[j]")};\n      output[j + offset] = ${r[0].type.value}((f32input ${i?"":"- mean"}) * inv_std_dev * f32scale\n        ${s?`+ ${Ge(n,d,"bias[j]")}`:""}\n      );\n    }\n\n    ${I?"mean_data_output[global_idx] = mean":""};\n    ${p?"inv_std_output[global_idx] = inv_std_dev":""};\n  }`}}},Ss=(t,e)=>{xs(t.inputs),t.compute(Ds(t.inputs,e,t.outputCount))}})),uu=z((()=>{pA(),QA(),mA(),kA(),Ms=(t,e)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=t[0],i=n.dims.length;if(n.dims[i-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((e.k+e.blockSize-1)/e.blockSize),o=e.blockSize/8*e.bits,s=t[1];if(!me.areEqual(s.dims,[e.n,r,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let a=t[2].dims;if(me.size(a)!==e.n*r)throw new Error("scales input size error.");if(4===t.length){let n=t[3].dims,i=e.bits>4?e.n*r:e.n*Math.floor((r+1)/2);if(me.size(n)!==i)throw new Error("zeroPoints input size error.")}},$s=(t,e,n,i)=>{let r=t[0].dims,o=r.length,s=Math.floor((e.k+e.blockSize-1)/e.blockSize),a=r[o-2],A=e.k,u=e.n,h=r.slice(0,o-2),l=me.size(h),c=e.blockSize/8*e.bits/4,f=t[0].dataType,d=Re(a),g=Re(e.k),v=Re(c),I=Zt(f),p=a*s*I,y=Math.floor(i/p),w=s<=n[0]&&y>0,C=!w||y>=4?Re(u):y>=2&&Re(u)>=2?2:1,B=h.concat([a,u]),E=me.size(B)/C/d,m=w?[]:[{type:12,data:E},{type:12,data:e.blockSize}],Q=[l,a,A/g],k=me.convertShape(t[1].dims).slice();k.splice(-1,1,c/v),m.push(...$e(Q)),m.push(...$e(k)),m.push(...$e(t[2].dims)),4===t.length&&m.push(...$e(me.convertShape(t[3].dims)));let b=[l,a,u/C];return m.push(...$e(b)),{name:w?"BlockwiseMatMulNBits":"MatMulNBits",shaderCache:{hint:`${e.cacheKey};${a};${f};${t.length}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:B,dataType:f}],name:w?"BlockwiseMatMulNBits":"MatMulNBits",dispatchGroup:w?{x:1,y:Math.ceil(u/C),z:l}:{x:Math.ceil(E/64)},programUniforms:m}),getShaderSource:n=>{let i=Q.length,r=Te("a",t[0].dataType,i,g),o=Te("b",12,k.length,v),A=Te("scales",t[2].dataType,t[2].dims.length),h=[r,o,A],l=4===t.length?Te("zero_points",12,t[3].dims.length):void 0;l&&h.push(l);let f=b.length,I=Pe("output",t[0].dataType,f,C),p=Se(t[0].dataType),y=(()=>{switch(g){case 1:return`array<${p}, 8>`;case 2:return`mat4x2<${p}>`;case 4:return`mat2x4<${p}>`;default:throw new Error(`${g}-component is not supported.`)}})(),B=`\n        for (var word: u32 = 0; word < ${c}; word += ${v}) {\n          ${o.indicesSet("b_indices","2","word")};\n          let b_data = ${o.getByIndices("b_indices")};\n          for (var i: u32 = 0; i < ${v}; i++) {\n            let b_value: u32 = ${1===v?"b_data":"b_data[word + i]"};\n            let b_mask: u32 = 0x0F0F0F0Fu;\n            let b_value_lower: vec4<u32> = unpack4xU8(b_value & b_mask);\n            let b_value_upper: vec4<u32> = unpack4xU8((b_value >> 4) & b_mask);\n            let b_quantized_values = ${y}(${Array.from({length:4},((t,e)=>`${p}(b_value_lower[${e}]), ${p}(b_value_upper[${e}])`)).join(", ")});\n            let b_dequantized_values = ${1===g?`${y}(${Array.from({length:8},((t,e)=>`(b_quantized_values[${e}] - zero_point) * scale`)).join(", ")});`:`(b_quantized_values - ${y}(${Array(8).fill("zero_point").join(",")})) * scale;`};\n            // Number of B elements per 32-bit word is 32/bits = 32/4 = 8\n            for (var m: u32 = 0; m < ${w?a:d}u; m++) {\n              ${r.indicesSet("a_indices",i-2,w?"m":`row * ${d} + m`)};\n              ${r.indicesSet("a_indices",i-1,"word_offset")};\n              var input_offset = ${r.indicesToOffset("a_indices")};\n              var a_data: ${y};\n              for (var j: u32 = 0; j < ${8/g}; j++) {\n                a_data[j] = ${r.getByOffset("input_offset")};\n                input_offset++;\n              }\n              ${w?"workgroup_shared[workgroup_shared_offset + m]":"output_values[m]"}${C>1?"[c]":""} += ${Array.from({length:8/g},((t,e)=>1===g?`a_data[${e}] * b_dequantized_values[${e}]`:`dot(a_data[${e}], b_dequantized_values[${e}])`)).join(" + ")};\n            }\n            word_offset += ${8/g};\n          }\n        }`,E=l?`\n          zero_point_offset += 4;\n          if (zero_point_offset == 32) {\n            zero_point_offset = 0;\n            zero_point_index++;\n            zero_point_word = ${l.getByOffset("zero_point_index")};\n          }`:"";return w?`\n        var<workgroup> workgroup_shared: array<${I.type.value}, ${a*s}>;\n        ${n.declareVariables(...h,I)}\n        ${n.mainStart([s,1,1])}\n          var a_indices: ${r.type.indices};\n          var block = local_id.x;\n          var col = workgroup_id.y;\n          var batch = workgroup_id.z;\n          ${r.indicesSet("a_indices","0","batch")};\n          // Two zero points are packed into one byte when uniforms.bits is 4.\n          for (var c: u32 = 0; c < ${C}; c++) {\n            let col_times_components_plus_c = col * ${C} + c;\n              ${l?`\n            var zero_point_bytes_per_col: u32 = (${s} + 1) / 2;\n            var zero_point_byte_count: u32 = col_times_components_plus_c * zero_point_bytes_per_col + (block >> 0x1u);\n            var zero_point_word_index: u32 = zero_point_byte_count >> 0x2u;\n            var zero_point_byte_offset: u32 = zero_point_byte_count & 0x3u;\n            var zero_point_nibble_offset: u32 = block & 0x1u;\n            var zero_point_bits_offset: u32 = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            var zero_point_word: u32 = ${l.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;`:""}\n            var b_indices: ${o.type.indices};\n            ${o.indicesSet("b_indices","0","col_times_components_plus_c")};\n            // The scale and zero points are computed per block.\n            var scales_index = col_times_components_plus_c * ${s} + block;\n            let scale = ${A.getByOffset("scales_index")};\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ${p}(${l?"(zero_point_word) & 0xFu":8});\n            ${o.indicesSet("b_indices","1","block")};\n            var word_offset: u32 = block * ${e.blockSize/g};\n            var workgroup_shared_offset: u32 = block * ${a};\n            ${B}\n          }\n          workgroupBarrier();\n          var output_indices: ${I.type.indices};\n          var elements_per_thread: u32 = ${Math.ceil(a/s)};\n          ${I.indicesSet("output_indices","0","batch")};\n          ${I.indicesSet("output_indices",f-1,"col")};\n          ${I.indicesSet("output_indices",f-2,"local_id.x * elements_per_thread")};\n          var output_offset = ${I.indicesToOffset("output_indices")};\n          for (var m: u32 = 0u; m < elements_per_thread; m++) {\n            var row = m + local_id.x * elements_per_thread;\n            if (row < ${a}) {\n              var output_value: ${I.type.value} = ${I.type.value}(0);\n              var workgroup_shared_offset: u32 = row;\n              for (var b: u32 = 0u; b < ${s}u; b++) {\n                output_value += workgroup_shared[workgroup_shared_offset];\n                workgroup_shared_offset += ${a};\n              }\n              ${I.setByOffset("output_offset","output_value")};\n              output_offset += ${u/C};\n            }\n          }\n        }`:`\n        ${n.registerUniforms([{name:"output_size",type:"u32"},{name:"block_size",type:"u32"}]).declareVariables(...h,I)}\n        ${n.mainStart()}\n          ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n          var output_values: array<${I.type.value}, ${d}>;\n          var output_indices = ${I.offsetToIndices("global_idx")};\n          var col = ${I.indicesGet("output_indices",f-1)};\n          var row = ${I.indicesGet("output_indices",f-2)};\n          var a_indices: ${r.type.indices} = output_indices;\n          // Two zero points are packed into one byte because uniforms.bits <= 4.\n          // zero_point_offset is either 0 or 4. It is bit offset within one byte.\n          // TODO support zero_point_offset for bits > 4\n          ${l?`\n          var zero_point_abs_offset = col * ${C} * ((${s} + 1) / 2);\n          var zero_point_index: u32 = zero_point_abs_offset / 4;\n          var zero_point_word: u32 = ${l.getByOffset("zero_point_index")};\n          var zero_point_offset: u32 = (zero_point_abs_offset % 4) * 8;`:""}\n          var scale_index = col * ${s*C};\n          var b_indices: ${o.type.indices};\n          for (var c: u32 = 0; c < ${C}; c++) {\n            ${o.indicesSet("b_indices","0",`col * ${C} + c`)};\n            var block_offset: u32 = 0;\n            for (var block: u32 = 0; block < ${s}; block++) {\n              // The scale and zero points are computed per block.\n              let scale = ${A.getByOffset("scale_index")};\n              // The default zero point is 8 for unsigned 4-bit quantization.\n              let zero_point = ${p}(${l?"extractBits(zero_point_word, zero_point_offset, 4)":8});\n              ${o.indicesSet("b_indices","1","block")};\n              var word_offset: u32 = block_offset;\n              ${B}\n              scale_index++;\n              ${E}\n              block_offset += uniforms.block_size / ${g};\n            }\n            // Drop the trailing 4 bits if the zero_poit_offset is not a byte boundary to align with the next byte.\n            ${l?`if (zero_point_offset % 8 > 0) {\n                ${E}\n              }`:""}\n            }\n            for (var k: u32 = 0u; k < ${d}u; k++) {\n              ${I.indicesSet("output_indices",f-2,`${d} * row + k`)};\n              ${I.setByIndices("output_indices","output_values[k]")}\n            }\n        }`}}},Rs=(t,e)=>{Ms(t.inputs,e);let n=t.getMaxComputeWorkgroupSizes(),i=t.getMaxComputeWorkgroupStoragesize();t.compute($s(t.inputs,e,n,i))},Fs=t=>Ce(t)})),hu=z((()=>{pA(),QA(),kA(),Gs=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(1!==t[0].dataType&&10!==t[0].dataType)throw new Error("Input type must be float or float16.");if(t.length>=2){let e=2*t[0].dims.length===t[1].dims[0];if(4===t.length&&(e=2*t[3].dims[0]===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Ls=(t,e,n)=>{let i="";for(let r=e-1;r>=0;--r)i+=`\n            k = i32(${t.indicesGet("indices",r)}) - ${Ne("uniforms.pads",r,n)};\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(${Ne("uniforms.x_shape",r,e)})) {\n              break;\n            }\n            offset += k * i32(${Ne("uniforms.x_strides",r,e)});\n        `;return`\n          value = ${t.type.value}(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ${i}\n            value = x[offset];\n          }\n      `},Ns=(t,e,n)=>{let i="";for(let r=e-1;r>=0;--r)i+=`\n                k = i32(${t.indicesGet("indices",r)}) - ${Ne("uniforms.pads",r,n)};\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(${Ne("uniforms.x_shape",r,e)}) - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(${Ne("uniforms.x_shape",r,e)})) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(${Ne("uniforms.x_strides",r,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${i}\n              value = x[offset];\n          `},Us=(t,e,n)=>{let i="";for(let r=e-1;r>=0;--r)i+=`\n                k = i32(${t.indicesGet("indices",r)}) - ${Ne("uniforms.pads",r,n)};\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(${Ne("uniforms.x_shape",r,e)})) {\n                  k = i32(${Ne("uniforms.x_shape",r,e)}) - 1;\n                }\n                offset += k * i32(${Ne("uniforms.x_strides",r,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${i}\n              value = x[offset];\n          `},Ts=(t,e,n)=>{let i="";for(let r=e-1;r>=0;--r)i+=`\n                k = i32(${t.indicesGet("indices",r)}) - ${Ne("uniforms.pads",r,n)};\n                if (k < 0)  {\n                  k += i32(${Ne("uniforms.x_shape",r,e)}]);\n                }\n                if (k >= i32(${Ne("uniforms.x_shape",r,e)})) {\n                  k -= i32(${Ne("uniforms.x_shape",r,e)});\n                }\n                offset += k * i32(${Ne("uniforms.x_strides",r,e)});\n            `;return`\n              var offset = 0;\n              var k = 0;\n              ${i}\n              value = x[offset];\n          `},Ps=(t,e,n)=>{switch(n.mode){case 0:return Ls(t,e,n.pads.length);case 1:return Ns(t,e,n.pads.length);case 2:return Us(t,e,n.pads.length);case 3:return Ts(t,e,n.pads.length);default:throw new Error("Invalid mode")}},qs=(t,e)=>{let n=me.padShape(t[0].dims.slice(),e.pads),i=t[0].dims,r=[{type:12,data:me.size(n)},{type:6,data:e.pads}];return 0===e.mode&&r.push({type:t[0].dataType,data:e.value}),r.push(...$e(t[0].dims,n)),{name:"Pad",shaderCache:{hint:`${e.mode}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(me.size(n)/64)},programUniforms:r}),getShaderSource:r=>{let o=Pe("output",t[0].dataType,n.length),s=Te("x",t[0].dataType,i.length),a=s.type.value,A=Ps(o,i.length,e),u=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return 0===e.mode&&u.push({name:"constant_value",type:a}),`\n            ${r.registerUniforms(u).declareVariables(s,o)}\n            ${r.mainStart()}\n            ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n\n            let indices = ${o.offsetToIndices("global_idx")};\n\n            var value = ${a}(0);\n            ${A}\n            output[global_idx] = value;\n        }`}}},Os=(t,e)=>{if(t.length>1){let n=t[1].getBigInt64Array(),i=t.length>=3&&t[2].data?t[2].getFloat32Array()[0]:0,r=t[0].dims.length,o=new Int32Array(2*r).fill(0);if(t.length>=4){let e=t[3].getBigInt64Array();for(let t=0;t<e.length;t++)o[Number(e[t])]=Number(n[t]),o[Number(e[t])+r]=Number(n[t+e.length])}else n.forEach(((t,e)=>o[Number(e)]=Number(t)));let s=[];return o.forEach((t=>s.push(t))),{mode:e.mode,value:i,pads:s}}return e},Hs=(t,e)=>{Gs(t.inputs);let n=Os(t.inputs,e);t.compute(qs(t.inputs,n),{inputs:[0]})}})),lu=z((()=>{gt(),pA(),QA(),kA(),zs=t=>{if(v.webgpu.validateInputContent&&(!t||1!==t.length))throw new Error("Pool ops requires 1 input.")},Ks=(t,e,n)=>{let i="NHWC"===e.format,r=t.dims.slice();i&&r.splice(1,0,r.pop());let o=Object.hasOwnProperty.call(e,"dilations"),s=e.kernelShape.slice(),a=e.strides.slice(),A=o?e.dilations.slice():[],u=e.pads.slice();Qe.adjustPoolAttributes(n,r,s,a,A,u);let h=Qe.computePoolOutputShape(n,r,a,A,s,u,e.autoPad),l=Object.assign({},e);o?Object.assign(l,{kernelShape:s,strides:a,pads:u,dilations:A,cacheKey:e.cacheKey}):Object.assign(l,{kernelShape:s,strides:a,pads:u,cacheKey:e.cacheKey});let c=h.slice();return c.push(c.splice(1,1)[0]),[l,i?c:h]},Vs=(t,e)=>{let n="NHWC"===e.format,i=[{type:12,data:me.size(t)},{type:12,data:me.size(e.kernelShape)}],r=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let t=e.kernelShape[e.kernelShape.length-1],n=e.strides[e.strides.length-1],o=e.pads[e.pads.length/2-1],s=e.pads[e.pads.length-1],a=!!(o+s);i.push({type:12,data:t},{type:12,data:n},{type:12,data:o},{type:12,data:s}),r.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let A=!1;if(2===e.kernelShape.length){let t=e.kernelShape[e.kernelShape.length-2],n=e.strides[e.strides.length-2],o=e.pads[e.pads.length/2-2],s=e.pads[e.pads.length-2];A=!!(o+s),i.push({type:12,data:t},{type:12,data:n},{type:12,data:o},{type:12,data:s}),r.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[i,r,!0,a,A]}{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let t=me.computeStrides(e.kernelShape);i.push({type:12,data:t},{type:12,data:e.pads},{type:12,data:e.strides}),r.push({name:"kernelStrides",type:"u32",length:t.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let o=e.pads.reduce(((t,e)=>t+e));return[i,r,!!o,!1,!1]}},Js=(t,e,n,i,r,o,s,a,A,u,h,l)=>{let c="NHWC"===r.format,f=e.type.value,d=Pe("output",e.type.tensor,i);if(r.kernelShape.length<=2){let i="",u="",g="",v=n-(c?2:1);if(i=h?`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${v}] = indices[${v}] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[${v}] < 0 || xIndices[${v}]\n                      >= uniforms.x_shape[${v}]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[${e.indicesToOffset("xIndices")}];\n                  ${o}\n                }`:`\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[${v}] = indices[${v}] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[${e.indicesToOffset("xIndices")}];\n                  ${o}\n                }`,2===r.kernelShape.length){let t=n-(c?3:2);u=l?`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[${t}] < 0 || xIndices[${t}] >= uniforms.x_shape[${t}]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              `:`\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;\n                `,g="\n              }\n            "}return`\n            ${t.registerUniforms(A).declareVariables(e,d)}\n\n            ${t.mainStart()}\n              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n\n              let indices = ${d.offsetToIndices("global_idx")};\n              var xIndices = ${d.offsetToIndices("global_idx")};\n\n              var value = ${f}(${a});\n              var pad = 0;\n              ${u}\n              ${i}\n              ${g}\n              ${s}\n\n              output[global_idx] = value;\n            }`}{if(c)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let i=r.kernelShape.length,h=r.pads.length,l="";return l=u?`\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[${e.indicesToOffset("xIndices")}];\n                ${o}\n              }`:`\n              }\n              let x_val = x[${e.indicesToOffset("xIndices")}];\n              ${o}\n            `,`\n            ${t.registerUniforms(A).declareVariables(e,d)}\n\n            ${t.mainStart()}\n              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n              let indices = ${d.offsetToIndices("global_idx")};\n              var xIndices = ${d.offsetToIndices("global_idx")};\n\n              var offsets: array<u32, ${i}>;\n\n              var value = ${f}(${a});\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ${i-1}u; j++) {\n                  offsets[j] = offset / ${Ne("uniforms.kernelStrides","j",i)};\n                  offset -= offsets[j] * ${Ne("uniforms.kernelStrides","j",i)};\n                }\n                offsets[${i-1}] = offset;\n\n                isPad = false;\n                for (var j = ${n-i}u; j < ${n}u; j++) {\n                  xIndices[j] = indices[j] * ${Ne("uniforms.strides",`j - ${n-i}u`,i)}\n                    + offsets[j - ${n-i}u] - ${Ne("uniforms.pads","j - 2u",h)};\n                  ${l}\n              }\n              ${s}\n\n              output[global_idx] = value;\n            }`}},Ys=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,js=t=>`${Ys(t)};${t.countIncludePad}`,Ws=t=>`${Ys(t)};${t.storageOrder};${t.dilations}`,Xs=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),Zs=(t,e,n,i)=>{let[r,o]=Ks(e,i,n),s=Te("x",e.dataType,e.dims.length),a=s.type.value,A="";r.countIncludePad?A+=`value /= ${a}(uniforms.kernelSize);`:A+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[u,h,l,c,f]=Vs(o,r);return u.push(...$e(e.dims,o)),{name:t,shaderCache:{hint:`${i.cacheKey};${l};${c};${f}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(me.size(o)/64)},programUniforms:u}),getShaderSource:t=>Js(t,s,e.dims.length,o.length,r,"value += x_val;",A,0,h,l,c,f)}},ta=t=>{let e=0!==t.count_include_pad,n=Xs(t);if(0!==n.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let i={countIncludePad:e,...n,cacheKey:""};return{...i,cacheKey:js(i)}},ea=(t,e)=>{zs(t.inputs),t.compute(Zs("AveragePool",t.inputs[0],!1,e))},na={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},ia=t=>{let e=t.format;return{format:e,...na,cacheKey:e}},ra=(t,e)=>{zs(t.inputs),t.compute(Zs("GlobalAveragePool",t.inputs[0],!0,e))},oa=(t,e,n,i)=>{let[r,o]=Ks(e,i,n),s=Te("x",e.dataType,e.dims.length),[a,A,u,h,l]=Vs(o,r);return a.push(...$e(e.dims,o)),{name:t,shaderCache:{hint:`${i.cacheKey};${u};${h};${l}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(me.size(o)/64)},programUniforms:a}),getShaderSource:t=>Js(t,s,e.dims.length,o.length,r,"\n      value = max(x_val, value);\n    ","",10===e.dataType?-65504:-1e5,A,u,h,l)}},sa=(t,e)=>{zs(t.inputs),t.compute(oa("MaxPool",t.inputs[0],!1,e))},aa=t=>{let e=t.storage_order,n=t.dilations,i=Xs(t);if(0!==e)throw new Error("column major storage order is not yet supported for MaxPool");if(0!==i.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r={storageOrder:e,dilations:n,...i,cacheKey:""};return{...r,cacheKey:Ws(r)}},Aa=t=>{let e=t.format;return{format:e,...na,cacheKey:e}},ua=(t,e)=>{zs(t.inputs),t.compute(oa("GlobalMaxPool",t.inputs[0],!0,e))}})),cu=z((()=>{gt(),pA(),kA(),ha=(t,e,n)=>{if(t===e||t<e&&n<0||t>e&&n>0)throw new Error("Range these inputs' contents are invalid.")},la=(t,e,n,i)=>{let r=Math.abs(Math.ceil((e-t)/n)),o=[r],s=r,a=[{type:12,data:s},{type:i,data:t},{type:i,data:n},...$e(o)];return{name:"Range",shaderCache:{hint:`${i}`},getShaderSource:t=>{let e=Pe("output",i,o.length),n=e.type.value,r=[{name:"outputSize",type:"u32"},{name:"start",type:n},{name:"delta",type:n}];return`\n        ${t.registerUniforms(r).declareVariables(e)}\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n        output[global_idx] = uniforms.start + ${n}(global_idx) * uniforms.delta;\n      }`},getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:a})}},ca=t=>{let e=0,n=0,i=0;6===t.inputs[0].dataType?(e=t.inputs[0].getInt32Array()[0],n=t.inputs[1].getInt32Array()[0],i=t.inputs[2].getInt32Array()[0]):1===t.inputs[0].dataType&&(e=t.inputs[0].getFloat32Array()[0],n=t.inputs[1].getFloat32Array()[0],i=t.inputs[2].getFloat32Array()[0]),v.webgpu.validateInputContent&&ha(e,n,i),t.compute(la(e,n,i,t.inputs[0].dataType),{inputs:[]})}})),fu=z((()=>{pA(),QA(),mA(),kA(),fa=(t,e)=>{if(t.every((t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")}))),t.length>0)if("linear"===e.mode){if(!(2===t.length||3===t.length||4===t.length&&1===t[0]&&1===t[1]||4===t.length&&1===t[0]&&1===t[3]||5===t.length&&1===t[0]&&1===t[1]))throw new Error("For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1")}else if("cubic"===e.mode&&!(2===t.length||4===t.length&&1===t[0]&&1===t[1]||4===t.length&&1===t[0]&&1===t[3]))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")},da=(t,e,n)=>{e.every((t=>t>=0&&t<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")})));let i=new Array(n).fill(1);return e.forEach(((e,n)=>i[e]=t[n])),i},ga=(t,e,n,i,r,o)=>{let[s,a,A]=n>10?[1,2,3]:[-1,t.length>1?1:-1,-1],u=t[0].dims.length;if(s>0&&t.length>s&&t[s].dims.length>0)t[s].getFloat32Array().forEach((t=>o.push(t)));else if("tf_crop_and_resize"===e.coordinateTransformMode)throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&t.length>a&&t[a].dims.length>0){if(t[a].getFloat32Array().forEach((t=>i.push(t))),0!==i.length&&i.length!==u&&n>=18&&i.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");fa(i,e),e.axes.length>0&&da(i,e.axes,u).forEach(((t,e)=>i[e]=t))}if(A>0&&t.length>A&&(t[A].getBigInt64Array().forEach((t=>r.push(Number(t)))),r.length!==u||n>=18&&r.length===e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(i.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(r.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof i<"u"&&typeof r<"u"&&i.length>0&&r.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},va=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`return ${e}(xResized) / ${e}(xScale);`;case"pytorch_half_pixel":return`if (lengthResized > 1) {\n                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n                    // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n                    // offset-by-one error later in floor().\n                    let whole = ${e}(xResized * (lengthOriginal - 1) / (lengthResized - 1));\n                    let fract =\n                        ${e}(xResized * (lengthOriginal - 1) % (lengthResized - 1)) / ${e}(lengthResized - 1);\n                    return whole + fract;\n                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {\n                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +\n                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /\n                        ${e}(lengthResized - 1);\n                  } else {\n                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);\n                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);\n                  const adjustment = ${e}(lengthResized) / outputWidth;\n                  const center = ${e}(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",Ia=(t,e,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",pa=(t,e,n)=>{let i=new Array(n).fill(0).concat(new Array(n).fill(1)),r=0===t.length?i:t.slice();return e.length>0?(e.forEach(((t,o)=>{i[t]=r[o],i[o+n]=r[e.length+o]})),i):r},ya=(t,e,n,i)=>{let r=[];if(n.length>0)if(i.length>0){if(t.forEach((t=>r.push(t))),Math.max(...i)>t.length)throw new Error("axes is out of bound");i.forEach(((t,e)=>r[t]=n[e]))}else n.forEach((t=>r.push(t)));else{if(0===e.length)throw new Error("Resize requires either scales or sizes.");r=t.map(((t,n)=>Math.round(t*e[n])))}return r},wa=(t,e,n)=>{let i=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map((t=>e[t])),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map((t=>e[t])),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let r=t.slice();return n.axes.length>0?(n.axes.forEach((t=>e[t]=i)),n.axes.forEach((n=>r[n]=Math.round(t[n]*e[n])))):(e.fill(i,0,e.length),r.forEach(((t,n)=>r[n]=Math.round(t*e[n])))),r},Ca=(t,e,n,i,r)=>`\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${n.length}> {\n      var original_indices: array<${t.type.value}, ${n.length}>;\n      for (var i:u32 = 0; i < ${n.length}; i++) {\n        var output_index = ${t.indicesGet("output_indices","i")};\n        var scale = ${Ne("uniforms.scales","i",i)};\n        var roi_low = ${Ne("uniforms.roi","i",r)};\n        var roi_hi = ${Ne("uniforms.roi",`i + ${e.length}`,r)};\n        if (scale == 1.0) {\n          original_indices[i] = ${t.type.value}(output_index);\n        } else {\n          var input_shape_i = ${Ne("uniforms.input_shape","i",e.length)};\n          var output_shape_i = ${Ne("uniforms.output_shape","i",n.length)};\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }`,Ba=(t,e,n,i,r,o,s)=>`\n    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {\n      var input_indices: ${t.type.indices};\n      for (var i:u32 = 0; i < ${i.length}; i++) {\n        var output_index = ${e.indicesGet("output_indices","i")};\n        var input_index: u32;\n        var scale = ${Ne("uniforms.scales","i",r)};\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ${Ne("uniforms.roi","i",o)};\n          var roi_hi = ${Ne("uniforms.roi",`i + ${n.length}`,o)};\n          var input_shape_i = ${Ne("uniforms.input_shape","i",n.length)};\n          var output_shape_i = ${Ne("uniforms.output_shape","i",i.length)};\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!${s} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ${t.indicesSet("input_indices","i"," input_index")}\n      }\n      return input_indices;\n    }`,Ea=(t,e)=>`\n    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {\n      for (var i:u32 = 0; i < ${e.length}; i++) {\n        var input_index = ${t.indicesGet("input_indices","i")};\n        if (input_index < 0 || input_index >= ${Ne("uniforms.input_shape","i",e.length)}) {\n          return false;\n        }\n      }\n      return true;\n    }`,ma=(t,e,n,i)=>t.rank>i?`\n    ${t.indicesSet("input_indices",e,"channel")};\n    ${t.indicesSet("input_indices",n,"batch")};\n`:"",Qa=(t,e,n,i,r)=>{let[o,s,a,A]=2===n.length?[-1,0,1,-1]:[0,2,3,1],u=t.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {\n      var input_indices: ${t.type.indices};\n      ${t.indicesSet("input_indices",s,`max(0, min(row, ${n[s]} - 1))`)};\n      ${t.indicesSet("input_indices",a,`max(0, min(col, ${n[a]} - 1))`)};\n      ${ma(t,A,o,2)}\n      return ${t.getByIndices("input_indices")};\n    }\n\n    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:${u} = originalIndices[${s}];\n      var col:${u} = originalIndices[${a}];\n      ${i?`if (row < 0 || row > (${n[s]} - 1) || col < 0 || col > (${n[a]} - 1)) {\n        return ${r};\n      }`:""};\n      row = max(0, min(row, ${n[s]} - 1));\n      col = max(0, min(col, ${n[a]} - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ${n.length>2?`u32(originalIndices[${A}])`:"0"};\n      var batch: u32 =  ${n.length>2?`u32(originalIndices[${o}])`:"0"};\n      var x11: ${u} = getInputValue(batch, channel, row1, col1);\n      var x12: ${u} = getInputValue(batch, channel, row1, col2);\n      var x21: ${u} = getInputValue(batch, channel, row2, col1);\n      var x22: ${u} = getInputValue(batch, channel, row2, col2);\n      var dx1: ${u} = abs(row - ${u}(row1));\n      var dx2: ${u} = abs(${u}(row2) - row);\n      var dy1: ${u} = abs(col - ${u}(col1));\n      var dy2: ${u} = abs(${u}(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }`},ka=(t,e,n,i,r,o,s,a,A,u)=>{let h=2===n.length,[l,c]=h?[0,1]:[2,3],f=t.type.value,d=s=>{let h=s===l?"row":"col";return`\n      fn ${h}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${f} {\n        var output_index = ${e.indicesGet("output_indices",s)};\n        var originalIdx: ${f} = getOriginalCoordinateFromResizedCoordinate(output_index, ${r[s]},\n        ${i[s]}, ${n[s]}, ${o[s]}, ${o[s]} + ${n.length});\n        var fractOriginalIdx: ${f} = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (${a} && (originalIdx < 0 || originalIdx > (${n[s]} - 1))) {\n          return ${A};\n        }\n        var data: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ${h}: ${f} = originalIdx + ${f}(i);\n          if (${h} < 0 || ${h} >= ${n[s]}) {\n            ${u?"coefs[i + 1] = 0.0;\n                        continue;":a?`return ${A};`:`${h} = max(0, min(${h}, ${n[s]} - 1));`};\n          }\n        var input_indices_copy: ${t.type.indices} = input_indices;\n          ${t.indicesSet("input_indices_copy",s,`u32(${h})`)};\n          data[i + 1] = ${s===l?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};\n        }\n        return cubicInterpolation1D(data, coefs);\n      }`};return`\n    ${d(l)};\n    ${d(c)};\n  fn getCubicInterpolationCoefs(s: ${f}) -> array<${f}, 4> {\n    var absS = abs(s);\n    var coeffs: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ${f} = 1.0 - absS;\n    var twoMinusAbsS: ${f} = 2.0 - absS;\n    var onePlusAbsS: ${f} = 1.0 + absS;\n    coeffs[0] = ((${s} * onePlusAbsS - 5 * ${s}) * onePlusAbsS + 8 * ${s}) * onePlusAbsS - 4 * ${s};\n    coeffs[1] = ((${s} + 2) * absS - (${s} + 3)) * absS * absS + 1;\n    coeffs[2] = ((${s} + 2) * oneMinusAbsS - (${s} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((${s} * twoMinusAbsS - 5 * ${s}) * twoMinusAbsS + 8 * ${s}) * twoMinusAbsS - 4 * ${s};\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<${f}, 4>, coefs: array<${f}, 4>) -> ${f} {\n    var coefsSum: ${f} = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${f} {\n    var input_indices: ${t.type.indices} = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    `},ba=(t,e,n,i,r)=>{let[o,s,a,A,u]=3===n.length?[-1,0,1,2,-1]:[0,2,3,4,1],h=t.type.value;return`\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${h} {\n      var input_indices: ${t.type.indices};\n      ${t.indicesSet("input_indices",s,`max(0, min(depth, ${n[s]} - 1))`)};\n      ${t.indicesSet("input_indices",a,`max(0, min(height, ${n[a]} - 1))`)};\n      ${t.indicesSet("input_indices",A,`max(0, min(width, ${n[A]} - 1))`)};\n      ${ma(t,u,o,3)}\n      return ${t.getByIndices("input_indices")};\n    }\n\n    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${h} {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:${h} = originalIndices[${s}];\n      var height:${h} = originalIndices[${a}];\n      var width:${h} = originalIndices[${A}];\n      ${i?`if (depth < 0 || depth > (${n[s]} - 1) || height < 0 || height > (${n[a]} - 1) || width < 0 || (width > ${n[A]} - 1)) {\n      return ${r};\n        }`:""};\n\n    depth = max(0, min(depth, ${n[s]} - 1));\n      height = max(0, min(height, ${n[a]} - 1));\n      width = max(0, min(width, ${n[A]} - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ${n.length>3?`u32(originalIndices[${u}])`:"0"};\n      var batch: u32 =  ${n.length>3?`u32(originalIndices[${o}])`:"0"};\n\n      var x111: ${h} = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ${h} = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ${h} = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ${h} = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ${h} = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ${h} = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ${h} = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ${h} = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ${h} = abs(depth - ${h}(depth1));\n      var dx2: ${h} = abs(${h}(depth2) - depth);\n      var dy1: ${h} = abs(height - ${h}(height1));\n      var dy2: ${h} = abs(${h}(height2) - height);\n      var dz1: ${h} = abs(width - ${h}(width1));\n      var dz2: ${h} = abs(${h}(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }`},_a=(t,e,n,i,r,o)=>{let s=t.dims,a=pa(o,e.axes,s.length),A=ya(s,i,r,e.axes),u=i.slice();0===i.length&&(u=s.map(((t,e)=>0===t?1:A[e]/t)),"stretch"!==e.keepAspectRatioPolicy&&(A=wa(s,u,e)));let h=Pe("output",t.dataType,A.length),l=Te("input",t.dataType,s.length),c=me.size(A),f=s.length===A.length&&s.every(((t,e)=>t===A[e])),d="tf_crop_and_resize"===e.coordinateTransformMode,g=e.extrapolationValue,v=l.type.value;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${n}|${u.length>0?u:""}|${r.length>0?r:""}|${a.length>0?a:""}|${f}|${s}`,inputDependencies:["rank"]},getShaderSource:t=>`\n      ${f?"":`\n      ${va(e.coordinateTransformMode,v)};\n      ${(()=>{switch(e.mode){case"nearest":return`\n              ${Ea(l,s)};\n              ${Ia(e.nearestMode,n,v)};\n              ${Ba(l,h,s,A,u.length,a.length,d)};\n              `;case"linear":return`\n              ${Ca(h,s,A,u.length,a.length)};\n              ${(()=>{if(2===s.length||4===s.length)return`${Qa(l,h,s,d,g)}`;if(3===s.length||5===s.length)return`${ba(l,h,s,d,g)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};\n            `;case"cubic":return`\n            ${(()=>{if(2===s.length||4===s.length)return`${ka(l,h,s,A,u,a,e.cubicCoeffA,d,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};\n            `;default:throw Error("Invalid resize mode")}})()};\n      `}\n      ${t.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",a.length).declareVariables(l,h)}\n      ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}\n        ${f?"output[global_idx] = input[global_idx];":`\n        let output_indices = ${h.offsetToIndices("global_idx")};\n        var input_indices: ${l.type.indices};\n        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ${l.getByIndices("input_indices")};\n                } else {\n                  output[global_idx] = ${e.extrapolationValue};\n                }`;case"linear":return`output[global_idx] = ${2===s.length||4===s.length?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};\n`}\n      }`,getRunData:()=>({outputs:[{dims:A,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},{type:1,data:u},{type:1,data:a},...$e(s,A)]})}},xa=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},Da=(t,e)=>{let n=[],i=[],r=[],o=xa(t);if(0!==e.antialias)throw Error("Only default value (0) for Antialias attribute is supported");ga(t.inputs,e,o,n,i,r),t.compute(_a(t.inputs[0],e,o,n,i,r),{inputs:[0]})},Sa=t=>{let e=t.antialias,n=t.axes,i=t.coordinateTransformMode,r=t.cubicCoeffA,o=0!==t.excludeOutside,s=t.extrapolationValue,a=t.keepAspectRatioPolicy,A=t.mode,u=""===t.nearestMode?"simple":t.nearestMode;return Ce({antialias:e,axes:n,coordinateTransformMode:i,cubicCoeffA:r,excludeOutside:o,extrapolationValue:s,keepAspectRatioPolicy:a,mode:A,nearestMode:u})}})),du=z((()=>{pA(),QA(),mA(),kA(),Ma=(t,e)=>{let[n,i,r,o]=t,{numHeads:s,rotaryEmbeddingDim:a}=e;if(3!==n.dims.length&&4!==n.dims.length)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!me.areEqual(i.dims,[])&&!me.areEqual(i.dims,[1])&&2!==i.dims.length)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${i.dims.length}`);if(2!==r.dims.length)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${r.dims.length}`);if(2!==o.dims.length)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!me.areEqual(r.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(a>0&&0===s)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let A=n.dims[0],u=n.dims[n.dims.length-2],h=r.dims[0],l=me.sizeFromDimension(n.dims,1)/u,c=0===a?2*r.dims[1]:l/s;if(a>c)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(2===i.dims.length){if(A!==i.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${i.dims[0]}`);if(u!==i.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${i.dims[1]}`)}if(c/2!==r.dims[1]&&a/2!==r.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${r.dims[1]}`);if(u>h)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},$a=(t,e)=>{let{interleaved:n,numHeads:i,rotaryEmbeddingDim:r,scale:o}=e,s=t[0].dims[0],a=me.sizeFromDimension(t[0].dims,1),A=t[0].dims[t[0].dims.length-2],u=a/A,h=t[2].dims[1],l=0===r?2*h:u/i,c=new Array(s,A,u/l,l-h),f=me.computeStrides(c),d=[{type:1,data:o},{type:12,data:c},{type:12,data:f},...3===t[0].dims.length?new Array({type:12,data:[a,u,l,1]}):[],...4===t[0].dims.length?new Array({type:12,data:[a,l,A*l,1]}):[],...$e(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)];return{name:"RotaryEmbedding",shaderCache:{hint:Ce({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:e=>{let i=Te("input",t[0].dataType,t[0].dims.length),r=Te("position_ids",t[1].dataType,t[1].dims.length),o=Te("cos_cache",t[2].dataType,t[2].dims.length),s=Te("sin_cache",t[3].dataType,t[3].dims.length),a=Pe("output",t[0].dataType,t[0].dims.length);return e.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:c.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),`\n        ${e.declareVariables(i,r,o,s,a)}\n\n        ${e.mainStart(xe)}\n          let half_rotary_emb_dim = uniforms.${o.name}_shape[1];\n          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;\n          let size = uniforms.global_shape[0] * uniforms.global_strides[0];\n          ${e.guardAgainstOutOfBoundsWorkgroupSizes("size")}\n\n          if (bsnh[3] < half_rotary_emb_dim) {\n            let position_ids_idx =\n                ${r.broadcastedIndicesToOffset("bsnh.xy",Pe("",r.type.tensor,2))};\n            let position_id =\n                u32(${r.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);\n            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});\n            let j = i + select(half_rotary_emb_dim, 1, ${n});\n            let re = ${i.getByOffset("i")} * ${o.get("position_id","bsnh[3]")} -\n                ${i.getByOffset("j")} * ${s.get("position_id","bsnh[3]")};\n            ${a.setByOffset("i","re")}\n            let im = ${i.getByOffset("i")} * ${s.get("position_id","bsnh[3]")} +\n                ${i.getByOffset("j")} * ${o.get("position_id","bsnh[3]")};\n            ${a.setByOffset("j","im")}\n          } else {\n            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;\n            ${a.setByOffset("k",i.getByOffset("k"))}\n          }\n        }`},getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(me.size(c)/xe)},programUniforms:d})}},Ra=(t,e)=>{Ma(t.inputs,e),t.compute($a(t.inputs,e))}})),gu=z((()=>{pA(),QA(),kA(),Fa=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],n=t[1],i=t[2];if(e.dataType!==n.dataType||e.dataType!==i.dataType)throw new Error("All inputs must have the same data type");if(3!==e.dims.length&&2!==e.dims.length)throw new Error("Input must be 2D or 3D");if(3!==n.dims.length&&2!==n.dims.length)throw new Error("Skip must be 2D or 3D");let r=e.dims[e.dims.length-1],o=e.dims[e.dims.length-2];if(n.dims[n.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(1!==i.dims.length)throw new Error("Gamma must be 1D");if(i.dims[i.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let e=t[3];if(1!==e.dims.length)throw new Error("Beta must be 1D");if(e.dims[e.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let e=t[4];if(1!==e.dims.length)throw new Error("Bias must be 1D");if(e.dims[e.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},Ga=(t,e,n,i)=>{let r=e.simplified,o=t[0].dims,s=me.size(o),a=o,A=s,u=o.slice(-1)[0],h=i?o.slice(0,-1).concat(1):[],l=!r&&t.length>3,c=t.length>4,f=i&&n>1,d=i&&n>2,g=n>3,v=Re(u),I=[{type:12,data:A},{type:12,data:v},{type:12,data:u},{type:1,data:e.epsilon}],p=[{dims:a,dataType:t[0].dataType}];return n>1&&p.push({dims:h,dataType:1}),n>2&&p.push({dims:h,dataType:1}),n>3&&p.push({dims:o,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${v};${f};${d};${g}`,inputDependencies:t.map(((t,e)=>"type"))},getShaderSource:e=>{let n=[Te("x",t[0].dataType,t[0].dims,v),Te("skip",t[1].dataType,t[1].dims,v),Te("gamma",t[2].dataType,t[2].dims,v)];l&&n.push(Te("beta",t[3].dataType,t[3].dims,v)),c&&n.push(Te("bias",t[4].dataType,t[4].dims,v)),n.push(Pe("output",t[0].dataType,a,v)),f&&n.push(Pe("mean_output",1,h)),d&&n.push(Pe("inv_std_output",1,h)),g&&n.push(Pe("input_skip_bias_sum",t[0].dataType,a,v));let i=Se(t[0].dataType),o=Se(1,v);return`\n\n      ${e.registerUniforms([{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...n)}\n      var<workgroup> sum_shared : array<${o}, 64>;\n      var<workgroup> sum_squared_shared : array<${o}, 64>;\n\n      ${e.mainStart([64,1,1])}\n        let ix = local_id.x;\n        let iy = global_id.x / 64;\n\n        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;\n        var stride = hidden_size_vectorized / 64;\n        let offset = ix * stride + iy * hidden_size_vectorized;\n        let offset1d = stride * ix;\n        if (ix == 63) {\n          stride = hidden_size_vectorized - stride * ix;\n        }\n        for (var i: u32 = 0; i < stride; i++) {\n          let skip_value = skip[offset + i];\n          let bias_value = ${c?"bias[offset1d + i]":i+"(0.0)"};\n          let input_value = x[offset + i];\n          let value = input_value + skip_value + bias_value;\n          ${g?"input_skip_bias_sum[offset + i] = value;":""}\n          output[offset + i] = value;\n          let f32_value = ${Ge(i,v,"value")};\n          sum_shared[ix] += f32_value;\n          sum_squared_shared[ix] += f32_value * f32_value;\n        }\n        workgroupBarrier();\n\n        var reduce_size : u32 = 64;\n        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {\n          reduce_size = curr_size + (reduce_size & 1);\n          if (ix < curr_size) {\n            sum_shared[ix] += sum_shared[ix + reduce_size];\n            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];\n          }\n          workgroupBarrier();\n        }\n\n        let sum = sum_shared[0];\n        let square_sum = sum_squared_shared[0];\n        let mean = ${Le("sum",v)} / f32(uniforms.hidden_size);\n        let inv_std_dev = inverseSqrt(${Le("square_sum",v)} / f32(uniforms.hidden_size) ${r?"":"- mean * mean"} + uniforms.epsilon);\n        ${f?"mean_output[global_idx] = mean;":""}\n        ${d?"inv_std_output[global_idx] = inv_std_dev;":""}\n\n        for (var i: u32 = 0; i < stride; i++) {\n          output[offset + i] = (output[offset + i] ${r?"":`- ${i}(mean)`}) *\n            ${i}(inv_std_dev) * gamma[offset1d + i]\n            ${l?"+ beta[offset1d + i]":""};\n        }\n      }`},getRunData:()=>({outputs:p,dispatchGroup:{x:Math.ceil(A/u)},programUniforms:I})}},La=(t,e)=>{Fa(t.inputs);let n=[0];t.outputCount>1&&n.push(-3),t.outputCount>2&&n.push(-3),t.outputCount>3&&n.push(3),t.compute(Ga(t.inputs,e,t.outputCount,!1),{outputs:n})}})),vu=z((()=>{pA(),QA(),mA(),kA(),Na=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(0!==e.axes.length){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach(((e,n)=>{if(6!==t[n+1].dataType&&7!==t[n+1].dataType)throw new Error(`Input ${n} must be an array of int32 or int64`)}))},Ua=(t,e)=>{let n=[];if(t.length>e)if(7===t[e].dataType)t[e].getBigInt64Array().forEach((t=>n.push(Number(t))));else{if(6!==t[e].dataType)throw new Error(`Input ${e} must be an array of int32 or int64`);t[e].getInt32Array().forEach((t=>n.push(Number(t))))}return n},Ta=(t,e)=>{if(t.length>1){let e=Ua(t,1),n=Ua(t,2),i=Ua(t,3);return 0===i.length&&(i=[...Array(t[0].dims.length).keys()]),Ce({starts:e,ends:n,axes:i})}return e},Pa=(t,e,n,i,r)=>{let o=t;return t<0&&(o+=n[i[e]]),r[e]<0?Math.max(0,Math.min(o,n[i[e]]-1)):Math.max(0,Math.min(o,n[i[e]]))},qa=(t,e,n)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {\n          var input_indices: ${t.type.indices};\n          var carry = 0u;\n          for (var i = ${n.length}; i >= 0; i--) {\n            let input_shape_i = ${Ne("uniforms.input_shape","i",n.length)};\n            let steps_i = ${Ne("uniforms.steps","i",n.length)};\n            let signs_i = ${Ne("uniforms.signs","i",n.length)};\n            let starts_i = ${Ne("uniforms.starts","i",n.length)};\n            var output_index = ${e.indicesGet("output_indices","i")};\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ${t.indicesSet("input_indices","i","input_index")};\n          }\n          return input_indices;\n      }`,Oa=(t,e)=>{let n=t[0].dims,i=me.size(n),r=e.axes.length>0?me.normalizeAxes(e.axes,n.length):[...Array(n.length).keys()],o=Ua(t,4);o.forEach((t=>0!==t||(()=>{throw new Error("step cannot be 0")}))),0===o.length&&(o=Array(r.length).fill(1));let s=e.starts.map(((t,e)=>Pa(t,e,n,r,o))),a=e.ends.map(((t,e)=>Pa(t,e,n,r,o)));if(r.length!==s.length||r.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==n.length)for(let t=0;t<n.length;++t)r.includes(t)||(s.splice(t,0,0),a.splice(t,0,n[t]),o.splice(t,0,1));let A=o.map((t=>Math.sign(t)));o.forEach(((t,e,n)=>{if(t<0){let i=(a[e]-s[e])/t,r=s[e],A=r+i*o[e];s[e]=A,a[e]=r,n[e]=-t}}));let u=n.slice(0);r.forEach(((t,e)=>{u[t]=Math.ceil((a[t]-s[t])/o[t])}));let h={dims:u,dataType:t[0].dataType},l=Pe("output",t[0].dataType,u.length),c=Te("input",t[0].dataType,t[0].dims.length),f=me.size(u),d=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:s.length},{name:"signs",type:"i32",length:A.length},{name:"steps",type:"u32",length:o.length}],g=[{type:12,data:f},{type:12,data:s},{type:6,data:A},{type:12,data:o},...$e(t[0].dims,u)];return{name:"Slice",shaderCache:{hint:`${A.length}_${s.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:t=>`\n      ${t.registerUniforms(d).declareVariables(c,l)}\n        ${qa(c,l,n)}\n        ${t.mainStart()}\n          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}\n          let output_indices = ${l.offsetToIndices("global_idx")};\n          let input_indices = calculateInputIndices(output_indices);\n          ${l.setByOffset("global_idx",c.getByIndices("input_indices"))}\n      }`,getRunData:()=>({outputs:[h],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:g})}},Ha=(t,e)=>{Na(t.inputs,e);let n=Ta(t.inputs,e);t.compute(Oa(t.inputs,n),{inputs:[0]})},za=t=>{let e=t.starts,n=t.ends,i=t.axes;return Ce({starts:e,ends:n,axes:i})}})),Iu=z((()=>{pA(),QA(),mA(),kA(),Ka=t=>{if(!t||1!==t.length)throw new Error("Softmax op requires 1 input.")},Va=(t,e)=>{let n=t.dims,i=me.size(n),r=e.axis;if(r<0&&(r=n.length+r),r<n.length-1)throw new Error("softmax only supports last axis for now.");let o=n[r],s=i/o,a=Re(o),A=o/a,u=Te("x",t.dataType,t.dims,a),h=Pe("result",t.dataType,t.dims,a),l=u.type.value,c="f32"===Se(t.dataType)?`var threadMax = ${l}(-3.402823e+38f);`:`var threadMax = ${l}(-65504.0h);`;return{name:"Softmax",shaderCache:{hint:`${a}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.dataType}],dispatchGroup:{x:s},programUniforms:[{type:6,data:A}]}),getShaderSource:t=>`\n      var<workgroup> rowMaxShared : ${l};\n      var<workgroup> rowSumShared : ${l};\n      var<workgroup> threadShared : array<${l}, 64>;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ${l} {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ${l}) {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ${t.registerUniform("packedCols","i32").declareVariables(u,h)}\n      ${t.mainStart()}\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = 64;\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ${c}\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ${l}(${((t,e)=>4===e?`max(max(${t}.x, ${t}.y), max(${t}.z, ${t}.w))`:2===e?`max(${t}.x, ${t}.y)`:3===e?`max(max(${t}.x, ${t}.y), ${t}.z)`:t)("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ${l}(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ${l}(${Le("threadShared[0]",a)});\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          setValue(row, col, row_stride, value);\n        }\n      }`}},Ja=(t,e)=>{Ka(t.inputs),t.compute(Va(t.inputs[0],e))},Ya=t=>Ce({axis:t.axis})})),pu=z((()=>{pA(),QA(),mA(),kA(),ja=t=>{if(!t||t.length<1)throw new Error("too few inputs")},Wa=(t,e)=>{let n=[],i=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach((t=>n.push(Number(t)))),i=n.length),Ce({numOutputs:i,axis:e.axis,splitSizes:n})},Xa=t=>`\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {\n    if (index < ${Ne("uniforms.size_in_split_axis","i",t)}) {\n        return i;\n    }\n    }\n    return ${t}u;\n}`,Za=t=>{let e=t.length,n=[];for(let i=0;i<e;++i){let r=t[i].setByIndices("indices","input[global_idx]");1===e?n.push(r):0===i?n.push(`if (output_number == ${i}u) { ${r} }`):i===e-1?n.push(`else { ${r} }`):n.push(`else if (output_number == ${i}) { ${r} }`)}return`\n      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {\n        ${n.join("\n")}\n      }`},tA=(t,e)=>{let n=t[0].dims,i=me.size(n),r=t[0].dataType,o=me.normalizeAxis(e.axis,n.length),s=new Array(e.numOutputs),a=Te("input",r,n.length),A=new Array(e.numOutputs),u=[],h=[],l=0,c=[{type:12,data:i}];for(let i=0;i<e.numOutputs;i++){l+=e.splitSizes[i],A[i]=l;let o=n.slice();o[e.axis]=e.splitSizes[i],h.push(o),s[i]=Pe(`output${i}`,r,o.length),u.push({dims:h[i],dataType:t[0].dataType})}return c.push({type:12,data:A},...$e(n,...h)),{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:t=>`\n  ${t.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",A.length).declareVariables(a,...s)}\n  ${Xa(A.length)}\n  ${Za(s)}\n\n  ${t.mainStart()}\n    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}\n\n    var indices = ${a.offsetToIndices("global_idx")};\n    var index = ${a.indicesGet("indices",o)};\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ${Ne("uniforms.size_in_split_axis","output_number - 1u",A.length)};\n      ${a.indicesSet("indices",o,"index")};\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }`,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(i/64)},programUniforms:c})}},eA=(t,e)=>{ja(t.inputs);let n=1===t.inputs.length?e:Wa(t.inputs,e);t.compute(tA(t.inputs,n),{inputs:[0]})},nA=t=>{let e=t.axis,n=t.splitSizes,i=t.numOutputs<0?n.length:t.numOutputs;if(i!==n.length)throw new Error("numOutputs and splitSizes lengh must be equal");return Ce({axis:e,numOutputs:i,splitSizes:n})}})),yu=z((()=>{pA(),QA(),kA(),iA=(t,e,n,i,r)=>{let o,s=Pe("output_data",r,n.length,4),a=Te("a_data",e[1].dataType,e[1].dims.length,4),A=Te("b_data",e[2].dataType,e[2].dims.length,4),u=Te("c_data",e[0].dataType,e[0].dims.length,4),h=(t,e,n)=>`select(${e}, ${t}, ${n})`;if(i){let t=(t,e,n="")=>{let i=`a_data[index_a${e}][component_a${e}]`,r=`b_data[index_b${e}][component_b${e}]`,o=`bool(c_data[index_c${e}] & (0xffu << (component_c${e} * 8)))`;return`\n            let output_indices${e} = ${s.offsetToIndices(`global_idx * 4u + ${e}u`)};\n            let offset_a${e} = ${a.broadcastedIndicesToOffset(`output_indices${e}`,s)};\n            let offset_b${e} = ${A.broadcastedIndicesToOffset(`output_indices${e}`,s)};\n            let offset_c${e} = ${u.broadcastedIndicesToOffset(`output_indices${e}`,s)};\n            let index_a${e} = offset_a${e} / 4u;\n            let index_b${e} = offset_b${e} / 4u;\n            let index_c${e} = offset_c${e} / 4u;\n            let component_a${e} = offset_a${e} % 4u;\n            let component_b${e} = offset_b${e} % 4u;\n            let component_c${e} = offset_c${e} % 4u;\n            ${t}[${e}] = ${n}(${h(i,r,o)});\n          `};o=9===r?`\n            var data = vec4<u32>(0);\n            ${t("data",0,"u32")}\n            ${t("data",1,"u32")}\n            ${t("data",2,"u32")}\n            ${t("data",3,"u32")}\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`\n            ${t("output_data[global_idx]",0)}\n            ${t("output_data[global_idx]",1)}\n            ${t("output_data[global_idx]",2)}\n            ${t("output_data[global_idx]",3)}\n          `}else o=s.setByOffset("global_idx",h(a.getByOffset("global_idx"),A.getByOffset("global_idx"),u.getByOffset("global_idx")));return`\n        ${t.registerUniform("vec_size","u32").declareVariables(u,a,A,s)}\n        ${t.mainStart()}\n        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}\n        ${o}\n      }`},rA=t=>{let e=t[1].dims,n=t[2].dims,i=t[0].dims,r=t[1].dataType,o=!(me.areEqual(e,n)&&me.areEqual(n,i)),s=e,a=me.size(e);if(o){let t=Ee.calcShape(Ee.calcShape(e,n,!1),i,!1);if(!t)throw new Error("Can't perform where op on the given tensors");s=t,a=me.size(s)}let A=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:e=>iA(e,t,s,o,r),getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:12,data:A},...$e(i,e,n,s)]})}},oA=t=>{t.compute(rA(t.inputs))}})),wu=z((()=>{DA(),SA(),MA(),$A(),FA(),GA(),LA(),KA(),YA(),jA(),WA(),XA(),ZA(),tu(),eu(),nu(),iu(),su(),au(),Au(),zA(),uu(),ru(),hu(),lu(),cu(),xA(),fu(),du(),gu(),vu(),Iu(),pu(),ou(),bA(),RA(),yu(),sA=new Map([["Abs",[fi]],["Acos",[di]],["Acosh",[gi]],["Add",[Ar]],["ArgMax",[Yn,jn]],["ArgMin",[Jn,jn]],["Asin",[vi]],["Asinh",[Ii]],["Atan",[pi]],["Atanh",[yi]],["Attention",[ii]],["AveragePool",[ea,ta]],["BatchNormalization",[ai]],["BiasAdd",[hi]],["BiasSplitGelu",[rr]],["Cast",[Ci,wi]],["Ceil",[mi]],["Clip",[Ei]],["Concat",[Br,Er]],["Conv",[Ao,ro]],["ConvTranspose",[Eo,po]],["Cos",[Qi]],["Cosh",[ki]],["CumSum",[Qo,ko]],["DepthToSpace",[Do,So]],["Div",[ur]],["Einsum",[To,Po]],["Elu",[_i,bi]],["Equal",[hr]],["Erf",[Di]],["Exp",[Si]],["Expand",[Ko]],["FastGelu",[Jo]],["Floor",[Mi]],["FusedConv",[Ao,ro]],["Gather",[Xo,Wo]],["GatherElements",[ns,es]],["Gelu",[$i]],["Gemm",[ss,os]],["GlobalAveragePool",[ra,ia]],["GlobalMaxPool",[ua,Aa]],["Greater",[dr]],["GreaterOrEqual",[vr]],["GroupQueryAttention",[ms,Cs]],["HardSigmoid",[Pi,Ti]],["InstanceNormalization",[_s]],["LayerNormalization",[Ss]],["LeakyRelu",[Ri,bi]],["Less",[gr]],["LessOrEqual",[Ir]],["Log",[Xi]],["MatMul",[Zr]],["MatMulNBits",[Rs,Fs]],["MaxPool",[sa,aa]],["Mul",[lr]],["MultiHeadAttention",[fs,us]],["Neg",[Gi]],["Not",[Fi]],["Pad",[Hs]],["Pow",[cr]],["QuickGelu",[er,bi]],["Range",[ca]],["Reciprocal",[Li]],["ReduceMin",[qn]],["ReduceMean",[Ln]],["ReduceMax",[Pn]],["ReduceSum",[Hn]],["ReduceProd",[On]],["ReduceL1",[Nn]],["ReduceL2",[Un]],["ReduceLogSum",[Kn]],["ReduceLogSumExp",[Tn]],["ReduceSumSquare",[zn]],["Relu",[Ni]],["Resize",[Da,Sa]],["RotaryEmbedding",[Ra]],["Sigmoid",[Ui]],["Sin",[qi]],["Sinh",[Oi]],["Slice",[Ha,za]],["SkipLayerNormalization",[La]],["Split",[eA,nA]],["Sqrt",[Hi]],["Softmax",[Ja,Ya]],["Sub",[fr]],["Tan",[zi]],["Tanh",[Vi]],["ThresholdedRelu",[Wi,bi]],["Tile",[ps]],["Transpose",[We,Xe]],["Where",[oA]]])})),Cu=z((()=>{gt(),wA(),kA(),aA=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,n,i,r){R(t.programInfo.name);let o=this.backend.device,s=this.backend.getComputePassEncoder();this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber);let a=[];for(let t of e)a.push({binding:a.length,resource:{buffer:t.buffer}});for(let t of n)a.push({binding:a.length,resource:{buffer:t.buffer}});r&&a.push({binding:a.length,resource:r});let A=o.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:a,label:t.programInfo.name});if("capturing"===this.backend.sessionStatus){let e={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:A,dispatchGroup:i};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(e)}s.setPipeline(t.computePipeline),s.setBindGroup(0,A),s.dispatchWorkgroups(...i),this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||"at-passes"===this.backend.queryType)&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),F(t.programInfo.name)}dispose(){}build(t,e){R(t.name);let n=this.backend.device,i=[];n.features.has("shader-f16")&&i.push("enable f16;");let r=He(e,this.backend.device.limits),o=t.getShaderSource(r),s=`${i.join("\n")}\n${r.additionalImplementations}\n${o}`,a=n.createShaderModule({code:s,label:t.name});ue("verbose",(()=>`[WebGPU] ${t.name} shader code: ${s}`));let A=n.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:t.name});return F(t.name),{programInfo:t,computePipeline:A,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(t){let e="number"==typeof t?t:t.x,n="number"==typeof t?1:t.y||1,i="number"==typeof t?1:t.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=r&&n<=r&&i<=r)return[e,n,i];let o=e*n*i,s=Math.ceil(Math.sqrt(o));if(s>r){if(s=Math.ceil(Math.cbrt(o)),s>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[s,s,s]}return[s,s,1]}}})),Bu=z((()=>{gt(),pA(),wA(),CA(),EA(),wu(),Cu(),AA=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let n=[];for(let i=0;i<t.length;++i){let r=t[i].dataType;switch(e[i]){case"none":n.push("");break;case"type":n.push(`${r}`);break;case"rank":{let e=t[i].dims.length;n.push(`${r};${e}`);break}case"dims":{let e=t[i].dims.join(",");n.push(`${r};${e}`);break}default:throw new Error(`unsupported input dependency: ${e[i]}`)}}return n.join("|")},uA=(t,e,n)=>{let i=t.name;return t.shaderCache?.hint&&(i+="["+t.shaderCache.hint+"]"),i+=":"+n+`:${AA(e,t.shaderCache?.inputDependencies??new Array(e.length).fill("dims"))}`,i},hA=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},lA=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(null===this.currentKernelId)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let n=[],i={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n};e.features.has("chromium-experimental-timestamp-query-inside-passes")?n.push("chromium-experimental-timestamp-query-inside-passes"):e.features.has("timestamp-query")&&n.push("timestamp-query"),e.features.has("shader-f16")&&n.push("shader-f16"),this.device=await e.requestDevice(i),this.adapterInfo=new hA(e.info||await e.requestAdapterInfo()),this.gpuDataManager=ye(this),this.programManager=new aA(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,ae(t.logLevel,!!t.debug),this.device.onuncapturederror=t=>{t.error,GPUValidationError},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};"at-passes"===this.queryType&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:2*this.pendingDispatchNumber,endOfPassWriteIndex:2*this.pendingDispatchNumber+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;let t;R(),this.endComputePass(),"none"!==this.queryType&&(this.commandEncoder.resolveQuerySet(this.querySet,0,2*this.pendingDispatchNumber,this.queryResolveBuffer,0),t=this.device.createBuffer({size:16*this.pendingDispatchNumber,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,16*this.pendingDispatchNumber)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,"none"!==this.queryType&&t.mapAsync(GPUMapMode.READ).then((()=>{let e=new BigUint64Array(t.getMappedRange()),n=this.pendingQueries.get(t);for(let t=0;t<e.length/2;t++){let i=n[t],r=i.kernelId,o=this.kernels.get(r),s=o.kernelType,a=o.kernelName,A=i.programName,u=i.inputTensorViews,h=i.outputTensorViews,l=e[2*t],c=e[2*t+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=l);let f=Number(l-this.queryTimeBase),d=Number(c-this.queryTimeBase);if(!Number.isSafeInteger(f)||!Number.isSafeInteger(d))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:u.map((t=>({dims:t.dims,dataType:Xt(t.dataType)}))),outputsMetadata:h.map((t=>({dims:t.dims,dataType:Xt(t.dataType)}))),kernelId:r,kernelType:s,kernelName:a,programName:A,startTime:f,endTime:d});else{let t="";u.forEach(((e,n)=>{t+=`input[${n}]: [${e.dims}] | ${Xt(e.dataType)}, `}));let e="";h.forEach(((t,n)=>{e+=`output[${n}]: [${t.dims}] | ${Xt(t.dataType)}, `}))}M("GPU",`${A}::${l}::${c}`)}t.unmap(),this.pendingQueries.delete(t)})),F()}run(t,e,n,i,r,o){R(t.name);let s=[];for(let t=0;t<e.length;++t){let n=e[t].data;if(0===n)continue;let i=this.gpuDataManager.get(n);if(!i)throw new Error(`no GPU data for input: ${n}`);s.push(i)}let{outputs:a,dispatchGroup:A,programUniforms:u}=t.getRunData(e),h=0===n.length?a.map(((t,e)=>e)):n;if(h.length!==a.length)throw new Error(`Output size ${h.length} must be equal to ${a.length}.`);let l,c=[],f=[];for(let t=0;t<a.length;++t){if(!Number.isInteger(h[t])||h[t]<-3||h[t]>=o)throw new Error(`Invalid output index: ${h[t]}`);if(-3===h[t])continue;let e=-1===h[t],n=-2===h[t],s=e||n?r(a[t].dataType,a[t].dims):i(h[t],a[t].dataType,a[t].dims);if(c.push(s),0===s.data)continue;let A=this.gpuDataManager.get(s.data);if(!A)throw new Error(`no GPU data for output: ${s.data}`);if(e&&this.temporaryData.push(A),n){let t=this.kernelPersistentData.get(this.currentKernelId);t||(t=[],this.kernelPersistentData.set(this.currentKernelId,t)),t.push(A)}f.push(A)}if(s.length!==e.length||f.length!==c.length){if(0===f.length)return F(t.name),c;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}if(u){let t=0,e=[];u.forEach((n=>{let i="number"==typeof n.data?[n.data]:n.data;if(0===i.length)return;let r,o,s=10===n.type?2:4;10===n.type?(o=i.length>4?16:i.length>2?8:i.length*s,r=i.length>4?16:s*i.length):(o=i.length<=2?i.length*s:16,r=16),t=Math.ceil(t/o)*o,e.push(t);let a=10===n.type?8:4;t+=i.length>4?Math.ceil(i.length/a)*r:i.length*s}));let n=16;t=Math.ceil(t/n)*n;let i=new ArrayBuffer(t);u.forEach(((t,n)=>{let r=e[n],o="number"==typeof t.data?[t.data]:t.data;if(6===t.type)new Int32Array(i,r,o.length).set(o);else if(12===t.type)new Uint32Array(i,r,o.length).set(o);else if(10===t.type)new Uint16Array(i,r,o.length).set(o);else{if(1!==t.type)throw new Error(`Unsupported uniform type: ${Xt(t.type)}`);new Float32Array(i,r,o.length).set(o)}}));let r=this.gpuDataManager.create(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(r.buffer,0,i,0,t),this.gpuDataManager.release(r.id),l={offset:0,size:t,buffer:r.buffer}}let d=this.programManager.normalizeDispatchGroupSize(A),g=1===d[1]&&1===d[2],v=uA(t,e,g),I=this.programManager.getArtifact(v);if(I||(I=this.programManager.build(t,d),this.programManager.setArtifact(v,I),ue("info",(()=>`[artifact] key: ${v}, programName: ${t.name}`))),u&&I.uniformVariablesInfo){if(u.length!==I.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${I.uniformVariablesInfo.length}, got ${u.length} in program "${I.programInfo.name}".`);for(let t=0;t<u.length;t++){let e=u[t],n=e.type,i="number"==typeof e.data?1:e.data.length,[r,o]=I.uniformVariablesInfo[t];if(n!==r||i!==o)throw new Error(`Uniform variable ${t} mismatch: expect type ${r} with size ${o}, got type ${n} with size ${i} in program "${I.programInfo.name}".`)}}if(ue("info",(()=>`[ProgramManager] run "${t.name}" (key=${v}) with ${d[0]}x${d[1]}x${d[2]}`)),"none"!==this.queryType||"capturing"===this.sessionStatus){let t={kernelId:this.currentKernelId,programName:I.programInfo.name,inputTensorViews:e,outputTensorViews:c};this.pendingKernels.push(t),"capturing"===this.sessionStatus&&this.capturedPendingKernels.get(this.currentSessionId).push(t)}return this.programManager.run(I,s,f,d,l),F(t.name),c}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,n,i){let r=sA.get(t);if(!r)throw new Error(`kernel not implemented: ${t}`);let o={kernelType:t,kernelName:i,kernelEntry:r[0],attributes:[r[1],n]};this.kernels.set(e,o)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let t of e)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,e,n){let i=this.kernels.get(t);if(!i)throw new Error(`kernel not created: ${t}`);let r=i.kernelType,o=i.kernelName,s=i.kernelEntry,a=i.attributes;if(null!==this.currentKernelId)throw new Error(`kernel "[${r}] ${o}" is not allowed to be called recursively`);this.currentKernelId=t,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),ue("info",(()=>`[WebGPU] Start to run kernel "[${r}] ${o}"...`));let A=this.env.debug;this.temporaryData=[];try{return A&&this.device.pushErrorScope("validation"),s(e,a[1]),0}catch(t){return n.push(Promise.resolve(`[WebGPU] Kernel "[${r}] ${o}" failed. ${t}`)),1}finally{A&&n.push(this.device.popErrorScope().then((t=>t?`GPU validation error for kernel "[${r}] ${o}": ${t.message}`:null)));for(let t of this.temporaryData)this.gpuDataManager.release(t.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,n,i){let r=this.sessionExternalDataMapping.get(t);r||(r=new Map,this.sessionExternalDataMapping.set(t,r));let o=r.get(e),s=this.gpuDataManager.registerExternalBuffer(n,i,o?.[1]);return r.set(e,[s,n]),s}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach((t=>this.gpuDataManager.unregisterExternalBuffer(t[1]))),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,n){return async()=>{let i=await Ie(this,t,e);return he(i.buffer,n)}}writeTimestamp(t){"inside-passes"===this.queryType&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",("default"===this.env.webgpu.profiling?.mode||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),"none"!==this.queryType&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:2*this.maxDispatchNumber}),this.queryResolveBuffer=this.device.createBuffer({size:16*this.maxDispatchNumber,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){ue("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){ue("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){ue("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),n=t.length;this.pendingKernels=[];for(let i=0;i<n;i++){let n=this.getComputePassEncoder(),r=t[i];this.writeTimestamp(2*this.pendingDispatchNumber),n.setPipeline(r.computePipeline),n.setBindGroup(0,r.bindGroup),n.dispatchWorkgroups(...r.dispatchGroup),this.writeTimestamp(2*this.pendingDispatchNumber+1),this.pendingDispatchNumber++,"none"!==this.queryType&&this.pendingKernels.push(e[i]),(this.pendingDispatchNumber>=this.maxDispatchNumber||"at-passes"===this.queryType)&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}})),Eu={};K(Eu,{init:()=>ku});var mu,Qu,ku,bu,_u,xu,Du,Su,Mu,$u,Ru,Fu,Gu,Lu,Nu,Uu,Tu,Pu,qu,Ou,Hu,zu,Ku,Vu,Ju,Yu,ju,Wu,Xu,Zu,th,eh,nh,ih,rh,oh,sh,ah,Ah=z((()=>{pA(),Bu(),wA(),QA(),mu=class t{constructor(t,e,n,i){this.module=t,this.dataType=e,this.data=n,this.dims=i}getFloat32Array(){if(1!==this.dataType)throw new Error("Invalid data type");let t=me.size(this.dims);return 0===t?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(7!==this.dataType)throw new Error("Invalid data type");let t=me.size(this.dims);return 0===t?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(6!==this.dataType)throw new Error("Invalid data type");let t=me.size(this.dims);return 0===t?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}reshape(e){if(me.size(e)!==me.size(this.dims))throw new Error("Invalid new shape");return new t(this.module,this.dataType,this.data,e)}},Qu=class{constructor(t,e,n){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let i=t.HEAPU32,r=n>>>2;this.opKernelContext=i[r++];let o=i[r++];this.outputCount=i[r++],this.customDataOffset=i[r++],this.customDataSize=i[r++];let s=[];for(let e=0;e<o;e++){let e=i[r++],n=i[r++],o=i[r++],a=[];for(let t=0;t<o;t++)a.push(i[r++]);s.push(new mu(t,e,n,a))}this.inputs=s}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}getMaxComputeWorkgroupSizes(){return[this.backend.device.limits.maxComputeWorkgroupSizeX,this.backend.device.limits.maxComputeWorkgroupSizeY,this.backend.device.limits.maxComputeWorkgroupSizeZ]}getMaxComputeWorkgroupStoragesize(){return this.backend.device.limits.maxComputeWorkgroupStorageSize}compute(t,e){let n=e?.inputs?.map((t=>"number"==typeof t?this.inputs[t]:t))??this.inputs,i=e?.outputs??[];return this.backend.run(t,n,i,((t,e,n)=>new mu(this.module,e,this.output(t,n),n)),((t,e)=>{let n=Zt(t);if(!n)throw new Error(`Unsupported data type: ${t}`);let i=n*me.size(e),r=i>0?this.backend.gpuDataManager.create(i).id:0;return new mu(this.module,t,r,e)}),this.outputCount)}output(t,e){let n=this.module.stackSave();try{let n=this.module.stackAlloc(4*(1+e.length)),i=n>>2;this.module.HEAPU32[i++]=e.length;for(let t=0;t<e.length;t++)this.module.HEAPU32[i++]=e[t];return this.module.$t(this.opKernelContext,t,n)}catch(n){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(n)}}},ku=async(t,e,n,i)=>{let r=e.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if("webgpu"===t){let t=new lA;await t.initialize(n,i),r("webgpu",[t,e=>t.alloc(e),e=>t.free(e),(n,i,r,o=!1)=>{if(o)ue("verbose",(()=>`[WebGPU] jsepCopyGpuToGpu: src=${n}, dst=${i}, size=${r}`)),t.memcpy(n,i);else{ue("verbose",(()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${n}, gpuDataId=${i}, size=${r}`));let o=e.HEAPU8.subarray(n>>>0,(n>>>0)+r);t.upload(i,o)}},async(n,i,r)=>{ue("verbose",(()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${n}, dataOffset=${i}, size=${r}`)),await t.download(n,(()=>e.HEAPU8.subarray(i>>>0,(i>>>0)+r)))},(n,i,r)=>t.createKernel(n,i,r,e.UTF8ToString(e.Rt(i))),e=>t.releaseKernel(e),(n,i,r,o)=>{ue("verbose",(()=>`[WebGPU] jsepRun: sessionHandle=${r}, kernel=${n}, contextDataOffset=${i}`));let s=new Qu(e,t,i);return t.computeKernel(n,s,o)},()=>t.captureBegin(),()=>t.captureEnd(),()=>t.replay()])}else r("webnn")}})),uh=z((()=>{vA(),IA(),pA(),dA(),gA(),yA(),bu=(t,e)=>{0!==Pt().rt(t,e)&&Ht("Can't initialize onnxruntime.")},_u=async t=>{bu(t.wasm.numThreads,ee(t.logLevel))},xu=async(t,e)=>{{let n=(Ah(),V(Eu)).init;if("webgpu"===e){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let e=t.webgpu.adapter;if(e){if("object"!=typeof e.limits||"object"!=typeof e.features||"function"!=typeof e.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let n=t.webgpu.powerPreference;if(void 0!==n&&"low-power"!==n&&"high-performance"!==n)throw new Error(`Invalid powerPreference setting: "${n}"`);let i=t.webgpu.forceFallbackAdapter;if(void 0!==i&&"boolean"!=typeof i)throw new Error(`Invalid forceFallbackAdapter setting: "${i}"`);if(e=await navigator.gpu.requestAdapter({powerPreference:n,forceFallbackAdapter:i}),!e)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await n("webgpu",Pt(),t,e)}if("webnn"===e){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await n("webnn",Pt(),t)}}},Du=new Map,Su=t=>{let e=Pt(),n=e.stackSave();try{let n=e.stackAlloc(8);return 0!==e.dt(t,n,n+4)&&Ht("Can't get session input/output count."),[e.HEAP32[n/4],e.HEAP32[n/4+1]]}finally{e.stackRestore(n)}},Mu=t=>{let e=Pt(),n=e.Ft(t.byteLength);if(0===n)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,n),[n,t.byteLength]},$u=async(t,e)=>{let n,i,r=Pt();Array.isArray(t)?[n,i]=t:t.buffer===r.HEAPU8.buffer?[n,i]=[t.byteOffset,t.byteLength]:[n,i]=Mu(t);let o=0,s=0,a=0,A=[],u=[],h=[];try{if([s,A]=jt(e),e?.externalData&&r.mountExternalData){let t=[];for(let n of e.externalData){let e="string"==typeof n?n:n.path;t.push(re("string"==typeof n?n:n.data).then((t=>{r.mountExternalData(e,t)})))}await Promise.all(t)}for(let t of e?.executionProviders??[])if("webnn"===("string"==typeof t?t:t.name)){if(r.currentContext)throw new Error("WebNN execution provider is already set.");if("string"!=typeof t){let e=t,n=e?.context,i=e?.gpuDevice,o=e?.deviceType,s=e?.numThreads,a=e?.powerPreference;r.currentContext=n||(i?await navigator.ml.createContext(i):await navigator.ml.createContext({deviceType:o,numThreads:s,powerPreference:a}))}else r.currentContext=await navigator.ml.createContext();break}o=await r._(n,i,s),0===o&&Ht("Can't create a session."),r.currentContext&&(r.currentContext=void 0);let[t,l]=Su(o),c=!!e?.enableGraphCapture,f=[],d=[],g=[];for(let e=0;e<t;e++){let t=r.vt(o,e);0===t&&Ht("Can't get an input name."),u.push(t),f.push(r.UTF8ToString(t))}for(let t=0;t<l;t++){let n=r.It(o,t);0===n&&Ht("Can't get an output name."),h.push(n);let i=r.UTF8ToString(n);d.push(i);{if(c&&void 0===e?.preferredOutputLocation){g.push("gpu-buffer");continue}let t="string"==typeof e?.preferredOutputLocation?e.preferredOutputLocation:e?.preferredOutputLocation?.[i]??"cpu";if("cpu"!==t&&"cpu-pinned"!==t&&"gpu-buffer"!==t)throw new Error(`Not supported preferred output location: ${t}.`);if(c&&"gpu-buffer"!==t)throw new Error(`Not supported preferred output location: ${t}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);g.push(t)}}let v=null;return g.some((t=>"gpu-buffer"===t))&&(a=r.bt(o),0===a&&Ht("Can't create IO binding."),v={handle:a,outputPreferredLocations:g,outputPreferredLocationsEncoded:g.map((t=>ie(t)))}),Du.set(o,[o,u,h,v,c,!1]),[o,f,d]}catch(t){throw u.forEach((t=>r.yt(t))),h.forEach((t=>r.yt(t))),0!==a&&r.St(a),0!==o&&r.ft(o),t}finally{r.Gt(n),0!==s&&r.ct(s),A.forEach((t=>r.Gt(t))),r.unmountExternalData?.()}},Ru=t=>{let e=Pt(),n=Du.get(t);if(!n)throw new Error(`cannot release session. invalid session id: ${t}`);let[i,r,o,s,a]=n;s&&(a&&e.xt(s.handle),e.St(s.handle)),e.jsepOnReleaseSession?.(t),r.forEach((t=>e.yt(t))),o.forEach((t=>e.yt(t))),e.ft(i),Du.delete(t)},Fu=(t,e,n,i,r,o=!1)=>{if(!t)return void e.push(0);let s,a,A=Pt(),u=t[0],h=t[1],l=t[3];if("string"===u&&"gpu-buffer"===l)throw new Error("String tensor is not supported on GPU.");if(o&&"gpu-buffer"!==l)throw new Error(`External buffer must be provided for input/output index ${r} when enableGraphCapture is true.`);if("gpu-buffer"===l){let e=t[2].gpuBuffer,n=Zt(Wt(u));a=h.reduce(((t,e)=>t*e),1)*n;let o=A.jsepRegisterBuffer;if(!o)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=o(i,r,e,a)}else{let e=t[2];if(Array.isArray(e)){a=4*e.length,s=A.Ft(a),n.push(s);let t=s/4;for(let i=0;i<e.length;i++){if("string"!=typeof e[i])throw new TypeError(`tensor data at index ${i} is not a string`);A.HEAPU32[t++]=qt(e[i],n)}}else a=e.byteLength,s=A.Ft(a),n.push(s),A.HEAPU8.set(new Uint8Array(e.buffer,e.byteOffset,a),s)}let c=A.stackSave(),f=A.stackAlloc(4*h.length);try{let t=f/4;h.forEach((e=>A.HEAP32[t++]=e));let n=A.wt(Wt(u),s,a,f,h.length,ie(l));0===n&&Ht(`Can't create tensor for input/output. session=${i}, index=${r}.`),e.push(n)}finally{A.stackRestore(c)}},Gu=async(t,e,n,i,r,o)=>{let s=Pt(),a=Du.get(t);if(!a)throw new Error(`cannot run inference. invalid session id: ${t}`);let A=a[0],u=a[1],h=a[2],l=a[3],c=a[4],f=a[5],d=e.length,g=i.length,v=0,I=[],p=[],y=[],w=[],C=s.stackSave(),B=s.stackAlloc(4*d),E=s.stackAlloc(4*d),m=s.stackAlloc(4*g),Q=s.stackAlloc(4*g);try{[v,I]=zt(o);for(let i=0;i<d;i++)Fu(n[i],p,w,t,e[i],c);for(let e=0;e<g;e++)Fu(r[e],y,w,t,d+i[e],c);let a,C=B/4,k=E/4,b=m/4,_=Q/4;for(let t=0;t<d;t++)s.HEAPU32[C++]=p[t],s.HEAPU32[k++]=u[e[t]];for(let t=0;t<g;t++)s.HEAPU32[b++]=y[t],s.HEAPU32[_++]=h[i[t]];if(l&&!f){let{handle:n,outputPreferredLocations:o,outputPreferredLocationsEncoded:a}=l;if(u.length!==d)throw new Error(`input count from feeds (${d}) is expected to be always equal to model's input count (${u.length}).`);for(let i=0;i<d;i++){let r=e[i];0!==await s.nt(n,u[r],p[i])&&Ht(`Can't bind input[${i}] for session=${t}.`)}for(let e=0;e<g;e++){let A=i[e];r[e]?.[3]?0!==s._t(n,h[A],y[e],0)&&Ht(`Can't bind pre-allocated output[${e}] for session=${t}.`):0!==s._t(n,h[A],0,a[A])&&Ht(`Can't bind output[${e}] to ${o[e]} for session=${t}.`)}Du.set(t,[A,u,h,l,c,!0])}s.jsepOnRunStart?.(A),a=l?await s.et(A,l.handle,g,m,v):await s.tt(A,E,B,d,Q,g,m,v),0!==a&&Ht("failed to call OrtRun().");let x=[];for(let t=0;t<g;t++){let e=s.HEAPU32[m/4+t];if(e===y[t]){x.push(r[t]);continue}let n,o=s.stackSave(),a=s.stackAlloc(16),A=!1,u=0;try{0!==s.Ct(e,a,a+4,a+8,a+12)&&Ht(`Can't access output tensor data on index ${t}.`);let r=a/4,o=s.HEAPU32[r++];u=s.HEAPU32[r++];let h=s.HEAPU32[r++],c=s.HEAPU32[r++],f=[];for(let t=0;t<c;t++)f.push(s.HEAPU32[h/4+t]);s.yt(h);let d=f.reduce(((t,e)=>t*e),1);n=Xt(o);let g=l?.outputPreferredLocations[i[t]];if("string"===n){if("gpu-buffer"===g)throw new Error("String tensor is not supported on GPU.");let t=[],e=u/4;for(let n=0;n<d;n++){let i=s.HEAPU32[e++],r=n===d-1?void 0:s.HEAPU32[e]-i;t.push(s.UTF8ToString(i,r))}x.push([n,f,t,"cpu"])}else if("gpu-buffer"===g&&d>0){let t=s.jsepGetBuffer;if(!t)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let i=t(u),r=Zt(o);if(void 0===r||!ne(n))throw new Error(`Unsupported data type: ${n}`);A=!0,x.push([n,f,{gpuBuffer:i,download:s.jsepCreateDownloader(i,d*r,n),dispose:()=>{s.Bt(e)}},"gpu-buffer"])}else{let t=new(te(n))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(s.HEAPU8.subarray(u,u+t.byteLength)),x.push([n,f,t,"cpu"])}}finally{s.stackRestore(o),"string"===n&&u&&s.Gt(u),A||s.Bt(e)}}return l&&!c&&(s.xt(l.handle),Du.set(t,[A,u,h,l,c,!1])),x}finally{s.stackRestore(C),p.forEach((t=>s.Bt(t))),y.forEach((t=>s.Bt(t))),w.forEach((t=>s.Gt(t))),0!==v&&s.kt(v),I.forEach((t=>s.Gt(t)))}},Lu=t=>{let e=Pt(),n=Du.get(t);if(!n)throw new Error("invalid session id");let i=n[0],r=e.Mt(i);0===r&&Ht("Can't get an profile file name."),e.yt(r)},Nu=t=>{let e=[];for(let n of t){let t=n[2];!Array.isArray(t)&&"buffer"in t&&e.push(t.buffer)}return e}})),hh=z((()=>{gt(),uh(),dA(),fA(),Uu=()=>!!v.wasm.proxy&&typeof document<"u",Pu=!1,qu=!1,Ou=!1,Ku=new Map,Vu=(t,e)=>{let n=Ku.get(t);n?n.push(e):Ku.set(t,[e])},Ju=()=>{if(Pu||!qu||Ou||!Tu)throw new Error("worker not ready")},Yu=t=>{switch(t.data.type){case"init-wasm":Pu=!1,t.data.err?(Ou=!0,zu[1](t.data.err)):(qu=!0,zu[0]()),Hu&&(URL.revokeObjectURL(Hu),Hu=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=Ku.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}}},ju=async()=>{if(!qu){if(Pu)throw new Error("multiple calls to 'initWasm()' detected.");if(Ou)throw new Error("previous call to 'initWasm()' failed.");if(Pu=!0,Uu())return new Promise(((t,e)=>{Tu?.terminate(),St().then((([n,i])=>{try{(Tu=i).onerror=t=>e(t),Tu.onmessage=Yu,zu=[t,e];let r={type:"init-wasm",in:v};Tu.postMessage(r),Hu=n}catch(t){e(t)}}),e)}));try{await Tt(v.wasm),await _u(v),qu=!0}catch(t){throw Ou=!0,t}finally{Pu=!1}}},Wu=async t=>{if(Uu())return Ju(),new Promise(((e,n)=>{Vu("init-ep",[e,n]);let i={type:"init-ep",in:{epName:t,env:v}};Tu.postMessage(i)}));await xu(v,t)},Xu=async t=>Uu()?(Ju(),new Promise(((e,n)=>{Vu("copy-from",[e,n]);let i={type:"copy-from",in:{buffer:t}};Tu.postMessage(i,[t.buffer])}))):Mu(t),Zu=async(t,e)=>{if(Uu()){if(e?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ju(),new Promise(((n,i)=>{Vu("create",[n,i]);let r={type:"create",in:{model:t,options:{...e}}},o=[];t instanceof Uint8Array&&o.push(t.buffer),Tu.postMessage(r,o)}))}return $u(t,e)},th=async t=>{if(Uu())return Ju(),new Promise(((e,n)=>{Vu("release",[e,n]);let i={type:"release",in:t};Tu.postMessage(i)}));Ru(t)},eh=async(t,e,n,i,r,o)=>{if(Uu()){if(n.some((t=>"cpu"!==t[3])))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some((t=>t)))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ju(),new Promise(((r,s)=>{Vu("run",[r,s]);let a=n,A={type:"run",in:{sessionId:t,inputIndices:e,inputs:a,outputIndices:i,options:o}};Tu.postMessage(A,Nu(a))}))}return Gu(t,e,n,i,r,o)},nh=async t=>{if(Uu())return Ju(),new Promise(((e,n)=>{Vu("end-profiling",[e,n]);let i={type:"end-profiling",in:t};Tu.postMessage(i)}));Lu(t)}})),lh=z((()=>{gt(),hh(),pA(),vt(),yA(),ih=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},rh=t=>{switch(t[3]){case"cpu":return new S(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!ne(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:n,download:i,dispose:r}=t[2];return S.fromGpuBuffer(n,{dataType:e,dims:t[1],download:i,dispose:r})}default:throw new Error(`invalid data location: ${t[3]}`)}},oh=class{async fetchModelAndCopyToWasmMemory(t){return Xu(await re(t))}async loadModel(t,e){let n;R(),n="string"==typeof t?await this.fetchModelAndCopyToWasmMemory(t):t,[this.sessionId,this.inputNames,this.outputNames]=await Zu(n,e),F()}async dispose(){return th(this.sessionId)}async run(t,e,n){R();let i=[],r=[];Object.entries(t).forEach((t=>{let e=t[0],n=t[1],o=this.inputNames.indexOf(e);if(-1===o)throw new Error(`invalid input '${e}'`);i.push(n),r.push(o)}));let o=[],s=[];Object.entries(e).forEach((t=>{let e=t[0],n=t[1],i=this.outputNames.indexOf(e);if(-1===i)throw new Error(`invalid output '${e}'`);o.push(n),s.push(i)}));let a=i.map(((t,e)=>ih(t,(()=>`input "${this.inputNames[r[e]]}"`)))),A=o.map(((t,e)=>t?ih(t,(()=>`output "${this.outputNames[s[e]]}"`)):null)),u=await eh(this.sessionId,r,a,s,A,n),h={};for(let t=0;t<u.length;t++)h[this.outputNames[s[t]]]=o[t]??rh(u[t]);return F(),h}startProfiling(){}endProfiling(){nh(this.sessionId)}}})),ch=z((()=>{gt(),hh(),lh(),fA(),sh=()=>{if(("number"!=typeof v.wasm.initTimeout||v.wasm.initTimeout<0)&&(v.wasm.initTimeout=0),v.wasm.simd,"boolean"!=typeof v.wasm.proxy&&(v.wasm.proxy=!1),"boolean"!=typeof v.wasm.trace&&(v.wasm.trace=!1),"number"!=typeof v.wasm.numThreads||!Number.isInteger(v.wasm.numThreads)||v.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)v.wasm.numThreads=1;else{let t=typeof navigator>"u"?H("node:os").cpus().length:navigator.hardwareConcurrency;v.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},ah=class{async init(t){sh(),await ju(),await Wu(t)}async createInferenceSessionHandler(t,e){let n=new oh;return await n.loadModel(t,e),Promise.resolve(n)}}})),fh={};K(fh,{wasmBackend:()=>dh});var dh,gh=z((()=>{ch(),dh=new ah}));gt(),gt(),gt();var vh=dt;{let t=(gh(),V(fh)).wasmBackend;h("webgpu",t,5),h("webnn",t,5),h("cpu",t,10),h("wasm",t,10)}Object.defineProperty(v.versions,"web",{value:"1.19.2",enumerable:!0});let Ih=new Worker(URL.createObjectURL(new Blob(["(",function(){const t=262145,e=new Uint32Array(1572870);let n,i;self.onmessage=r=>{(async r=>{((r,o)=>{const s=r.Ut,a=r.Tt;let A=1/0,u=-1/0,h=0,l=1/0,c=0;const f=a*a/2;for(let t=0,e=s.length;t<e;t+=1){const e=s[t],{Pt:n,qt:i,Ot:r,Ht:o,zt:a,Kt:f}=e;h+=a.byteLength/4/3,l=Math.min(l,f),c=Math.max(c,f),r[0],r[1];const d=r[2];r[3],r[4],r[5];const g=r[6];r[7],r[8],r[9];const v=r[10];r[11],r[12],r[13];const I=r[14];r[15];for(let t=0;t<8;++t){let e=d*(1&t?i[0]:n[0])+g*(2&t?i[1]:n[1])+v*(4&t?i[2]:n[2])+I;A=Math.min(A,e),u=Math.max(u,e)}}const d=t*(c-l+1),g=new Uint32Array(e.buffer,0,d);A-=1,n=new Uint32Array(h),i=new Uint32Array(h);for(var v=0;v<d;v+=1)g[v]=0;const I=1/(u-A)*262144;let p=0;const y=[],w=2*Math.log2(a);let C,B=0;for(let e=0,r=s.length;e<r;e+=1){const r=s[e],{Pt:o,qt:u,Ot:h,Ht:l,zt:d,Kt:v,Vt:C,Jt:E}=r;let m=0,Q=[];for(let t=0,e=C.length;t<e;t+=1){const e=C[t];let n=y.indexOf(e._id);-1==n?(y.push(e._id),e.Yt=y.length-1):e.Yt=n;let i=l+"_"+t;e.idxOffsetInThisTexture=e.jt[i][0]*a/2,e.startIdxInTile=m,m+=e.jt[i][1]*a/2,e.endIdxInTilePlus1=Math.min(E,m),Q.push(e.endIdxInTilePlus1)}r.Wt=p;const k=c-v,b=h[2],_=h[6],x=h[10],D=h[14],S=new Float32Array(d);let M=0,$=C[0].Yt,R=C[M],F=R.idxOffsetInThisTexture-R.startIdxInTile;for(let e=0;e<E;++e){const r=3*e,o=((b*S[r]+_*S[r+1]+x*S[r+2]+D-A)*I|0)+k*t,s=e+p;n[s]=o,B+=1,Q.length>1&&(M=e/f|0,$=C[M].Yt,R=C[M],F=R.idxOffsetInThisTexture-R.startIdxInTile);const a=F+e;i[s]=($<<w)+a,g[o]++}p+=E}for(let t=1;t<d;t++)g[t]+=g[t-1];C=r.Xt.byteLength/4<h?new Int32Array(h):new Int32Array(r.Xt);for(let t=h-1;t>=0;t--){const e=n[t];e&&(C[--g[e]]=i[t])}C=C.reverse();const E=[],m=[],Q=[0],k=[];s.forEach((t=>{E.push(t.Ht),k.push(t.Kt),m.push(t.zt),Q.push(t.Jt+Q[Q.length-1])})),Q.pop(),self.postMessage({Zt:o,te:E,zt:m,jt:Q,Xt:C,ee:y,ne:C.length-B,ie:B},[C.buffer,...m])})(r,r.Zt)})(r.data)}}.toString(),")(self)"],{type:"application/javascript"})));const ph=Ih;for(var yh,wh=[],Ch=0;Ch<256;++Ch)wh.push((Ch+256).toString(16).slice(1));var Bh=new Uint8Array(16);function Eh(){if(!yh&&!(yh="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yh(Bh)}var mh={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Qh(t,e,n){if(mh.randomUUID&&!e&&!t)return mh.randomUUID();var i=(t=t||{}).random||(t.rng||Eh)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(t,e=0){return(wh[t[e+0]]+wh[t[e+1]]+wh[t[e+2]]+wh[t[e+3]]+"-"+wh[t[e+4]]+wh[t[e+5]]+"-"+wh[t[e+6]]+wh[t[e+7]]+"-"+wh[t[e+8]]+wh[t[e+9]]+"-"+wh[t[e+10]]+wh[t[e+11]]+wh[t[e+12]]+wh[t[e+13]]+wh[t[e+14]]+wh[t[e+15]]).toLowerCase()}(i)}class kh{static idCount=0;_id;re;oe;se;ae;Ae;_texture;jt={};ue;he=-2;ce=0;fe=!1;constructor(t,e){this._id=kh.idCount++,this.Ae=e,this.oe=this.se=t,this.ue=[[0,this.se]],this.ae=t,this._texture=new r.Texture({name:this._id,context:this.Ae,internalFormat:r.WebGLConstants.RGBA32F,pixelFormat:r.WebGLConstants.RGBA,pixelDatatype:r.WebGLConstants.FLOAT,width:t,height:t,flipY:!1,sampler:new r.Sampler({minificationFilter:r.TextureMinificationFilter.NEAREST,magnificationFilter:r.TextureMagnificationFilter.NEAREST})})}de(t,e,n){const i=this.ve(t.height),r=this.ue[i][0];this._texture.copyFrom({xOffset:0,yOffset:r,source:t}),this.jt[e]=[r,t.height],this.ae-=t.height,this.re?(this.re.x=(this.re.x*this.ce+n.x)/(this.ce+1),this.re.y=(this.re.y*this.ce+n.y)/(this.ce+1),this.re.z=(this.re.z*this.ce+n.z)/(this.ce+1)):this.re=n,this.ce+=1,this.Ie()}pe(t,e){this.ae+=this.jt[t][1],delete this.jt[t],this.Ie(),this.ue.length&&this.re?(this.re.x=(this.re.x*this.ce-e.x)/(this.ce-1),this.re.y=(this.re.y*this.ce-e.y)/(this.ce-1),this.re.z=(this.re.z*this.ce-e.z)/(this.ce-1)):this.re=void 0,this.ce-=1}Ie(){const t=Object.values(this.jt).map((t=>[t[0],t[0]+t[1]])).sort(((t,e)=>t[0]<e[0]?-1:1)).flat();t.unshift(0),t.push(this.se);const e=[];for(let n=0;n<t.length;n+=2)t[n]!==t[n+1]&&e.push([t[n],t[n+1]]);this.ue=e}ve(t){for(let e=0;e<this.ue.length;e+=1)if(this.ue[e][1]-this.ue[e][0]>=t)return e;return-1}ye(){this.ae=this.se,this.re=void 0,this.ce=0,this.jt={},this.ue=[[0,this.se]]}we(){return this.ae===this.se}_destroy(){this.fe||(this.fe=!0,this.ye(),this._texture.destroy(),this._texture=null)}}class bh{Ce=[];Be={};Ae;Tt;Vt={};constructor(t,e){this.Ae=t,this.Tt=e}Ee(t){return t.map((t=>this.Vt[t]))}me(t,e,n,i){if(this.Be[i]){let r=this.Qe(t,e,n,this.Be[i]);return r||(r=this.Ce.length?this.Ce.pop():new kh(this.Tt,this.Ae),r.he=i,this.Be[i].push(r),this.Vt[r._id]=r),r}{this.Be[i]=[];const t=new kh(this.Tt,this.Ae);return t.he=i,this.Be[i].push(t),this.Vt[t._id]=t,t}}_destroy(){Object.keys(this.Be).forEach((t=>{this.Be[t].forEach((t=>{t._destroy(),delete this.Vt[t._id]})),delete this.Be[t]})),this.Ce.forEach((t=>{t._destroy(),delete this.Vt[t._id]})),this.Ce=[]}Qe(t,n,i,r){let o,s=1/0;for(let a=r.length-1;a>=0;a-=1){const A=r[a];if(-1!==A.ve(i)){const i=e.Cartesian3.distance(t,A.re);i<n&&i<s&&(s=i,o=A)}}return o}ke(t){const{Vt:e}=t;e?.forEach(((e,n)=>{const i=t.be+"_"+n;if(e.pe(i,t._e),e.we()){e.ye(),this.Ce.length<2?this.Ce.push(e):e._destroy();const n=this.Be[t.Kt].indexOf(e);-1!==n&&this.Be[t.Kt].splice(n,1),delete this.Vt[e._id]}}))}}class _h{xe=Qh();Ae;De=0;Se;_texture;Me;textureWidth;$e=!0;Re;Fe={zt:new ArrayBuffer(0),Ot:[],ie:0,Pt:[0,0,0],qt:[0,0,0]};Ge;afterSort;Le={Xt:new Int32Array(0),te:[],_modelMatrix:r.Matrix4.IDENTITY.clone(),Vt:[],ie:0,Ne:-1,Ue:void 0,Te:[0]};Pe=[0,0,0];constructor(t){this.Ae=t.Ae,this.Me=t.Me,this.textureWidth=Math.min(4096,this.Ae._gl.getParameter(this.Ae._gl.MAX_TEXTURE_SIZE)),this.Ge=new bh(this.Ae,this.textureWidth),ph.addEventListener("message",(t=>{this.qe(t.data)})),t.Oe&&(this.Re=t.Oe,this.He(),this.ze()),this.Pe=t.Pe}updateData(t,e){this.Re=t,this.Pe=e,this.He(),this.ze()}qe(t){const{Xt:e,jt:n,ie:i,Zt:o}=t;if(o!==this.xe)return;const s=r.Cartesian3.fromDegrees(this.Me[0],this.Me[1],this.Me[2]),a=r.Transforms.eastNorthUpToFixedFrame(s);this.Le={te:["single-model"],Xt:e,_modelMatrix:a,Vt:[this._texture],ie:i,Ne:this.Le.Ne,Ue:this.Le.Ue,Te:[i]},this.$e=!0,this.afterSort&&this.afterSort(this.Le)}ze(){if(this._texture&&this._texture.destroy(),!this.Re)return;const t=this.textureWidth;let e=Math.ceil(this.Re.byteLength/16/t);e=Math.pow(2,Math.ceil(Math.log2(e)));const n=new Float32Array(new ArrayBuffer(t*e*16));n.set(new Float32Array(this.Re),0);const i=new r.Cartesian3(this.Pe[0],this.Pe[1],this.Pe[2]),o=this.Ge.me(i,600,e,4);o.de({width:t,height:e,arrayBufferView:n},"single-buffer",i),this._texture=o}_destroy(){this.Le=void 0,this.Fe=void 0}Ke(t,e){this.Le.Ne=t,this.Le.Ue=e||void 0}Ve(t){const e=t.camera.viewMatrix,n=(new Date).getTime();let i=!1;if(!(0==this.$e||this.Le&&this.Le.Xt.buffer.detached)&&(this.De?this.Je(this.Se,e)&&(i=!0):i=!0,i)){const i=t.camera.frustum.projectionMatrix;this.De=n,this.Se=e.clone(),this.$e=!1;const o=[this.Le.Xt.buffer],s=r.Cartesian3.fromDegrees(this.Me[0],this.Me[1],this.Me[2]),a=r.Transforms.eastNorthUpToFixedFrame(s);r.Matrix4.multiply(e,a,a),r.Matrix4.multiply(i,a,a);const A={Zt:this.xe,Ye:e,Xt:this.Le.Xt,jt:[0],Ut:[{Kt:0,Ht:this.xe,zt:this.Fe.zt,Ot:a,Pt:this.Fe.Pt,qt:this.Fe.qt,Jt:this.Fe.ie}]};ph.postMessage(A,o)}}Je(t,e){let n=t[2]*e[2]+t[6]*e[6]+t[10]*e[10];const i=(t[2]**2+t[6]**2+t[10]**2)**.5,r=(e[2]**2+e[6]**2+e[10]**2)**.5;return Math.abs(n/i/r-1)>.01}He(){if(!this.Re)return;const t=new Float32Array(this.Re),e=[1/0,1/0,1/0,-1/0,-1/0,-1/0],n=new Float32Array(this.Re.byteLength/8/4*3);for(let i=0;i<t.length;i+=8){const r=t[i],o=t[i+1],s=t[i+2];n[i/8*3]=r,n[i/8*3+1]=o,n[i/8*3+2]=s,e[0]=Math.min(e[0],r),e[1]=Math.min(e[1],o),e[2]=Math.min(e[2],s),e[3]=Math.max(e[3],r),e[4]=Math.max(e[4],o),e[5]=Math.max(e[5],s)}this.Fe.qt=[e[0],e[1],e[2]],this.Fe.Pt=[e[3],e[4],e[5]],this.Fe.zt=n.buffer,this.Fe.ie=n.length/3}}var xh="#version 300 es\nprecision lowp float;in vec4 color;in vec2 texCoord;void main(){float A=-dot(texCoord,texCoord);float B=exp(A*4.0f)*color.a;if(B<0.1f)discard;out_FragColor=vec4(color.rgb,B);}",Dh="precision mediump float;varying vec4 color;varying vec2 texCoord;void main(){float A=-dot(texCoord,texCoord);float B=exp(A*4.0)*color.a;if(B<0.1)discard;out_FragColor=vec4(color.rgb,B);}";class Sh{je;We;Oe;Xe=!1;fe=!1;Ze;tn;constructor(t,e,n){this.Oe=t,this.Ze=e,this.tn=n}update(t){this.fe||this.Xe&&this.tn.Xe&&(this.tn.en&&(t.commandList.unshift(this.We),this.We.nn),t.commandList.unshift(this.je))}postPassesUpdate(t){}isDestroyed(){return this.fe}show(t){0==this.Xe&&(this.Xe=!0),this.je.sort=t,this.We.sort=t}hide(){this.Xe&&(this.Xe=!1)}destroy(){this.Oe?.Vt&&this.Oe?.Vt.forEach((t=>{t._destroy()})),this.je.vertexArray.getAttribute(1).vertexBuffer.destroy(),this.je.vertexArray.rn=[],this.je.vertexArray.destroy(),this.tn=void 0,this.Oe=void 0,this.fe=!0}}class Mh{Ae;_scene;sn;an;An;un;hn;ln=[];cn;Tt;fn;dn;en;gn;vn=new r.Cartesian2(1,1);Xe=!0;constructor(t){this.Ae=t.scene.context,this.Tt=t.Tt,t.vn&&(this.vn=new r.Cartesian2(t.vn.brightness||1,t.vn.saturate||1)),this._scene=t.scene,this.en=t.en,this.gn=t.gn;const e=r.FeatureDetection.supportsWebgl2&&r.FeatureDetection.supportsWebgl2(this._scene);this.dn=new r.PrimitiveCollection,this.dn.destroyPrimitives=!1,this._scene.primitives.add(this.dn),this.sn=r.ShaderProgram.fromCache({context:this.Ae,vertexShaderSource:e?"#version 300 es\nprecision highp int;precision highp float;in vec3 position;in float pIdx;uniform vec2 viewport;uniform highp sampler2D u_txts[16];uniform mat4 u_mvs;uniform ivec4 u_params;uniform int u_sltid;uniform vec4 u_sltc;uniform vec2 u_filter;out vec3 texCoord;out vec4 color;vec3 rgbToHls(vec3 rgb){float maxC=max(max(rgb.r,rgb.g),rgb.b);float minC=min(min(rgb.r,rgb.g),rgb.b);float h,l,s;l=(maxC+minC)/2.0f;if(maxC==minC){s=0.0f;h=0.0f;}else{float delta=maxC-minC;s=(l<0.5f)? delta/(maxC+minC): delta/(2.0f-maxC-minC);if(maxC==rgb.r){h=(rgb.g-rgb.b)/delta+(rgb.g<rgb.b ? 6.0f : 0.0f);}else if(maxC==rgb.g){h=(rgb.b-rgb.r)/delta+2.0f;}else{h=(rgb.r-rgb.g)/delta+4.0f;}h/=6.0f;}return vec3(h,l,s);}float hueToRgb(float t1,float t2,float hue){if(hue<0.0f)hue+=1.0f;if(hue>1.0f)hue-=1.0f;if(hue<1.0f/6.0f)return t1+(t2-t1)*6.0f*hue;if(hue<0.5f)return t2;if(hue<2.0f/3.0f)return t1+(t2-t1)*(2.0f/3.0f-hue)*6.0f;return t1;}vec3 hlsToRgb(vec3 hls){float h=hls.x;float l=hls.y;float s=hls.z;vec3 rgb;if(s==0.0f){rgb=vec3(l);}else{float temp2=(l<0.5f)? l*(1.0f+s): l+s-l*s;float temp1=2.0f*l-temp2;rgb.r=hueToRgb(temp1,temp2,h+1.0f/3.0f);rgb.g=hueToRgb(temp1,temp2,h);rgb.b=hueToRgb(temp1,temp2,h-1.0f/3.0f);}return rgb;}vec4 modify(vec4 color,vec2 f){vec3 hls=rgbToHls(color.xyz);hls.z*=f.y;hls.y*=f.x;hls=clamp(hls,0.0f,1.0f);return vec4(hlsToRgb(hls),color.a);}void main(){int idx=floatBitsToInt(pIdx);int bits=((u_params.y+1)*2);int texId=idx>>bits;idx=idx&((1<<bits)-1);int px=u_params.x;int py=u_params.y;int u_1=(idx&px)<<1;int u_2=u_1|1;int v=(idx>>py);ivec2 a=ivec2(u_1,v);ivec2 b=ivec2(u_2,v);highp vec4 ct;vec4 cvf;switch(texId){case 0:ct=texelFetch(u_txts[0],a,0);cvf=texelFetch(u_txts[0],b,0);break;case 1:ct=texelFetch(u_txts[1],a,0);cvf=texelFetch(u_txts[1],b,0);break;case 2:ct=texelFetch(u_txts[2],a,0);cvf=texelFetch(u_txts[2],b,0);break;case 3:ct=texelFetch(u_txts[3],a,0);cvf=texelFetch(u_txts[3],b,0);break;case 4:ct=texelFetch(u_txts[4],a,0);cvf=texelFetch(u_txts[4],b,0);break;case 5:ct=texelFetch(u_txts[5],a,0);cvf=texelFetch(u_txts[5],b,0);break;case 6:ct=texelFetch(u_txts[6],a,0);cvf=texelFetch(u_txts[6],b,0);break;case 7:ct=texelFetch(u_txts[7],a,0);cvf=texelFetch(u_txts[7],b,0);break;case 8:ct=texelFetch(u_txts[8],a,0);cvf=texelFetch(u_txts[8],b,0);break;case 9:ct=texelFetch(u_txts[9],a,0);cvf=texelFetch(u_txts[9],b,0);break;case 10:ct=texelFetch(u_txts[10],a,0);cvf=texelFetch(u_txts[10],b,0);break;case 11:ct=texelFetch(u_txts[11],a,0);cvf=texelFetch(u_txts[11],b,0);break;case 12:ct=texelFetch(u_txts[12],a,0);cvf=texelFetch(u_txts[12],b,0);break;case 13:ct=texelFetch(u_txts[13],a,0);cvf=texelFetch(u_txts[13],b,0);break;case 14:ct=texelFetch(u_txts[14],a,0);cvf=texelFetch(u_txts[14],b,0);break;case 15:ct=texelFetch(u_txts[15],a,0);cvf=texelFetch(u_txts[15],b,0);break;}if((floatBitsToUint(ct.w)>>24)>15u){return;}vec4 splat_cam=u_mvs*vec4(ct.xyz,1);vec4 splat_proj=czm_projection*splat_cam;float w=abs(splat_proj.w)*1.05f;if(abs(splat_proj.z)>w||abs(splat_proj.x)>w||abs(splat_proj.y)>w){return;}uvec4 cov=floatBitsToUint(cvf);vec2 u1=unpackHalf2x16(cov.x),u2=unpackHalf2x16(cov.y),u3=unpackHalf2x16(cov.z);mat3 Vrk=mat3(u1.x,u1.y,u2.x,u1.y,u2.y,u3.x,u2.x,u3.x,u3.y);float focal=viewport.x*czm_projection[0][0];mat3 J=mat3(focal/splat_cam.z,0.f,-(focal*splat_cam.x)/(splat_cam.z*splat_cam.z),0.f,focal/splat_cam.z,-(focal*splat_cam.y)/(splat_cam.z*splat_cam.z),0.f,0.f,0.f);mat3 W=transpose(mat3(u_mvs));mat3 T=W*J;mat3 cov2d=transpose(T)*Vrk*T;float diagonal1=cov2d[0][0];float offDiagonal=cov2d[0][1];float diagonal2=cov2d[1][1];float mid=0.5f*(diagonal1+diagonal2);float _radius=length(vec2((diagonal1-diagonal2)/2.0f,offDiagonal));if(_radius<0.01f){return;}float lambda1=mid+_radius;float lambda2=max(mid-_radius,0.1f);vec2 diagonalVector=normalize(vec2(offDiagonal,lambda1-diagonal1));vec2 v1=min(sqrt(2.0f*lambda1),1024.0f)*diagonalVector;vec2 v2=min(sqrt(2.0f*lambda2),1024.0f)*vec2(diagonalVector.y,-diagonalVector.x);if(dot(v1,v1)<0.01f&&dot(v2,v2)<0.01f){return;}color=clamp(splat_proj.z/splat_proj.w+1.0f,0.0f,1.0f)*vec4((cov.w)&0xffu,(cov.w>>8)&0xffu,(cov.w>>16)&0xffu,(cov.w>>24)&0xffu)/255.0f;color=modify(color,u_filter);if((u_sltid!=0&&(floatBitsToUint(ct.w)&0xffu)==uint(u_sltid))||u_sltid==-1){if(u_sltc.a==0.0f){return;}color.rgb=mix(color.rgb,u_sltc.rgb,u_sltc.a);}texCoord=vec3(position.xy,clamp(splat_proj.z,100.0f,2000.0f));vec2 vct=vec2(splat_proj)/splat_proj.w;gl_Position=vec4((vct+position.x*v1/viewport+position.y*v2/viewport)*splat_proj.w,splat_proj.z,splat_proj.w);}":"precision highp int;precision highp float;attribute vec3 position;attribute float pIdx;uniform vec2 viewport;uniform highp sampler2D u_txts[16];uniform mat4 u_mvs[16];uniform vec2 u_tsz[16];uniform int u_ofsts[16];uniform ivec2 u_params;uniform int u_sltid;uniform vec4 u_sltc;varying vec2 texCoord;varying vec4 color;int getIndex(int idx){for(int i=0;i<15;i++){if(idx<(u_ofsts[i+1])){return i;}}return 15;}vec4 floatToVec4Bytes(float value){if(value==0.0){return vec4(0.0);}float sign=value<0.0 ? 1.0 : 0.0;value=abs(value);float exponent=floor(log2(value));float mantissa=value/exp2(exponent)-1.0;exponent+=127.0;mantissa*=8388608.0;float b0=(sign*128.0)+floor(exponent/2.0);float b1=mod(exponent,2.0)*128.0+floor(mantissa/65536.0);float b2=mod(floor(mantissa/256.0),256.0);float b3=mod(mantissa,256.0);return vec4(b0,b1,b2,b3);}int vec4ToInt(vec4 bytes){return int(bytes[0]*16777216.0)+int(bytes[1]*65536.0)+int(bytes[2]*256.0)+int(bytes[3]);}int floatBitsToInt(float value){float man=fract(value*8388608.0);float exp=floor(value/8388608.0);return int((exp*8388608.0+man)-2147483648.0);}ivec4 floatBitsToInt(vec4 value){return ivec4(vec4ToInt(floatToVec4Bytes(value.x)),vec4ToInt(floatToVec4Bytes(value.y)),vec4ToInt(floatToVec4Bytes(value.z)),vec4ToInt(floatToVec4Bytes(value.w)));}vec4 texelFetch(sampler2D texture,ivec2 coord,int texId){vec2 texCoord=(vec2(coord)+0.5)/u_tsz[texId];return texture2D(texture,texCoord);}int rightShift(int v,int x){return v/int(exp2(float(x)));}int leftShift(int v,int x){return v*int(exp2(float(x)));}float unpackHalf(float value){float s=(mod(value,32768.0)>=16384.0)?-1.0 : 1.0;value=mod(value,16384.0);float e=floor(value/1024.0);float m=mod(value,1024.0);if(e==0.0){return s*m*exp2(-24.0);}else if(e<31.0){return s*(1.0+m*exp2(-10.0))*exp2(e-15.0);}else{return s*m*exp2(16.0);}}vec2 unpackHalf2x16(int packedValue){float highBits=float(packedValue/65536);float lowBits=mod(float(packedValue),65536.0);return vec2(unpackHalf(highBits),unpackHalf(lowBits));}mat3 transpose(mat3 m){return mat3(m[0][0],m[1][0],m[2][0],m[0][1],m[1][1],m[2][1],m[0][2],m[1][2],m[2][2]);}int mod(int v,int u){return int(mod(float(v),float(u)));}void main(){int pIdx2=floatBitsToInt(pIdx);if(pIdx2==100)return;int texId=getIndex(pIdx2);int idx=pIdx2-(u_ofsts[texId]);highp vec4 ct;vec4 cvf;int px=u_params.x;int py=u_params.y;int ux=int(mod(float(idx),float(px+1)))*2;int ux2=ux+1;int uy=rightShift(idx,py);if(texId==0){ct=texelFetch(u_txts[0],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[0],ivec2(ux2,uy),texId);}else if(texId==1){ct=texelFetch(u_txts[1],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[1],ivec2(ux2,uy),texId);}else if(texId==2){ct=texelFetch(u_txts[2],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[2],ivec2(ux2,uy),texId);}else if(texId==3){ct=texelFetch(u_txts[3],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[3],ivec2(ux2,uy),texId);}else if(texId==4){ct=texelFetch(u_txts[4],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[4],ivec2(ux2,uy),texId);}else if(texId==5){ct=texelFetch(u_txts[5],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[5],ivec2(ux2,uy),texId);}else if(texId==6){ct=texelFetch(u_txts[6],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[6],ivec2(ux2,uy),texId);}else if(texId==7){ct=texelFetch(u_txts[7],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[7],ivec2(ux2,uy),texId);}else if(texId==8){ct=texelFetch(u_txts[8],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[8],ivec2(ux2,uy),texId);}else if(texId==9){ct=texelFetch(u_txts[9],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[9],ivec2(ux2,uy),texId);}else if(texId==10){ct=texelFetch(u_txts[10],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[10],ivec2(ux2,uy),texId);}else if(texId==11){ct=texelFetch(u_txts[11],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[11],ivec2(ux2,uy),texId);}else if(texId==12){ct=texelFetch(u_txts[12],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[12],ivec2(ux2,uy),texId);}else if(texId==13){ct=texelFetch(u_txts[13],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[13],ivec2(ux2,uy),texId);}else if(texId==14){ct=texelFetch(u_txts[14],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[14],ivec2(ux2,uy),texId);}else{ct=texelFetch(u_txts[15],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[15],ivec2(ux2,uy),texId);}ivec4 cov=floatBitsToInt(cvf);vec4 splat_cam=u_mvs[texId]*vec4(ct.xyz,1.0);vec4 splat_proj=czm_projection*splat_cam;vec2 u1=unpackHalf2x16(cov.x),u2=unpackHalf2x16(cov.y),u3=unpackHalf2x16(cov.z);mat3 Vrk=mat3(u1.x,u1.y,u2.x,u1.y,u2.y,u3.x,u2.x,u3.x,u3.y);float focal=viewport.x*czm_projection[0][0];mat3 J=mat3(focal/splat_cam.z,0.0,-(focal*splat_cam.x)/(splat_cam.z*splat_cam.z),0.0,focal/splat_cam.z,-(focal*splat_cam.y)/(splat_cam.z*splat_cam.z),0.0,0.0,0.0);mat3 W=transpose(mat3(u_mvs[texId]));mat3 T=W*J;mat3 cov2d=transpose(T)*Vrk*T;float diagonal1=cov2d[0][0];float offDiagonal=cov2d[0][1];float diagonal2=cov2d[1][1];float mid=0.5*(diagonal1+diagonal2);float _radius=length(vec2((diagonal1-diagonal2)/2.0,offDiagonal));float lambda1=mid+_radius;float lambda2=max(mid-_radius,0.1);vec2 diagonalVector=normalize(vec2(offDiagonal,lambda1-diagonal1));vec2 v1=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;vec2 v2=min(sqrt(2.0*lambda2),1024.0)*vec2(diagonalVector.y,-diagonalVector.x);color=clamp(splat_proj.z/splat_proj.w+1.0,0.0,1.0)*vec4(mod(cov.w,256),mod(rightShift(cov.w,8),256),mod(rightShift(cov.w,16),256),rightShift(cov.w,24))/255.0;texCoord=position.xy;vec2 vct=vec2(splat_proj)/splat_proj.w;gl_Position=vec4((vct+position.x*v1/viewport+position.y*v2/viewport)*splat_proj.w,splat_proj.z,splat_proj.w);gl_Position=vec4((ct.xy/100.0+position.xy/100.0)*splat_proj.w,splat_proj.z,splat_proj.w);if(pIdx==0.0){color=vec4(1.0,0.0,0.0,1.0);}else{color=vec4(0.0,0.0,1.0,1.0);}color.a=1.0;}",fragmentShaderSource:e?"#version 300 es\nprecision lowp float;in vec4 color;in vec3 texCoord;void main(){float A=-dot(texCoord.xy,texCoord.xy);float B=exp(A*4.0f)*color.a;out_FragColor=vec4(color.rgb,B);}":"precision highp float;varying vec4 color;varying vec2 texCoord;void main(){float A=-dot(texCoord,texCoord);float B=exp(A*4.0)*color.a;out_FragColor=vec4(color.rgb,B);}",attributeLocations:{position:0,pIdx:1}}),this.an=r.ShaderProgram.fromCache({context:this.Ae,vertexShaderSource:e?"#version 300 es\nprecision highp int;precision highp float;in vec3 position;in float pIdx;uniform vec2 viewport;uniform highp sampler2D u_txts[16];uniform mat4 u_mvs;uniform ivec4 u_params;uniform int u_sltid;uniform vec4 u_sltc;out vec2 texCoord;out vec4 color;void main(){int idx=floatBitsToInt(pIdx);int texId=idx>>24;idx=idx&0xffffff;int px=u_params.x;int py=u_params.y;int u_1=(idx&px)<<1;int u_2=u_1|1;int v=(idx>>py);ivec2 a=ivec2(u_1,v);ivec2 b=ivec2(u_2,v);highp vec4 ct;vec4 cvf;switch(texId){case 0:ct=texelFetch(u_txts[0],a,0);cvf=texelFetch(u_txts[0],b,0);break;case 1:ct=texelFetch(u_txts[1],a,0);cvf=texelFetch(u_txts[1],b,0);break;case 2:ct=texelFetch(u_txts[2],a,0);cvf=texelFetch(u_txts[2],b,0);break;case 3:ct=texelFetch(u_txts[3],a,0);cvf=texelFetch(u_txts[3],b,0);break;case 4:ct=texelFetch(u_txts[4],a,0);cvf=texelFetch(u_txts[4],b,0);break;case 5:ct=texelFetch(u_txts[5],a,0);cvf=texelFetch(u_txts[5],b,0);break;case 6:ct=texelFetch(u_txts[6],a,0);cvf=texelFetch(u_txts[6],b,0);break;case 7:ct=texelFetch(u_txts[7],a,0);cvf=texelFetch(u_txts[7],b,0);break;case 8:ct=texelFetch(u_txts[8],a,0);cvf=texelFetch(u_txts[8],b,0);break;case 9:ct=texelFetch(u_txts[9],a,0);cvf=texelFetch(u_txts[9],b,0);break;case 10:ct=texelFetch(u_txts[10],a,0);cvf=texelFetch(u_txts[10],b,0);break;case 11:ct=texelFetch(u_txts[11],a,0);cvf=texelFetch(u_txts[11],b,0);break;case 12:ct=texelFetch(u_txts[12],a,0);cvf=texelFetch(u_txts[12],b,0);break;case 13:ct=texelFetch(u_txts[13],a,0);cvf=texelFetch(u_txts[13],b,0);break;case 14:ct=texelFetch(u_txts[14],a,0);cvf=texelFetch(u_txts[14],b,0);break;case 15:ct=texelFetch(u_txts[15],a,0);cvf=texelFetch(u_txts[15],b,0);break;}vec4 splat_cam=u_mvs*vec4(ct.xyz,1);vec4 splat_proj=czm_projection*splat_cam;if(abs(splat_proj.z)>splat_proj.w||abs(splat_proj.x)>splat_proj.w||abs(splat_proj.y)>splat_proj.w){return;}uvec4 cov=floatBitsToUint(cvf);vec2 u1=unpackHalf2x16(cov.x),u2=unpackHalf2x16(cov.y),u3=unpackHalf2x16(cov.z);mat3 Vrk=mat3(u1.x,u1.y,u2.x,u1.y,u2.y,u3.x,u2.x,u3.x,u3.y);float focal=viewport.x*czm_projection[0][0];mat3 J=mat3(focal/splat_cam.z,0.f,-(focal*splat_cam.x)/(splat_cam.z*splat_cam.z),0.f,focal/splat_cam.z,-(focal*splat_cam.y)/(splat_cam.z*splat_cam.z),0.f,0.f,0.f);mat3 W=transpose(mat3(u_mvs));mat3 T=W*J;mat3 cov2d=transpose(T)*Vrk*T;float diagonal1=cov2d[0][0];float offDiagonal=cov2d[0][1];float diagonal2=cov2d[1][1];float mid=0.5f*(diagonal1+diagonal2);float _radius=length(vec2((diagonal1-diagonal2)/2.0f,offDiagonal));if(_radius<0.1f){return;}float lambda1=mid+_radius;float lambda2=max(mid-_radius,0.1f);vec2 diagonalVector=normalize(vec2(offDiagonal,lambda1-diagonal1));vec2 v1=min(sqrt(2.0f*lambda1),1024.0f)*diagonalVector;vec2 v2=min(sqrt(2.0f*lambda2),1024.0f)*vec2(diagonalVector.y,-diagonalVector.x);color=clamp(splat_proj.z/splat_proj.w+1.0f,0.0f,1.0f)*vec4(255.0f,255.0f,255.0f,(cov.w>>24)&0xffu)/255.0f;if(u_sltid!=-1&&(floatBitsToUint(ct.w)&0xffu)==uint(u_sltid)){if(u_sltc.a==0.0f){return;}}texCoord=position.xy;vec2 vct=vec2(splat_proj)/splat_proj.w;gl_Position=vec4((vct+position.x*v1/viewport+position.y*v2/viewport)*splat_proj.w,splat_proj.z,splat_proj.w);}":"precision highp int;precision highp float;attribute vec3 position;attribute float pIdx;uniform vec2 viewport;uniform highp sampler2D u_txts[16];uniform mat4 u_mvs[16];uniform vec2 u_tsz[16];uniform int u_ofsts[16];uniform ivec2 u_params;varying vec2 texCoord;varying vec4 color;int getIndex(int idx){for(int i=0;i<15;i++){if(idx<(u_ofsts[i+1])){return i;}}return 15;}vec4 floatToVec4Bytes(float value){if(value==0.0){return vec4(0.0);}float sign=value<0.0 ? 1.0 : 0.0;value=abs(value);float exponent=floor(log2(value));float mantissa=value/exp2(exponent)-1.0;exponent+=127.0;mantissa*=8388608.0;float b0=(sign*128.0)+floor(exponent/2.0);float b1=mod(exponent,2.0)*128.0+floor(mantissa/65536.0);float b2=mod(floor(mantissa/256.0),256.0);float b3=mod(mantissa,256.0);return vec4(b0,b1,b2,b3);}int vec4ToInt(vec4 bytes){return int(bytes[0]*16777216.0)+int(bytes[1]*65536.0)+int(bytes[2]*256.0)+int(bytes[3]);}int floatBitsToInt(float value){vec4 bytes=floatToVec4Bytes(value);return vec4ToInt(bytes);}ivec4 floatBitsToInt(vec4 value){return ivec4(vec4ToInt(floatToVec4Bytes(value.x)),vec4ToInt(floatToVec4Bytes(value.y)),vec4ToInt(floatToVec4Bytes(value.z)),vec4ToInt(floatToVec4Bytes(value.w)));}vec4 texelFetch(sampler2D texture,ivec2 coord,int texId){vec2 texCoord=(vec2(coord)+0.5)/u_tsz[texId];return texture2D(texture,texCoord);}int rightShift(int v,int x){return v/int(exp2(float(x)));}int leftShift(int v,int x){return v*int(exp2(float(x)));}float unpackHalf(float value){float s=(mod(value,32768.0)>=16384.0)?-1.0 : 1.0;value=mod(value,16384.0);float e=floor(value/1024.0);float m=mod(value,1024.0);if(e==0.0){return s*m*exp2(-24.0);}else if(e<31.0){return s*(1.0+m*exp2(-10.0))*exp2(e-15.0);}else{return s*m*exp2(16.0);}}vec2 unpackHalf2x16(int packedValue){float highBits=float(packedValue/65536);float lowBits=mod(float(packedValue),65536.0);return vec2(unpackHalf(highBits),unpackHalf(lowBits));}mat3 transpose(mat3 m){return mat3(m[0][0],m[1][0],m[2][0],m[0][1],m[1][1],m[2][1],m[0][2],m[1][2],m[2][2]);}void main(){int pIdx2=floatBitsToInt(pIdx);int texId=getIndex(pIdx2);int idx=pIdx2-(u_ofsts[texId]);highp vec4 ct;vec4 cvf;int px=u_params.x;int py=u_params.y;int ux=int(mod(float(idx),float(px+1)))*2;int ux2=ux+1;int uy=rightShift(idx,py);if(texId==0){ct=texelFetch(u_txts[0],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[0],ivec2(ux2,uy),texId);}else if(texId==1){ct=texelFetch(u_txts[1],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[1],ivec2(ux2,uy),texId);}else if(texId==2){ct=texelFetch(u_txts[2],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[2],ivec2(ux2,uy),texId);}else if(texId==3){ct=texelFetch(u_txts[3],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[3],ivec2(ux2,uy),texId);}else if(texId==4){ct=texelFetch(u_txts[4],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[4],ivec2(ux2,uy),texId);}else if(texId==5){ct=texelFetch(u_txts[5],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[5],ivec2(ux2,uy),texId);}else if(texId==6){ct=texelFetch(u_txts[6],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[6],ivec2(ux2,uy),texId);}else if(texId==7){ct=texelFetch(u_txts[7],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[7],ivec2(ux2,uy),texId);}else if(texId==8){ct=texelFetch(u_txts[8],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[8],ivec2(ux2,uy),texId);}else if(texId==9){ct=texelFetch(u_txts[9],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[9],ivec2(ux2,uy),texId);}else if(texId==10){ct=texelFetch(u_txts[10],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[10],ivec2(ux2,uy),texId);}else if(texId==11){ct=texelFetch(u_txts[11],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[11],ivec2(ux2,uy),texId);}else if(texId==12){ct=texelFetch(u_txts[12],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[12],ivec2(ux2,uy),texId);}else if(texId==13){ct=texelFetch(u_txts[13],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[13],ivec2(ux2,uy),texId);}else if(texId==14){ct=texelFetch(u_txts[14],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[14],ivec2(ux2,uy),texId);}else{ct=texelFetch(u_txts[15],ivec2(ux,uy),texId);cvf=texelFetch(u_txts[15],ivec2(ux2,uy),texId);}if((floatBitsToInt(ct.w)/int(exp2(24.0)))>1){return;}ivec4 cov=floatBitsToInt(cvf);vec4 splat_cam=u_mvs[texId]*vec4(ct.xyz,1);vec4 splat_proj=czm_projection*splat_cam;if(splat_proj.z<-splat_proj.w){return;}vec2 u1=unpackHalf2x16(cov.x),u2=unpackHalf2x16(cov.y),u3=unpackHalf2x16(cov.z);mat3 Vrk=mat3(u1.x,u1.y,u2.x,u1.y,u2.y,u3.x,u2.x,u3.x,u3.y);float focal=viewport.x*czm_projection[0][0];mat3 J=mat3(focal/splat_cam.z,0.,-(focal*splat_cam.x)/(splat_cam.z*splat_cam.z),0.,focal/splat_cam.z,-(focal*splat_cam.y)/(splat_cam.z*splat_cam.z),0.,0.,0.);mat3 W=transpose(mat3(u_mvs[texId]));mat3 T=W*J;mat3 cov2d=transpose(T)*Vrk*T;float diagonal1=cov2d[0][0];float offDiagonal=cov2d[0][1];float diagonal2=cov2d[1][1];float mid=0.5*(diagonal1+diagonal2);float _radius=length(vec2((diagonal1-diagonal2)/2.0,offDiagonal));if(_radius<0.1){return;}float lambda1=mid+_radius;float lambda2=max(mid-_radius,0.1);vec2 diagonalVector=normalize(vec2(offDiagonal,lambda1-diagonal1));vec2 v1=min(sqrt(2.0*lambda1),1024.0)*diagonalVector;vec2 v2=min(sqrt(2.0*lambda2),1024.0)*vec2(diagonalVector.y,-diagonalVector.x);color=clamp(splat_proj.z/splat_proj.w+1.0,0.0,1.0)*vec4(255.0,255.0,255.0,rightShift(cov.w,24))/255.0;texCoord=position.xy;vec2 vct=vec2(splat_proj)/splat_proj.w;gl_Position=vec4((vct+position.x*v1/viewport+position.y*v2/viewport)*splat_proj.w,splat_proj.z,splat_proj.w);}",fragmentShaderSource:e?xh:Dh,fragmentShaderSource1:new r.ShaderSource({defines:["LOG_DEPTH_READ_ONLY"],sources:[e?xh:Dh]}),attributeLocations:{position:0,pIdx:1}});const n={enabled:!0,equationRgb:r.BlendEquation.ADD,equationAlpha:r.BlendEquation.ADD,functionSourceRgb:r.BlendFunction.SOURCE_ALPHA,functionDestinationRgb:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:r.BlendFunction.ONE,functionDestinationAlpha:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA};this.An=r.RenderState.fromCache({depthTest:{enabled:!1},blending:n,depthMask:!1,colorMask:{red:!0,green:!0,blue:!0,alpha:!0}}),this.un=r.RenderState.fromCache({depthTest:{enabled:!0},blending:{enabled:!1},depthMask:!0,colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this.hn={index:0,vertexBuffer:r.Buffer.createVertexBuffer({usage:r.BufferUsage.STATIC_DRAW,typedArray:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),context:this.Ae}),componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT},this.cn=this.In(this._scene.context)}_destroy(){this._scene.primitives.remove(this.dn),this.dn=void 0,this.ln.forEach((t=>{t.destroy()})),this.ln=[]}In(t){const e=new Uint8Array([255,255,255,255]);return new r.Texture({context:t,source:{width:1,height:1,arrayBufferView:e},pixelFormat:r.PixelFormat.RGBA,pixelDatatype:r.PixelDatatype.UNSIGNED_BYTE})}pn(){this.Xe=!1,this.dn.show=!1}_show(){this.Xe=!0,this.dn.show=!0}yn(){}wn(t,e){if(e){const n=e.getAttribute(1).vertexBuffer;n.sizeInBytes<t.byteLength?(n.destroy(),e=new r.VertexArray({name:"gaussian",context:this.Ae,attributes:[this.hn,{name:"pIdx",index:1,vertexBuffer:r.Buffer.createVertexBuffer({usage:r.BufferUsage.STATIC_DRAW,typedArray:t,context:this.Ae}),componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,instanceDivisor:1}]})):n?.copyFromArrayView(t)}else e=new r.VertexArray({name:"gaussian",context:this.Ae,attributes:[this.hn,{name:"pIdx",index:1,vertexBuffer:r.Buffer.createVertexBuffer({usage:r.BufferUsage.STATIC_DRAW,typedArray:t,context:this.Ae}),componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,instanceDivisor:1}]});return e}Cn(t){if(!window.stopUpdate&&this.dn)if(t&&t.ie){this.dn.Oe=t;for(let e=0;e<1;e+=1){let n=t;if(this.ln[e]){const t=this.wn(n.Xt,this.ln[e].je.vertexArray);this.ln[e].je.vertexArray=t,this.ln[e].je.instanceCount=n.ie,this.ln[e].We.vertexArray=t,this.ln[e].We.instanceCount=n.ie,this.ln[e].Oe=n}else{this.ln[e]=new Sh(n,e,this);const t={viewport:()=>new r.Cartesian2(this._scene.canvas.width,this._scene.canvas.height),u_filter:()=>this.vn,u_mvs:()=>{const t=new r.Matrix4;return r.Matrix4.multiply(this._scene.camera.viewMatrix,this.ln[e].Oe._modelMatrix,t),t},u_txts:()=>{const t=this.ln[e].Oe.Vt,n=new Array(16);return n.fill(this.cn),t.forEach(((t,e)=>{n[e]=t._texture})),n},u_params:()=>new r.Cartesian4(this.Tt/2-1,Math.log2(this.Tt/2),this.Tt*this.Tt/2,this.ln[e].Oe.te.length),u_sltid:()=>this.ln[e].Oe.Ne||0,u_sltc:()=>this.ln[e].Oe?.Ue||r.Color.fromBytes(0,200,255,80)},i=this.wn(n.Xt);this.ln[e].je=new r.DrawCommand({vertexArray:i,shaderProgram:this.sn,uniformMap:t,renderState:this.An,pass:this.gn||r.Pass.TERRAIN_CLASSIFICATION,instanceCount:n.ie,count:6}),this.ln[e].We=new r.DrawCommand({vertexArray:i,shaderProgram:this.an,uniformMap:t,renderState:this.un,pass:r.Pass.TERRAIN_CLASSIFICATION,instanceCount:n.ie,depthForTranslucentClassification:!0,count:6}),this.dn.add(this.ln[e])}this.ln[e].show()}for(let t=1;t<this.ln.length;t+=1)this.ln[t].hide();this._scene.requestRender()}else this.dn&&(this.dn.show=!1)}}class $h{Bn;be;Oe;Pe;Me;tn;En;constructor(t){this.Bn=t.viewer,this.be=t.url,this.Oe=t.data,this.Pe=t.deltaCenter,this.Me=t.enuCenter;const e=this.Bn.scene;this.En=new _h({Ae:e.context,Oe:this.Oe,Pe:this.Pe,Me:this.Me||[0,0,0]}),this.tn=new Mh({en:!0,scene:e,Tt:this.En.textureWidth}),this.En.afterSort=t=>{this.tn.Cn(t),this.Bn.scene.requestRender()},e.preRender.addEventListener(((t,e)=>{this.En.Ve(t)}),this),this.Bn.scene.requestRender()}selectedEntity(t,e){this.En.Ke(+t,e)}hide(){this.tn.pn()}show(){this.tn._show()}setData(t,e){this.En.updateData(t,e)}destroy(){this.En._destroy(),this.tn._destroy()}}var Rh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Fh(t){return t&&t.mn&&{}.hasOwnProperty.call(t,"default")?t.default:t}var Gh,Lh,Nh,Uh,Th,Ph={exports:{}},qh={exports:{}},Oh={exports:{}},Hh={exports:{}},zh={exports:{}};function Kh(){return Nh||(Nh=1,function(t){function e(t,e,n){this.Qn=[],this.kn=[],this.bn="desc",this._n(t,e,n)}e.prototype.insert=function(t,e){for(var n=this.Qn.length,i=n;i--;){var r=this.kn[i];"desc"===this.bn?e>r&&(n=i):e<r&&(n=i)}this.xn(t,e,n)},e.prototype.remove=function(t){for(var e=this.Qn.length;e--;)if(t===this.Qn[e]){this.Qn.splice(e,1),this.kn.splice(e,1);break}},e.prototype.forEach=function(t){this.Qn.forEach(t)},e.prototype.getElements=function(){return this.Qn},e.prototype.getElementPriority=function(t){return this.kn[t]},e.prototype.getPriorities=function(){return this.kn},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this.Qn.length;e<n;e++)t.push([this.Qn[e],this.kn[e]]);return t},e.prototype._n=function(t,e,n){if(t&&e){if(this.Qn=[],this.kn=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var i=0;i<t.length;i++)this.insert(t[i],e[i])}n&&(this.bn=n)},e.prototype.xn=function(t,e,n){this.Qn.length===n?(this.Qn.push(t),this.kn.push(e)):(this.Qn.splice(n,0,t),this.kn.splice(n,0,e))},t.exports&&(t.exports=e)}(zh)),zh.exports}var Vh,Jh=(Th||(Th=1,(Vh=Ph).exports&&(Vh.exports={DBSCAN:(Gh||(Gh=1,function(t){function e(t,e,n,i){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this.Dn,this.clusters=[],this.noise=[],this.Sn=[],this.Mn=[],this.$n=0,this._n(t,e,n,i)}e.prototype.run=function(t,e,n,i){this._n(t,e,n,i);for(var r=0;r<this.$n;r++)if(1!==this.Sn[r]){this.Sn[r]=1;var o=this.Rn(r);if(o.length<this.minPts)this.noise.push(r);else{var s=this.clusters.length;this.clusters.push([]),this.Fn(r,s),this.Gn(s,o)}}return this.clusters},e.prototype._n=function(t,e,n,i){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this.$n=t.length,this.Sn=new Array(this.$n),this.Mn=new Array(this.$n)}e&&(this.epsilon=e),n&&(this.minPts=n),i&&(this.distance=i)},e.prototype.Gn=function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(1!==this.Sn[i]){this.Sn[i]=1;var r=this.Rn(i);r.length>=this.minPts&&(e=this.Ln(e,r))}1!==this.Mn[i]&&this.Fn(i,t)}},e.prototype.Fn=function(t,e){this.clusters[e].push(t),this.Mn[t]=1},e.prototype.Rn=function(t){for(var e=[],n=0;n<this.$n;n++)this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n);return e},e.prototype.Ln=function(t,e){for(var n=e.length,i=0;i<n;i++){var r=e[i];t.indexOf(r)<0&&t.push(r)}return t},e.prototype.Dn=function(t,e){for(var n=0,i=Math.min(t.length,e.length);i--;)n+=(t[i]-e[i])*(t[i]-e[i]);return Math.sqrt(n)},t.exports&&(t.exports=e)}(qh)),qh.exports),KMEANS:(Lh||(Lh=1,function(t){function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,i=0;i<this.k;i++)this.centroids[i]=this.randomCentroid();for(var r=!0;r;){r=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(h),a=0,A=0;A<h;A++)s[A]=0;for(var u=0;u<n;u++){var h=this.dataset[u].length;if(o===this.assignments[u]){for(A=0;A<h;A++)s[A]+=this.dataset[u][A];a++}}if(a>0){for(A=0;A<h;A++)s[A]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),r=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,i=0;i<n;i++)(t=this.argmin(this.dataset[i],this.centroids,this.distance))!=this.assignments[i]&&(this.assignments[i]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===e[t=this.assignments[n]]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var i,r=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(i=n(t,e[a]))<r&&(r=i,o=a);return o},e.prototype.distance=function(t,e){for(var n=0,i=Math.min(t.length,e.length);i--;){var r=t[i]-e[i];n+=r*r}return Math.sqrt(n)},t.exports&&(t.exports=e)}(Oh)),Oh.exports),OPTICS:(Uh||(Uh=1,function(t){if(t.exports)var e=Kh();function n(t,e,n,i){this.epsilon=1,this.minPts=1,this.distance=this.Dn,this.Nn=[],this.Un=[],this.Tn=0,this.Pn=[],this._n(t,e,n,i)}n.prototype.run=function(t,n,i,r){this._n(t,n,i,r);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this.Un[o]){this.Un[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this.Pn.push(o);var A=new e(null,null,"asc"),u=this.Rn(o);void 0!==this.qn(o)&&(this.On(o,u,A),this.Gn(a,A))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this.Pn.length;e<n;e++){var i=this.Pn[e],r=this.Nn[i];t.push([i,r])}return t},n.prototype._n=function(t,e,n,i){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.Nn=new Array(this.dataset.length),this.Un=new Array(this.dataset.length),this.Tn=0,this.Pn=[]}e&&(this.epsilon=e),n&&(this.minPts=n),i&&(this.distance=i)},n.prototype.On=function(t,e,n){var i=this;this.Tn=this.qn(t),e.forEach((function(e){if(void 0===i.Un[e]){var r=i.distance(i.dataset[t],i.dataset[e]),o=Math.max(i.Tn,r);void 0===i.Nn[e]?(i.Nn[e]=o,n.insert(e,o)):o<i.Nn[e]&&(i.Nn[e]=o,n.remove(e),n.insert(e,o))}}))},n.prototype.Gn=function(t,e){for(var n=e.getElements(),i=0,r=n.length;i<r;i++){var o=n[i];if(void 0===this.Un[o]){var s=this.Rn(o);this.Un[o]=1,this.clusters[t].push(o),this.Pn.push(o),void 0!==this.qn(o)&&(this.On(o,s,e),this.Gn(t,e))}}},n.prototype.qn=function(t){for(var e=this.epsilon,n=0;n<e;n++)if(this.Rn(t,n).length>=this.minPts)return n},n.prototype.Rn=function(t,e){e=e||this.epsilon;for(var n=[],i=0,r=this.dataset.length;i<r;i++)this.distance(this.dataset[t],this.dataset[i])<e&&n.push(i);return n},n.prototype.Dn=function(t,e){for(var n=0,i=Math.min(t.length,e.length);i--;)n+=(t[i]-e[i])*(t[i]-e[i]);return Math.sqrt(n)},t.exports&&(t.exports=n)}(Hh)),Hh.exports),PriorityQueue:Kh()})),Ph.exports),Yh=Fh(Jh);const jh=1e-6,Wh=[0,0,0],Xh=[0,0,0],Zh=[0,0,0],tl=[0,0,0],el=[0,0,0],nl=[0,0,0],il=[0,0,0],rl=[0,0,0],ol=[0,0,0],sl=[0,0,0],al=[0,0,0],Al=[0,0],ul=[0,0,0],hl=[0,0,0],ll=[0,0,0],cl=[0,0,0],fl=[0,0,0],dl=[0,0,0];function gl(t,e,n,i,r,o){if(Tl(e)<jh)return;Nl(ul,n,e),Nl(hl,i,e),Nl(ll,r,e),Il(t,e,Al),fl[1]=Al[0],cl[1]=Al[1],dl[1]=cl[1]-fl[1];const s=[n,i,r],a=[ul,hl,ll];for(let n=0;n<3;++n){Il(t,s[n],Al),fl[0]=Al[0],cl[0]=Al[1],Il(t,a[n],Al),fl[2]=Al[0],cl[2]=Al[1],dl[0]=cl[0]-fl[0],dl[2]=cl[2]-fl[2];const i=$l(dl);i<o.quality&&(Ll(o.b0,s[n]),Ll(o.b1,e),Ll(o.b2,a[n]),o.quality=i)}}const vl=[0,0,0];function Il(t,e,n){const{data:i,offsetIdx:r,strideIdx:o}=t;n[0]=Number.POSITIVE_INFINITY,n[1]=Number.NEGATIVE_INFINITY;for(let t=r;t<i.length;t+=o){const r=i[t]*e[0]+i[t+1]*e[1]+i[t+2]*e[2];n[0]=Math.min(n[0],r),n[1]=Math.max(n[1],r)}}function pl(t,e,n){Ll(n.center,t),Gl(n.halfSize,e,.5),n.quaternion[0]=0,n.quaternion[1]=0,n.quaternion[2]=0,n.quaternion[3]=1}const yl=[0,0,0],wl=[0,0,0],Cl=[0,0,0],Bl=[0,0,0],El=[0,0,0],ml=[0,0,0];function Ql(t,e,n){Ll(yl,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?yl[0]=0:Math.abs(e[1])>Math.abs(e[2])?yl[1]=0:yl[2]=0,Tl(yl)<jh&&(yl[0]=yl[1]=yl[2]=1),Nl(wl,e,yl),Ul(wl,wl),Nl(Cl,e,wl),Ul(Cl,Cl),kl(t,e,wl,Cl,Bl,El),Fl(ml,El,Bl),Dl(e,wl,Cl,Bl,El,ml,n)}function kl(t,e,n,i,r,o){Il(t,e,Al),r[0]=Al[0],o[0]=Al[1],Il(t,n,Al),r[1]=Al[0],o[1]=Al[1],Il(t,i,Al),r[2]=Al[0],o[2]=Al[1]}const bl=[0,0,0],_l=[1,0,0,0,1,0,0,0,1],xl=[0,0,0];function Dl(t,e,n,i,r,o,s){_l[0]=t[0],_l[1]=t[1],_l[2]=t[2],_l[3]=e[0],_l[4]=e[1],_l[5]=e[2],_l[6]=n[0],_l[7]=n[1],_l[8]=n[2],function(t,e){const n=e[0]+e[4]+e[8];if(n>0){let i=Math.sqrt(n+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const i=(n+1)%3,r=(n+2)%3;let o=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*r+r]+1);t[n]=.5*o,o=.5/o,t[3]=(e[3*i+r]-e[3*r+i])*o,t[i]=(e[3*i+n]+e[3*n+i])*o,t[r]=(e[3*r+n]+e[3*n+r])*o}}(s.quaternion,_l),Rl(xl,i,r),Gl(xl,xl,.5),Gl(s.center,t,xl[0]),Gl(bl,e,xl[1]),Rl(s.center,s.center,bl),Gl(bl,n,xl[2]),Rl(s.center,s.center,bl),Gl(s.halfSize,o,.5)}class Sl{buffer;minProj;maxProj;minVert=new Array(7);maxVert=new Array(7);constructor(t){this.buffer=new ArrayBuffer(448);let e=0;this.minProj=new Float64Array(this.buffer,e,7),e+=56,this.maxProj=new Float64Array(this.buffer,e,7),e+=56;for(let t=0;t<7;++t)this.minVert[t]=new Float64Array(this.buffer,e,3),e+=24;for(let t=0;t<7;++t)this.maxVert[t]=new Float64Array(this.buffer,e,3),e+=24;for(let t=0;t<7;++t)this.minProj[t]=Number.POSITIVE_INFINITY,this.maxProj[t]=Number.NEGATIVE_INFINITY;const n=new Array(7),i=new Array(7),{data:r,offsetIdx:o,strideIdx:s}=t;for(let t=o;t<r.length;t+=s){let e=r[t];e<this.minProj[0]&&(this.minProj[0]=e,n[0]=t),e>this.maxProj[0]&&(this.maxProj[0]=e,i[0]=t),e=r[t+1],e<this.minProj[1]&&(this.minProj[1]=e,n[1]=t),e>this.maxProj[1]&&(this.maxProj[1]=e,i[1]=t),e=r[t+2],e<this.minProj[2]&&(this.minProj[2]=e,n[2]=t),e>this.maxProj[2]&&(this.maxProj[2]=e,i[2]=t),e=r[t]+r[t+1]+r[t+2],e<this.minProj[3]&&(this.minProj[3]=e,n[3]=t),e>this.maxProj[3]&&(this.maxProj[3]=e,i[3]=t),e=r[t]+r[t+1]-r[t+2],e<this.minProj[4]&&(this.minProj[4]=e,n[4]=t),e>this.maxProj[4]&&(this.maxProj[4]=e,i[4]=t),e=r[t]-r[t+1]+r[t+2],e<this.minProj[5]&&(this.minProj[5]=e,n[5]=t),e>this.maxProj[5]&&(this.maxProj[5]=e,i[5]=t),e=r[t]-r[t+1]-r[t+2],e<this.minProj[6]&&(this.minProj[6]=e,n[6]=t),e>this.maxProj[6]&&(this.maxProj[6]=e,i[6]=t)}for(let t=0;t<7;++t){let e=n[t];Ll(this.minVert[t],r,e),e=i[t],Ll(this.maxVert[t],r,e)}}}class Ml{b0=[1,0,0];b1=[0,1,0];b2=[0,0,1];quality=0}function $l(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function Rl(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}function Fl(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2]}function Gl(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}function Ll(t,e,n=0){t[0]=e[n+0],t[1]=e[n+1],t[2]=e[n+2]}function Nl(t,e,n){const i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],A=n[2];t[0]=r*A-o*a,t[1]=o*s-i*A,t[2]=i*a-r*s}function Ul(t,e){const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(n>0){const i=1/Math.sqrt(n);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function Tl(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function Pl(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function ql(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}const Ol=(t,e)=>{const n=10**e;return Math.round(t*n)/n},Hl=(t,e,n=!1)=>{const i=t[0],r=t[1];let o,s,a,A,u=!1;const h=e.length;for(let t=0,l=h-1;t<h;l=t,t+=1){let h=!1;if(o=e[t][0],s=e[t][1],a=e[l][0],A=e[l][1],o===i&&s===r||a===i&&A===r)return!!n;if(s<r==A>=r){const t=(a-o)*(r-s)/(A-s)+o;if(i===t)return!!n;h=i<t}h&&(u=!u)}return u},zl=(t,e)=>{var n=e[0],i=e[1],o=e[2],s=t[0],a=t[1],A=t[2];const u=r.Cartesian3.fromDegrees(s,a,A),h=r.Cartesian3.fromDegrees(n,i,o),l=r.Transforms.eastNorthUpToFixedFrame(h);var c=r.Matrix4.inverse(l,new r.Matrix4);return r.Matrix4.multiplyByPoint(c,u,new r.Cartesian3)},Kl=new r.Matrix4,Vl=new r.Matrix4,Jl=new r.Cartesian3;function Yl(t,e,n){const[i,o,s]=e;return r.Cartesian3.fromDegrees(i,o,s,void 0,Jl),r.Transforms.eastNorthUpToFixedFrame(Jl,void 0,Vl),r.Matrix4.inverseTransformation(Vl,Kl),r.Matrix4.multiplyByPoint(Kl,t,n||new r.Cartesian3)}function jl(t,e,n,i){if(!n){const[t,i,s]=e;var o=r.Cartesian3.fromDegrees(t,i,s);n=r.Transforms.eastNorthUpToFixedFrame(o)}return r.Matrix4.multiplyByPoint(n,t,i||new r.Cartesian3)}function Wl(t){var e=r.Cartographic.fromCartesian(t);return{lng:r.Math.toDegrees(e.longitude),lat:r.Math.toDegrees(e.latitude),height:e.height}}function Xl(t,e){const n=2*Math.PI;let i=(e=(e%n+n)%n)-(t=(t%n+n)%n);return i>Math.PI?i-=n:i<-Math.PI&&(i+=n),i}var Zl=new Float32Array(1);function tc(t){const e=[];for(let n=0,i=t.length;n<i;n+=2)e.push(parseInt(t.substr(n,2),16)/255);return e.push(e.shift()),e}function ec(t,e){let n,i,r,o,s,a,A,u="ASDFGHJKLQWERTYUIO!sdfghjkleiu3~yr5-P&mq9`%zCN*b=8@^xpVM";for((e=e||"v5")>"v5"?(n=u.length,i=512):(n=27,u=u.substr(0,27),i=333),o=[],s=NaN,a=0,A=t.length;a<A;a++)r=t[a],r=u.indexOf(r),isNaN(s)?s=r*n:(o.push(s+r-i),s=NaN);return o}new Int32Array(Zl.buffer);class nc{Hn;zn;Ae;Kn;Vn;Jn=[];Yn=-1;jn="close";Wn={};Xn=0;Zn;ti;ei;ni;ii;ri;oi;si=[0,0];ai=[];Ai=[1/0,1/0,1/0,-1/0,-1/0,-1/0];options={layer:void 0,inPointStyle:{color:"rgba(37,165,247,1)",radius:6,borderWidth:4,borderColor:"rgba(255,255,255,1)"},outPointStyle:{color:"rgba(247,55,37,1)",radius:6,borderWidth:4,borderColor:"rgba(255,255,255,1)"},polygonStyle:{color:"rgba(0,255,255,0.6)",borderWidth:4,borderColor:"rgba(255,255,255,1)"},model:{encoderUrl:"",decoderUrl:"",name:"model",wasmPaths:""}};constructor(t){t.viewer&&(this.Hn=t.viewer.container,this.options.inPointStyle=Object.assign(this.options.inPointStyle,t.inPointStyle),this.options.outPointStyle=Object.assign(this.options.outPointStyle,t.outPointStyle),this.options.polygonStyle=Object.assign(this.options.polygonStyle,t.polygonStyle),this.options.model=Object.assign(this.options.model,t.model),this.options.viewer=t.viewer,this.options.layer=t.layer,this.options.layer&&(this.ui(),this.hi()))}show(){this.zn.style.visibility="visible",this.Kn.style.visibility="visible"}hide(){this.zn.style.visibility="hidden",this.Kn.style.visibility="hidden"}open(){this.jn="open",this.zn.style.visibility="visible",this.Kn.style.visibility="visible",this.zn.style.pointerEvents="all",this.zn.addEventListener("mousedown",this.li),this.zn.addEventListener("mouseup",this.ci),this.Hn.addEventListener("contextmenu",this.li)}createMask(){"open"!==this.jn&&"adding"!==this.jn||(this.jn="adding",this.Vn.clearRect(0,0,this.Kn.width,this.Kn.height),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.zn.style.pointerEvents=this.Kn.style.pointerEvents="all",this.Yn++,this.Jn[this.Yn]=[])}async embeddings(){await this.fi(),void 0===this.ei&&await this.Zn,this.oi=await this.ei}maskCompleted(){this.Vn.clearRect(0,0,this.Kn.width,this.Kn.height),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.zn.style.pointerEvents=this.Kn.style.pointerEvents="none",this.di()}highLight(t){if(!this.options.viewer)return;if(!this.ii||0===this.ii.length)return;let e=0;for(let t=0;t<this.ii.length;t++){const{centers:n,rgbas:i,sigmas:r}=this.ii[t];n&&i&&r&&(e+=n.byteLength/3*8)}const n=new ArrayBuffer(e),i=new DataView(n);let r=0;const o=[0,0,0];for(let t=0;t<this.ii.length;t++){const{centers:e,rgbas:n,sigmas:s,modelMatrix:a,count:A,indices:u}=this.ii[t];if(0===t&&(o[0]=a[12],o[1]=a[13],o[2]=a[14]),e&&n&&s){const t=new Float32Array(e),o=new Uint8Array(n),a=new Uint32Array(s);for(let e=0;e<t.length/3;e++){const n=r+e,s=t[3*e],A=t[3*e+1],u=t[3*e+2];this.Ai[0]=Math.min(s,this.Ai[0]),this.Ai[1]=Math.min(A,this.Ai[1]),this.Ai[2]=Math.min(u,this.Ai[2]),this.Ai[3]=Math.max(s,this.Ai[3]),this.Ai[4]=Math.max(A,this.Ai[4]),this.Ai[5]=Math.max(u,this.Ai[5]);const h=o[4*e],l=o[4*e+1],c=o[4*e+2],f=o[4*e+3],d=32*n;i.setFloat32(d,s,!0),i.setFloat32(d+4,A,!0),i.setFloat32(d+8,u,!0),i.setUint8(d+12,1),i.setUint8(d+15,1),i.setUint32(d+16,a[3*e],!0),i.setUint32(d+20,a[3*e+1],!0),i.setUint32(d+24,a[3*e+2],!0),i.setUint8(d+28,h),i.setUint8(d+29,l),i.setUint8(d+30,c),i.setUint8(d+31,f)}r+=A||0}}this.ri=new $h({viewer:this.options.viewer,deltaCenter:o,enuCenter:this.options.layer?.getEnuCenter(),data:n}),this.ri.selectedEntity(-1,t)}cancelMask(){this.jn="open",this.Xn=0,this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.Jn[this.Yn]=[],this.Yn--}close(){this.jn="close",this.Xn=0,this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.Vn.clearRect(0,0,this.Kn.width,this.Kn.height),this.Jn=[],this.Ai=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this.Yn=-1,this.zn.style.visibility=this.Kn.style.visibility="hidden",this.zn.style.pointerEvents=this.Kn.style.pointerEvents="none",this.Hn.removeEventListener("contextmenu",this.li),this.zn.removeEventListener("mousedown",this.li),this.zn.removeEventListener("mouseup",this.ci)}removePoint(){"adding"===this.jn&&this.Jn[this.Yn].length>0&&(this.Jn[this.Yn].pop(),this.gi(),this.Ii())}getSingleData(){return this.ii}getSingleModel(){return this.ri}lock(){this.jn="locking",this.zn.style.pointerEvents="all";var t=this.options.viewer.scene.screenSpaceCameraController;this.Wn={enableTranslate:t.enableTranslate,enableZoom:t.enableZoom,enableRotate:t.enableRotate,enableTilt:t.enableTilt,enableLook:t.enableLook,inertiaSpin:t.inertiaSpin,inertiaTranslate:t.inertiaTranslate,inertiaZoom:t.inertiaZoom},t.enableTranslate=!1,t.enableZoom=!1,t.enableRotate=!1,t.enableTilt=!1,t.enableLook=!1,t.inertiaSpin=0,t.inertiaTranslate=0,t.inertiaZoom=0}unlock(){this.jn="open",this.zn.style.pointerEvents="none";var t=this.options.viewer.scene.screenSpaceCameraController;t.enableTranslate=this.Wn.enableTranslate,t.enableZoom=this.Wn.enableZoom,t.enableRotate=this.Wn.enableRotate,t.enableTilt=this.Wn.enableTilt,t.enableLook=this.Wn.enableLook,t.inertiaSpin=this.Wn.inertiaSpin,t.inertiaTranslate=this.Wn.inertiaTranslate,t.inertiaZoom=this.Wn.inertiaZoom}getBoxs(t){performance.now();const e=(new Yh.KMEANS).run(this.ai,t,2);performance.now();const n=[];for(let t=0;t<e.length;t++){const i=e[t],r=[];for(let t=0;t<i.length;t++)r.push(this.ai[i[t]][0],this.ai[i[t]][1],this.ai[i[t]][2]);n.push(this.pi(r))}const i=n.map((t=>{const e=new r.Quaternion(t.quaternion[0],t.quaternion[1],t.quaternion[2],t.quaternion[3]),n=new r.HeadingPitchRoll;return r.HeadingPitchRoll.fromQuaternion(e,n),{center:t.center,scale:[t.halfSize[0],t.halfSize[1],t.halfSize[2]],rotation:[-n.roll,n.pitch,n.heading]}})),o=this.yi(i);return this.options.viewer?.scene.render(),{boxesModel:o,AABB:{center:[(this.Ai[0]+this.Ai[3])/2,(this.Ai[1]+this.Ai[4])/2,(this.Ai[2]+this.Ai[5])/2],scale:[Math.abs((this.Ai[3]-this.Ai[0])/1),Math.abs((this.Ai[4]-this.Ai[1])/1),Math.abs((this.Ai[5]-this.Ai[2])/1)],rotation:[0,0,0]},OBBs:i}}yi(t){const e=this.options.layer?.getEnuCenter();if(!e)return;const n=[];for(let i=0;i<t.length;i++){const{rotation:o,scale:s,center:a}=t[i],A=new r.Cartesian3(2*s[0],2*s[1],2*s[2]),u=jl(new r.Cartesian3(a[0],a[1],a[2]),e),h=new r.HeadingPitchRoll(o[0],o[1],o[2]),l=r.Transforms.headingPitchRollQuaternion(u,h),c=this.options.viewer?.entities.add({name:"single boxs",position:u,orientation:l,box:{dimensions:A,material:new r.Color(1,0,1,1),outline:!0,outlineWidth:5}});n.push(c)}return n}ui(){const t=document.createElement("canvas"),e=document.createElement("canvas"),n=this.Hn?.getBoundingClientRect();n&&(t.width=e.width=n.width*window.devicePixelRatio,t.height=e.height=n.height*window.devicePixelRatio,t.style.cssText=e.style.cssText="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n        ",this.Hn.appendChild(e),this.Hn.appendChild(t),this.zn=t,this.Kn=e,this.Ae=t.getContext("2d")||void 0,this.Vn=e.getContext("2d")||void 0,this.wi())}async Ii(){const t=[],e=[];this.Jn[this.Yn].forEach((n=>{e.push(n.isIn?1:0),t.push(...n.point)})),0!==e.length&&(await this.Ci(t,e),await this.Bi())}async hi(){const t=this.options.model;vh.env.wasm.wasmPaths=t.wasmPaths||"../../onnx/",vh.env.wasm.numThreads=10;const e=await caches.open("onnx");await e.match(t.encoderUrl),await e.match(t.decoderUrl);const n={executionProviders:["webgpu"],enableMemPattern:!1,enableCpuMemArena:!1,extra:{session:{disable_prepacking:"1",use_device_allocator_for_initializers:"1",use_ort_model_bytes_directly:"1",use_ort_model_bytes_for_initializers:"1"}}},i=await this.Ei(t.encoderUrl),r=await this.Ei(t.decoderUrl);this.Zn=await vh.InferenceSession.create(i,n),this.ti=await vh.InferenceSession.create(r,n)}async Ei(t){try{const e=await caches.open("onnx");let n=await e.match(t);if(null==n&&(await e.add(t),n=await e.match(t)),n)return await n.arrayBuffer()}catch(e){return await fetch(t).then((t=>t.arrayBuffer()))}}async Ci(t,e){if(t.length>0){const n=this.ti,i=this.mi(t,e),r=(await n.run(i)).masks;this.ni=r.toImageData()}}mi(t,e){const n=new vh.Tensor(new Float32Array(65536),[1,1,256,256]),i=new vh.Tensor(new Float32Array([0]),[1]),r=new vh.Tensor(new Float32Array([1024,1024]),[2]),o=new vh.Tensor(new Float32Array(t),[1,t.length/2,2]),s=new vh.Tensor(new Float32Array(e),[1,e.length]);return{image_embeddings:new vh.Tensor(this.oi.image_embeddings.type,Float32Array.from(this.oi.image_embeddings.data),this.oi.image_embeddings.dims),point_coords:o,point_labels:s,mask_input:n,has_mask_input:i,orig_im_size:r}}async fi(){this.ei=void 0;const t=document.createElement("canvas");t.width=1024,t.height=1024;const e=t.getContext("2d");if(e&&this.options.viewer?.canvas){e.drawImage(this.options.viewer?.canvas,0,0,t.width,t.height);const n=e.getImageData(0,0,1024,1024),i=await vh.Tensor.fromImage(n,{resizedWidth:1024,resizedHeight:1024}),r=await this.Zn;this.ei=r.run({input_image:i}),this.ei.then((()=>{}))}}ci=t=>{const e=t;if(this.si[0]!==e.clientX||this.si[1]!==e.clientY)return;const n=this.zn?.getBoundingClientRect();if(n){const t=Math.trunc(e.clientX-n.left)*window.devicePixelRatio,i=Math.trunc(e.clientY-n.top)*window.devicePixelRatio;0===e.button?this.Qi([t,i],!0):2===e.button&&this.Qi([t,i],!1)}};li=t=>{const e=t;e.preventDefault(),this.si=[e.clientX,e.clientY]};Qi(t,e){void 0===this.Jn[this.Yn]&&(this.Jn[this.Yn]=[]),this.Jn[this.Yn].length>5||("adding"===this.jn&&this.Jn[this.Yn].push({isIn:e,point:[Math.trunc(t[0]/this.zn.width*1024),Math.trunc(t[1]/this.zn.height*1024)]}),this.gi(),this.Ii())}gi(){this.Ae?.clearRect(0,0,this.zn.width,this.zn.height);for(let t=0;t<this.Jn[this.Yn].length;t++){const e=this.Jn[this.Yn][t],n=e.isIn?this.options.inPointStyle:this.options.outPointStyle;this.Ae.strokeStyle=n.borderColor,this.Ae.lineWidth=n.borderWidth*window.devicePixelRatio,this.Ae.fillStyle=n.color,this.Ae.beginPath(),this.Ae.arc(e.point[0]/1024*this.zn.width,e.point[1]/1024*this.zn.height,n.radius*window.devicePixelRatio,0,2*Math.PI,!1),this.Ae.closePath(),this.Ae.stroke(),this.Ae.fill()}}async Bi(){const t=this.ni,e=t.data,n=this.options.polygonStyle.color.slice(5,-1).split(",");this.Vn.clearRect(0,0,this.Kn.width,this.Kn.height);for(let t=0;t<e.length;t+=4)0!==e[t]?(e[t]=+n[0],e[t+1]=+n[1],e[t+2]=+n[2],e[t+3]=255*+n[3]):e[t+3]=0;this.Vn.drawImage(await createImageBitmap(t),0,0,this.Kn.width,this.Kn.height)}di(){if(!this.options.layer)return;const t=this.options.viewer.scene.camera.viewMatrix,e=this.options.viewer.scene.camera.frustum.projectionMatrix,n=new r.Matrix4;r.Matrix4.multiply(e,t,n),this.ai=[];let i=!1;if(this.ii&&0!==this.ii.length||0!==this.Xn||(i=!0,this.ii=this.options.layer.ki().map((t=>({tileNum:t.bi,modelMatrix:t._modelMatrix,centers:t.zt,rgbas:t._i,sigmas:t.xi,indices:[]})))),this.ii){const{data:t,width:e,height:o}=this.ni,s=[];for(let a=0;a<this.ii.length;a++){const A=this.ii[a];if(A.centers&&A.centers.byteLength>0&&A.rgbas&&A.sigmas){const a=[],u=[];let h=new Uint32Array(A.centers.byteLength/4);const l=[],c=new Float32Array(A.centers),f=new Uint8Array(A.rgbas),d=new Uint32Array(A.sigmas),g=new r.Matrix4;r.Matrix4.multiply(n,A.modelMatrix,g);const v=c.length,I=A.indices;let p=0;for(let n=0;n<v;n++){const s=c[3*n],A=c[3*n+1],v=c[3*n+2],y=new r.Cartesian3(s,A,v);r.Matrix4.multiplyByPoint(g,new r.Cartesian3(s,A,v),y),y.x=Math.trunc((y.x/y.z+1)/2*e),y.y=o-Math.trunc((y.y/y.z+1)/2*o),y.x>0&&y.x<e&&y.y<o&&y.y>0&&t[4*(e*y.y+y.x)+3]>0&&(i?l.push(n):I&&l.push(I[n]),a.push(s,A,v),this.ai.push([s,A,v]),u.push(f[4*n],f[4*n+1],f[4*n+2],f[4*n+3]),h[p]=d[3*n],h[p+1]=d[3*n+1],h[p+2]=d[3*n+2],p+=3)}h=h.slice(0,p),a.length>0&&s.push({centers:new Float32Array(a).buffer,rgbas:new Uint8Array(u).buffer,sigmas:h.buffer,tileNum:A.tileNum,modelMatrix:A.modelMatrix,count:a.length/3,indices:l})}}this.ii=s}}pi(t){const e={center:new Float64Array([0,0,0]),halfSize:new Float32Array([0,0,0]),quaternion:new Float32Array([0,0,0,1])};return function(t,e){const{data:n,strideIdx:i}=t,r=n.length/i;if(r<=0)return;const o=new Sl(t);Rl(Wh,o.minProj,o.maxProj),Gl(Wh,Wh,.5),Fl(Xh,o.maxProj,o.minProj);const s=$l(Xh),a=new Ml;a.quality=s,r<14&&(t={data:new Float64Array(o.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});const A=[0,0,0],u=[0,0,0],h=[0,0,0],l=[0,0,0],c=[0,0,0],f=[0,0,0],d=[0,0,0];switch(function(t,e,n,i,r,o,s,a,A,u,h){if(function(t,e,n){let i=Pl(t.maxVert[0],t.minVert[0]),r=0;for(let e=1;e<7;++e){const n=Pl(t.maxVert[e],t.minVert[e]);n>i&&(i=n,r=e)}Ll(e,t.minVert[r]),Ll(n,t.maxVert[r])}(t,i,r),Pl(i,r)<jh)return 1;Fl(s,i,r),Ul(s,s);const l=function(t,e,n,i){const{data:r,offsetIdx:o,strideIdx:s}=t;let a=Number.NEGATIVE_INFINITY,A=0;for(let t=o;t<r.length;t+=s){al[0]=r[t]-e[0],al[1]=r[t+1]-e[1],al[2]=r[t+2]-e[2];const i=n[0]*al[0]+n[1]*al[1]+n[2]*al[2],o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],s=al[0]*al[0]+al[1]*al[1]+al[2]*al[2]-i*i/o;s>a&&(a=s,A=t)}return Ll(i,r,A),a}(e,i,s,o);return l<jh?2:(Fl(a,r,o),Ul(a,a),Fl(A,o,i),Ul(A,A),Nl(n,a,s),Ul(n,n),gl(e,n,s,a,A,u),0)}(o,t,d,A,u,h,l,c,f,a)){case 1:return void pl(Wh,Xh,e);case 2:return void Ql(t,l,e)}!function(t,e,n,i,r,o,s,a,A,u){(function(t,e,n,i,r,o,s){!function(t,e,n,i,r){const{data:o,offsetIdx:s,strideIdx:a}=t;Ll(i,o,s),Ll(r,i),n[0]=ql(vl,e),n[1]=n[0];for(let t=s+a;t<o.length;t+=a){const s=o[t]*e[0]+o[t+1]*e[1]+o[t+2]*e[2];s<n[0]&&(n[0]=s,Ll(i,o,t)),s>n[1]&&(n[1]=s,Ll(r,o,t))}}(t,e,Al,s,o);const a=ql(n,e);Al[1]-jh<=a&&(o[0]=-1/0),Al[0]+jh>=a&&(s[0]=-1/0)})(t,e,n,0,0,Zh,tl),void 0!==Zh[0]&&(Fl(el,Zh,n),Ul(el,el),Fl(nl,Zh,i),Ul(nl,nl),Fl(il,Zh,r),Ul(il,il),Nl(rl,nl,o),Ul(rl,rl),Nl(ol,il,s),Ul(ol,ol),Nl(sl,el,a),Ul(sl,sl),gl(t,rl,o,nl,el,A),gl(t,ol,s,il,nl,A),gl(t,sl,a,el,il,A)),void 0!==tl[0]&&(Fl(el,tl,n),Ul(el,el),Fl(nl,tl,i),Ul(nl,nl),Fl(il,tl,r),Ul(il,il),Nl(rl,nl,o),Ul(rl,rl),Nl(ol,il,s),Ul(ol,ol),Nl(sl,el,a),Ul(sl,sl),gl(t,rl,o,nl,el,A),gl(t,ol,s,il,nl,A),gl(t,sl,a,el,il,A))}(t,d,A,u,h,l,c,f,a),kl(t,a.b0,a.b1,a.b2,Bl,El);const g=[0,0,0];Fl(g,El,Bl),a.quality=$l(g),a.quality<s?Dl(a.b0,a.b1,a.b2,Bl,El,g,e):pl(Wh,Xh,e)}({data:t,size:3,offsetIdx:0,strideIdx:3},e),e}wi(){window.addEventListener("resize",(()=>{const t=this.Hn?.getBoundingClientRect();t&&this.zn&&this.Kn&&(this.zn.width=this.Kn.width=t.width*window.devicePixelRatio,this.zn.height=this.Kn.height=t.height*window.devicePixelRatio,this.zn.style.cssText=this.Kn.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n            ")}))}}class ic{Bn;Oe;Di=[];Si;Mi;$i;Ri;Fi;constructor(t){const e=t.viewer;this.Bn=e,this.Oe=t.data;const n=t.style.materialColor?t.style.materialColor:"rgba(255 165 0 0.5)",i=void 0===t.style.outline||t.style.outline;let o=t.style.outlineColor?t.style.outlineColor:"rgba(0, 0, 0, 0)";const s=t.style.outlineWidth?t.style.outlineWidth:1;!1===i&&(o="rgba(0, 0, 0, 0)"),this.$i={materialColor:n,outline:i,outlineColor:o,outlineWidth:s};let a=[],A=[],u=0;for(let t of this.Oe){const e=r.Cartesian3.fromDegreesArrayHeights(t),i=new r.PolygonGeometry({polygonHierarchy:new r.PolygonHierarchy(e),perPositionHeight:!0}),s=new r.GeometryInstance({id:"polygon_"+u,geometry:i,attributes:{color:r.ColorGeometryInstanceAttribute.fromColor(r.Color.fromCssColorString(n))}});a.push(s);const h=new r.PolygonOutlineGeometry({polygonHierarchy:new r.PolygonHierarchy(e),perPositionHeight:!0});let l=new r.GeometryInstance({id:"polygonOutline_"+u,geometry:h,attributes:{color:r.ColorGeometryInstanceAttribute.fromColor(r.Color.fromCssColorString(o))}});A.push(l),u++}let h=new r.Primitive({geometryInstances:a,appearance:new r.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!1}}})});this.Di.push(h);const l=e.scene.primitives.add(h);this.Ri=l;let c=new r.Primitive({geometryInstances:A,appearance:new r.PerInstanceColorAppearance({flat:!0})});this.Di.push(c);const f=e.scene.primitives.add(c);this.Fi=f}show(t){"all"===t.id?this.Di.forEach((t=>{t.show=!0})):this.Di.forEach((e=>{e.id===t.id&&(e.show=!0)}))}hide(t){"all"===t.id?this.Di.forEach((t=>{t.show=!1})):this.Di.forEach((e=>{e.id===t.id&&(e.show=!1)}))}styleChange(t){const e=t.style.materialColor?t.style.materialColor:"rgba(255 165 0 0.5)",n=void 0===t.style.outline||t.style.outline;let i=t.style.outlineColor?t.style.outlineColor:"rgba(0, 0, 0, 0)";const o=t.style.outlineWidth?t.style.outlineWidth:1;!1===n&&(i="rgba(0, 0, 0, 0)"),this.$i={materialColor:e,outline:n,outlineColor:i,outlineWidth:o};const s=this.Ri._instanceIds;for(let e of s){const n=e,i="polygonOutline_"+e.split("_")[1];this.Ri.getGeometryInstanceAttributes(n).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(t.style.materialColor)),this.Fi.getGeometryInstanceAttributes(i).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(t.style.outlineColor))}}resetHighlight(){if(this.Si){const{materialColor:t,outline:e,outlineColor:n,outlineWidth:i}=this.$i;this.Ri.getGeometryInstanceAttributes(this.Si).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(t)),this.Fi.getGeometryInstanceAttributes(this.Mi).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(n))}}highlight(t){var e=this.Bn.scene.pick(t.position);let n,i,o,s=r.defined(e)?e.id:void 0;if(void 0!==s){if(s.startsWith("polygon_")?(n=s,i="polygonOutline_"+s.split("_")[1],o="polygon"):s.startsWith("polygonOutline_")&&(i=s,n="polygon_"+s.split("_")[1],o="polygonOutline"),this.Si){const{materialColor:t,outline:e,outlineColor:n,outlineWidth:i}=this.$i;this.Ri.getGeometryInstanceAttributes(this.Si).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(t)),this.Fi.getGeometryInstanceAttributes(this.Mi).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(n))}if(r.defined(e)&&(this.Si=n,this.Mi=i,"polygon"===o)){const e=this.Ri.getGeometryInstanceAttributes(n);let o=t.style.materialColor?t.style.materialColor:null;if(o&&(e.color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(o))),t.style.outline){const e=this.Fi.getGeometryInstanceAttributes(i);o=t.style.outlineColor?t.style.outlineColor:null,o&&(e.color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString(o)))}else this.Fi.getGeometryInstanceAttributes(i).color=r.ColorGeometryInstanceAttribute.toValue(r.Color.fromCssColorString("rgba(0, 0, 0, 0)"))}}}}class rc{Gi;Li={};Ni=0;Ui=30;Ti=null;Pi=.8;qi=2;Oi=300;Hi=0;constructor(t){this.Gi=t.Gi,this.Ui=t.Ni||30}zi(t){return{Ki:t,Vi:(new Date).getTime(),Ji:0}}Yi(t,e){let n=this.Li[t];return n?(e||(n.Vi=(new Date).getTime(),n.Ji+=1),n.Ki):null}ji(t,e){for(let n in this.Li)if(this.Li.hasOwnProperty(n)&&!1===t.call(e,this.Li[n].Ki,n))break}Wi(t,e){if(this.Xi(t)?this.Li[t].Ki=e:(this.Ni+=1,this.Li[t]=this.zi(e)),this.Ni>this.Ui&&this.Zi(),this.Ni>this.Ui-1)return!0}Xi(t){return this.Li.hasOwnProperty(t)}tr(t){if(!this.Xi(t))return null;this.Ni-=1;let e=this.Li[t];return delete this.Li[t],e.Ki}ye(){this.er(),this.Li={},this.Ni=0}_destroy(){this.ji(((t,e)=>{this.Gi?this.Gi(e,this.Li[e].Ki)&&this.tr(e):this.tr(e)}),this)}er(){this.Ti&&clearTimeout(this.Ti)}Zi(){if(this.Ni>this.Ui*this.qi)this.er(),this.nr();else{if((new Date).getTime()-this.Hi<10)return;this.er();let t=this;this.Ti=setTimeout((function(){t.Ti=null,t.nr()}),this.Oi),this.Hi=(new Date).getTime()}}nr(){let t=Math.round(this.Ui*this.Pi);if(this.Ni<t)return;let e,n=this.ir(this.Ni-t);for(let t=0,i=n.length;t<i;t+=1)e=n[t],this.Gi?this.Gi(e,this.Li[e].Ki)&&this.tr(e):this.tr(e)}rr(t,e){let n=this.Li[t],i=this.Li[e],r=n.Vi-i.Vi;return 0!==r?r:n.Ji-i.Ji}ir(t){let e=[];for(let t in this.Li)this.Li.hasOwnProperty(t)&&e.push(t);return this.sr(e,t,this.rr)}sr(t,e,n){if(e<=0)return[];let i,r,o,s=0,a=t.length-1;for(;s<a;){for(i=s,r=a,o=t[e];i<=e&&r>=e;){for(;i<=e&&n.call(this,t[i],o)<0;)i+=1;for(;r>=e&&n.call(this,t[r],o)>0;)r-=1;let s=t[i];t[i]=t[r],t[r]=s,i+=1,r-=1}r<e&&(s=i),i>e&&(a=r)}return t.slice(0,e)}}let oc=new Worker(URL.createObjectURL(new Blob(["(",function(){const t=(t=0,e=0,n=0,i=1)=>[t,e,n,i],e=(t,e,n)=>{const i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],A=n[1],u=n[2],h=n[3];return t[0]=i*h+s*a+r*u-o*A,t[1]=r*h+s*A+o*a-i*u,t[2]=o*h+s*u+i*A-r*a,t[3]=s*h-i*a-r*A-o*u,t},n=(t,e,n,i,r="zyx")=>{let o=.5*Math.PI/180;e*=o,n*=o,i*=o;let s=Math.sin(e),a=Math.cos(e),A=Math.sin(n),u=Math.cos(n),h=Math.sin(i),l=Math.cos(i);switch(r){case"xyz":t[0]=s*u*l+a*A*h,t[1]=a*A*l-s*u*h,t[2]=a*u*h+s*A*l,t[3]=a*u*l-s*A*h;break;case"xzy":t[0]=s*u*l-a*A*h,t[1]=a*A*l-s*u*h,t[2]=a*u*h+s*A*l,t[3]=a*u*l+s*A*h;break;case"yxz":t[0]=s*u*l+a*A*h,t[1]=a*A*l-s*u*h,t[2]=a*u*h-s*A*l,t[3]=a*u*l+s*A*h;break;case"yzx":t[0]=s*u*l+a*A*h,t[1]=a*A*l+s*u*h,t[2]=a*u*h-s*A*l,t[3]=a*u*l-s*A*h;break;case"zxy":t[0]=s*u*l-a*A*h,t[1]=a*A*l+s*u*h,t[2]=a*u*h+s*A*l,t[3]=a*u*l-s*A*h;break;case"zyx":t[0]=s*u*l-a*A*h,t[1]=a*A*l+s*u*h,t[2]=a*u*h-s*A*l,t[3]=a*u*l+s*A*h;break;default:throw new Error("Unknown angle order "+r)}return t};function i(i,r,o=0){const s=t();n(s,0,0,90+o,"xyz");const a=t();n(a,0,90-i[1],0,"xyz");const A=t();n(A,0,0,i[0],"xyz");const u=t();e(u,A,a),e(u,u,s);const h=t();n(h,0,0,-90,"xyz");const l=t();n(l,0,-(90-r[1]),0,"xyz");const c=t();n(c,0,0,-r[0],"xyz");const f=t();e(f,h,l),e(f,f,c);const d=t();return e(d,f,u),d}function r(t,e,n){const i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15]||1;return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,t}var o=new Float32Array(1),s=new Int32Array(o.buffer);let a={};function A(t){o[0]=t;var e,n=s[0],i=n>>23&255,r=8388607&n;return 0==i?e=0:i<113?(e=0,r|=8388608,16777216&(r>>=113-i)&&(e=1,r=0)):i<142?e=i-112:(e=31,r=0),(n>>31&1)<<15|e<<10|r>>13}function u(t,e){return(A(t)|A(e)<<16)>>>0}const h=(t,e,n=!1)=>{const i=t[0],r=t[1];let o,s,a,A,u=!1;const h=e.length;for(let t=0,l=h-1;t<h;l=t,t+=1){let h=!1;if(o=e[t][0],s=e[t][1],a=e[l][0],A=e[l][1],o===i&&s===r||a===i&&A===r)return!!n;if(s<r==A>=r){const t=(a-o)*(r-s)/(A-s)+o;if(i===t)return!!n;h=i<t}h&&(u=!u)}return u},l=(t,e)=>t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5];function c(t,e){return!(t[3]<e[0]||e[3]<t[0]||t[4]<e[1]||e[4]<t[1]||t[5]<e[2]||e[5]<t[2])}self.onmessage=n=>{if(n.data.ar){const o=function(n,o){const{ar:s,Zt:a,ie:A,Ht:f,Tt:d}=n,g=A,v=new Float32Array(3*g),I=new Uint8Array(4*g),p=new Uint32Array(3*g),y=d||4096,w=y,C=y**2/2,B=Math.ceil(2*g/w),E=Math.ceil(B/y),m=[],Q=[],k=[];for(let t=0;t<E;t+=1){const e=t==E-1?B-y*(E-1):y;m[t]=new Uint32Array(w*e*4),Q[t]=new Uint8Array(m[t].buffer),k[t]=new Float32Array(m[t].buffer)}const b={x:1/0,y:1/0,z:1/0},_={x:-1/0,y:-1/0,z:-1/0};return s.forEach((s=>{s.Ar?function(s){const{Jt:a,Pe:A,ur:f,hr:d,lr:g=1,cr:y=0,dr:w,Me:B}=s;let E;d&&(E=i(B,n.Me,y));let x=[];o&&(x=o.filter(((t,e)=>(t.gr=e+1,c(t.dr,w)))));const D=new Uint32Array(f),S=D[0],M=1023,$=Math.ceil(24*S/32),R=$+Math.ceil(16*S/32),F=4*a,G=new Float32Array(D.buffer,8,18),L=new Uint8Array(D.buffer,80,3*S),N=new Uint16Array(D.buffer,80+4*$,S),U=new Uint32Array(D.buffer,80+4*R,F),T=new Uint8Array(D.buffer,80+4*R,4*F),P=G[0],q=G[1],O=G[2];G[3],G[4],G[5];const H=G[6],z=G[7],K=G[8];G[9],G[10],G[11];const V=G[12],J=G[13],Y=G[14],j=G[15],W=G[16],X=G[17],Z=V/M,tt=J/M,et=Y/M,nt=[0,0,0];let it=0,rt=0;for(let n=0;n<S;n+=1){const i=L[3*n],o=L[3*n+1],s=L[3*n+2],a=N[n],c=i*V+P,f=o*J+q,y=s*Y+O;for(let n=0;n<a;n++){const n=Math.floor(it/C),i=n*C;var ot=m[n],st=Q[n],at=k[n];const o=U[4*rt];let s=o>>20,a=(1047552&o)>>10,w=1023&o;s=c+s*Z+A[0],a=f+a*tt+A[1],w=y+w*et+A[2];const B=[(T[12+16*rt]-128)/128,(T[13+16*rt]-128)/128,(T[14+16*rt]-128)/128,(T[15+16*rt]-128)/128];let D=U[4*rt+1],S=D>>20,M=(1047552&D)>>10,$=1023&D;S=H+S*j,M=z+M*W,$=K+$*X;const R=[S,M,$];if(d){[s,a,w]=r(nt,[s,a,w],d);const n=t(B[1],B[2],B[3],B[0]),i=t();e(i,E,n),B[0]=i[3],B[1]=i[0],B[2]=i[1],B[3]=i[2],R[0]*=g,R[1]*=g,R[2]*=g}const F=T[8+16*rt],G=T[9+16*rt],L=T[10+16*rt],N=T[11+16*rt];rt+=1,v[3*it]=s,v[3*it+1]=a,v[3*it+2]=w,b.x=Math.min(b.x,s),b.y=Math.min(b.y,a),b.z=Math.min(b.z,w),_.x=Math.max(_.x,s),_.y=Math.max(_.y,a),_.z=Math.max(_.z,w);const P=it-i<<3;at[P+0]=s,at[P+1]=a,at[P+2]=w,st[4*(P+7)+0]=F,st[4*(P+7)+1]=G,st[4*(P+7)+2]=L,st[4*(P+7)+3]=N,I[4*it]=F,I[4*it+1]=G,I[4*it+2]=L,I[4*it+3]=N;const q=[1-2*(B[2]*B[2]+B[3]*B[3]),2*(B[1]*B[2]+B[0]*B[3]),2*(B[1]*B[3]-B[0]*B[2]),2*(B[1]*B[2]-B[0]*B[3]),1-2*(B[1]*B[1]+B[3]*B[3]),2*(B[2]*B[3]+B[0]*B[1]),2*(B[1]*B[3]+B[0]*B[2]),2*(B[2]*B[3]-B[0]*B[1]),1-2*(B[1]*B[1]+B[2]*B[2])].map(((t,e)=>t*R[Math.floor(e/3)])),O=[q[0]*q[0]+q[3]*q[3]+q[6]*q[6],q[0]*q[1]+q[3]*q[4]+q[6]*q[7],q[0]*q[2]+q[3]*q[5]+q[6]*q[8],q[1]*q[1]+q[4]*q[4]+q[7]*q[7],q[1]*q[2]+q[4]*q[5]+q[7]*q[8],q[2]*q[2]+q[5]*q[5]+q[8]*q[8]];ot[P+4]=p[3*it]=u(4*O[0],4*O[1]),ot[P+5]=p[3*it+1]=u(4*O[2],4*O[3]),ot[P+6]=p[3*it+2]=u(4*O[4],4*O[5]),st[4*(P+3)+3]=Math.ceil(Math.max(R[0]*g,R[1]*g,R[2]*g));for(let t=0,e=x.length;t<e;t+=1)if(l([s,a,w],x[t].dr)&&h([s,a],x[t].vr)){st[4*(P+3)]=x[t].gr;break}it+=1}}}(s):function(s){const{Jt:a,Pe:A,ur:f,dr:d,hr:g,lr:y=1,cr:w=0,Me:B}=s;let E;g&&(E=i(B,n.Me,w));let x=[];o&&(x=o.filter(((t,e)=>(t.gr=e+1,c(t.dr,d)))));const D=new Float32Array(f),S=new Uint8Array(f);let M=0;const $=[0,0,0];for(let n=0;n<a;n++){const i=Math.floor(M/C),o=i*C;var R=m[i],F=Q[i],G=k[i];let s=D[8*n+0]+A[0],a=D[8*n+1]+A[1],c=D[8*n+2]+(A[2]||0);const f=M-o<<3,d=S[24+32*n],w=S[25+32*n],B=S[26+32*n],L=S[27+32*n];if(L<30)continue;I[4*M]=d,I[4*M+1]=w,I[4*M+2]=B,I[4*M+3]=L,F[4*(f+7)+0]=d,F[4*(f+7)+1]=w,F[4*(f+7)+2]=B,F[4*(f+7)+3]=L;const N=[D[3+8*n],D[4+8*n],D[5+8*n]],U=[(S[28+32*n]-128)/128,(S[29+32*n]-128)/128,(S[30+32*n]-128)/128,(S[31+32*n]-128)/128];if(g){[s,a,c]=r($,[s,a,c],g);const n=t(U[1],U[2],U[3],U[0]),i=t();e(i,E,n),U[0]=i[3],U[1]=i[0],U[2]=i[1],U[3]=i[2],N[0]*=y,N[1]*=y,N[2]*=y}b.x=Math.min(b.x,s),b.y=Math.min(b.y,a),b.z=Math.min(b.z,c),_.x=Math.max(_.x,s),_.y=Math.max(_.y,a),_.z=Math.max(_.z,c),G[f+0]=s,G[f+1]=a,G[f+2]=c,v[3*M]=s,v[3*M+1]=a,v[3*M+2]=c;const T=[1-2*(U[2]*U[2]+U[3]*U[3]),2*(U[1]*U[2]+U[0]*U[3]),2*(U[1]*U[3]-U[0]*U[2]),2*(U[1]*U[2]-U[0]*U[3]),1-2*(U[1]*U[1]+U[3]*U[3]),2*(U[2]*U[3]+U[0]*U[1]),2*(U[1]*U[3]+U[0]*U[2]),2*(U[2]*U[3]-U[0]*U[1]),1-2*(U[1]*U[1]+U[2]*U[2])].map(((t,e)=>t*N[Math.floor(e/3)])),P=[T[0]*T[0]+T[3]*T[3]+T[6]*T[6],T[0]*T[1]+T[3]*T[4]+T[6]*T[7],T[0]*T[2]+T[3]*T[5]+T[6]*T[8],T[1]*T[1]+T[4]*T[4]+T[7]*T[7],T[1]*T[2]+T[4]*T[5]+T[7]*T[8],T[2]*T[2]+T[5]*T[5]+T[8]*T[8]];R[f+4]=p[3*M]=u(4*P[0],4*P[1]),R[f+5]=p[3*M+1]=u(4*P[2],4*P[3]),R[f+6]=p[3*M+2]=u(4*P[4],4*P[5]),F[4*(f+3)+3]=Math.ceil(Math.max(N[0],N[1],N[2]));for(let t=0,e=x.length;t<e;t+=1)if(l([s,a,c],x[t].dr)&&h([s,a],x[t].vr)){F[4*(f+3)]=x[t].gr;break}M+=1}}(s)})),b.x-=.5,b.y-=.5,b.z-=.5,_.x+=.5,_.y+=.5,_.z+=.5,{Zt:a,Ht:f,zt:v.buffer,_i:I.buffer,xi:p.buffer,Pt:Object.values(_),qt:Object.values(b),Ir:m.map((t=>t.buffer))}}(n.data,a[n.data.Zt]);self.postMessage(o,[o.zt,...o.Ir,o._i,o.xi])}else n.data.pr&&(a[n.data.Zt]=n.data.pr)}}.toString(),")(self)"],{type:"application/javascript"})));const sc=oc;class ac{events;constructor(){this.events=new Map}on(t,e){this.events.has(t)||this.events.set(t,[]),this.events.get(t).push(e)}clear(t){t?this.events.set(t,[]):this.events.clear()}off(t,e){const n=this.events.get(t);if(!n)return;const i=n.indexOf(e);-1!==i&&n.splice(i,1),0===n.length&&this.events.delete(t)}emit(t,e){const n=this.events.get(t);n&&n.forEach((t=>t(e)))}}var Ac;!function(t){t[t.init=0]="init",t[t.loading=1]="loading",t[t.failed=2]="failed",t[t.loaded=3]="loaded",t[t.parsed=4]="parsed",t[t.destroyed=5]="destroyed"}(Ac||(Ac={}));class uc extends ac{yr=0;be;xe=Qh();Li;Ae;wr=null;De=0;Se;Cr="";Br=[];Er=[];mr;Qr="splat";kr=0;br=0;Tt;$e=!0;pr;_r=new hc;Dr;Sr;Le={Xt:new Int32Array(0),te:[],_modelMatrix:r.Matrix4.IDENTITY.clone(),Vt:[],ie:0,Ne:0,Ue:void 0,Te:[]};Mr;Ge;$r;Rr;Fr=!1;Gr;constructor(t){super(),this._r.Lr=this.Lr.bind(this),this._r.Nr=this.Nr.bind(this),this._r.Ur=this.Ur.bind(this),this._r.Tr=this.Tr.bind(this),this.be=t.be,this.Ae=t.Ae,this.$r=t.$r,this.Gr=t.Gr,this.Rr=Math.max(.5,Math.min(2,t.Rr||1)),this.Tt=Math.min(4096,this.Ae._gl.getParameter(this.Ae._gl.MAX_TEXTURE_SIZE)),this.Ge=new bh(this.Ae,this.Tt),this.Li=new rc({Ni:t.Pr,Gi:(t,e)=>!(this.br===e.qr||this.Le&&-1!==this.Le.te.indexOf(t)||this.Er.find((e=>e.be==t))||(this.Ge.ke(e),this.Or(e),0))}),this.mr=this.be.substring(0,this.be.lastIndexOf("/")+1),this.pr=t.pr,this.Hr(t).then((()=>{if(t.pr.length){const e=this.wr.enuCenter;t.pr.forEach((t=>{let n=1/0,i=1/0,r=-1/0,o=-1/0;t.vr=t.polygon.map((t=>{const{x:s,y:a,z:A}=zl([t[0],t[1],0],e);return n=Math.min(n,s),r=Math.max(r,s),i=Math.min(i,a),o=Math.max(o,a),[s,a]})),t.dr=[n,i,t.height,r,o,t.extrudedHeight]})),sc.postMessage({Zt:this.xe,pr:t.pr})}}));const e=t=>{t.data.Zt==this.xe&&this.ze(t.data)},n=t=>{t.data.Zt==this.xe&&this.qe(t.data)};sc.addEventListener("message",e),ph.addEventListener("message",n),this.Mr=()=>{sc.removeEventListener("message",e),sc.removeEventListener("message",n)}}Or(t){t.zr=Ac.destroyed,t.ur=void 0,t.zt=void 0,t.Vt=[]}_destroy(){this.Ae=null,this.pr=[],this.mr="",this.be="",this.Mr(),this.Mr=void 0,this.Le=void 0,this.wr=null,this.br=0,this.Li._destroy(),this.Ge._destroy(),this.Er=[],this.Br=[],this._r.clear()}Kr(){if(this.wr)return this.wr}qe(t){const{te:e,zt:n,Xt:i,jt:o,ne:s,ie:a,ee:A}=t;let u=r.Matrix4.IDENTITY.clone();const h=[];e.forEach(((t,e)=>{const i=this.Li.Yi(t,!0);i&&(i.Vr=!0,i.zt=n[e],h[e]=i.Jt,u=i._modelMatrix)})),this.Le={Xt:new Int32Array(i.buffer,4*s),te:e,_modelMatrix:u,Vt:this.Ge.Ee(A),Te:h,ie:a,Ne:this.Le?.Ne||0,Ue:this.Le?.Ue},this.$e=!0,this.Dr&&this.Dr(this.Le)}ze(t){const{Ir:e,Pt:n,qt:i,Zt:r,Ht:o,zt:s,_i:a,xi:A}=t,u=this.Tt,h=this.Li.Yi(o,!0);h&&(h.Vt=[],h.zt=s,h.Pt=n,h.qt=i,e.forEach(((t,e)=>{const n=new Float32Array(t),i=t.byteLength/16/u,r={width:u,height:i,arrayBufferView:n},s=o+"_"+e,a=2*Math.round(Math.sqrt(this.Tt**2/2/15e4)),A=this.Ge.me(h._e,2**(5-h.Kt)*a*240,i,h.Kt);A.de(r,s,h._e),h.Vt.push(A)})),h.zr=Ac.parsed,this.Sr&&this.Sr())}async Hr(t){const e=await fetch(this.be,{cache:"default",mode:"cors",credentials:"omit"}),n=await e.json();if(this.Qr=n.type||"splat",this.wr=n.root,t.Jr){const e=Math.floor(1073741824*t.Jr/44/(this.wr.avgCount||15e4));this.Li.Ui=e}if(this.emit("configloaded",null),!document.getElementById("yunjinglogo")){const t=document.createElement("img");t.id="yunjinglogo",t.style.cssText="position: absolute; top: 5px; left: 5px;",t.width=200,t.src="data:image/png;base64,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",document.getElementsByClassName("cesium-viewer")[0].appendChild(t)}}Yr(t,e,n,i,r,o,s,a,A){let u=Math.max(t-s,0,s-i),h=Math.max(e-a,0,a-r),l=Math.max(n-A,0,A-o);return Math.sqrt(u*u+h*h+l*l)}jr(t,e,n){const i=e.bbox;return this.Yr(i[0],i[1],i[2],i[3],i[4],n||i[5],t.x,t.y,t.z)}Wr(t,e,n,i,o){let s=e;const{enuCenter:a=o,bbox:A,rotate:u,scale:h,depth_Test:l,content:c,geometricError:f}=t,[d,g,v]=a,I=r.Cartesian3.fromDegrees(d,g,v),p=i?e:r.Transforms.eastNorthUpToFixedFrame(I),y=jl(new r.Cartesian3((A[0]+A[3])/2,(A[1]+A[4])/2,(A[2]+A[5])/2),a,p);let w=!1,C=r.Matrix4.IDENTITY.clone();if(i||(w=!0,C=r.Matrix4.multiply(n,p,C)),u){w=!0;const t=r.Math.toRadians(u),e=r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationZ(t));C=r.Matrix4.multiply(C,e,C)}if(h){w=!0;const t=r.Matrix4.fromScale(new r.Cartesian3(h,h,h),new r.Matrix4);C=r.Matrix4.multiply(C,t,C)}return{Xr:f,dr:[A[0],A[1],A[2],A[3],A[4],A[5]],Xe:!0,en:l,bi:c.coord,_e:y,be:this.mr+c.uri,Kt:c.rank,Me:I,Zr:a,_modelMatrix:s,hr:w?C:void 0,lr:h,cr:u,zr:Ac.init,kr:this.kr}}eo(t,e){return t.map((t=>{const n=new r.Cartesian3(t.x,t.y,t.z),i=t.w,o=r.Matrix4.multiplyByPointAsVector(e,n,new r.Cartesian3),s=r.Cartesian3.multiplyByScalar(n,-i,new r.Cartesian3),a=r.Matrix4.multiplyByPoint(e,s,new r.Cartesian3),A=-r.Cartesian3.dot(o,a);return new r.Cartesian4(o.x,o.y,o.z,A)}))}no(t){if(!this.wr)return this.Er=[],this.Er;this.br=(new Date).getTime(),this.kr+=1;const e=this.wr,n=[],i=[],o=t.camera,s=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC).planes;let a=this.wr.enuCenter;const A=a[0],u=a[1],h=a[2],l=r.Cartesian3.fromDegrees(A,u,h),c=r.Transforms.eastNorthUpToFixedFrame(l),f=r.Matrix4.inverse(c,new r.Matrix4),d=this.eo(s,f);let g=Yl(o.positionWC,a);const v=this.Gr,I=t=>{let A=!1,u=!1,h=!1;const{enuCenter:l=a,bbox:p,geometricError:y,content:w}=t,C=this.mr+w.uri,B=l[0]===a[0]&&l[1]===a[1]&&l[2]===a[2];let E=d,m=g,Q=c;if(!B){const t=r.Cartesian3.fromDegrees(l[0],l[1],l[2]);Q=r.Transforms.eastNorthUpToFixedFrame(t);const e=r.Matrix4.inverse(Q,new r.Matrix4);m=Yl(o.positionWC,l),E=this.eo(s,e)}const k=new r.Cartesian3(p[0]-v,p[1]-v,p[2]-v),b=new r.Cartesian3(p[3]+v,p[4]+v,p[5]+v),_=new r.AxisAlignedBoundingBox(k,b);if(A=new r.CullingVolume(E).computeVisibility(_)!==r.Intersect.OUTSIDE,A){const r=this.jr(m,t,e.maxZ);let o;if((0==r||r<=y/this.Rr)&&(u=!0),u)if(w.uri&&(o=this.Li.Yi(C,!1),o||(o=this.Wr(t,c,f,B,a),this.Li.Wi(C,o)),o.qr=this.br,-1==n.indexOf(o)?(n.unshift(o),o.io=r):o.io=Math.min(o.io,r)),t.children&&t.children.length){let e=!0,n=!1,r=!1;t.children.forEach((t=>{const[i,o,s]=I(t);i&&(r=!0,s||(e=!1),"ADD"==t.refine&&(n=!0))})),e=r&&e,!e||n||"ALWAYS"==t.refine?o&&o.zr==Ac.parsed&&(h=!0,-1==i.indexOf(o)&&i.unshift(o)):h=!0}else o&&o.zr==Ac.parsed&&(h=!0,-1==i.indexOf(o)&&i.unshift(o))}return[A,u,h]};I(e),this.Er=i.filter((t=>t.Xe&&t.ie)),this.Br=n;const p=r.Cartographic.fromCartesian(o.positionWC);return this.ro([180*p.longitude/Math.PI,180*p.latitude/Math.PI,p.height],this.$r),this.Er}Je(t,e){let n=t[2]*e[2]+t[6]*e[6]+t[10]*e[10];const i=(t[2]**2+t[6]**2+t[10]**2)**.5,r=(e[2]**2+e[6]**2+e[10]**2)**.5;return Math.abs(n/i/r-1)>.01}oo(t){let e=this.Er;if(!e.length)return;e.sort(((t,e)=>t.Kt==e.Kt?t.io>e.io?-1:1:t.Kt<e.Kt?-1:1));const n=t.camera.viewMatrix,i=t.camera.frustum.projectionMatrix,o=(new Date).getTime();let s=!1;if(0==this.$e||this.Le&&this.Le.Xt.buffer.detached)return;const a=e.map((t=>t.be)).sort().join("|");if(this.De?(o-this.De>200&&this.Cr!==a||this.Je(this.Se,n))&&(s=!0):s=!0,s){this.De=o,this.Se=n.clone(),this.Cr=a,this.$e=!1;const t=[this.Le.Xt.buffer],s={Zt:this.xe,Ye:n,Xt:this.Le.Xt,Tt:this.Tt,Ut:e.map((e=>{t.push(e.zt);const o=new r.Matrix4;return r.Matrix4.multiply(n,e._modelMatrix,o),r.Matrix4.multiply(i,o,o),{Kt:e.Kt||0,Ht:e.be,zt:e.zt,Ot:o,Pt:e.Pt,qt:e.qt,Jt:e.ie,Vt:e.Vt?.map((t=>({jt:t.jt,_id:t._id})))}}))};ph.postMessage(s,t)}}so(){if(this.Er.length)return this.Le}ao(){const t=this.Br;t.sort(((t,e)=>t.Kt==e.Kt?t.io<e.io?-1:1:t.Kt<e.Kt?-1:1)),t.forEach((async t=>{t.zr==Ac.init?(t.zr=Ac.loading,await this._r.load(t.be)):t.zr==Ac.loaded||t.zr==Ac.loading||t.zr==Ac.failed||(t.zr,Ac.parsed)}))}Ao(t,e){const n=this.Li.Yi(this.mr+t+"."+this.Qr,!1);n&&(n.Xe=e)}uo(t){const{x:e,y:n,z:i}=zl(t,this.wr?.enuCenter);for(let t=0,s=this.pr.length;t<s;t+=1)if(r=[e,n,i],o=this.pr[t].dr,r[0]>=o[0]&&r[1]>=o[1]&&r[2]>=o[2]&&r[0]<=o[3]&&r[1]<=o[4]&&r[2]<=o[5]&&Hl([e,n],this.pr[t].vr))return this.pr[t];var r,o;return null}Ke(t,e){if(t){for(let n=0,i=this.pr.length;n<i;n+=1)if(this.pr[n].id==t){this.Le.Ne=n+1,this.Le.Ue=e?.fillColor||void 0;break}}else this.Le.Ne=0}ho(){return this.Er}Lr(t){return!!this.Li.Yi(t,!0)}Nr(t){const e=this.Li.Yi(t.url,!0);e&&(e.zr=Ac.failed)}Tr(){this.Fr&&this.emit("preloadComplete",null)}Ur(t){const e=this.Li.Yi(t.url,!0);e&&(e.ie=t.totalVertexCount,e.Jt=t.totalVertexCount,e.ur=t.data,e.zr=Ac.loaded,sc.postMessage({ar:[{dr:e.dr,ur:e.ur.buffer,Pe:[0,0,0],Jt:t.totalVertexCount,Ar:t.isCompressed,hr:e.hr,lr:e.lr,cr:e.cr,Me:e.Zr}],Me:this.Kr()?.enuCenter,Tt:this.Tt,ie:t.totalVertexCount,Ht:e.be,Zt:this.xe},[e.ur.buffer]))}ro(t,e=1e3){if(this.wr){this.Fr=!0;let n=this.wr.enuCenter;t=t||n;const i=n[0],o=n[1],s=n[2],a=r.Cartesian3.fromDegrees(i,o,s),A=r.Transforms.eastNorthUpToFixedFrame(a),u=r.Matrix4.inverse(A,new r.Matrix4),h=zl(t,n),l=new Map,c=i=>{for(let r=0,o=i.length;r<o;r+=1){const o=i[r],{enuCenter:s=n,content:a}=o,f=a.rank,d=s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2],g=d?h:zl(t,s);if(this.jr(g,o)<=e){const t=this.mr+a.uri;if(a.uri&&!this.Li.Yi(t,!0)){const e=this.Wr(o,A,u,d,n),i=this.Li.Wi(t,e);if(l.get(f)||l.set(f,[]),l.get(f)?.push(t),i)return i}if(o.children&&c(o.children))return!0}}},f=this.wr;c([f]),l.keys().forEach((t=>{const e=l.get(t);for(let t=0,n=e.length;t<n;t+=1)this._r.lo(e[t])}))}}}class hc{co=18;Qn=[];fo=[];Wi=new Set;do=0;Lr;Nr;Ur;Tr;constructor(){}clear(){this.Qn=[],this.Wi.clear(),this.do=0}load(t){this.Wi.has(t)||(this.Qn.push(t),this.Wi.add(t),this.vo())}lo(t){this.Wi.has(t)||(this.fo.push(t),this.Wi.add(t),this.vo())}async vo(){if(this.do<this.co&&this.Qn.length||this.fo.length){this.do++;const t=this.Qn.shift()||this.fo.shift();if(this.Wi.delete(t),!this.Lr(t))return this.do--,void this.vo();const e=await fetch(t,{cache:"default",mode:"cors",credentials:"omit"});if(200!==e.status&&304!==e.status)return this.Nr({url:t,message:e.status}),this.do--,void this.vo();const n=parseInt(e.headers.get("content-length"));if(!n)return this.Nr({url:t,message:"empity"}),this.do--,void this.vo();const i=await e.arrayBuffer();let r,o=new Uint8Array(i),s=!1;t.endsWith("splat")?r=n/32:t.endsWith(".bin")&&(r=new Uint32Array(i,0,2)[1],s=!0),this.Ur({url:t,data:o,isCompressed:s,totalVertexCount:r}),this.do--,this.vo()}else this.Qn.length||this.do||this.Tr&&this.Tr()}}class lc{Io;po="单体化图层";yo=!1;wo;Co;Bo;_show=!0;Eo;Bn;mo;Qo;Ut;ko;bo;_o;xo;Do;So;constructor(t){this.mo=t,this.So=t.cb,this.Bn=t.viewer,this.Ut=t.tiles,this.Qo=t.api_url,this.bo={},this.ko=[],this.xo={},this.Do=[],this._o=new rc({Ni:10,Gi:this.onDrop}),this.wo=new r.Event,this.Co=new r.Event,this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this.init()}init(){this.So&&this.So(this.Io)}initMonomer(t,e,n){const i=e.points,o=e.indexes;for(let e=0;e<o.length;e+=3){const r=o[e],s=o[e+1],a=o[e+2];t.push({monomer_id:n,points:[i[r],i[s],i[a]]})}let s=[],a=e.min_height;const A=e.contours;for(let t of A){const n=parseFloat(t[0]),i=parseFloat(t[1]);s.push(n),s.push(i),s.push(e.max_height)}this.Io.add({name:"polygon",polygon:{hierarchy:r.Cartesian3.fromDegreesArrayHeights(s),material:r.Color.YELLOW.withAlpha(.3),extrudedHeight:a,perPositionHeight:!0}})}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}onDrop=(t,e)=>{delete this.bo[t],this.xo=[],this.Do=[],this.Io.removeAll();for(let t in this.bo)this.ko=this.ko.concat(this.bo[t]);let n=0;for(let t of this.ko)this.xo[n]=t,this.initMonomer(this.Do,t,n),n++;return!0};updateData(t){for(let e of t)this._o.Xi(e)||(this._o.Wi(e,"1"),fetch(this.Qo+e+"_triangle.json").then((t=>t.json())).then((t=>{this.bo[e]=t,this.ko=[];for(let t in this.bo)this.ko=this.ko.concat(this.bo[t]);let n=0;for(let t of this.ko)this.xo[n]=t,this.initMonomer(this.Do,t,n),n++})).catch((t=>{})));return!0}update(){return!0}pick(t){let e=!1,n="";for(let i of this.Do){const o=r.Cartesian3.fromDegrees(i.points[0][0],i.points[0][1],i.points[0][2]),s=r.Cartesian3.fromDegrees(i.points[1][0],i.points[1][1],i.points[1][2]),a=r.Cartesian3.fromDegrees(i.points[2][0],i.points[2][1],i.points[2][2]);if(r.IntersectionTests.rayTriangle(t,o,s,a)){e=!0,n=i.monomer_id;break}}return e?this.xo[n]:null}}class cc{Bn;Mo;fe=!1;constructor(t){const e=t.viewer;this.Bn=e,this.Mo=new lc(t),e.dataSources.add(this.Mo)}setVisibility(t,e){this.Mo&&(this.Mo.show=e)}hide(){this.Mo&&(this.Mo.entities.show=!1)}show(){this.Mo&&(this.Mo.entities.show=!0)}destory(){this.Mo&&(this.Mo.entities.removeAll(),this.Bn?.dataSources.remove(this.Mo),this.Mo=void 0),this.fe=!0,this.Bn=void 0}getEntities(){return this.Mo?.entities}pick(t){return this.Mo?.pick(t)}update(t){return this.Mo?.updateData(t)}}class fc extends ac{$o;Bn;tn;Xe=!0;fe=!1;Ro;Fo=.1;Go=1/0;Lo=-1/0;No;Uo;To;constructor(t){super();const e=t.viewer;this.Bn=e;const n=e.scene;this.$o=new uc({Rr:t.lodFactor||1,Pr:t.cacheSize||2e3,Jr:t.cacheMemorySize,$r:t.loadBuffer||0,Gr:t.renderBuffer||10,be:t.url,Ae:n.context,pr:t.entityInfos||[]}),this.$o.on("configloaded",(()=>{this.emit("configloaded",this.$o.Kr())})),this.$o.on("todrawtile",(t=>{this.emit("todrawtile",t)})),t.maxPitch&&this.setMaxPitch(t.maxPitch),(t.minHeight||t.minRange||t.maxRange)&&this.setMinHeight(t.minHeight,t.minRange,t.maxRange),this.tn=new Mh({scene:n,en:t.depthTest||!1,Tt:this.$o.Tt,gn:t.pass,vn:t.filter}),t.monomerConfig&&(this.No=new cc({name:"单体化图层",viewer:e,tiles:[],api_url:t.monomerConfig.api_url}),this.To=t.monomerConfig.highlight_color),this.$o.Dr=t=>{this.tn.Cn(t)},this.$o.Sr=()=>{this.Bn?.scene.requestRender()},n.preRender.addEventListener(((t,e)=>{if(this.Xe&&!this.fe){const e=this.$o.no(t);e?.length?(this.Po(e),this.No&&this.qo(e),this.tn._show()):this.tn.pn(),this.$o.ao(),this.$o.oo(t)}}),this)}preLoad(t,e=1e3,n){if(this.Bn){this.$o.clear("preloadComplete"),this.$o.on("preloadComplete",(()=>{this.$o.clear("preloadComplete"),n&&n()}));const i=this.getCameraPos();this.$o.Kr()?this.$o.ro(t||[i.lng,i.lat,i.height],e):this.$o.on("configloaded",(()=>{this.$o.ro(t||[i.lng,i.lat,i.height],e)}))}}set lodFactor(t){this.$o.Rr=Math.max(.3333,Math.min(3,t)),this.Bn?.scene.requestRender()}Po(t){}qo(t){const e=[];if(t.length>0)for(let n of t){const t=n.bi,i=t[0];if(14===i)e.push(t.join("_"));else{const n=i-14,r=[t[0]-n,t[1]>>n,t[2]>>n];e.push(r.join("_"))}}const n=[...new Set(e)];this.No&&this.No.update(n)}getTileSetUrl(){return this.$o.be}getEnuCenter(){return this.$o.Kr()?.enuCenter}getBaseHeight(){const t=this.$o.Kr();return t?Math.max(0,t.bbox[2]+t.enuCenter[2]):0}setMaxPitch(t){void 0!==t?(t=t*Math.PI/180,this.Ro=t,this.Bn.camera.rotateUp=function(e){t&&(e&&this.pitch+e>t+.2*Math.PI/180&&(e=t-this.pitch),r.Camera.prototype.rotateUp.call(this,e))}):(this.Ro=void 0,this.Bn.camera.rotateUp=r.Camera.prototype.rotateUp)}getMaxPitch(){return this.Ro||0}setMinHeight(t,n,i){if(void 0!==t||void 0!==n||void 0!==i){this.Fo=t,this.Go=n,this.Lo=i;const o=this.Bn.scene,s=this.Bn;this.Bn.camera.move=function(a,A){let u;const h=o.pickFromRay({direction:a,origin:this.positionWC});if(h&&h.position?u=h.position:s?.trackedEntity&&(u=s.trackedEntity.position?.getValue(s.clock.currentTime)),u){const r=e.Cartesian3.distance(u,this.positionWC);t&&A>0&&r*Math.cos(this.pitch+Math.PI/2)<t&&(A=0),n&&A>0&&r<n&&(A=0),i&&A<0&&r>i&&(A=0)}r.Camera.prototype.move.call(this,a,A)}}else this.Fo=void 0,this.Go=void 0,this.Lo=void 0,this.Bn.camera.move=r.Camera.prototype.move}getMinHeight(){return this.Fo||0}set depthTest(t){this.tn.en=t}setVisibility(t,e){this.$o.Ao(t,e)}hide(){this.Xe=!1,this.tn.pn()}show(){this.Xe=!0,this.tn._show()}destory(){this.setMaxPitch(),this.setMinHeight(),this.$o._destroy(),this.tn._destroy(),this.fe=!0,this.Bn=void 0,this.fe=!0}pickPosition(t){const e=this.Bn.scene.pickPosition(t);if(r.defined(e)){var n=r.Cartographic.fromCartesian(e),i=r.Math.toDegrees(n.longitude),o=r.Math.toDegrees(n.latitude),s=n.height;return{lnglat:{lng:Ol(i,6),lat:Ol(o,6),alt:Ol(s,1)},ecef:e,target:this}}return null}pickEntity(t){const e=this.Bn.scene.pickPosition(t);if(r.defined(e)){var n=r.Cartographic.fromCartesian(e),i=r.Math.toDegrees(n.longitude),o=r.Math.toDegrees(n.latitude),s=n.height;return this.$o.uo([i,o,s])}return null}selectedEntity(t,e){this.$o.Ke(t,e),1==this.$o.$e&&this.tn.Cn(this.$o.Le)}getCameraPos(){if(this.Bn){var t=r.Cartographic.fromCartesian(this.Bn.camera.position),e=this.Bn.camera;return{lng:r.Math.toDegrees(t.longitude),lat:r.Math.toDegrees(t.latitude),height:t.height,heading:r.Math.toDegrees(e.heading),pitch:r.Math.toDegrees(e.pitch),roll:0}}}ki(){return this.$o.ho()}pickMonomer(t){const e=this.Bn;if(e){const a=e.camera.getPickRay(t.position),A=e.scene.camera.positionCartographic,u=r.Math.toDegrees(A.longitude),h=r.Math.toDegrees(A.latitude);new r.Cartesian3(u,h,A.height);var n=e.camera.pickEllipsoid(new r.Cartesian2(t.position.x,t.position.y));if(n){var i=r.Cartographic.fromCartesian(n),o=r.Math.toDegrees(i.longitude),s=r.Math.toDegrees(i.latitude);if(new r.Cartesian3(o,s,0),this.No){const t=this.No.pick(a);if(t){this.Uo&&e.entities.remove(this.Uo);let n=[];const i=t.contours;for(let e of i){const i=parseFloat(e[0]),r=parseFloat(e[1]),o=t.max_height;n.push(i),n.push(r),n.push(o)}let o="RGBA(255,0,0,0.3)";return this.To&&(o=this.To),this.Uo=e.entities.add({name:"polygon",polygon:{hierarchy:r.Cartesian3.fromDegreesArrayHeights(n),material:r.Color.fromCssColorString(o),extrudedHeight:t.min_height,perPositionHeight:!0}}),{contours:t.contours,max_height:t.max_height,min_height:t.min_height}}}}}}}const dc=new r.Cartesian3,gc=new r.Cartesian3,vc=new r.Cartesian3,Ic=new r.Cartesian3(0,0,1);class pc{Oo;Ho;constructor(t=1,e=1,n=.1){this.Oo=new r.Cartesian3(t,e,n),this.Ho=0}zo(t,e){const n=r.Cartesian3.subtract(e,t,new r.Cartesian3);n.z<0?this.Ho=r.Cartesian3.magnitude(r.Cartesian3.divideComponents(n,this.Oo,n)):this.Ho=r.Cartesian3.magnitude(new r.Cartesian3(n.x,n.y,0))}Ko(t,e=!1){t=r.Cartesian3.divideComponents(t,this.Oo,t),t=r.Cartesian3.normalize(t,t),t=r.Cartesian3.multiplyComponents(t,this.Oo,t);const n=new r.Cartesian3;if(r.Cartesian3.multiplyByScalar(t,this.Ho,n),e&&n.z>0){const t=r.Cartesian3.dot(n,Ic);r.Cartesian3.multiplyByScalar(Ic,t,dc),r.Cartesian3.multiplyByScalar(r.Cartesian3.normalize(r.Cartesian3.fromElements(n.x,n.y,0,vc),vc),this.Ho,vc),r.Cartesian3.add(n,r.Cartesian3.multiplyByScalar(r.Cartesian3.subtract(r.Cartesian3.add(vc,dc,gc),n,gc),2,gc),gc),n.x=gc.x,n.y=gc.y}return n.x=Math.round(100*n.x)/100,n.y=Math.round(100*n.y)/100,n.z=Math.round(100*n.z)/100,n}}var yc;class wc{je;Xe=!1;fe=!1;_texture;Vo;constructor(t,e){this._texture=t,this.Vo=e}update(t){this.fe||this.Xe&&(this.Vo.Jo()||(this._texture.Yo(),t.commandList.unshift(this.je)))}isDestroyed(){return this.fe}show(){0==this.Xe&&(this.Xe=!0)}hide(){this.Xe&&(this.Xe=!1)}destroy(){this.fe=!0,this.je.vertexArray.getAttribute(0).vertexBuffer.destroy(),this.je.vertexArray.rn=[],this.je.vertexArray.destroy()}}class Cc{mo;jo;Wo;Xo;Zo;ts;es;Xe=!0;ns;rs=!0;destroyed=!1;constructor(e){e.autoHide=null==e.autoHide?t.AUTOHIDE_MODE.AUTO:e.autoHide,e.autoHideDistance=null==e.autoHideDistance?50:e.autoHideDistance,e.autoHideAngle=null==e.autoHideAngle?15:e.autoHideAngle;const n=e.viewer;this.ns=new pc(1,1,1),this.mo=e,n.scene,this.jo=r.Cartesian3.fromDegrees(this.mo.pos[0],this.mo.pos[1],this.mo.pos[2]),this.Xo=r.Transforms.localFrameToFixedFrameGenerator("north","west"),(t=>new Promise(((e,n)=>{!function n(){t.terrainProvider?setTimeout((()=>{e()}),2e3):setTimeout(n,300)}()})))(this.mo.viewer).then((async()=>{this.es=(await r.sampleTerrain(this.mo.viewer.terrainProvider,13,[r.Cartographic.fromCartesian(this.jo)]))[0]?.height||0,this.ss(),this.As()}))}Jo(){if(this.mo.autoHide==t.AUTOHIDE_MODE.NO)return!1;if(this.mo.autoHide==t.AUTOHIDE_MODE.ALL||this.mo.autoHide==t.AUTOHIDE_MODE.AUTO&&!this.rs){const t=this.mo.viewer.camera;if(r.Cartesian3.distance(t.positionWC,this.jo)>this.mo.autoHideDistance)return!0;if(Math.abs(r.Math.toDegrees(t.heading)-this.mo.heading)>this.mo.autoHideAngle)return!0;if(Math.abs(r.Math.toDegrees(t.pitch)-this.mo.pitch)>this.mo.autoHideAngle)return!0}return!1}getPosition(){return this.jo}async setPos(t){this.mo.pos=t,this.jo=r.Cartesian3.fromDegrees(t[0],t[1],t[2]),this.es=(await r.sampleTerrain(this.mo.viewer.terrainProvider,13,[r.Cartographic.fromCartesian(this.jo)]))[0]?.height||0,this.ss()}setOpacity(t){"number"==typeof t&&(this.mo.opacity=t)}setInternalParams(t,e,n){this.mo.resolution=t,this.mo.fov_vertical=e,this.mo.fov_horizontal=n,this.ss()}setHeadingAndPitch(t,e){const n=typeof t,i=typeof e;"number"!=n&&"undefined"!=n||"number"!=i&&"undefined"!=i||this.ss(t,e)&&(void 0!==t&&(this.mo.heading=t),void 0!==e&&(this.mo.pitch=e))}ss(t,n){const i=this.mo.resolution[0]/this.mo.resolution[1];var o=r.Math.toRadians(this.mo.fov_vertical),s=this.mo.fov_horizontal?r.Math.toRadians(this.mo.fov_vertical):2*Math.atan(Math.tan(o/2)*i);t=r.Math.toRadians(null==t?this.mo.heading:t),n=r.Math.toRadians(null==n?this.mo.pitch:n),this.us(t,n,0,0,0);const a=this.jo,A=new r.Camera(this.mo.viewer.scene);A.position=this.jo;let u=new r.HeadingPitchRoll(t,n,0),h=r.Transforms.headingPitchRollToFixedFrame(this.jo,u,r.Ellipsoid.WGS84,this.Xo),l=r.Matrix4.multiplyByPointAsVector(h,r.Cartesian3.UNIT_X,new r.Cartesian3);A.direction=l,A.frustum.aspectRatio=i,A.frustum.fov=i>1?s:o,A.frustum.near=1,A.frustum.far=1e4,A.setView({destination:this.jo,orientation:{heading:t,pitch:n,roll:0}});var c=A.frustum.projectionMatrix,f=r.Matrix4.multiply(A.viewMatrix,r.Matrix4.fromTranslation(a),new r.Matrix4),d=r.Matrix4.multiply(c,f,new r.Matrix4);this.ts=d;const g=[],v=16;if(this.mo.mode){const i=this.mo.pos[2]-this.es,r=new e.Cartesian3(0,0,0),A=new e.Cartesian3(0,0,-i);this.ns.zo(r,A);let u=-s/2,h=o/2,l=(-o/2-h)/v;for(let e=0;e<=v;e+=1){const i=this.hs(t,n,0,u,h+l*e);g.push(i.x-a.x,i.y-a.y,i.z-a.z)}u=s/2;for(let e=0;e<=v;e+=1){const i=this.hs(t,n,0,u,h+l*e);g.push(i.x-a.x,i.y-a.y,i.z-a.z)}}else{let i=-o/2,r=(o/2-i)/v,A=-s/2,u=e.Cartesian3.fromDegrees(this.mo.pos[0],this.mo.pos[1],this.es);for(let e=0;e<=v;e+=1){const o=this.ls(t,n,0,A,i+r*e);let s=this.cs(o);s?u=s:(s=this.fs(u,o),this.rs=!1),g.push(s.x-a.x,s.y-a.y,s.z-a.z)}A=s/2;for(let e=0;e<=v;e+=1){const o=this.ls(t,n,0,A,i+r*e);let s=this.cs(o);s?u=s:(s=this.fs(u,o),this.rs=!1),g.push(s.x-a.x,s.y-a.y,s.z-a.z)}}if(this.Zo=g,this.Wo?.je){const t=this.Wo.je.vertexArray.getAttribute(0).vertexBuffer;t?.copyFromArrayView(new Float32Array(g))}return!0}fs(t,n){const i=new e.Cartesian3(0,0,0),r=Yl(t,this.mo.pos);return this.ns.zo(i,r),jl(this.ns.Ko(n),this.mo.pos)}cs(t){let n=jl(t,this.mo.pos);n=e.Cartesian3.subtract(n,this.jo,new e.Cartesian3);var i=new r.Ray(this.jo,n),o=new r.Ellipsoid(r.Ellipsoid.WGS84.radii.x+this.es,r.Ellipsoid.WGS84.radii.y+this.es,r.Ellipsoid.WGS84.radii.z+this.es),s=r.IntersectionTests.rayEllipsoid(i,o);return s?r.Ray.getPoint(i,s.start):null}ls(t,n,i,o,s){o=Math.tan(o),s=Math.tan(s);let a=new r.Cartesian3;a=r.Cartesian3.normalize(new e.Cartesian3(o,1,s),a);let A=r.Matrix3.fromRotationX(n),u=r.Matrix3.fromRotationZ(-t),h=r.Matrix3.fromColumnMajorArray([a.x,a.y,a.z,0,0,0,0,0,0]);return h=r.Matrix3.multiply(A,h,new r.Matrix3),h=r.Matrix3.multiply(u,h,new r.Matrix3),r.Matrix3.getColumn(h,0,new e.Cartesian3)}hs(t,e,n,i,r){const o=this.ls(t,e,n,i,r);return jl(this.ns.Ko(o),this.mo.pos)}hide(){this.Xe=!1,this.Wo?.hide()}show(){this.Xe=!0,this.Wo?.show()}destroy(){this.Wo?.destroy(),this.Wo=void 0,this.ts=void 0,this.destroyed=!0}focus(t,e){(e||this.mo.viewer).camera.setView({destination:this.jo,orientation:{heading:r.Math.toRadians(this.mo.heading),pitch:r.Math.toRadians(this.mo.pitch),roll:0}}),t&&this.show()}us(t,n,i,o,s){let a=new r.HeadingPitchRoll(t,n,i),A=r.Transforms.headingPitchRollToFixedFrame(this.jo,a,r.Ellipsoid.WGS84,this.Xo);o=Math.tan(o),s=Math.tan(s);let u=new r.Cartesian3;u=r.Cartesian3.normalize(new e.Cartesian3(1,o,s),u);let h=r.Matrix4.multiplyByPointAsVector(A,u,new r.Cartesian3);var l=new r.Ray(this.jo,h),c=this.es,f=new r.Ellipsoid(r.Ellipsoid.WGS84.radii.x+c,r.Ellipsoid.WGS84.radii.y+c,r.Ellipsoid.WGS84.radii.z+c),d=r.IntersectionTests.rayEllipsoid(l,f);return d?r.Ray.getPoint(l,d.start):null}As(){var t=document.createElement("video");t.style.cssText="position:fixed;top:0;right:0",t.width=400,t.muted=!0,t.autoplay=!0,t.loop=!0,t.style.display="none",document.body.appendChild(t),t.src=this.mo.url,t.crossOrigin="anonymous",t.load(),t.play();const e=[];for(let t=0;t<16;t+=1)e.push(t,t+16+1,t+16+2),e.push(t,t+16+2,t+1);var n=new Uint16Array(e);t.addEventListener("loadeddata",(()=>{const e=this.mo.viewer.scene.context,i=r.FeatureDetection.supportsWebgl2&&r.FeatureDetection.supportsWebgl2(this.mo.viewer.scene),o=r.ShaderProgram.fromCache({context:e,vertexShaderSource:i?"#version 300 es\nprecision highp int;precision highp float;in vec3 position;out vec3 pos;uniform vec3 u_delta;uniform mat4 u_vp2;void main(){gl_Position=u_vp2*vec4(position,1.0f);pos=position;}":"#version 300 es\nprecision highp int;precision highp float;in vec3 position;in vec2 coord;out vec2 texCoord;void main(){gl_Position=czm_modelViewProjection*vec4(position,1.0f);texCoord=coord;}",fragmentShaderSource:i?"#version 300 es\nprecision highp float;uniform highp sampler2D u_video;uniform mat4 u_vp;uniform float u_opacity;in vec3 pos;void main(){vec4 proj=(u_vp*vec4(pos,1.0f));vec2 uv=proj.xy/proj.w+vec2(1,1);vec4 c=texture(u_video,uv/2.0f);c.a=u_opacity;out_FragColor=c;}":"#version 300 es\nprecision highp float;in vec2 texCoord;uniform highp sampler2D u_video;void main(){highp vec4 c=texelFetch(u_video,texCoord,0.0f);out_FragColor=c;}",attributeLocations:{position:0}}),s={enabled:!0,equationRgb:r.BlendEquation.ADD,equationAlpha:r.BlendEquation.ADD,functionSourceRgb:r.BlendFunction.SOURCE_ALPHA,functionDestinationRgb:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:r.BlendFunction.ONE,functionDestinationAlpha:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA},a=r.RenderState.fromCache({depthTest:{enabled:!1},blending:s,depthMask:!0,colorMask:{red:!0,green:!0,blue:!0,alpha:!0}}),A=(()=>{const n=new r.Texture({name:"camera",context:e,source:t,flipY:!0,sampler:new r.Sampler({minificationFilter:r.TextureMinificationFilter.NEAREST,magnificationFilter:r.TextureMagnificationFilter.LINEAR})});return n.Yo=()=>{n.copyFrom({source:t})},n})();this.Wo=new wc(A,this),this.Xe||this.Wo.hide();const u={u_video:()=>A,u_vp:()=>this.ts,u_vp2:()=>{let t=this.mo.viewer.camera.frustum.projectionMatrix;var e=r.Matrix4.multiply(this.mo.viewer.camera.viewMatrix,r.Matrix4.fromTranslation(this.jo),new r.Matrix4);return r.Matrix4.multiply(t,e,new r.Matrix4)},u_delta:()=>this.jo,u_opacity:()=>void 0!==this.mo.opacity?this.mo.opacity:1},h=new r.VertexArray({name:"camera",context:e,attributes:[{index:0,vertexBuffer:r.Buffer.createVertexBuffer({usage:r.BufferUsage.STATIC_DRAW,typedArray:new Float32Array(this.Zo),context:e}),componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT}],indexBuffer:r.Buffer.createIndexBuffer({context:e,typedArray:n,usage:r.BufferUsage.STATIC_DRAW,indexDatatype:r.IndexDatatype.UNSIGNED_SHORT})}),l=new r.DrawCommand({vertexArray:h,shaderProgram:o,uniformMap:u,renderState:a,pass:r.Pass.OPAQUE,count:96});this.Wo.je=l,this.mo.viewer.scene.primitives.add(this.Wo),this.Xe&&this.Wo.show()}))}}t.AUTOHIDE_MODE=void 0,(yc=t.AUTOHIDE_MODE||(t.AUTOHIDE_MODE={}))[yc.NO=0]="NO",yc[yc.ALL=1]="ALL",yc[yc.AUTO=2]="AUTO";var Bc=6371008.8,Ec={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*Bc,kilometers:6371.0088,kilometres:6371.0088,meters:Bc,metres:Bc,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:Bc/1852,radians:1,yards:6967335.223679999};function mc(t,e,n={}){const i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function Qc(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function kc(t,e="kilometers"){const n=Ec[e];if(!n)throw new Error(e+" units is invalid");return t*n}function bc(t){return t%360*Math.PI/180}function _c(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function xc(t,e,n){if(null!==t)for(var i,r,o,s,a,A,u,h,l=0,c=0,f=t.type,d="FeatureCollection"===f,g="Feature"===f,v=d?t.features.length:1,I=0;I<v;I++){a=(h=!!(u=d?t.features[I].geometry:g?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var p=0;p<a;p++){var y=0,w=0;if(null!==(s=h?u.geometries[p]:u)){A=s.coordinates;var C=s.type;switch(l=0,C){case null:break;case"Point":if(!1===e(A,c,I,y,w))return!1;c++,y++;break;case"LineString":case"MultiPoint":for(i=0;i<A.length;i++){if(!1===e(A[i],c,I,y,w))return!1;c++,"MultiPoint"===C&&y++}"LineString"===C&&y++;break;case"Polygon":case"MultiLineString":for(i=0;i<A.length;i++){for(r=0;r<A[i].length-l;r++){if(!1===e(A[i][r],c,I,y,w))return!1;c++}"MultiLineString"===C&&y++,"Polygon"===C&&w++}"Polygon"===C&&y++;break;case"MultiPolygon":for(i=0;i<A.length;i++){for(w=0,r=0;r<A[i].length;r++){for(o=0;o<A[i][r].length-l;o++){if(!1===e(A[i][r][o],c,I,y,w))return!1;c++}w++}y++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===xc(s.geometries[i],e))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Dc(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function Sc(t,e){var n,i,r,o,s,a,A,u,h,l,c=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(n=0;n<g;n++){for(a=f?t.features[n].geometry:d?t.geometry:t,u=f?t.features[n].properties:d?t.properties:{},h=f?t.features[n].bbox:d?t.bbox:void 0,l=f?t.features[n].id:d?t.id:void 0,s=(A=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=A?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,c,u,h,l))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===e(o.geometries[i],c,u,h,l))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,c,u,h,l))return!1;c++}}var Mc,$c={exports:{}},Rc=(Mc||(Mc=1,function(t,e){t.exports=function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function o(t,e){return o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},o(t,e)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function a(t,e,n){return a=s()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&o(r,n.prototype),r},a.apply(null,arguments)}function A(t){var e="function"==typeof Map?new Map:void 0;return A=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return a(t,arguments,r(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,t)},A(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){var e=s();return function(){var n,i=r(t);if(e){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}(this,n)}}function l(t,e,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},l(t,e,n||t)}function c(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function g(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=f(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}var v=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getEndCapStyle",value:function(){return this.ds}},{key:"isSingleSided",value:function(){return this.gs}},{key:"setQuadrantSegments",value:function(t){this.vs=t,0===this.vs&&(this.Is=e.JOIN_BEVEL),this.vs<0&&(this.Is=e.JOIN_MITRE,this.ps=Math.abs(this.vs)),t<=0&&(this.vs=1),this.Is!==e.JOIN_ROUND&&(this.vs=e.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this.Is}},{key:"setJoinStyle",value:function(t){this.Is=t}},{key:"setSimplifyFactor",value:function(t){this.ys=t<0?0:t}},{key:"getSimplifyFactor",value:function(){return this.ys}},{key:"getQuadrantSegments",value:function(){return this.vs}},{key:"setEndCapStyle",value:function(t){this.ds=t}},{key:"getMitreLimit",value:function(){return this.ps}},{key:"setMitreLimit",value:function(t){this.ps=t}},{key:"setSingleSided",value:function(t){this.gs=t}}],[{key:"constructor_",value:function(){if(this.vs=e.DEFAULT_QUADRANT_SEGMENTS,this.ds=e.CAP_ROUND,this.Is=e.JOIN_ROUND,this.ps=e.DEFAULT_MITRE_LIMIT,this.gs=!1,this.ys=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}}},{key:"bufferDistanceError",value:function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)}}]),e}();v.CAP_ROUND=1,v.CAP_FLAT=2,v.CAP_SQUARE=3,v.JOIN_ROUND=1,v.JOIN_MITRE=2,v.JOIN_BEVEL=3,v.DEFAULT_QUADRANT_SEGMENTS=8,v.DEFAULT_MITRE_LIMIT=5,v.DEFAULT_SIMPLIFY_FACTOR=.01;var I=function(e){i(o,e);var r=h(o);function o(e){var n;return t(this,o),(n=r.call(this,e)).name=Object.keys({Exception:o})[0],n}return n(o,[{key:"toString",value:function(){return this.message}}]),o}(A(Error)),p=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({IllegalArgumentException:r})[0],i}return r}(I),y=function(){function e(){t(this,e)}return n(e,[{key:"filter",value:function(t){}}]),e}();function w(){}function C(){}function B(){}var E,m,Q,k,b,_,x,D=function(){function e(){t(this,e)}return n(e,null,[{key:"equalsWithTolerance",value:function(t,e,n){return Math.abs(t-e)<=n}}]),e}(),S=function(){function e(n,i){t(this,e),this.low=i||0,this.high=n||0}return n(e,null,[{key:"toBinaryString",value:function(t){var e,n="";for(e=2147483648;e>0;e>>>=1)n+=(t.high&e)===e?"1":"0";for(e=2147483648;e>0;e>>>=1)n+=(t.low&e)===e?"1":"0";return n}}]),e}();function M(){}function $(){}M.NaN=NaN,M.isNaN=function(t){return Number.isNaN(t)},M.isInfinite=function(t){return!Number.isFinite(t)},M.MAX_VALUE=Number.MAX_VALUE,M.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,M.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,"function"==typeof Float64Array&&"function"==typeof Int32Array?(b=2146435072,_=new Float64Array(1),x=new Int32Array(_.buffer),M.doubleToLongBits=function(t){_[0]=t;var e=0|x[0],n=0|x[1];return(n&b)===b&&!!(1048575&n)&&0!==e&&(e=0,n=2146959360),new S(n,e)},M.longBitsToDouble=function(t){return x[0]=t.low,x[1]=t.high,_[0]}):(E=Math.log2,m=Math.floor,Q=Math.pow,k=function(){for(var t=53;t>0;t--){var e=Q(2,t)-1;if(m(E(e))+1===t)return e}return 0}(),M.doubleToLongBits=function(t){var e,n,i,r,o,s,a,A,u;if(t<0||1/t===Number.NEGATIVE_INFINITY?(s=1<<31,t=-t):s=0,0===t)return new S(A=s,u=0);if(t===1/0)return new S(A=2146435072|s,u=0);if(t!=t)return new S(A=2146959360,u=0);if(r=0,u=0,(e=m(t))>1)if(e<=k)(r=m(E(e)))<=20?(u=0,A=e<<20-r&1048575):(u=e%(n=Q(2,i=r-20))<<32-i,A=e/n&1048575);else for(i=e,u=0;0!==(i=m(n=i/2));)r++,u>>>=1,u|=(1&A)<<31,A>>>=1,n!==i&&(A|=524288);if(a=r+1023,o=0===e,e=t-e,r<52&&0!==e)for(i=0;;){if((n=2*e)>=1?(e=n-1,o?(a--,o=!1):(i<<=1,i|=1,r++)):(e=n,o?0==--a&&(r++,o=!1):(i<<=1,r++)),20===r)A|=i,i=0;else if(52===r){u|=i;break}if(1===n){r<20?A|=i<<20-r:r<52&&(u|=i<<52-r);break}}return A|=a<<20,new S(A|=s,u)},M.longBitsToDouble=function(t){var e,n,i,r,o=t.high,s=t.low,a=o&1<<31?-1:1;for(i=((2146435072&o)>>20)-1023,r=0,n=1<<19,e=1;e<=20;e++)o&n&&(r+=Q(2,-e)),n>>>=1;for(n=1<<31,e=21;e<=52;e++)s&n&&(r+=Q(2,-e)),n>>>=1;if(-1023===i){if(0===r)return 0*a;i=-1022}else{if(1024===i)return 0===r?a/0:NaN;r+=1}return a*r*Q(2,i)});var R=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({RuntimeException:r})[0],i}return r}(I),F=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,null,[{key:"constructor_",value:function(){if(0===arguments.length)R.constructor_.call(this);else if(1===arguments.length){var t=arguments[0];R.constructor_.call(this,t)}}}]),o}(R),G=function(){function e(){t(this,e)}return n(e,null,[{key:"shouldNeverReachHere",value:function(){if(0===arguments.length)e.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new F("Should never reach here"+(null!==t?": "+t:""))}}},{key:"isTrue",value:function(){if(1===arguments.length){var t=arguments[0];e.isTrue(t,null)}else if(2===arguments.length){var n=arguments[1];if(!arguments[0])throw null===n?new F:new F(n)}}},{key:"equals",value:function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];e.equals(t,n,null)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];if(!r.equals(i))throw new F("Expected "+i+" but encountered "+r+(null!==o?": "+o:""))}}}]),e}(),L=new ArrayBuffer(8),N=new Float64Array(L),U=new Int32Array(L),T=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getM",value:function(){return M.NaN}},{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;case e.Z:this.setZ(n);break;default:throw new p("Invalid ordinate index: "+t)}}},{key:"equals2D",value:function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!D.equalsWithTolerance(this.x,e.x,n)&&!!D.equalsWithTolerance(this.y,e.y,n)}}},{key:"setM",value:function(t){throw new p("Invalid ordinate index: "+e.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y;case e.Z:return this.getZ()}throw new p("Invalid ordinate index: "+t)}},{key:"equals3D",value:function(t){return this.x===t.x&&this.y===t.y&&(this.getZ()===t.getZ()||M.isNaN(this.getZ())&&M.isNaN(t.getZ()))}},{key:"equals",value:function(t){return t instanceof e&&this.equals2D(t)}},{key:"equalInZ",value:function(t,e){return D.equalsWithTolerance(this.getZ(),t.getZ(),e)}},{key:"setX",value:function(t){this.x=t}},{key:"compareTo",value:function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(t){this.z=t}},{key:"clone",value:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return G.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.getZ()-t.getZ();return Math.sqrt(e*e+n*n+i*i)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(t){this.y=t}},{key:"distance",value:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}},{key:"hashCode",value:function(){var t=17;return 37*(t=37*t+e.hashCode(this.x))+e.hashCode(this.y)}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}},{key:"interfaces_",get:function(){return[w,C,B]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)e.constructor_.call(this,0,0);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.x,t.y,t.getZ())}else if(2===arguments.length){var n=arguments[0],i=arguments[1];e.constructor_.call(this,n,i,e.NULL_ORDINATE)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this.x=r,this.y=o,this.z=s}}},{key:"hashCode",value:function(t){return N[0]=t,U[0]^U[1]}}]),e}(),P=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"compare",value:function(t,n){var i=e.compare(t.x,n.x);if(0!==i)return i;var r=e.compare(t.y,n.y);return 0!==r?r:this.ws<=2?0:e.compare(t.getZ(),n.getZ())}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this.ws=2,0===arguments.length)e.constructor_.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new p("only 2 or 3 dimensions may be specified");this.ws=t}}},{key:"compare",value:function(t,e){return t<e?-1:t>e?1:M.isNaN(t)?M.isNaN(e)?0:-1:M.isNaN(e)?1:0}}]),e}();T.DimensionalComparator=P,T.NULL_ORDINATE=M.NaN,T.X=0,T.Y=1,T.Z=2,T.M=3;var q=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.isNull()?n.isNull():this.Cs===n.getMaxX()&&this.Bs===n.getMaxY()&&this.Es===n.getMinX()&&this.Qs===n.getMinY()}},{key:"intersection",value:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new e;var n=this.Es>t.Es?this.Es:t.Es,i=this.Qs>t.Qs?this.Qs:t.Qs;return new e(n,this.Cs<t.Cs?this.Cs:t.Cs,i,this.Bs<t.Bs?this.Bs:t.Bs)}},{key:"isNull",value:function(){return this.Cs<this.Es}},{key:"getMaxX",value:function(){return this.Cs}},{key:"covers",value:function(){if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof e){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this.Es&&n.getMaxX()<=this.Cs&&n.getMinY()>=this.Qs&&n.getMaxY()<=this.Bs}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&i>=this.Es&&i<=this.Cs&&r>=this.Qs&&r<=this.Bs}}},{key:"intersects",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t.Es>this.Cs||t.Cs<this.Es||t.Qs>this.Bs||t.Bs<this.Qs)}if(arguments[0]instanceof T){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(2===arguments.length){if(arguments[0]instanceof T&&arguments[1]instanceof T){var i=arguments[0],r=arguments[1];return!(this.isNull()||(i.x<r.x?i.x:r.x)>this.Cs||(i.x>r.x?i.x:r.x)<this.Es||(i.y<r.y?i.y:r.y)>this.Bs||(i.y>r.y?i.y:r.y)<this.Qs)}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return!this.isNull()&&!(o>this.Cs||o<this.Es||s>this.Bs||s<this.Qs)}}}},{key:"getMinY",value:function(){return this.Qs}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return Math.sqrt(t*t+e*e)}},{key:"getMinX",value:function(){return this.Es}},{key:"expandToInclude",value:function(){if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this.Es=n.getMinX(),this.Cs=n.getMaxX(),this.Qs=n.getMinY(),this.Bs=n.getMaxY()):(n.Es<this.Es&&(this.Es=n.Es),n.Cs>this.Cs&&(this.Cs=n.Cs),n.Qs<this.Qs&&(this.Qs=n.Qs),n.Bs>this.Bs&&(this.Bs=n.Bs))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this.Es=i,this.Cs=i,this.Qs=r,this.Bs=r):(i<this.Es&&(this.Es=i),i>this.Cs&&(this.Cs=i),r<this.Qs&&(this.Qs=r),r>this.Bs&&(this.Bs=r))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e}},{key:"getWidth",value:function(){return this.isNull()?0:this.Cs-this.Es}},{key:"compareTo",value:function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this.Es<e.Es?-1:this.Es>e.Es?1:this.Qs<e.Qs?-1:this.Qs>e.Qs?1:this.Cs<e.Cs?-1:this.Cs>e.Cs?1:this.Bs<e.Bs?-1:this.Bs>e.Bs?1:0}},{key:"translate",value:function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"Env["+this.Es+" : "+this.Cs+", "+this.Qs+" : "+this.Bs+"]"}},{key:"setToNull",value:function(){this.Es=0,this.Cs=-1,this.Qs=0,this.Bs=-1}},{key:"disjoint",value:function(t){return!(!this.isNull()&&!t.isNull())||t.Es>this.Cs||t.Cs<this.Es||t.Qs>this.Bs||t.Bs<this.Qs}},{key:"getHeight",value:function(){return this.isNull()?0:this.Bs-this.Qs}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e}},{key:"expandBy",value:function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this.Es-=e,this.Cs+=e,this.Qs-=n,this.Bs+=n,(this.Es>this.Cs||this.Qs>this.Bs)&&this.setToNull()}}},{key:"contains",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof T){var n=arguments[0];return this.covers(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}}},{key:"centre",value:function(){return this.isNull()?null:new T((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.Es=n.Es,this.Cs=n.Cs,this.Qs=n.Qs,this.Bs=n.Bs}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],A=arguments[3];o<s?(this.Es=o,this.Cs=s):(this.Es=s,this.Cs=o),a<A?(this.Qs=a,this.Bs=A):(this.Qs=A,this.Bs=a)}}},{key:"getMaxY",value:function(){return this.Bs}},{key:"distance",value:function(t){if(this.intersects(t))return 0;var e=0;this.Cs<t.Es?e=t.Es-this.Cs:this.Es>t.Cs&&(e=this.Es-t.Cs);var n=0;return this.Bs<t.Qs?n=t.Qs-this.Bs:this.Qs>t.Bs&&(n=this.Qs-t.Bs),0===e?n:0===n?e:Math.sqrt(e*e+n*n)}},{key:"hashCode",value:function(){var t=17;return 37*(t=37*(t=37*(t=37*t+T.hashCode(this.Es))+T.hashCode(this.Cs))+T.hashCode(this.Qs))+T.hashCode(this.Bs)}},{key:"interfaces_",get:function(){return[w,B]}}],[{key:"constructor_",value:function(){if(this.Es=null,this.Cs=null,this.Qs=null,this.Bs=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],A=arguments[3];this.init(o,s,a,A)}}},{key:"intersects",value:function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),A=Math.max(o.x,s.x),u=Math.min(i.x,r.x),h=Math.max(i.x,r.x);return!(u>A||h<a||(a=Math.min(o.y,s.y),A=Math.max(o.y,s.y),u=Math.min(i.y,r.y),h=Math.max(i.y,r.y),u>A||h<a))}}}]),e}(),O=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this.ks}},{key:"getGeometryN",value:function(t){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(t){return this===t||this.equalsExact(t,0)}},{key:"geometryChanged",value:function(){this.apply(e.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this.bs=null}},{key:"equalsNorm",value:function(t){return null!==t&&this.norm().equalsExact(t.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var t;if(1===arguments.length){var e=arguments[0];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return t=n,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(n,i)}}},{key:"getUserData",value:function(){return this._s}},{key:"getSRID",value:function(){return this.xs}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(t){if(t.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION)throw new p("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n}},{key:"norm",value:function(){var t=this.copy();return t.normalize(),t}},{key:"reverse",value:function(){var t=this.reverseInternal();return null!=this.envelope&&(t.envelope=this.envelope.copy()),t.setSRID(this.getSRID()),t}},{key:"copy",value:function(){var t=this.copyInternal();return t.envelope=null==this.bs?null:this.bs.copy(),t.xs=this.xs,t._s=this._s,t}},{key:"getPrecisionModel",value:function(){return this.ks.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return null===this.bs&&(this.bs=this.computeEnvelopeInternal()),new q(this.bs)}},{key:"setSRID",value:function(t){this.xs=t}},{key:"setUserData",value:function(t){this._s=t}},{key:"compare",value:function(t,e){for(var n=t.iterator(),i=e.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),o=i.next(),s=r.compareTo(o);if(0!==s)return s}return n.hasNext()?1:i.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(t){return this.getClass()===t.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===e.TYPECODE_MULTIPOINT||this.getTypeCode()===e.TYPECODE_MULTILINESTRING||this.getTypeCode()===e.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[C,w,B]}},{key:"getClass",value:function(){return e}}],[{key:"hasNonEmptyElements",value:function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1}}]),e}();O.constructor_=function(t){t&&(this.bs=null,this._s=null,this.ks=t,this.xs=t.getSRID())},O.TYPECODE_POINT=0,O.TYPECODE_MULTIPOINT=1,O.TYPECODE_LINESTRING=2,O.TYPECODE_LINEARRING=3,O.TYPECODE_MULTILINESTRING=4,O.TYPECODE_POLYGON=5,O.TYPECODE_MULTIPOLYGON=6,O.TYPECODE_GEOMETRYCOLLECTION=7,O.TYPENAME_POINT="Point",O.TYPENAME_MULTIPOINT="MultiPoint",O.TYPENAME_LINESTRING="LineString",O.TYPENAME_LINEARRING="LinearRing",O.TYPENAME_MULTILINESTRING="MultiLineString",O.TYPENAME_POLYGON="Polygon",O.TYPENAME_MULTIPOLYGON="MultiPolygon",O.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",O.geometryChangedFilter={get interfaces_(){return[y]},filter:function(t){t.geometryChangedAction()}};var H=function(){function e(){t(this,e)}return n(e,null,[{key:"toLocationSymbol",value:function(t){switch(t){case e.EXTERIOR:return"e";case e.BOUNDARY:return"b";case e.INTERIOR:return"i";case e.NONE:return"-"}throw new p("Unknown location value: "+t)}}]),e}();H.INTERIOR=0,H.BOUNDARY=1,H.EXTERIOR=2,H.NONE=-1;var z=function(){function e(){t(this,e)}return n(e,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),e}(),K=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({NoSuchElementException:r})[0],i}return r}(I),V=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({UnsupportedOperationException:r})[0],i}return r}(I),J=function(e){i(o,e);var r=h(o);function o(){return t(this,o),r.apply(this,arguments)}return n(o,[{key:"contains",value:function(){}}]),o}(z),Y=function(e,r){i(s,e);var o=h(s);function s(e){var n;return t(this,s),(n=o.call(this)).map=new Map,e instanceof z&&n.addAll(e),n}return n(s,[{key:"contains",value:function(t){var e=t.hashCode?t.hashCode():t;return!!this.map.has(e)}},{key:"add",value:function(t){var e=t.hashCode?t.hashCode():t;return!this.map.has(e)&&!!this.map.set(e,t)}},{key:"addAll",value:function(t){var e,n=g(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.add(i)}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new V}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return 0===this.map.size}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new j(this.map)}},{key:r,value:function(){return this.map}}]),s}(J,Symbol.iterator),j=function(){function e(n){t(this,e),this.iterator=n.values();var i=this.iterator.next(),r=i.done,o=i.value;this.done=r,this.value=o}return n(e,[{key:"next",value:function(){if(this.done)throw new K;var t=this.value,e=this.iterator.next(),n=e.done,i=e.value;return this.done=n,this.value=i,t}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new V}}]),e}(),W=function(){function e(){t(this,e)}return n(e,null,[{key:"opposite",value:function(t){return t===e.LEFT?e.RIGHT:t===e.RIGHT?e.LEFT:t}}]),e}();W.ON=0,W.LEFT=1,W.RIGHT=2;var X=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({EmptyStackException:r})[0],i}return r}(I),Z=function(e){i(r,e);var n=h(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).name=Object.keys({IndexOutOfBoundsException:r})[0],i}return r}(I),tt=function(e){i(o,e);var r=h(o);function o(){return t(this,o),r.apply(this,arguments)}return n(o,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),o}(z),et=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),(e=r.call(this)).array=[],e}return n(o,[{key:"add",value:function(t){return this.array.push(t),!0}},{key:"get",value:function(t){if(t<0||t>=this.size())throw new Z;return this.array[t]}},{key:"push",value:function(t){return this.array.push(t),t}},{key:"pop",value:function(){if(0===this.array.length)throw new X;return this.array.pop()}},{key:"peek",value:function(){if(0===this.array.length)throw new X;return this.array[this.array.length-1]}},{key:"empty",value:function(){return 0===this.array.length}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(t){return this.array.indexOf(t)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),o}(tt);function nt(t,e){return t.interfaces_&&t.interfaces_.indexOf(e)>-1}var it=function(){function e(n){t(this,e),this.str=n}return n(e,[{key:"append",value:function(t){this.str+=t}},{key:"setCharAt",value:function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}},{key:"toString",value:function(){return this.str}}]),e}(),rt=function(){function e(n){t(this,e),this.value=n}return n(e,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(t){return this.value<t?-1:this.value>t?1:0}}],[{key:"compare",value:function(t,e){return t<e?-1:t>e?1:0}},{key:"isNan",value:function(t){return Number.isNaN(t)}},{key:"valueOf",value:function(t){return new e(t)}}]),e}(),ot=function(){function e(){t(this,e)}return n(e,null,[{key:"isWhitespace",value:function(t){return t<=32&&t>=0||127===t}},{key:"toUpperCase",value:function(t){return t.toUpperCase()}}]),e}(),st=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"le",value:function(t){return this.Ds<t.Ds||this.Ds===t.Ds&&this.Ss<=t.Ss}},{key:"extractSignificantDigits",value:function(t,n){var i=this.abs(),r=e.magnitude(i.Ds),o=e.TEN.pow(r);(i=i.divide(o)).gt(e.TEN)?(i=i.divide(e.TEN),r+=1):i.lt(e.ONE)&&(i=i.multiply(e.TEN),r-=1);for(var s=r+1,a=new it,A=e.MAX_PRINT_DIGITS-1,u=0;u<=A;u++){t&&u===s&&a.append(".");var h=Math.trunc(i.Ds);if(h<0)break;var l=!1,c=0;h>9?(l=!0,c="9"):c="0"+h,a.append(c),i=i.subtract(e.valueOf(h)).multiply(e.TEN),l&&i.selfAdd(e.TEN);var f=!0,d=e.magnitude(i.Ds);if(d<0&&Math.abs(d)>=A-u&&(f=!1),!f)break}return n[0]=r,a.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this.Ds+this.Ss}},{key:"subtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var n=arguments[0];return this.add(-n)}}},{key:"equals",value:function(){if(1===arguments.length&&arguments[0]instanceof e){var t=arguments[0];return this.Ds===t.Ds&&this.Ss===t.Ss}}},{key:"isZero",value:function(){return 0===this.Ds&&0===this.Ss}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t.Ds,-t.Ss)}if("number"==typeof arguments[0]){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(t){return this.le(t)?this:t}},{key:"selfDivide",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfDivide(t.Ds,t.Ss)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfDivide(n,0)}}else if(2===arguments.length){var i,r,o,s,a=arguments[0],A=arguments[1],u=null,h=null,l=null,c=null;return o=this.Ds/a,c=(u=(l=e.SPLIT*o)-(u=l-o))*(h=(c=e.SPLIT*a)-(h=c-a))-(s=o*a)+u*(r=a-h)+(i=o-u)*h+i*r,c=o+(l=(this.Ds-s-c+this.Ss-o*A)/a),this.Ds=c,this.Ss=o-c+l,this}}},{key:"dump",value:function(){return"DD<"+this.Ds+", "+this.Ss+">"}},{key:"divide",value:function(){if(arguments[0]instanceof e){var t,n,i,r,o=arguments[0],s=null,a=null,A=null,u=null;return t=(i=this.Ds/o.Ds)-(s=(A=e.SPLIT*i)-(s=A-i)),u=s*(a=(u=e.SPLIT*o.Ds)-(a=u-o.Ds))-(r=i*o.Ds)+s*(n=o.Ds-a)+t*a+t*n,new e(u=i+(A=(this.Ds-r-u+this.Ss-i*o.Ss)/o.Ds),i-u+A)}if("number"==typeof arguments[0]){var h=arguments[0];return M.isNaN(h)?e.createNaN():e.copy(this).selfDivide(h,0)}}},{key:"ge",value:function(t){return this.Ds>t.Ds||this.Ds===t.Ds&&this.Ss>=t.Ss}},{key:"pow",value:function(t){if(0===t)return e.valueOf(1);var n=new e(this),i=e.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(n),(r/=2)>0&&(n=n.sqr());else i=n;return t<0?i.reciprocal():i}},{key:"ceil",value:function(){if(this.isNaN())return e.NaN;var t=Math.ceil(this.Ds),n=0;return t===this.Ds&&(n=Math.ceil(this.Ss)),new e(t,n)}},{key:"compareTo",value:function(t){var e=t;return this.Ds<e.Ds?-1:this.Ds>e.Ds?1:this.Ss<e.Ss?-1:this.Ss>e.Ss?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var n=arguments[0];return this.init(n),this}}},{key:"max",value:function(t){return this.ge(t)?this:t}},{key:"sqrt",value:function(){if(this.isZero())return e.valueOf(0);if(this.isNegative())return e.NaN;var t=1/Math.sqrt(this.Ds),n=this.Ds*t,i=e.valueOf(n),r=.5*this.subtract(i.sqr()).Ds*t;return i.add(r)}},{key:"selfAdd",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfAdd(t.Ds,t.Ss)}if("number"==typeof arguments[0]){var n,i,r,o,s,a=arguments[0],A=null;return A=(r=this.Ds+a)-(o=r-this.Ds),i=(s=(A=a-o+(this.Ds-A))+this.Ss)+(r-(n=r+s)),this.Ds=n+i,this.Ss=i+(n-this.Ds),this}}else if(2===arguments.length){var u,h,l,c,f=arguments[0],d=arguments[1],g=null,v=null,I=null;l=this.Ds+f,h=this.Ss+d,v=l-(I=l-this.Ds),g=h-(c=h-this.Ss);var p=(u=l+(I=(v=f-I+(this.Ds-v))+h))+(I=(g=d-c+(this.Ss-g))+(I+(l-u))),y=I+(u-p);return this.Ds=p,this.Ss=y,this}}},{key:"selfMultiply",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfMultiply(t.Ds,t.Ss)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfMultiply(n,0)}}else if(2===arguments.length){var i,r,o=arguments[0],s=arguments[1],a=null,A=null,u=null,h=null;a=(u=e.SPLIT*this.Ds)-this.Ds,h=e.SPLIT*o,a=u-a,i=this.Ds-a,A=h-o;var l=(u=this.Ds*o)+(h=a*(A=h-A)-u+a*(r=o-A)+i*A+i*r+this.Ds*s+this.Ss*o),c=h+(a=u-l);return this.Ds=l,this.Ss=c,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return e.NaN;var t=Math.floor(this.Ds),n=0;return t===this.Ds&&(n=Math.floor(this.Ss)),new e(t,n)}},{key:"negate",value:function(){return this.isNaN()?this:new e(-this.Ds,-this.Ss)}},{key:"clone",value:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}}},{key:"multiply",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return t.isNaN()?e.createNaN():e.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var n=arguments[0];return M.isNaN(n)?e.createNaN():e.copy(this).selfMultiply(n,0)}}},{key:"isNaN",value:function(){return M.isNaN(this.Ds)}},{key:"intValue",value:function(){return Math.trunc(this.Ds)}},{key:"toString",value:function(){var t=e.magnitude(this.Ds);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!0,n),r=n[0]+1,o=i;if("."===i.charAt(0))o="0"+i;else if(r<0)o="0."+e.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var s=r-i.length;o=i+e.stringOfChar("0",s)+".0"}return this.isNegative()?"-"+o:o}},{key:"reciprocal",value:function(){var t,n,i,r,o=null,s=null,a=null,A=null;t=(i=1/this.Ds)-(o=(a=e.SPLIT*i)-(o=a-i)),s=(A=e.SPLIT*this.Ds)-this.Ds;var u=i+(a=(1-(r=i*this.Ds)-(A=o*(s=A-s)-r+o*(n=this.Ds-s)+t*s+t*n)-i*this.Ss)/this.Ds);return new e(u,i-u+a)}},{key:"toSciNotation",value:function(){if(this.isZero())return e.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!1,n),r=e.SCI_NOT_EXPONENT_CHAR+n[0];if("0"===i.charAt(0))throw new IllegalStateException("Found leading zero: "+i);var o="";i.length>1&&(o=i.substring(1));var s=i.charAt(0)+"."+o;return this.isNegative()?"-"+s+r:s+r}},{key:"abs",value:function(){return this.isNaN()?e.NaN:this.isNegative()?this.negate():new e(this)}},{key:"isPositive",value:function(){return this.Ds>0||0===this.Ds&&this.Ss>0}},{key:"lt",value:function(t){return this.Ds<t.Ds||this.Ds===t.Ds&&this.Ss<t.Ss}},{key:"add",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return e.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var n=arguments[0];return e.copy(this).selfAdd(n)}}},{key:"init",value:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.Ds=t,this.Ss=0}else if(arguments[0]instanceof e){var n=arguments[0];this.Ds=n.Ds,this.Ss=n.Ss}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.Ds=i,this.Ss=r}}},{key:"gt",value:function(t){return this.Ds>t.Ds||this.Ds===t.Ds&&this.Ss>t.Ss}},{key:"isNegative",value:function(){return this.Ds<0||0===this.Ds&&this.Ss<0}},{key:"trunc",value:function(){return this.isNaN()?e.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this.Ds>0?1:this.Ds<0?-1:this.Ss>0?1:this.Ss<0?-1:0}},{key:"interfaces_",get:function(){return[B,w,C]}}],[{key:"constructor_",value:function(){if(this.Ds=0,this.Ss=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];e.constructor_.call(this,e.parse(i))}}else if(2===arguments.length){var r=arguments[0],o=arguments[1];this.init(r,o)}}},{key:"determinant",value:function(){if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];return e.determinant(e.valueOf(t),e.valueOf(n),e.valueOf(i),e.valueOf(r))}if(arguments[3]instanceof e&&arguments[2]instanceof e&&arguments[0]instanceof e&&arguments[1]instanceof e){var o=arguments[1],s=arguments[2],a=arguments[3];return arguments[0].multiply(a).selfSubtract(o.multiply(s))}}},{key:"sqr",value:function(t){return e.valueOf(t).selfMultiply(t)}},{key:"valueOf",value:function(){if("string"==typeof arguments[0]){var t=arguments[0];return e.parse(t)}if("number"==typeof arguments[0])return new e(arguments[0])}},{key:"sqrt",value:function(t){return e.valueOf(t).sqrt()}},{key:"parse",value:function(t){for(var n=0,i=t.length;ot.isWhitespace(t.charAt(n));)n++;var r=!1;if(n<i){var o=t.charAt(n);"-"!==o&&"+"!==o||(n++,"-"===o&&(r=!0))}for(var s=new e,a=0,A=0,u=0,h=!1;!(n>=i);){var l=t.charAt(n);if(n++,ot.isDigit(l)){var c=l-"0";s.selfMultiply(e.TEN),s.selfAdd(c),a++}else{if("."!==l){if("e"===l||"E"===l){var f=t.substring(n);try{u=rt.parseInt(f)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+f+" in string "+t):e}break}throw new NumberFormatException("Unexpected character '"+l+"' at position "+n+" in string "+t)}A=a,h=!0}}var d=s;h||(A=a);var g=a-A-u;if(0===g)d=s;else if(g>0){var v=e.TEN.pow(g);d=s.divide(v)}else if(g<0){var I=e.TEN.pow(-g);d=s.multiply(I)}return r?d.negate():d}},{key:"createNaN",value:function(){return new e(M.NaN,M.NaN)}},{key:"copy",value:function(t){return new e(t)}},{key:"magnitude",value:function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=e&&(i+=1),i}},{key:"stringOfChar",value:function(t,e){for(var n=new it,i=0;i<e;i++)n.append(t);return n.toString()}}]),e}();st.PI=new st(3.141592653589793,12246467991473532e-32),st.TWO_PI=new st(6.283185307179586,24492935982947064e-32),st.PI_2=new st(1.5707963267948966,6123233995736766e-32),st.E=new st(2.718281828459045,14456468917292502e-32),st.NaN=new st(M.NaN,M.NaN),st.EPS=123259516440783e-46,st.SPLIT=134217729,st.MAX_PRINT_DIGITS=32,st.TEN=st.valueOf(10),st.ONE=st.valueOf(1),st.SCI_NOT_EXPONENT_CHAR="E",st.SCI_NOT_ZERO="0.0E0";var at=function(){function e(){t(this,e)}return n(e,null,[{key:"orientationIndex",value:function(t,n,i){var r=e.orientationIndexFilter(t,n,i);if(r<=1)return r;var o=st.valueOf(n.x).selfAdd(-t.x),s=st.valueOf(n.y).selfAdd(-t.y),a=st.valueOf(i.x).selfAdd(-n.x),A=st.valueOf(i.y).selfAdd(-n.y);return o.selfMultiply(A).selfSubtract(s.selfMultiply(a)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof st&&arguments[2]instanceof st&&arguments[0]instanceof st&&arguments[1]instanceof st){var t=arguments[1],e=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(t.multiply(e)).signum()}if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=st.valueOf(i),A=st.valueOf(r),u=st.valueOf(o),h=st.valueOf(s);return a.multiply(h).selfSubtract(A.multiply(u)).signum()}}},{key:"intersection",value:function(t,e,n,i){var r=new st(t.y).selfSubtract(e.y),o=new st(e.x).selfSubtract(t.x),s=new st(t.x).selfMultiply(e.y).selfSubtract(new st(e.x).selfMultiply(t.y)),a=new st(n.y).selfSubtract(i.y),A=new st(i.x).selfSubtract(n.x),u=new st(n.x).selfMultiply(i.y).selfSubtract(new st(i.x).selfMultiply(n.y)),h=o.multiply(u).selfSubtract(A.multiply(s)),l=a.multiply(s).selfSubtract(r.multiply(u)),c=r.multiply(A).selfSubtract(a.multiply(o)),f=h.selfDivide(c).doubleValue(),d=l.selfDivide(c).doubleValue();return M.isNaN(f)||M.isInfinite(f)||M.isNaN(d)||M.isInfinite(d)?null:new T(f,d)}},{key:"orientationIndexFilter",value:function(t,n,i){var r=null,o=(t.x-i.x)*(n.y-i.y),s=(t.y-i.y)*(n.x-i.x),a=o-s;if(o>0){if(s<=0)return e.signum(a);r=o+s}else{if(!(o<0))return e.signum(a);if(s>=0)return e.signum(a);r=-o-s}var A=e.DP_SAFE_EPSILON*r;return a>=A||-a>=A?e.signum(a):2}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}}]),e}();at.DP_SAFE_EPSILON=1e-15;var At=function(){function e(){t(this,e)}return n(e,[{key:"getM",value:function(t){if(this.hasM()){var e=this.getDimension()-this.getMeasures();return this.getOrdinate(t,e)}return M.NaN}},{key:"setOrdinate",value:function(t,e,n){}},{key:"getZ",value:function(t){return this.hasZ()?this.getOrdinate(t,2):M.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(t,e){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(t){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(t){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(t){}},{key:"copy",value:function(){}},{key:"getY",value:function(t){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[C]}}]),e}();At.X=0,At.Y=1,At.Z=2,At.M=3;var ut=function(){function e(){t(this,e)}return n(e,null,[{key:"index",value:function(t,e,n){return at.orientationIndex(t,e,n)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var t=arguments[0],n=t.length-1;if(n<3)throw new p("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],r=0,o=1;o<=n;o++){var s=t[o];s.y>i.y&&(i=s,r=o)}var a=r;do{(a-=1)<0&&(a=n)}while(t[a].equals2D(i)&&a!==r);var A=r;do{A=(A+1)%n}while(t[A].equals2D(i)&&A!==r);var u=t[a],h=t[A];if(u.equals2D(i)||h.equals2D(i)||u.equals2D(h))return!1;var l=e.index(u,i,h);return 0===l?u.x>h.x:l>0}if(nt(arguments[0],At)){var c=arguments[0],f=c.size()-1;if(f<3)throw new p("Ring has fewer than 4 points, so orientation cannot be determined");for(var d=c.getCoordinate(0),g=0,v=1;v<=f;v++){var I=c.getCoordinate(v);I.y>d.y&&(d=I,g=v)}var y=null,w=g;do{(w-=1)<0&&(w=f),y=c.getCoordinate(w)}while(y.equals2D(d)&&w!==g);var C=null,B=g;do{B=(B+1)%f,C=c.getCoordinate(B)}while(C.equals2D(d)&&B!==g);if(y.equals2D(d)||C.equals2D(d)||y.equals2D(C))return!1;var E=e.index(y,d,C);return 0===E?y.x>C.x:E>0}}}]),e}();ut.CLOCKWISE=-1,ut.RIGHT=ut.CLOCKWISE,ut.COUNTERCLOCKWISE=1,ut.LEFT=ut.COUNTERCLOCKWISE,ut.COLLINEAR=0,ut.STRAIGHT=ut.COLLINEAR;var ht=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getCoordinate",value:function(){return this.Ms}},{key:"getRightmostSide",value:function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this.Ms=null,this.checkForRightmostCoordinate(t)),n}},{key:"findRightmostEdgeAtVertex",value:function(){var t=this.$s.getEdge().getCoordinates();G.isTrue(this.Rs>0&&this.Rs<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this.Rs-1],n=t[this.Rs+1],i=ut.index(this.Ms,n,e),r=!1;(e.y<this.Ms.y&&n.y<this.Ms.y&&i===ut.COUNTERCLOCKWISE||e.y>this.Ms.y&&n.y>this.Ms.y&&i===ut.CLOCKWISE)&&(r=!0),r&&(this.Rs=this.Rs-1)}},{key:"getRightmostSideOfSegment",value:function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var i=W.LEFT;return n[e].y<n[e+1].y&&(i=W.RIGHT),i}},{key:"getEdge",value:function(){return this.Fs}},{key:"checkForRightmostCoordinate",value:function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this.Ms||e[n].x>this.Ms.x)&&(this.$s=t,this.Rs=n,this.Ms=e[n])}},{key:"findRightmostEdgeAtNode",value:function(){var t=this.$s.getNode().getEdges();this.$s=t.getRightmostEdge(),this.$s.isForward()||(this.$s=this.$s.getSym(),this.Rs=this.$s.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}G.isTrue(0!==this.Rs||this.Ms.equals(this.$s.getCoordinate()),"inconsistency in rightmost processing"),0===this.Rs?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.Fs=this.$s,this.getRightmostSide(this.$s,this.Rs)===W.LEFT&&(this.Fs=this.$s.getSym())}}],[{key:"constructor_",value:function(){this.Rs=-1,this.Ms=null,this.$s=null,this.Fs=null}}]),e}(),lt=function(e){i(o,e);var r=h(o);function o(e,n){var i;return t(this,o),(i=r.call(this,n?e+" [ "+n+" ]":e)).pt=n?new T(n):void 0,i.name=Object.keys({TopologyException:o})[0],i}return n(o,[{key:"getCoordinate",value:function(){return this.pt}}]),o}(R),ct=function(){function e(){t(this,e),this.array=[]}return n(e,[{key:"addLast",value:function(t){this.array.push(t)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return 0===this.array.length}}]),e}(),ft=function(e,r){i(s,e);var o=h(s);function s(e){var n;return t(this,s),(n=o.call(this)).array=[],e instanceof z&&n.addAll(e),n}return n(s,[{key:"interfaces_",get:function(){return[tt,z]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(t){return 1===arguments.length?this.array.push(t):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(t){var e,n=g(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.array.push(i)}}catch(t){n.e(t)}finally{n.f()}}},{key:"set",value:function(t,e){var n=this.array[t];return this.array[t]=e,n}},{key:"iterator",value:function(){return new dt(this)}},{key:"get",value:function(t){if(t<0||t>=this.size())throw new Z;return this.array[t]}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"sort",value:function(t){t?this.array.sort((function(e,n){return t.compare(e,n)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(t){for(var e=0,n=this.array.length;e<n;e++)if(this.array[e]===t)return!!this.array.splice(e,1);return!1}},{key:r,value:function(){return this.array.values()}}]),s}(tt,Symbol.iterator),dt=function(){function e(n){t(this,e),this.arrayList=n,this.position=0}return n(e,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new K;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(t){return this.arrayList.set(this.position-1,t)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),e}(),gt=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"clearVisitedEdges",value:function(){for(var t=this.Gs.iterator();t.hasNext();)t.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this.Ls}},{key:"computeNodeDepth",value:function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){e=i;break}}if(null===e)throw new lt("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var r=t.getEdges().iterator();r.hasNext();){var o=r.next();o.setVisited(!0),this.copySymDepths(o)}}},{key:"computeDepth",value:function(t){this.clearVisitedEdges();var e=this.Ns.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(W.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)}},{key:"create",value:function(t){this.addReachable(t),this.Ns.findEdge(this.Gs),this.Ls=this.Ns.getCoordinate()}},{key:"findResultEdges",value:function(){for(var t=this.Gs.iterator();t.hasNext();){var e=t.next();e.getDepth(W.RIGHT)>=1&&e.getDepth(W.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}}},{key:"computeDepths",value:function(t){var e=new Y,n=new ct,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(n.addLast(a),e.add(a))}}}}},{key:"compareTo",value:function(t){var e=t;return this.Ls.x<e.Ls.x?-1:this.Ls.x>e.Ls.x?1:0}},{key:"getEnvelope",value:function(){if(null===this.Us){for(var t=new q,e=this.Gs.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)t.expandToInclude(n[i]);this.Us=t}return this.Us}},{key:"addReachable",value:function(t){var e=new et;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}}},{key:"copySymDepths",value:function(t){var e=t.getSym();e.setDepth(W.LEFT,t.getDepth(W.RIGHT)),e.setDepth(W.RIGHT,t.getDepth(W.LEFT))}},{key:"add",value:function(t,e){t.setVisited(!0),this.Ts.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();this.Gs.add(i);var r=i.getSym().getNode();r.isVisited()||e.push(r)}}},{key:"getNodes",value:function(){return this.Ts}},{key:"getDirectedEdges",value:function(){return this.Gs}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.Ns=null,this.Gs=new ft,this.Ts=new ft,this.Ls=null,this.Us=null,this.Ns=new ht}}]),e}(),vt=function(){function e(){t(this,e)}return n(e,null,[{key:"intersection",value:function(t,e,n,i){var r=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,a=t.y>e.y?t.y:e.y,A=n.x<i.x?n.x:i.x,u=n.y<i.y?n.y:i.y,h=n.x>i.x?n.x:i.x,l=n.y>i.y?n.y:i.y,c=((r>A?r:A)+(s<h?s:h))/2,f=((o>u?o:u)+(a<l?a:l))/2,d=t.x-c,g=t.y-f,v=e.x-c,I=e.y-f,p=n.x-c,y=n.y-f,w=i.x-c,C=i.y-f,B=g-I,E=v-d,m=d*I-v*g,Q=y-C,k=w-p,b=p*C-w*y,_=B*k-Q*E,x=(E*b-k*m)/_,D=(Q*m-B*b)/_;return M.isNaN(x)||M.isInfinite(x)||M.isNaN(D)||M.isInfinite(D)?null:new T(x+c,D+f)}}]),e}(),It=function(){function e(){t(this,e)}return n(e,null,[{key:"arraycopy",value:function(t,e,n,i,r){for(var o=0,s=e;s<e+r;s++)n[i+o]=t[s],o++}},{key:"getProperty",value:function(t){return{"line.separator":"\n"}[t]}}]),e}(),pt=function(){function e(){t(this,e)}return n(e,null,[{key:"log10",value:function(t){var n=Math.log(t);return M.isInfinite(n)||M.isNaN(n)?n:n/e.LOG_10}},{key:"min",value:function(t,e,n,i){var r=t;return e<r&&(r=e),n<r&&(r=n),i<r&&(r=i),r}},{key:"clamp",value:function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],o=arguments[2];return i<r?r:i>o?o:i}}},{key:"wrap",value:function(t,e){return t<0?e- -t%e:t%e}},{key:"max",value:function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[0];return t>n&&(n=t),e>n&&(n=e),n}if(4===arguments.length){var i=arguments[1],r=arguments[2],o=arguments[3],s=arguments[0];return i>s&&(s=i),r>s&&(s=r),o>s&&(s=o),s}}},{key:"average",value:function(t,e){return(t+e)/2}}]),e}();pt.LOG_10=Math.log(10);var yt=function(){function e(){t(this,e)}return n(e,null,[{key:"segmentToSegment",value:function(t,n,i,r){if(t.equals(n))return e.pointToSegment(t,i,r);if(i.equals(r))return e.pointToSegment(r,t,n);var o=!1;if(q.intersects(t,n,i,r)){var s=(n.x-t.x)*(r.y-i.y)-(n.y-t.y)*(r.x-i.x);if(0===s)o=!0;else{var a=(t.y-i.y)*(r.x-i.x)-(t.x-i.x)*(r.y-i.y),A=((t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y))/s,u=a/s;(u<0||u>1||A<0||A>1)&&(o=!0)}}else o=!0;return o?pt.min(e.pointToSegment(t,i,r),e.pointToSegment(n,i,r),e.pointToSegment(i,t,n),e.pointToSegment(r,t,n)):0}},{key:"pointToSegment",value:function(t,e,n){if(e.x===n.x&&e.y===n.y)return t.distance(e);var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;if(r<=0)return t.distance(e);if(r>=1)return t.distance(n);var o=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(o)*Math.sqrt(i)}},{key:"pointToLinePerpendicular",value:function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(r)*Math.sqrt(i)}},{key:"pointToSegmentString",value:function(t,n){if(0===n.length)throw new p("Line array must contain at least one vertex");for(var i=t.distance(n[0]),r=0;r<n.length-1;r++){var o=e.pointToSegment(t,n[r],n[r+1]);o<i&&(i=o)}return i}}]),e}(),wt=function(){function e(){t(this,e)}return n(e,[{key:"create",value:function(){if(1===arguments.length)arguments[0]instanceof Array||nt(arguments[0],At);else if(2===arguments.length);else if(3===arguments.length){var t=arguments[0],e=arguments[1];return this.create(t,e)}}}]),e}(),Ct=function(){function e(){t(this,e)}return n(e,[{key:"filter",value:function(t){}}]),e}(),Bt=function(){function e(){t(this,e)}return n(e,null,[{key:"ofLine",value:function(t){var e=t.size();if(e<=1)return 0;var n=0,i=new T;t.getCoordinate(0,i);for(var r=i.x,o=i.y,s=1;s<e;s++){t.getCoordinate(s,i);var a=i.x,A=i.y,u=a-r,h=A-o;n+=Math.sqrt(u*u+h*h),r=a,o=A}return n}}]),e}(),Et=function e(){t(this,e)},mt=function(){function e(){t(this,e)}return n(e,null,[{key:"copyCoord",value:function(t,e,n,i){for(var r=Math.min(t.getDimension(),n.getDimension()),o=0;o<r;o++)n.setOrdinate(i,o,t.getOrdinate(e,o))}},{key:"isRing",value:function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,At.X)===t.getOrdinate(e-1,At.X)&&t.getOrdinate(0,At.Y)===t.getOrdinate(e-1,At.Y)}},{key:"scroll",value:function(){if(2===arguments.length){if(nt(arguments[0],At)&&Number.isInteger(arguments[1])){var t=arguments[0],n=arguments[1];e.scroll(t,n,e.isRing(t))}else if(nt(arguments[0],At)&&arguments[1]instanceof T){var i=arguments[0],r=arguments[1],o=e.indexOf(r,i);if(o<=0)return null;e.scroll(i,o)}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],A=arguments[2];if(a<=0)return null;for(var u=s.copy(),h=A?s.size()-1:s.size(),l=0;l<h;l++)for(var c=0;c<s.getDimension();c++)s.setOrdinate(l,c,u.getOrdinate((a+l)%h,c));if(A)for(var f=0;f<s.getDimension();f++)s.setOrdinate(h,f,s.getOrdinate(0,f))}}},{key:"isEqual",value:function(t,e){var n=t.size();if(n!==e.size())return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),r=0;r<n;r++)for(var o=0;o<i;o++){var s=t.getOrdinate(r,o),a=e.getOrdinate(r,o);if(!(t.getOrdinate(r,o)===e.getOrdinate(r,o)||M.isNaN(s)&&M.isNaN(a)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(1===arguments.length){var t=arguments[0];return e.minCoordinateIndex(t,0,t.size()-1)}if(3===arguments.length){for(var n=arguments[0],i=arguments[2],r=-1,o=null,s=arguments[1];s<=i;s++){var a=n.getCoordinate(s);(null===o||o.compareTo(a)>0)&&(o=a,r=s)}return r}}},{key:"extend",value:function(t,n,i){var r=t.create(i,n.getDimension()),o=n.size();if(e.copy(n,0,r,0,o),o>0)for(var s=o;s<i;s++)e.copy(n,o-1,r,s,1);return r}},{key:"reverse",value:function(t){for(var n=t.size()-1,i=Math.trunc(n/2),r=0;r<=i;r++)e.swap(t,r,n-r)}},{key:"swap",value:function(t,e,n){if(e===n)return null;for(var i=0;i<t.getDimension();i++){var r=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,r)}}},{key:"copy",value:function(t,n,i,r,o){for(var s=0;s<o;s++)e.copyCoord(t,n+s,i,r+s)}},{key:"ensureValidRing",value:function(t,n){var i=n.size();return 0===i?n:i<=3?e.createClosedRing(t,n,4):n.getOrdinate(0,At.X)===n.getOrdinate(i-1,At.X)&&n.getOrdinate(0,At.Y)===n.getOrdinate(i-1,At.Y)?n:e.createClosedRing(t,n,i+1)}},{key:"indexOf",value:function(t,e){for(var n=0;n<e.size();n++)if(t.x===e.getOrdinate(n,At.X)&&t.y===e.getOrdinate(n,At.Y))return n;return-1}},{key:"createClosedRing",value:function(t,n,i){var r=t.create(i,n.getDimension()),o=n.size();e.copy(n,0,r,0,o);for(var s=o;s<i;s++)e.copy(n,0,r,s,1);return r}},{key:"minCoordinate",value:function(t){for(var e=null,n=0;n<t.size();n++){var i=t.getCoordinate(n);(null===e||e.compareTo(i)>0)&&(e=i)}return e}}]),e}(),Qt=function(){function e(){t(this,e)}return n(e,null,[{key:"toDimensionSymbol",value:function(t){switch(t){case e.FALSE:return e.SYM_FALSE;case e.TRUE:return e.SYM_TRUE;case e.DONTCARE:return e.SYM_DONTCARE;case e.P:return e.SYM_P;case e.L:return e.SYM_L;case e.A:return e.SYM_A}throw new p("Unknown dimension value: "+t)}},{key:"toDimensionValue",value:function(t){switch(ot.toUpperCase(t)){case e.SYM_FALSE:return e.FALSE;case e.SYM_TRUE:return e.TRUE;case e.SYM_DONTCARE:return e.DONTCARE;case e.SYM_P:return e.P;case e.SYM_L:return e.L;case e.SYM_A:return e.A}throw new p("Unknown dimension symbol: "+t)}}]),e}();Qt.P=0,Qt.L=1,Qt.A=2,Qt.FALSE=-1,Qt.TRUE=-2,Qt.DONTCARE=-3,Qt.SYM_FALSE="F",Qt.SYM_TRUE="T",Qt.SYM_DONTCARE="*",Qt.SYM_P="0",Qt.SYM_L="1",Qt.SYM_A="2";var kt=function(){function e(){t(this,e)}return n(e,[{key:"filter",value:function(t){}}]),e}(),bt=function(){function e(){t(this,e)}return n(e,[{key:"filter",value:function(t,e){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),e}(),_t=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new q:this.Jn.expandEnvelope(new q)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this.Jn.toCoordinateArray()}},{key:"copyInternal",value:function(){return new s(this.Jn.copy(),this.ks)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.Jn.size()!==n.Jn.size())return!1;for(var i=0;i<this.Jn.size();i++)if(!this.equal(this.Jn.getCoordinate(i),n.Jn.getCoordinate(i),e))return!1;return!0}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var t=0;t<Math.trunc(this.Jn.size()/2);t++){var e=this.Jn.size()-1-t;if(!this.Jn.getCoordinate(t).equals(this.Jn.getCoordinate(e))){if(this.Jn.getCoordinate(t).compareTo(this.Jn.getCoordinate(e))>0){var n=this.Jn.copy();mt.reverse(n),this.Jn=n}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this.Jn.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Qt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var t=this.Jn.copy();return mt.reverse(t),this.getFactory().createLineString(t)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return O.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Bt.ofLine(this.Jn)}},{key:"getNumPoints",value:function(){return this.Jn.size()}},{key:"compareToSameClass",value:function(){if(1===arguments.length){for(var t=arguments[0],e=0,n=0;e<this.Jn.size()&&n<t.Jn.size();){var i=this.Jn.getCoordinate(e).compareTo(t.Jn.getCoordinate(n));if(0!==i)return i;e++,n++}return e<this.Jn.size()?1:n<t.Jn.size()?-1:0}if(2===arguments.length){var r=arguments[0];return arguments[1].compare(this.Jn,r.Jn)}}},{key:"apply",value:function(){if(nt(arguments[0],Ct))for(var t=arguments[0],e=0;e<this.Jn.size();e++)t.filter(this.Jn.getCoordinate(e));else if(nt(arguments[0],bt)){var n=arguments[0];if(0===this.Jn.size())return null;for(var i=0;i<this.Jn.size()&&(n.filter(this.Jn,i),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else(nt(arguments[0],kt)||nt(arguments[0],y))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new V}},{key:"isEquivalentClass",value:function(t){return t instanceof s}},{key:"getCoordinateN",value:function(t){return this.Jn.getCoordinate(t)}},{key:"getGeometryType",value:function(){return O.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this.Jn}},{key:"isEmpty",value:function(){return 0===this.Jn.size()}},{key:"init",value:function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new p("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this.Jn=t}},{key:"isCoordinate",value:function(t){for(var e=0;e<this.Jn.size();e++)if(this.Jn.getCoordinate(e).equals(t))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(t){return this.getFactory().createPoint(this.Jn.getCoordinate(t))}},{key:"interfaces_",get:function(){return[Et]}}],[{key:"constructor_",value:function(){if(this.Jn=null,0===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];O.constructor_.call(this,e),this.init(t)}}}]),s}(O),xt=function e(){t(this,e)},Dt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new q;var t=new q;return t.expandToInclude(this.Ps.getX(0),this.Ps.getY(0)),t}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new s(this.Ps.copy(),this.ks)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return 0!==this.Ps.size()?this.Ps.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Qt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this.Ps.copy())}},{key:"getTypeCode",value:function(){return O.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this.Ps,e.Ps)}}},{key:"apply",value:function(){if(nt(arguments[0],Ct)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(nt(arguments[0],bt)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.Ps,0),e.isGeometryChanged()&&this.geometryChanged()}else(nt(arguments[0],kt)||nt(arguments[0],y))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return O.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this.Ps}},{key:"getY",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return 0===this.Ps.size()}},{key:"init",value:function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),G.isTrue(t.size()<=1),this.Ps=t}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[xt]}}],[{key:"constructor_",value:function(){this.Ps=null;var t=arguments[0],e=arguments[1];O.constructor_.call(this,e),this.init(t)}}]),s}(O),St=function(){function e(){t(this,e)}return n(e,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(e.ofRingSigned(t))}if(nt(arguments[0],At)){var n=arguments[0];return Math.abs(e.ofRingSigned(n))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++){var r=t[i].x-n,o=t[i+1].y;e+=r*(t[i-1].y-o)}return e/2}if(nt(arguments[0],At)){var s=arguments[0],a=s.size();if(a<3)return 0;var A=new T,u=new T,h=new T;s.getCoordinate(0,u),s.getCoordinate(1,h);var l=u.x;h.x-=l;for(var c=0,f=1;f<a-1;f++)A.y=u.y,u.x=h.x,u.y=h.y,s.getCoordinate(f+1,h),h.x-=l,c+=u.x*(A.y-h.y);return c/2}}}]),e}(),Mt=function(){function e(){t(this,e)}return n(e,null,[{key:"sort",value:function(){var t=arguments,e=arguments[0];if(1===arguments.length)e.sort((function(t,e){return t.compareTo(e)}));else if(2===arguments.length)e.sort((function(e,n){return t[1].compare(e,n)}));else if(3===arguments.length){var n=e.slice(arguments[1],arguments[2]);n.sort();var i=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));e.splice(0,e.length);var r,o=g(i);try{for(o.s();!(r=o.n()).done;){var s=r.value;e.push(s)}}catch(t){o.e(t)}finally{o.f()}}else if(4===arguments.length){var a=e.slice(arguments[1],arguments[2]);a.sort((function(e,n){return t[3].compare(e,n)}));var A=e.slice(0,arguments[1]).concat(a,e.slice(arguments[2],e.length));e.splice(0,e.length);var u,h=g(A);try{for(h.s();!(u=h.n()).done;){var l=u.value;e.push(l)}}catch(t){h.e(t)}finally{h.f()}}}},{key:"asList",value:function(t){var e,n=new ft,i=g(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;n.add(r)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"copyOf",value:function(t,e){return t.slice(0,e)}}]),e}(),$t=function e(){t(this,e)},Rt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"computeEnvelopeInternal",value:function(){return this.qs.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this.qs.getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];for(var r=0;r<this.Os.length;r++)for(var o=this.Os[r].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t}},{key:"getArea",value:function(){var t=0;t+=St.ofRing(this.qs.getCoordinateSequence());for(var e=0;e<this.Os.length;e++)t-=St.ofRing(this.Os[e].getCoordinateSequence());return t}},{key:"copyInternal",value:function(){for(var t=this.qs.copy(),e=new Array(this.Os.length).fill(null),n=0;n<this.Os.length;n++)e[n]=this.Os[n].copy();return new s(t,e,this.ks)}},{key:"isRectangle",value:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.qs)return!1;if(5!==this.qs.getNumPoints())return!1;for(var t=this.qs.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var i=t.getX(n);if(i!==e.getMinX()&&i!==e.getMaxX())return!1;var r=t.getY(n);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var A=t.getX(a),u=t.getY(a);if(A!==o==(u!==s))return!1;o=A,s=u}return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t,i=this.qs,o=n.qs;if(!i.equalsExact(o,e))return!1;if(this.Os.length!==n.Os.length)return!1;for(var a=0;a<this.Os.length;a++)if(!this.Os[a].equalsExact(n.Os[a],e))return!1;return!0}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(0===arguments.length){this.qs=this.normalized(this.qs,!0);for(var t=0;t<this.Os.length;t++)this.Os[t]=this.normalized(this.Os[t],!1);Mt.sort(this.Os)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var i=e.getCoordinateSequence(),r=mt.minCoordinateIndex(i,0,i.size()-2);mt.scroll(i,r,!0),ut.isCCW(i)===n&&mt.reverse(i)}}},{key:"getCoordinate",value:function(){return this.qs.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this.Os.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var t=this.getExteriorRing().reverse(),e=new Array(this.getNumInteriorRing()).fill(null),n=0;n<e.length;n++)e[n]=this.getInteriorRingN(n).reverse();return this.getFactory().createPolygon(t,e)}},{key:"getTypeCode",value:function(){return O.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var t=0;t+=this.qs.getLength();for(var e=0;e<this.Os.length;e++)t+=this.Os[e].getLength();return t}},{key:"getNumPoints",value:function(){for(var t=this.qs.getNumPoints(),e=0;e<this.Os.length;e++)t+=this.Os[e].getNumPoints();return t}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(t,e){var n=t.copy();return this.normalize(n,e),n}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var t=arguments[0],e=this.qs,n=t.qs;return e.compareToSameClass(n)}if(2===arguments.length){var i=arguments[1],r=arguments[0],o=this.qs,s=r.qs,a=o.compareToSameClass(s,i);if(0!==a)return a;for(var A=this.getNumInteriorRing(),u=r.getNumInteriorRing(),h=0;h<A&&h<u;){var l=this.getInteriorRingN(h),c=r.getInteriorRingN(h),f=l.compareToSameClass(c,i);if(0!==f)return f;h++}return h<A?1:h<u?-1:0}}},{key:"apply",value:function(){if(nt(arguments[0],Ct)){var t=arguments[0];this.qs.apply(t);for(var e=0;e<this.Os.length;e++)this.Os[e].apply(t)}else if(nt(arguments[0],bt)){var n=arguments[0];if(this.qs.apply(n),!n.isDone())for(var i=0;i<this.Os.length&&(this.Os[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(nt(arguments[0],kt))arguments[0].filter(this);else if(nt(arguments[0],y)){var r=arguments[0];r.filter(this),this.qs.apply(r);for(var o=0;o<this.Os.length;o++)this.Os[o].apply(r)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this.Os.length+1).fill(null);t[0]=this.qs;for(var e=0;e<this.Os.length;e++)t[e+1]=this.Os[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)}},{key:"getGeometryType",value:function(){return O.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this.qs}},{key:"isEmpty",value:function(){return this.qs.isEmpty()}},{key:"getInteriorRingN",value:function(t){return this.Os[t]}},{key:"interfaces_",get:function(){return[$t]}}],[{key:"constructor_",value:function(){this.qs=null,this.Os=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(O.constructor_.call(this,n),null===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),O.hasNullElements(e))throw new p("holes must not contain null elements");if(t.isEmpty()&&O.hasNonEmptyElements(e))throw new p("shell is empty but holes are not");this.qs=t,this.Os=e}}]),s}(O),Ft=function(e){i(r,e);var n=h(r);function r(){return t(this,r),n.apply(this,arguments)}return r}(J),Gt=function(e){i(o,e);var r=h(o);function o(e){var n;return t(this,o),(n=r.call(this)).array=[],e instanceof z&&n.addAll(e),n}return n(o,[{key:"contains",value:function(t){var e,n=g(this.array);try{for(n.s();!(e=n.n()).done;)if(0===e.value.compareTo(t))return!0}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"add",value:function(t){if(this.contains(t))return!1;for(var e=0,n=this.array.length;e<n;e++)if(1===this.array[e].compareTo(t))return!!this.array.splice(e,0,t);return this.array.push(t),!0}},{key:"addAll",value:function(t){var e,n=g(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.add(i)}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new V}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Lt(this.array)}}]),o}(Ft),Lt=function(){function e(n){t(this,e),this.array=n,this.position=0}return n(e,[{key:"next",value:function(){if(this.position===this.array.length)throw new K;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new V}}]),e}(),Nt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"computeEnvelopeInternal",value:function(){for(var t=new q,e=0;e<this.Hs.length;e++)t.expandToInclude(this.Hs[e].getEnvelopeInternal());return t}},{key:"getGeometryN",value:function(t){return this.Hs[t]}},{key:"getCoordinates",value:function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this.Hs.length;n++)for(var i=this.Hs[n].getCoordinates(),r=0;r<i.length;r++)t[++e]=i[r];return t}},{key:"getArea",value:function(){for(var t=0,e=0;e<this.Hs.length;e++)t+=this.Hs[e].getArea();return t}},{key:"copyInternal",value:function(){for(var t=new Array(this.Hs.length).fill(null),e=0;e<t.length;e++)t[e]=this.Hs[e].copy();return new s(t,this.ks)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.Hs.length!==n.Hs.length)return!1;for(var i=0;i<this.Hs.length;i++)if(!this.Hs[i].equalsExact(n.Hs[i],e))return!1;return!0}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var t=0;t<this.Hs.length;t++)this.Hs[t].normalize();Mt.sort(this.Hs)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this.Hs[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var t=Qt.FALSE,e=0;e<this.Hs.length;e++)t=Math.max(t,this.Hs[e].getBoundaryDimension());return t}},{key:"reverseInternal",value:function(){for(var t=this.Hs.length,e=new ft(t),n=0;n<t;n++)e.add(this.Hs[n].reverse());return this.getFactory().buildGeometry(e)}},{key:"getTypeCode",value:function(){return O.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var t=Qt.FALSE,e=0;e<this.Hs.length;e++)t=Math.max(t,this.Hs[e].getDimension());return t}},{key:"getLength",value:function(){for(var t=0,e=0;e<this.Hs.length;e++)t+=this.Hs[e].getLength();return t}},{key:"getNumPoints",value:function(){for(var t=0,e=0;e<this.Hs.length;e++)t+=this.Hs[e].getNumPoints();return t}},{key:"getNumGeometries",value:function(){return this.Hs.length}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var t=arguments[0],e=new Gt(Mt.asList(this.Hs)),n=new Gt(Mt.asList(t.Hs));return this.compare(e,n)}if(2===arguments.length){for(var i=arguments[1],r=arguments[0],o=this.getNumGeometries(),s=r.getNumGeometries(),a=0;a<o&&a<s;){var A=this.getGeometryN(a),u=r.getGeometryN(a),h=A.compareToSameClass(u,i);if(0!==h)return h;a++}return a<o?1:a<s?-1:0}}},{key:"apply",value:function(){if(nt(arguments[0],Ct))for(var t=arguments[0],e=0;e<this.Hs.length;e++)this.Hs[e].apply(t);else if(nt(arguments[0],bt)){var n=arguments[0];if(0===this.Hs.length)return null;for(var i=0;i<this.Hs.length&&(this.Hs[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(nt(arguments[0],kt)){var r=arguments[0];r.filter(this);for(var o=0;o<this.Hs.length;o++)this.Hs[o].apply(r)}else if(nt(arguments[0],y)){var s=arguments[0];s.filter(this);for(var a=0;a<this.Hs.length;a++)this.Hs[a].apply(s)}}},{key:"getBoundary",value:function(){return O.checkNotGeometryCollection(this),G.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return O.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var t=0;t<this.Hs.length;t++)if(!this.Hs[t].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this.Hs=null,0===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];if(O.constructor_.call(this,e),null===t&&(t=[]),O.hasNullElements(t))throw new p("geometries must not contain null elements");this.Hs=t}}}]),s}(O),Ut=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"copyInternal",value:function(){for(var t=new Array(this.Hs.length).fill(null),e=0;e<t.length;e++)t[e]=this.Hs[e].copy();return new s(t,this.ks)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&l(r(s.prototype),"equalsExact",this).call(this,t,e)}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(1===arguments.length&&Number.isInteger(arguments[0])){var t=arguments[0];return this.Hs[t].getCoordinate()}return l(r(s.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Qt.FALSE}},{key:"getTypeCode",value:function(){return O.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return O.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[xt]}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];Nt.constructor_.call(this,t,e)}}]),s}(Nt),Tt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"copyInternal",value:function(){return new s(this.Jn.copy(),this.ks)}},{key:"getBoundaryDimension",value:function(){return Qt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||l(r(s.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var t=this.Jn.copy();return mt.reverse(t),this.getFactory().createLinearRing(t)}},{key:"getTypeCode",value:function(){return O.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!l(r(s.prototype),"isClosed",this).call(this))throw new p("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new p("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return O.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];_t.constructor_.call(this,t,e),this.validateConstruction()}}]),s}(_t);Tt.MINIMUM_VALID_SIZE=4;var Pt=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"setOrdinate",value:function(t,e){switch(t){case o.X:this.x=e;break;case o.Y:this.y=e;break;default:throw new p("Invalid ordinate index: "+t)}}},{key:"getZ",value:function(){return T.NULL_ORDINATE}},{key:"getOrdinate",value:function(t){switch(t){case o.X:return this.x;case o.Y:return this.y}throw new p("Invalid ordinate index: "+t)}},{key:"setZ",value:function(t){throw new p("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}}],[{key:"constructor_",value:function(){if(0===arguments.length)T.constructor_.call(this);else if(1===arguments.length){if(arguments[0]instanceof o){var t=arguments[0];T.constructor_.call(this,t.x,t.y)}else if(arguments[0]instanceof T){var e=arguments[0];T.constructor_.call(this,e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];T.constructor_.call(this,n,i,T.NULL_ORDINATE)}}}]),o}(T);Pt.X=0,Pt.Y=1,Pt.Z=-1,Pt.M=-1;var qt=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"getM",value:function(){return this.zs}},{key:"setOrdinate",value:function(t,e){switch(t){case o.X:this.x=e;break;case o.Y:this.y=e;break;case o.M:this.zs=e;break;default:throw new p("Invalid ordinate index: "+t)}}},{key:"setM",value:function(t){this.zs=t}},{key:"getZ",value:function(){return T.NULL_ORDINATE}},{key:"getOrdinate",value:function(t){switch(t){case o.X:return this.x;case o.Y:return this.y;case o.M:return this.zs}throw new p("Invalid ordinate index: "+t)}},{key:"setZ",value:function(t){throw new p("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this.zs=t.getM()}}],[{key:"constructor_",value:function(){if(this.zs=null,0===arguments.length)T.constructor_.call(this),this.zs=0;else if(1===arguments.length){if(arguments[0]instanceof o){var t=arguments[0];T.constructor_.call(this,t.x,t.y),this.zs=t.zs}else if(arguments[0]instanceof T){var e=arguments[0];T.constructor_.call(this,e.x,e.y),this.zs=this.getM()}}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];T.constructor_.call(this,n,i,T.NULL_ORDINATE),this.zs=r}}}]),o}(T);qt.X=0,qt.Y=1,qt.Z=-1,qt.M=2;var Ot=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"getM",value:function(){return this.zs}},{key:"setOrdinate",value:function(t,e){switch(t){case T.X:this.x=e;break;case T.Y:this.y=e;break;case T.Z:this.z=e;break;case T.M:this.zs=e;break;default:throw new p("Invalid ordinate index: "+t)}}},{key:"setM",value:function(t){this.zs=t}},{key:"getOrdinate",value:function(t){switch(t){case T.X:return this.x;case T.Y:return this.y;case T.Z:return this.getZ();case T.M:return this.getM()}throw new p("Invalid ordinate index: "+t)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this.zs=t.getM()}}],[{key:"constructor_",value:function(){if(this.zs=null,0===arguments.length)T.constructor_.call(this),this.zs=0;else if(1===arguments.length){if(arguments[0]instanceof o){var t=arguments[0];T.constructor_.call(this,t),this.zs=t.zs}else if(arguments[0]instanceof T){var e=arguments[0];T.constructor_.call(this,e),this.zs=this.getM()}}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3];T.constructor_.call(this,n,i,r),this.zs=s}}}]),o}(T),Ht=function(){function e(){t(this,e)}return n(e,null,[{key:"measures",value:function(t){return t instanceof Pt?0:t instanceof qt||t instanceof Ot?1:0}},{key:"dimension",value:function(t){return t instanceof Pt?2:t instanceof qt?3:t instanceof Ot?4:3}},{key:"create",value:function(){if(1===arguments.length){var t=arguments[0];return e.create(t,0)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return 2===n?new Pt:3===n&&0===i?new T:3===n&&1===i?new qt:4===n&&1===i?new Ot:new T}}}]),e}(),zt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"getCoordinate",value:function(t){return this.get(t)}},{key:"addAll",value:function(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&nt(arguments[0],z)){for(var t=arguments[1],e=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),t),e=!0;return e}return l(r(s.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var t=l(r(s.prototype),"clone",this).call(this),e=0;e<this.size();e++)t.add(e,this.get(e).clone());return t}},{key:"toCoordinateArray",value:function(){if(0===arguments.length)return this.toArray(s.coordArrayType);if(1===arguments.length){if(arguments[0])return this.toArray(s.coordArrayType);for(var t=this.size(),e=new Array(t).fill(null),n=0;n<t;n++)e[n]=this.get(t-n-1);return e}}},{key:"add",value:function(){if(1===arguments.length){var t=arguments[0];return l(r(s.prototype),"add",this).call(this,t)}if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var e=arguments[0],n=arguments[1];return this.add(e,n,!0),!0}if(arguments[0]instanceof T&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;l(r(s.prototype),"add",this).call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];return this.add(o,a),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var A=arguments[0],u=arguments[1];if(arguments[2])for(var h=0;h<A.length;h++)this.add(A[h],u);else for(var c=A.length-1;c>=0;c--)this.add(A[c],u);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof T){var f=arguments[0],d=arguments[1];if(!arguments[2]){var g=this.size();if(g>0){if(f>0&&this.get(f-1).equals2D(d))return null;if(f<g&&this.get(f).equals2D(d))return null}}l(r(s.prototype),"add",this).call(this,f,d)}}else if(4===arguments.length){var v=arguments[0],I=arguments[1],p=arguments[2],y=arguments[3],w=1;p>y&&(w=-1);for(var C=p;C!==y;C+=w)this.add(v[C],I);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var t=this.get(0).copy();this.add(t,!1)}}}],[{key:"constructor_",value:function(){if(0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.ensureCapacity(e.length),this.add(e,n)}}}]),s}(ft);zt.coordArrayType=new Array(0).fill(null);var Kt=function(){function e(){t(this,e)}return n(e,null,[{key:"isRing",value:function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))}},{key:"ptNotInList",value:function(t,n){for(var i=0;i<t.length;i++){var r=t[i];if(e.indexOf(r,n)<0)return r}return null}},{key:"scroll",value:function(t,n){var i=e.indexOf(n,t);if(i<0)return null;var r=new Array(t.length).fill(null);It.arraycopy(t,i,r,0,t.length-i),It.arraycopy(t,0,r,t.length-i,i),It.arraycopy(r,0,t,0,t.length)}},{key:"equals",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(0!==o.compare(i[s],r[s]))return!1;return!0}}},{key:"intersection",value:function(t,e){for(var n=new zt,i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()}},{key:"measures",value:function(t){if(null===t||0===t.length)return 0;var e,n=0,i=g(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;n=Math.max(n,Ht.measures(r))}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"hasRepeatedPoints",value:function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(t){return e.hasRepeatedPoints(t)?new zt(t,!1).toCoordinateArray():t}},{key:"reverse",value:function(t){for(var e=t.length-1,n=Math.trunc(e/2),i=0;i<=n;i++){var r=t[i];t[i]=t[e-i],t[e-i]=r}}},{key:"removeNull",value:function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var i=new Array(e).fill(null);if(0===e)return i;for(var r=0,o=0;o<t.length;o++)null!==t[o]&&(i[r++]=t[o]);return i}},{key:"copyDeep",value:function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=t[n].copy();return e}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],A=0;A<a;A++)o[s+A]=i[r+A].copy()}},{key:"isEqualReversed",value:function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[t.length-n-1];if(0!==i.compareTo(r))return!1}return!0}},{key:"envelope",value:function(t){for(var e=new q,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e}},{key:"toCoordinateArray",value:function(t){return t.toArray(e.coordArrayType)}},{key:"dimension",value:function(t){if(null===t||0===t.length)return 3;var e,n=0,i=g(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;n=Math.max(n,Ht.dimension(r))}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"atLeastNCoordinatesOrNothing",value:function(t,e){return e.length>=t?e:[]}},{key:"indexOf",value:function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1}},{key:"increasingDirection",value:function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,i=t[e].compareTo(t[n]);if(0!==i)return i}return 1}},{key:"compare",value:function(t,e){for(var n=0;n<t.length&&n<e.length;){var i=t[n].compareTo(e[n]);if(0!==i)return i;n++}return n<e.length?-1:n<t.length?1:0}},{key:"minCoordinate",value:function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e}},{key:"extract",value:function(t,e,n){e=pt.clamp(e,0,t.length);var i=(n=pt.clamp(n,-1,t.length))-e+1;n<0&&(i=0),e>=t.length&&(i=0),n<e&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var o=0,s=e;s<=n;s++)r[o++]=t[s];return r}}]),e}(),Vt=function(){function e(){t(this,e)}return n(e,[{key:"compare",value:function(t,e){var n=t,i=e;return Kt.compare(n,i)}},{key:"interfaces_",get:function(){return[$]}}]),e}(),Jt=function(){function e(){t(this,e)}return n(e,[{key:"compare",value:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=Kt.compare(n,i);return Kt.isEqualReversed(n,i)?0:r}},{key:"OLDcompare",value:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=Kt.increasingDirection(n),o=Kt.increasingDirection(i),s=r>0?0:n.length-1,a=o>0?0:n.length-1,A=0;A<n.length;A++){var u=n[s].compareTo(i[a]);if(0!==u)return u;s+=r,a+=o}return 0}},{key:"interfaces_",get:function(){return[$]}}]),e}();Kt.ForwardComparator=Vt,Kt.BidirectionalComparator=Jt,Kt.coordArrayType=new Array(0).fill(null);var Yt=function(){function e(n){t(this,e),this.str=n}return n(e,[{key:"append",value:function(t){this.str+=t}},{key:"setCharAt",value:function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}},{key:"toString",value:function(){return this.str}}]),e}(),jt=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getM",value:function(t){return this.hasM()?this.Ps[t].getM():M.NaN}},{key:"setOrdinate",value:function(t,e,n){switch(e){case At.X:this.Ps[t].x=n;break;case At.Y:this.Ps[t].y=n;break;default:this.Ps[t].setOrdinate(e,n)}}},{key:"getZ",value:function(t){return this.hasZ()?this.Ps[t].getZ():M.NaN}},{key:"size",value:function(){return this.Ps.length}},{key:"getOrdinate",value:function(t,e){switch(e){case At.X:return this.Ps[t].x;case At.Y:return this.Ps[t].y;default:return this.Ps[t].getOrdinate(e)}}},{key:"getCoordinate",value:function(){if(1===arguments.length){var t=arguments[0];return this.Ps[t]}if(2===arguments.length){var e=arguments[0];arguments[1].setCoordinate(this.Ps[e])}}},{key:"getCoordinateCopy",value:function(t){var e=this.createCoordinate();return e.setCoordinate(this.Ps[t]),e}},{key:"createCoordinate",value:function(){return Ht.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this.Ks}},{key:"getX",value:function(t){return this.Ps[t].x}},{key:"getMeasures",value:function(){return this.Vs}},{key:"expandEnvelope",value:function(t){for(var e=0;e<this.Ps.length;e++)t.expandToInclude(this.Ps[e]);return t}},{key:"copy",value:function(){for(var t=new Array(this.size()).fill(null),n=0;n<this.Ps.length;n++){var i=this.createCoordinate();i.setCoordinate(this.Ps[n]),t[n]=i}return new e(t,this.Ks,this.Vs)}},{key:"toString",value:function(){if(this.Ps.length>0){var t=new Yt(17*this.Ps.length);t.append("("),t.append(this.Ps[0]);for(var e=1;e<this.Ps.length;e++)t.append(", "),t.append(this.Ps[e]);return t.append(")"),t.toString()}return"()"}},{key:"getY",value:function(t){return this.Ps[t].y}},{key:"toCoordinateArray",value:function(){return this.Ps}},{key:"interfaces_",get:function(){return[At,B]}}],[{key:"constructor_",value:function(){if(this.Ks=3,this.Vs=0,this.Ps=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];e.constructor_.call(this,t,Kt.dimension(t),Kt.measures(t))}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.Ps=new Array(n).fill(null);for(var i=0;i<n;i++)this.Ps[i]=new T}else if(nt(arguments[0],At)){var r=arguments[0];if(null===r)return this.Ps=new Array(0).fill(null),null;this.Ks=r.getDimension(),this.Vs=r.getMeasures(),this.Ps=new Array(r.size()).fill(null);for(var o=0;o<this.Ps.length;o++)this.Ps[o]=r.getCoordinateCopy(o)}}else if(2===arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];e.constructor_.call(this,s,a,Kt.measures(s))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var A=arguments[0],u=arguments[1];this.Ps=new Array(A).fill(null),this.Ks=u;for(var h=0;h<A;h++)this.Ps[h]=Ht.create(u)}}else if(3===arguments.length)if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var l=arguments[0],c=arguments[1],f=arguments[2];this.Ks=c,this.Vs=f,this.Ps=null===l?new Array(0).fill(null):l}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var d=arguments[0],g=arguments[1],v=arguments[2];this.Ps=new Array(d).fill(null),this.Ks=g,this.Vs=v;for(var I=0;I<d;I++)this.Ps[I]=this.createCoordinate()}}}]),e}(),Wt=function(){function e(){t(this,e)}return n(e,[{key:"readResolve",value:function(){return e.instance()}},{key:"create",value:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new jt(arguments[0]);if(nt(arguments[0],At))return new jt(arguments[0])}else{if(2===arguments.length){var t=arguments[1];return t>3&&(t=3),t<2&&(t=2),new jt(arguments[0],t)}if(3===arguments.length){var e=arguments[2],n=arguments[1]-e;return e>1&&(e=1),n>3&&(n=3),n<2&&(n=2),new jt(arguments[0],n+e,e)}}}},{key:"interfaces_",get:function(){return[wt,B]}}],[{key:"instance",value:function(){return e.instanceObject}}]),e}();Wt.instanceObject=new Wt;var Xt=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"copyInternal",value:function(){for(var t=new Array(this.Hs.length).fill(null),e=0;e<t.length;e++)t[e]=this.Hs[e].copy();return new s(t,this.ks)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&l(r(s.prototype),"equalsExact",this).call(this,t,e)}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return O.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new ft,e=0;e<this.Hs.length;e++)for(var n=this.Hs[e].getBoundary(),i=0;i<n.getNumGeometries();i++)t.add(n.getGeometryN(i));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))}},{key:"getGeometryType",value:function(){return O.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[$t]}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];Nt.constructor_.call(this,t,e)}}]),s}(Nt),Zt=function(){function e(){t(this,e)}return n(e,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),e}(),te=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),(e=r.call(this)).map=new Map,e}return n(o,[{key:"get",value:function(t){return this.map.get(t)||null}},{key:"put",value:function(t,e){return this.map.set(t,e),e}},{key:"values",value:function(){for(var t=new ft,e=this.map.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t}},{key:"entrySet",value:function(){var t=new Y;return this.map.entries().forEach((function(e){return t.add(e)})),t}},{key:"size",value:function(){return this.map.size()}}]),o}(Zt),ee=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.Js===n.Js&&this.lr===n.lr}},{key:"compareTo",value:function(t){var e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return rt.compare(n,i)}},{key:"getScale",value:function(){return this.lr}},{key:"isFloating",value:function(){return this.Js===e.FLOATING||this.Js===e.FLOATING_SINGLE}},{key:"getType",value:function(){return this.Js}},{key:"toString",value:function(){var t="UNKNOWN";return this.Js===e.FLOATING?t="Floating":this.Js===e.FLOATING_SINGLE?t="Floating-Single":this.Js===e.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}},{key:"makePrecise",value:function(){if("number"==typeof arguments[0]){var t=arguments[0];return M.isNaN(t)||this.Js===e.FLOATING_SINGLE?t:this.Js===e.FIXED?Math.round(t*this.lr)/this.lr:t}if(arguments[0]instanceof T){var n=arguments[0];if(this.Js===e.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}}},{key:"getMaximumSignificantDigits",value:function(){var t=16;return this.Js===e.FLOATING?t=16:this.Js===e.FLOATING_SINGLE?t=6:this.Js===e.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}},{key:"setScale",value:function(t){this.lr=Math.abs(t)}},{key:"interfaces_",get:function(){return[B,w]}}],[{key:"constructor_",value:function(){if(this.Js=null,this.lr=null,0===arguments.length)this.Js=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof ne){var t=arguments[0];this.Js=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this.Js=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this.Js=i.Js,this.lr=i.lr}}},{key:"mostPrecise",value:function(t,e){return t.compareTo(e)>=0?t:e}}]),e}(),ne=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"readResolve",value:function(){return e.nameToTypeMap.get(this.po)}},{key:"toString",value:function(){return this.po}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){this.po=null;var t=arguments[0];this.po=t,e.nameToTypeMap.put(t,this)}}]),e}();ne.nameToTypeMap=new te,ee.Type=ne,ee.FIXED=new ne("FIXED"),ee.FLOATING=new ne("FLOATING"),ee.FLOATING_SINGLE=new ne("FLOATING SINGLE"),ee.maximumPreciseValue=9007199254740992;var ie=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"copyInternal",value:function(){for(var t=new Array(this.Hs.length).fill(null),e=0;e<t.length;e++)t[e]=this.Hs[e].copy();return new s(t,this.ks)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof O){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&l(r(s.prototype),"equalsExact",this).call(this,t,e)}return l(r(s.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Qt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var t=0;t<this.Hs.length;t++)if(!this.Hs[t].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return O.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new V}},{key:"getGeometryType",value:function(){return O.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Et]}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];Nt.constructor_.call(this,t,e)}}]),s}(Nt),re=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"createEmpty",value:function(t){switch(t){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new p("Invalid dimension: "+t)}}},{key:"toGeometry",value:function(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new T(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new T(t.getMinX(),t.getMinY()),new T(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new T(t.getMinX(),t.getMinY()),new T(t.getMinX(),t.getMaxY()),new T(t.getMaxX(),t.getMaxY()),new T(t.getMaxX(),t.getMinY()),new T(t.getMinX(),t.getMinY())]),null)}},{key:"createLineString",value:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLineString(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(nt(arguments[0],At))return new _t(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return 0===arguments.length?new ie(null,this):1===arguments.length?new ie(arguments[0],this):void 0}},{key:"buildGeometry",value:function(t){for(var n=null,i=!1,r=!1,o=t.iterator();o.hasNext();){var s=o.next(),a=s.getTypeCode();null===n&&(n=a),a!==n&&(i=!0),s instanceof Nt&&(r=!0)}if(null===n)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(e.toGeometryArray(t));var A=t.iterator().next();if(t.size()>1){if(A instanceof Rt)return this.createMultiPolygon(e.toPolygonArray(t));if(A instanceof _t)return this.createMultiLineString(e.toLineStringArray(t));if(A instanceof Dt)return this.createMultiPoint(e.toPointArray(t));G.shouldNeverReachHere("Unhandled geometry type: "+A.getGeometryType())}return A}},{key:"createMultiPointFromCoords",value:function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}},{key:"createPoint",value:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(nt(arguments[0],At))return new Dt(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this.Ys}},{key:"createPolygon",value:function(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(nt(arguments[0],At)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Tt){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Rt(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this.xs}},{key:"createGeometryCollection",value:function(){return 0===arguments.length?new Nt(null,this):1===arguments.length?new Nt(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this.js}},{key:"createLinearRing",value:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(nt(arguments[0],At))return new Tt(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return 0===arguments.length?new Xt(null,this):1===arguments.length?new Xt(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(0===arguments.length)return new Ut(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ut(arguments[0],this);if(nt(arguments[0],At)){var t=arguments[0];if(null===t)return this.createMultiPoint(new Array(0).fill(null));for(var e=new Array(t.size()).fill(null),n=0;n<t.size();n++){var i=this.getCoordinateSequenceFactory().create(1,t.getDimension(),t.getMeasures());mt.copy(t,n,i,0,1),e[n]=this.createPoint(i)}return this.createMultiPoint(e)}}}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this.js=null,this.Ys=null,this.xs=null,0===arguments.length)e.constructor_.call(this,new ee,0);else if(1===arguments.length){if(nt(arguments[0],wt)){var t=arguments[0];e.constructor_.call(this,new ee,0,t)}else if(arguments[0]instanceof ee){var n=arguments[0];e.constructor_.call(this,n,0,e.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];e.constructor_.call(this,i,r,e.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.js=o,this.Ys=a,this.xs=s}}},{key:"toMultiPolygonArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toGeometryArray",value:function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Wt.instance()}},{key:"toMultiLineStringArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toLineStringArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toMultiPointArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toLinearRingArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toPointArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"toPolygonArray",value:function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)}},{key:"createPointFromInternalCoord",value:function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)}}]),e}(),oe="XY",se={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ae="EMPTY";for(var Ae in se)se[Ae].toUpperCase();var ue=function(){function e(n){t(this,e),this.wkt=n,this.index_=-1}return n(e,[{key:"isAlpha_",value:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}},{key:"isNumeric_",value:function(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)}},{key:"isWhiteSpace_",value:function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var t,e=this.nextChar_(),n=this.index_,i=e;if("("==e)t=2;else if(","==e)t=5;else if(")"==e)t=3;else if(this.isNumeric_(e)||"-"==e)t=4,i=this.readNumber_();else if(this.isAlpha_(e))t=1,i=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=6}return{position:n,value:i,type:t}}},{key:"readNumber_",value:function(){var t,e=this.index_,n=!1,i=!1;do{"."==t?n=!0:"e"!=t&&"E"!=t||(i=!0),t=this.nextChar_()}while(this.isNumeric_(t,n)||!i&&("e"==t||"E"==t)||i&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))}},{key:"readText_",value:function(){var t,e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}]),e}(),he=function(){function e(n,i){t(this,e),this.lexer_=n,this.token_,this.layout_=oe,this.factory=i}return n(e,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(t){return this.token_.type==t}},{key:"match",value:function(t){var e=this.isTokenType(t);return e&&this.consume_(),e}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var t=oe,e=this.token_;if(this.isTokenType(1)){var n=e.value;"Z"===n?t="XYZ":"M"===n?t="XYM":"ZM"===n&&(t="XYZM"),t!==oe&&this.consume_()}return t}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(2)){var t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(2)){var t=this.parsePoint_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(2)){var t=this.parsePointList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var t;if(this.match(2)){if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(2)){var t=this.parsePolygonTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var t=[],e=this.layout_.length,n=0;n<e;++n){var i=this.token_;if(!this.match(4))break;t.push(i.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var t=[this.parsePoint_()];this.match(5);)t.push(this.parsePoint_());return t}},{key:"parsePointTextList_",value:function(){for(var t=[this.parsePointText_()];this.match(5);)t.push(this.parsePointText_());return t}},{key:"parseLineStringTextList_",value:function(){for(var t=[this.parseLineStringText_()];this.match(5);)t.push(this.parseLineStringText_());return t}},{key:"parsePolygonTextList_",value:function(){for(var t=[this.parsePolygonText_()];this.match(5);)t.push(this.parsePolygonText_());return t}},{key:"isEmptyGeometry_",value:function(){var t=this.isTokenType(1)&&this.token_.value==ae;return t&&this.consume_(),t}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var t=this.factory,e=function(t){return a(T,c(t))},n=function(n){var i=n.map((function(n){return t.createLinearRing(n.map(e))}));return i.length>1?t.createPolygon(i[0],i.slice(1)):t.createPolygon(i[0])},i=this.token_;if(this.match(1)){var r=i.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==r){var o=this.parseGeometryCollectionText_();return t.createGeometryCollection(o)}switch(r){case"POINT":var s=this.parsePointText_();return s?t.createPoint(a(T,c(s))):t.createPoint();case"LINESTRING":var A=this.parseLineStringText_().map(e);return t.createLineString(A);case"LINEARRING":var u=this.parseLineStringText_().map(e);return t.createLinearRing(u);case"POLYGON":var h=this.parsePolygonText_();return h&&0!==h.length?n(h):t.createPolygon();case"MULTIPOINT":var l=this.parseMultiPointText_();if(!l||0===l.length)return t.createMultiPoint();var f=l.map(e).map((function(e){return t.createPoint(e)}));return t.createMultiPoint(f);case"MULTILINESTRING":var d=this.parseMultiLineStringText_().map((function(n){return t.createLineString(n.map(e))}));return t.createMultiLineString(d);case"MULTIPOLYGON":var g=this.parseMultiPolygonText_();if(!g||0===g.length)return t.createMultiPolygon();var v=g.map(n);return t.createMultiPolygon(v);default:throw new Error("Invalid geometry type: "+r)}}throw new Error(this.formatErrorMessage_())}}]),e}();function le(t){if(t.isEmpty())return"";var e=t.getCoordinate(),n=[e.x,e.y];return void 0===e.z||Number.isNaN(e.z)||n.push(e.z),void 0===e.m||Number.isNaN(e.m)||n.push(e.m),n.join(" ")}function ce(t){for(var e=t.getCoordinates().map((function(t){var e=[t.x,t.y];return void 0===t.z||Number.isNaN(t.z)||e.push(t.z),void 0===t.m||Number.isNaN(t.m)||e.push(t.m),e})),n=[],i=0,r=e.length;i<r;++i)n.push(e[i].join(" "));return n.join(", ")}function fe(t){var e=[];e.push("("+ce(t.getExteriorRing())+")");for(var n=0,i=t.getNumInteriorRing();n<i;++n)e.push("("+ce(t.getInteriorRingN(n))+")");return e.join(", ")}var de={Point:le,LineString:ce,LinearRing:ce,Polygon:fe,MultiPoint:function(t){for(var e=[],n=0,i=t.getNumGeometries();n<i;++n)e.push("("+le(t.getGeometryN(n))+")");return e.join(", ")},MultiLineString:function(t){for(var e=[],n=0,i=t.getNumGeometries();n<i;++n)e.push("("+ce(t.getGeometryN(n))+")");return e.join(", ")},MultiPolygon:function(t){for(var e=[],n=0,i=t.getNumGeometries();n<i;++n)e.push("("+fe(t.getGeometryN(n))+")");return e.join(", ")},GeometryCollection:function(t){for(var e=[],n=0,i=t.getNumGeometries();n<i;++n)e.push(ge(t.getGeometryN(n)));return e.join(", ")}};function ge(t){var e=t.getGeometryType(),n=de[e];e=e.toUpperCase();var i=function(t){var e="";if(t.isEmpty())return e;var n=t.getCoordinate();return void 0===n.z||Number.isNaN(n.z)||(e+="Z"),void 0===n.m||Number.isNaN(n.m)||(e+="M"),e}(t);return i.length>0&&(e+=" "+i),t.isEmpty()?e+" "+ae:e+" ("+n(t)+")"}var ve=function(){function e(n){t(this,e),this.geometryFactory=n||new re,this.precisionModel=this.geometryFactory.getPrecisionModel()}return n(e,[{key:"read",value:function(t){var e=new ue(t);return new he(e,this.geometryFactory).parse()}},{key:"write",value:function(t){return ge(t)}}]),e}(),Ie=function(){function e(n){t(this,e),this.parser=new ve(n)}return n(e,[{key:"write",value:function(t){return this.parser.write(t)}}],[{key:"toLineString",value:function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}]),e}(),pe=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getIndexAlongSegment",value:function(t,e){return this.computeIntLineIndex(),this.Ws[t][e]}},{key:"getTopologySummary",value:function(){var t=new Yt;return this.isEndPoint()&&t.append(" endpoint"),this.Xs&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()}},{key:"computeIntersection",value:function(t,e,n,i){this.Zs[0][0]=t,this.Zs[0][1]=e,this.Zs[1][0]=n,this.Zs[1][1]=i,this._a=this.computeIntersect(t,e,n,i)}},{key:"getIntersectionNum",value:function(){return this._a}},{key:"computeIntLineIndex",value:function(){if(0===arguments.length)null===this.Ws&&(this.Ws=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this.Ws[t][0]=0,this.Ws[t][1]=1):(this.Ws[t][0]=1,this.Ws[t][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this.Xs}},{key:"setPrecisionModel",value:function(t){this.js=t}},{key:"isInteriorIntersection",value:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._a;e++)if(!this.tA[e].equals2D(this.Zs[t][0])&&!this.tA[e].equals2D(this.Zs[t][1]))return!0;return!1}}},{key:"getIntersection",value:function(t){return this.tA[t]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this.Xs}},{key:"hasIntersection",value:function(){return this._a!==e.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(t,n){return e.computeEdgeDistance(this.tA[n],this.Zs[t][0],this.Zs[t][1])}},{key:"isCollinear",value:function(){return this._a===e.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Ie.toLineString(this.Zs[0][0],this.Zs[0][1])+" - "+Ie.toLineString(this.Zs[1][0],this.Zs[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(t,e){return this.Zs[t][e]}},{key:"isIntersection",value:function(t){for(var e=0;e<this._a;e++)if(this.tA[e].equals2D(t))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(t,e){return this.computeIntLineIndex(),this.tA[this.Ws[t][e]]}}],[{key:"constructor_",value:function(){this._a=null,this.Zs=Array(2).fill().map((function(){return Array(2)})),this.tA=new Array(2).fill(null),this.Ws=null,this.Xs=null,this.eA=null,this.nA=null,this.js=null,this.tA[0]=new T,this.tA[1]=new T,this.eA=this.tA[0],this.nA=this.tA[1],this._a=0}},{key:"computeEdgeDistance",value:function(t,e,n){var i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=i>r?i:r;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=i>r?s:a)||t.equals(e)||(o=Math.max(s,a))}return G.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o}},{key:"nonRobustComputeEdgeDistance",value:function(t,e,n){var i=t.x-e.x,r=t.y-e.y,o=Math.sqrt(i*i+r*r);return G.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o}}]),e}();pe.DONT_INTERSECT=0,pe.DO_INTERSECT=1,pe.COLLINEAR=2,pe.NO_INTERSECTION=0,pe.POINT_INTERSECTION=1,pe.COLLINEAR_INTERSECTION=2;var ye=function(e){i(s,e);var o=h(s);function s(){return t(this,s),o.call(this)}return n(s,[{key:"isInSegmentEnvelopes",value:function(t){var e=new q(this.Zs[0][0],this.Zs[0][1]),n=new q(this.Zs[1][0],this.Zs[1][1]);return e.contains(t)&&n.contains(t)}},{key:"computeIntersection",value:function(){if(3!==arguments.length)return l(r(s.prototype),"computeIntersection",this).apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2];if(this.Xs=!1,q.intersects(e,n,t)&&0===ut.index(e,n,t)&&0===ut.index(n,e,t))return this.Xs=!0,(t.equals(e)||t.equals(n))&&(this.Xs=!1),this._a=pe.POINT_INTERSECTION,null;this._a=pe.NO_INTERSECTION}},{key:"intersection",value:function(t,e,n,i){var r=this.intersectionSafe(t,e,n,i);return this.isInSegmentEnvelopes(r)||(r=new T(s.nearestEndpoint(t,e,n,i))),null!==this.js&&this.js.makePrecise(r),r}},{key:"checkDD",value:function(t,e,n,i,r){var o=at.intersection(t,e,n,i),s=this.isInSegmentEnvelopes(o);It.out.println("DD in env = "+s+"  --------------------- "+o),r.distance(o)>1e-4&&It.out.println("Distance = "+r.distance(o))}},{key:"intersectionSafe",value:function(t,e,n,i){var r=vt.intersection(t,e,n,i);return null===r&&(r=s.nearestEndpoint(t,e,n,i)),r}},{key:"computeCollinearIntersection",value:function(t,e,n,i){var r=q.intersects(t,e,n),o=q.intersects(t,e,i),s=q.intersects(n,i,t),a=q.intersects(n,i,e);return r&&o?(this.tA[0]=n,this.tA[1]=i,pe.COLLINEAR_INTERSECTION):s&&a?(this.tA[0]=t,this.tA[1]=e,pe.COLLINEAR_INTERSECTION):r&&s?(this.tA[0]=n,this.tA[1]=t,!n.equals(t)||o||a?pe.COLLINEAR_INTERSECTION:pe.POINT_INTERSECTION):r&&a?(this.tA[0]=n,this.tA[1]=e,!n.equals(e)||o||s?pe.COLLINEAR_INTERSECTION:pe.POINT_INTERSECTION):o&&s?(this.tA[0]=i,this.tA[1]=t,!i.equals(t)||r||a?pe.COLLINEAR_INTERSECTION:pe.POINT_INTERSECTION):o&&a?(this.tA[0]=i,this.tA[1]=e,!i.equals(e)||r||s?pe.COLLINEAR_INTERSECTION:pe.POINT_INTERSECTION):pe.NO_INTERSECTION}},{key:"computeIntersect",value:function(t,e,n,i){if(this.Xs=!1,!q.intersects(t,e,n,i))return pe.NO_INTERSECTION;var r=ut.index(t,e,n),o=ut.index(t,e,i);if(r>0&&o>0||r<0&&o<0)return pe.NO_INTERSECTION;var s=ut.index(n,i,t),a=ut.index(n,i,e);return s>0&&a>0||s<0&&a<0?pe.NO_INTERSECTION:0===r&&0===o&&0===s&&0===a?this.computeCollinearIntersection(t,e,n,i):(0===r||0===o||0===s||0===a?(this.Xs=!1,t.equals2D(n)||t.equals2D(i)?this.tA[0]=t:e.equals2D(n)||e.equals2D(i)?this.tA[0]=e:0===r?this.tA[0]=new T(n):0===o?this.tA[0]=new T(i):0===s?this.tA[0]=new T(t):0===a&&(this.tA[0]=new T(e))):(this.Xs=!0,this.tA[0]=this.intersection(t,e,n,i)),pe.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(t,e,n,i){var r=t,o=yt.pointToSegment(t,n,i),s=yt.pointToSegment(e,n,i);return s<o&&(o=s,r=e),(s=yt.pointToSegment(n,t,e))<o&&(o=s,r=n),(s=yt.pointToSegment(i,t,e))<o&&(o=s,r=i),r}}]),s}(pe),we=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"countSegment",value:function(t,e){if(t.x<this.iA.x&&e.x<this.iA.x)return null;if(this.iA.x===e.x&&this.iA.y===e.y)return this.rA=!0,null;if(t.y===this.iA.y&&e.y===this.iA.y){var n=t.x,i=e.x;return n>i&&(n=e.x,i=t.x),this.iA.x>=n&&this.iA.x<=i&&(this.rA=!0),null}if(t.y>this.iA.y&&e.y<=this.iA.y||e.y>this.iA.y&&t.y<=this.iA.y){var r=ut.index(t,e,this.iA);if(r===ut.COLLINEAR)return this.rA=!0,null;e.y<t.y&&(r=-r),r===ut.LEFT&&this.oA++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==H.EXTERIOR}},{key:"getLocation",value:function(){return this.rA?H.BOUNDARY:this.oA%2==1?H.INTERIOR:H.EXTERIOR}},{key:"isOnSegment",value:function(){return this.rA}}],[{key:"constructor_",value:function(){this.iA=null,this.oA=0,this.rA=!1;var t=arguments[0];this.iA=t}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof T&&nt(arguments[1],At)){for(var t=arguments[1],n=new e(arguments[0]),i=new T,r=new T,o=1;o<t.size();o++)if(t.getCoordinate(o,i),t.getCoordinate(o-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof T&&arguments[1]instanceof Array){for(var s=arguments[1],a=new e(arguments[0]),A=1;A<s.length;A++){var u=s[A],h=s[A-1];if(a.countSegment(u,h),a.isOnSegment())return a.getLocation()}return a.getLocation()}}}]),e}(),Ce=function(){function e(){t(this,e)}return n(e,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof T&&nt(arguments[1],At)){for(var t=arguments[0],e=arguments[1],n=new ye,i=new T,r=new T,o=e.size(),s=1;s<o;s++)if(e.getCoordinate(s-1,i),e.getCoordinate(s,r),n.computeIntersection(t,i,r),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof T&&arguments[1]instanceof Array){for(var a=arguments[0],A=arguments[1],u=new ye,h=1;h<A.length;h++){var l=A[h-1],c=A[h];if(u.computeIntersection(a,l,c),u.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(t,e){return we.locatePointInRing(t,e)}},{key:"isInRing",value:function(t,n){return e.locateInRing(t,n)!==H.EXTERIOR}}]),e}(),Be=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"setAllLocations",value:function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t}},{key:"isNull",value:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==H.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(t){for(var e=0;e<this.location.length;e++)this.location[e]===H.NONE&&(this.location[e]=t)}},{key:"isLine",value:function(){return 1===this.location.length}},{key:"merge",value:function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[W.ON]=this.location[W.ON],e[W.LEFT]=H.NONE,e[W.RIGHT]=H.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===H.NONE&&n<t.location.length&&(this.location[n]=t.location[n])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var t=this.location[W.LEFT];this.location[W.LEFT]=this.location[W.RIGHT],this.location[W.RIGHT]=t}},{key:"toString",value:function(){var t=new it;return this.location.length>1&&t.append(H.toLocationSymbol(this.location[W.LEFT])),t.append(H.toLocationSymbol(this.location[W.ON])),this.location.length>1&&t.append(H.toLocationSymbol(this.location[W.RIGHT])),t.toString()}},{key:"setLocations",value:function(t,e,n){this.location[W.ON]=t,this.location[W.LEFT]=e,this.location[W.RIGHT]=n}},{key:"get",value:function(t){return t<this.location.length?this.location[t]:H.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===H.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(1===arguments.length){var t=arguments[0];this.setLocation(W.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}}},{key:"init",value:function(t){this.location=new Array(t).fill(null),this.setAllLocations(H.NONE)}},{key:"isEqualOnSide",value:function(t,e){return this.location[e]===t.location[e]}},{key:"allPositionsEqual",value:function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[W.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var r=0;r<this.location.length;r++)this.location[r]=i.location[r]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[W.ON]=o,this.location[W.LEFT]=s,this.location[W.RIGHT]=a}}}]),e}(),Ee=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getGeometryCount",value:function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t}},{key:"setAllLocations",value:function(t,e){this.elt[t].setAllLocations(e)}},{key:"isNull",value:function(t){return this.elt[t].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}}},{key:"isLine",value:function(t){return this.elt[t].isLine()}},{key:"merge",value:function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Be(t.elt[e]):this.elt[e].merge(t.elt[e])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(W.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}}},{key:"toString",value:function(){var t=new it;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()}},{key:"isArea",value:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}}},{key:"isAnyNull",value:function(t){return this.elt[t].isAnyNull()}},{key:"setLocation",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(W.ON,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}}},{key:"isEqualOnSide",value:function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)}},{key:"allPositionsEqual",value:function(t,e){return this.elt[t].allPositionsEqual(e)}},{key:"toLine",value:function(t){this.elt[t].isArea()&&(this.elt[t]=new Be(this.elt[t].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Be(t),this.elt[1]=new Be(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Be(n.elt[0]),this.elt[1]=new Be(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Be(H.NONE),this.elt[1]=new Be(H.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Be(o,s,a),this.elt[1]=new Be(o,s,a)}else if(4===arguments.length){var A=arguments[0],u=arguments[1],h=arguments[2],l=arguments[3];this.elt[0]=new Be(H.NONE,H.NONE,H.NONE),this.elt[1]=new Be(H.NONE,H.NONE,H.NONE),this.elt[A].setLocations(u,h,l)}}},{key:"toLineLabel",value:function(t){for(var n=new e(H.NONE),i=0;i<2;i++)n.setLocation(i,t.getLocation(i));return n}}]),e}(),me=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"computeRing",value:function(){if(null!==this.sA)return null;for(var t=new Array(this.aA.size()).fill(null),e=0;e<this.aA.size();e++)t[e]=this.aA.get(e);this.sA=this.AA.createLinearRing(t),this.uA=ut.isCCW(this.sA.getCoordinates())}},{key:"isIsolated",value:function(){return 1===this.hA.getGeometryCount()}},{key:"computePoints",value:function(t){this.lA=t;var e=t,n=!0;do{if(null===e)throw new lt("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new lt("Directed Edge visited twice during ring-building at "+e.getCoordinate());this.cA.add(e);var i=e.getLabel();G.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this.lA)}},{key:"getLinearRing",value:function(){return this.sA}},{key:"getCoordinate",value:function(t){return this.aA.get(t)}},{key:"computeMaxNodeDegree",value:function(){this.fA=0;var t=this.lA;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this.fA&&(this.fA=e),t=this.getNext(t)}while(t!==this.lA);this.fA*=2}},{key:"addPoints",value:function(t,e,n){var i=t.getCoordinates();if(e){var r=1;n&&(r=0);for(var o=r;o<i.length;o++)this.aA.add(i[o])}else{var s=i.length-2;n&&(s=i.length-1);for(var a=s;a>=0;a--)this.aA.add(i[a])}}},{key:"isHole",value:function(){return this.uA}},{key:"setInResult",value:function(){var t=this.lA;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this.lA)}},{key:"containsPoint",value:function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!Ce.isInRing(t,e.getCoordinates()))return!1;for(var n=this.Os.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0}},{key:"addHole",value:function(t){this.Os.add(t)}},{key:"isShell",value:function(){return null===this.qs}},{key:"getLabel",value:function(){return this.hA}},{key:"getEdges",value:function(){return this.cA}},{key:"getMaxNodeDegree",value:function(){return this.fA<0&&this.computeMaxNodeDegree(),this.fA}},{key:"getShell",value:function(){return this.qs}},{key:"mergeLabel",value:function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],n=arguments[0].getLocation(e,W.RIGHT);if(n===H.NONE)return null;if(this.hA.getLocation(e)===H.NONE)return this.hA.setLocation(e,n),null}}},{key:"setShell",value:function(t){this.qs=t,null!==t&&t.addHole(this)}},{key:"toPolygon",value:function(t){for(var e=new Array(this.Os.size()).fill(null),n=0;n<this.Os.size();n++)e[n]=this.Os.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)}}],[{key:"constructor_",value:function(){if(this.lA=null,this.fA=-1,this.cA=new ft,this.aA=new ft,this.hA=new Ee(H.NONE),this.sA=null,this.uA=null,this.qs=null,this.Os=new ft,this.AA=null,0===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.AA=e,this.computePoints(t),this.computeRing()}}}]),e}(),Qe=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"setEdgeRing",value:function(t,e){t.setMinEdgeRing(e)}},{key:"getNext",value:function(t){return t.getNextMin()}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];me.constructor_.call(this,t,e)}}]),o}(me),ke=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"buildMinimalRings",value:function(){var t=new ft,e=this.lA;do{if(null===e.getMinEdgeRing()){var n=new Qe(e,this.AA);t.add(n)}e=e.getNext()}while(e!==this.lA);return t}},{key:"setEdgeRing",value:function(t,e){t.setEdgeRing(e)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var t=this.lA;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this.lA)}},{key:"getNext",value:function(t){return t.getNext()}}],[{key:"constructor_",value:function(){var t=arguments[0],e=arguments[1];me.constructor_.call(this,t,e)}}]),o}(me),be=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"setVisited",value:function(t){this.dA=t}},{key:"setInResult",value:function(t){this.gA=t}},{key:"isCovered",value:function(){return this.vA}},{key:"isCoveredSet",value:function(){return this.IA}},{key:"setLabel",value:function(t){this.hA=t}},{key:"getLabel",value:function(){return this.hA}},{key:"setCovered",value:function(t){this.vA=t,this.IA=!0}},{key:"updateIM",value:function(t){G.isTrue(this.hA.getGeometryCount()>=2,"found partial label"),this.computeIM(t)}},{key:"isInResult",value:function(){return this.gA}},{key:"isVisited",value:function(){return this.dA}}],[{key:"constructor_",value:function(){if(this.hA=null,this.gA=!1,this.vA=!1,this.IA=!1,this.dA=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.hA=t}}}]),e}(),_e=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"isIncidentEdgeInResult",value:function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return 1===this.hA.getGeometryCount()}},{key:"getCoordinate",value:function(){return this.bi}},{key:"print",value:function(t){t.println("node "+this.bi+" lbl: "+this.hA)}},{key:"computeIM",value:function(t){}},{key:"computeMergedLocation",value:function(t,e){var n=H.NONE;if(n=this.hA.getLocation(e),!t.isNull(e)){var i=t.getLocation(e);n!==H.BOUNDARY&&(n=i)}return n}},{key:"setLabel",value:function(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return l(r(s.prototype),"setLabel",this).apply(this,arguments);var t=arguments[0],e=arguments[1];null===this.hA?this.hA=new Ee(t,e):this.hA.setLocation(t,e)}},{key:"getEdges",value:function(){return this.cA}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof s){var t=arguments[0];this.mergeLabel(t.hA)}else if(arguments[0]instanceof Ee)for(var e=arguments[0],n=0;n<2;n++){var i=this.computeMergedLocation(e,n);this.hA.getLocation(n)===H.NONE&&this.hA.setLocation(n,i)}}},{key:"add",value:function(t){this.cA.insert(t),t.setNode(this)}},{key:"setLabelBoundary",value:function(t){if(null===this.hA)return null;var e=H.NONE;null!==this.hA&&(e=this.hA.getLocation(t));var n=null;switch(e){case H.BOUNDARY:n=H.INTERIOR;break;case H.INTERIOR:default:n=H.BOUNDARY}this.hA.setLocation(t,n)}}],[{key:"constructor_",value:function(){this.bi=null,this.cA=null;var t=arguments[0],e=arguments[1];this.bi=t,this.cA=e,this.hA=new Ee(0,H.NONE)}}]),s}(be),xe=function(e){i(r,e);var n=h(r);function r(){return t(this,r),n.apply(this,arguments)}return r}(Zt);function De(t){return null==t?0:t.color}function Se(t){return null==t?null:t.parent}function Me(t,e){null!==t&&(t.color=e)}function $e(t){return null==t?null:t.left}function Re(t){return null==t?null:t.right}var Fe=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),(e=r.call(this)).root_=null,e.size_=0,e}return n(o,[{key:"get",value:function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null}},{key:"put",value:function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=t.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var o=r.value;return r.value=e,o}r=r.right}}while(null!==r);var s={key:t,left:null,right:null,value:e,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null}},{key:"fixAfterInsertion",value:function(t){var e;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)Se(t)===$e(Se(Se(t)))?1===De(e=Re(Se(Se(t))))?(Me(Se(t),0),Me(e,0),Me(Se(Se(t)),1),t=Se(Se(t))):(t===Re(Se(t))&&(t=Se(t),this.rotateLeft(t)),Me(Se(t),0),Me(Se(Se(t)),1),this.rotateRight(Se(Se(t)))):1===De(e=$e(Se(Se(t))))?(Me(Se(t),0),Me(e,0),Me(Se(Se(t)),1),t=Se(Se(t))):(t===$e(Se(t))&&(t=Se(t),this.rotateRight(t)),Me(Se(t),0),Me(Se(Se(t)),1),this.rotateLeft(Se(Se(t))));this.root_.color=0}},{key:"values",value:function(){var t=new ft,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=o.successor(e));)t.add(e.value);return t}},{key:"entrySet",value:function(){var t=new Y,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=o.successor(e));)t.add(e);return t}},{key:"rotateLeft",value:function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}}},{key:"rotateRight",value:function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}}},{key:"getFirstEntry",value:function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return!0;e=e.right}}return!1}}],[{key:"successor",value:function(t){var e;if(null===t)return null;if(null!==t.right){for(e=t.right;null!==e.left;)e=e.left;return e}e=t.parent;for(var n=t;null!==e&&n===e.right;)n=e,e=e.parent;return e}}]),o}(xe),Ge=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"find",value:function(t){return this.nodeMap.get(t)}},{key:"addNode",value:function(){if(arguments[0]instanceof T){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof _e){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}}},{key:"print",value:function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(t){for(var e=new ft,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===H.BOUNDARY&&e.add(i)}return e}},{key:"add",value:function(t){var e=t.getCoordinate();this.addNode(e).add(t)}}],[{key:"constructor_",value:function(){this.nodeMap=new Fe,this.nodeFact=null;var t=arguments[0];this.nodeFact=t}}]),e}(),Le=function(){function e(){t(this,e)}return n(e,null,[{key:"isNorthern",value:function(t){return t===e.NE||t===e.NW}},{key:"isOpposite",value:function(t,e){return t!==e&&2==(t-e+4)%4}},{key:"commonHalfPlane",value:function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n}},{key:"isInHalfPlane",value:function(t,n){return n===e.SE?t===e.SE||t===e.SW:t===n||t===n+1}},{key:"quadrant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new p("Cannot compute the quadrant for point ( "+t+", "+n+" )");return t>=0?n>=0?e.NE:e.SE:n>=0?e.NW:e.SW}if(arguments[0]instanceof T&&arguments[1]instanceof T){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new p("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?e.NE:e.SE:r.y>=i.y?e.NW:e.SW}}}]),e}();Le.NE=0,Le.NW=1,Le.SW=2,Le.SE=3;var Ne=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"compareDirection",value:function(t){return this.pA===t.pA&&this.yA===t.yA?0:this.wA>t.wA?1:this.wA<t.wA?-1:ut.index(t.CA,t.BA,this.BA)}},{key:"getDy",value:function(){return this.yA}},{key:"getCoordinate",value:function(){return this.CA}},{key:"setNode",value:function(t){this.EA=t}},{key:"print",value:function(t){var e=Math.atan2(this.yA,this.pA),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);t.print("  "+r+": "+this.CA+" - "+this.BA+" "+this.wA+":"+e+"   "+this.hA)}},{key:"compareTo",value:function(t){var e=t;return this.compareDirection(e)}},{key:"getDirectedCoordinate",value:function(){return this.BA}},{key:"getDx",value:function(){return this.pA}},{key:"getLabel",value:function(){return this.hA}},{key:"getEdge",value:function(){return this.mA}},{key:"getQuadrant",value:function(){return this.wA}},{key:"getNode",value:function(){return this.EA}},{key:"toString",value:function(){var t=Math.atan2(this.yA,this.pA),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this.CA+" - "+this.BA+" "+this.wA+":"+t+"   "+this.hA}},{key:"computeLabel",value:function(t){}},{key:"init",value:function(t,e){this.CA=t,this.BA=e,this.pA=e.x-t.x,this.yA=e.y-t.y,this.wA=Le.quadrant(this.pA,this.yA),G.isTrue(!(0===this.pA&&0===this.yA),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){if(this.mA=null,this.hA=null,this.EA=null,this.CA=null,this.BA=null,this.pA=null,this.yA=null,this.wA=null,1===arguments.length){var t=arguments[0];this.mA=t}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];e.constructor_.call(this,n,i,r,null)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],A=arguments[3];e.constructor_.call(this,o),this.init(s,a),this.hA=A}}}]),e}(),Ue=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"getNextMin",value:function(){return this.QA}},{key:"getDepth",value:function(t){return this.kA[t]}},{key:"setVisited",value:function(t){this.dA=t}},{key:"computeDirectedLabel",value:function(){this.hA=new Ee(this.mA.getLabel()),this.bA||this.hA.flip()}},{key:"getNext",value:function(){return this._A}},{key:"setDepth",value:function(t,e){if(-999!==this.kA[t]&&this.kA[t]!==e)throw new lt("assigned depths do not match",this.getCoordinate());this.kA[t]=e}},{key:"isInteriorAreaEdge",value:function(){for(var t=!0,e=0;e<2;e++)this.hA.isArea(e)&&this.hA.getLocation(e,W.LEFT)===H.INTERIOR&&this.hA.getLocation(e,W.RIGHT)===H.INTERIOR||(t=!1);return t}},{key:"setNextMin",value:function(t){this.QA=t}},{key:"print",value:function(t){l(r(s.prototype),"print",this).call(this,t),t.print(" "+this.kA[W.LEFT]+"/"+this.kA[W.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this.gA&&t.print(" inResult")}},{key:"setMinEdgeRing",value:function(t){this.xA=t}},{key:"isLineEdge",value:function(){var t=this.hA.isLine(0)||this.hA.isLine(1),e=!this.hA.isArea(0)||this.hA.allPositionsEqual(0,H.EXTERIOR),n=!this.hA.isArea(1)||this.hA.allPositionsEqual(1,H.EXTERIOR);return t&&e&&n}},{key:"setEdgeRing",value:function(t){this.DA=t}},{key:"getMinEdgeRing",value:function(){return this.xA}},{key:"getDepthDelta",value:function(){var t=this.mA.getDepthDelta();return this.bA||(t=-t),t}},{key:"setInResult",value:function(t){this.gA=t}},{key:"getSym",value:function(){return this.SA}},{key:"isForward",value:function(){return this.bA}},{key:"getEdge",value:function(){return this.mA}},{key:"printEdge",value:function(t){this.print(t),t.print(" "),this.bA?this.mA.print(t):this.mA.printReverse(t)}},{key:"setSym",value:function(t){this.SA=t}},{key:"setVisitedEdge",value:function(t){this.setVisited(t),this.SA.setVisited(t)}},{key:"setEdgeDepths",value:function(t,e){var n=this.getEdge().getDepthDelta();this.bA||(n=-n);var i=1;t===W.LEFT&&(i=-1);var r=W.opposite(t),o=e+n*i;this.setDepth(t,e),this.setDepth(r,o)}},{key:"getEdgeRing",value:function(){return this.DA}},{key:"isInResult",value:function(){return this.gA}},{key:"setNext",value:function(t){this._A=t}},{key:"isVisited",value:function(){return this.dA}}],[{key:"constructor_",value:function(){this.bA=null,this.gA=!1,this.dA=!1,this.SA=null,this._A=null,this.QA=null,this.DA=null,this.xA=null,this.kA=[0,-999,-999];var t=arguments[0],e=arguments[1];if(Ne.constructor_.call(this,t),this.bA=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var n=t.getNumPoints()-1;this.init(t.getCoordinate(n),t.getCoordinate(n-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(t,e){return t===H.EXTERIOR&&e===H.INTERIOR?1:t===H.INTERIOR&&e===H.EXTERIOR?-1:0}}]),s}(Ne),Te=function(){function e(){t(this,e)}return n(e,[{key:"createNode",value:function(t){return new _e(t,null)}}]),e}(),Pe=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"printEdges",value:function(t){t.println("Edges:");for(var e=0;e<this.cA.size();e++){t.println("edge "+e+":");var n=this.cA.get(e);n.print(t),n.eiList.print(t)}}},{key:"find",value:function(t){return this.Ts.find(t)}},{key:"addNode",value:function(){if(arguments[0]instanceof _e){var t=arguments[0];return this.Ts.addNode(t)}if(arguments[0]instanceof T){var e=arguments[0];return this.Ts.addNode(e)}}},{key:"getNodeIterator",value:function(){return this.Ts.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var t=this.Ts.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(t){It.out.println(t)}},{key:"isBoundaryNode",value:function(t,e){var n=this.Ts.find(e);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(t)===H.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var t=this.Ts.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(t,e,n,i){return!!t.equals(n)&&ut.index(t,e,i)===ut.COLLINEAR&&Le.quadrant(t,e)===Le.quadrant(n,i)}},{key:"getEdgeEnds",value:function(){return this.MA}},{key:"debugPrint",value:function(t){It.out.print(t)}},{key:"getEdgeIterator",value:function(){return this.cA.iterator()}},{key:"findEdgeInSameDirection",value:function(t,e){for(var n=0;n<this.cA.size();n++){var i=this.cA.get(n),r=i.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return i;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return i}return null}},{key:"insertEdge",value:function(t){this.cA.add(t)}},{key:"findEdgeEnd",value:function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null}},{key:"addEdges",value:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.cA.add(n);var i=new Ue(n,!0),r=new Ue(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}}},{key:"add",value:function(t){this.Ts.add(t),this.MA.add(t)}},{key:"getNodes",value:function(){return this.Ts.values()}},{key:"findEdge",value:function(t,e){for(var n=0;n<this.cA.size();n++){var i=this.cA.get(n),r=i.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return i}return null}}],[{key:"constructor_",value:function(){if(this.cA=new ft,this.Ts=null,this.MA=new ft,0===arguments.length)this.Ts=new Ge(new Te);else if(1===arguments.length){var t=arguments[0];this.Ts=new Ge(t)}}},{key:"linkResultDirectedEdges",value:function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}}]),e}(),qe=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"sortShellsAndHoles",value:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):e.add(r)}}},{key:"computePolygons",value:function(t){for(var e=new ft,n=t.iterator();n.hasNext();){var i=n.next().toPolygon(this.AA);e.add(i)}return e}},{key:"placeFreeHoles",value:function(t,n){for(var i=n.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var o=e.findEdgeRingContaining(r,t);if(null===o)throw new lt("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(o)}}}},{key:"buildMinimalEdgeRings",value:function(t,e,n){for(var i=new ft,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):n.addAll(s)}else i.add(o)}return i}},{key:"buildMaximalEdgeRings",value:function(t){for(var e=new ft,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new ke(i,this.AA);e.add(r),r.setInResult()}}return e}},{key:"placePolygonHoles",value:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}}},{key:"getPolygons",value:function(){return this.computePolygons(this.$A)}},{key:"findShell",value:function(t){for(var e=0,n=null,i=t.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,e++)}return G.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n}},{key:"add",value:function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Pe.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(e),r=new ft,o=this.buildMinimalEdgeRings(i,this.$A,r);this.sortShellsAndHoles(o,this.$A,r),this.placeFreeHoles(this.$A,r)}}}],[{key:"constructor_",value:function(){this.AA=null,this.$A=new ft;var t=arguments[0];this.AA=t}},{key:"findEdgeRingContaining",value:function(t,e){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var A=a.next(),u=A.getLinearRing(),h=u.getEnvelopeInternal();if(!h.equals(i)&&h.contains(i)){r=Kt.ptNotInList(n.getCoordinates(),u.getCoordinates());var l=!1;Ce.isInRing(r,u.getCoordinates())&&(l=!0),l&&(null===o||s.contains(h))&&(s=(o=A).getLinearRing().getEnvelopeInternal())}}return o}}]),e}(),Oe=function(){function e(){t(this,e)}return n(e,[{key:"getBounds",value:function(){}}]),e}(),He=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getItem",value:function(){return this.RA}},{key:"getBounds",value:function(){return this.FA}},{key:"interfaces_",get:function(){return[Oe,B]}}],[{key:"constructor_",value:function(){this.FA=null,this.RA=null;var t=arguments[0],e=arguments[1];this.FA=t,this.RA=e}}]),e}(),ze=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"poll",value:function(){if(this.isEmpty())return null;var t=this.GA.get(1);return this.GA.set(1,this.GA.get(this.Ni)),this.Ni-=1,this.reorder(1),t}},{key:"size",value:function(){return this.Ni}},{key:"reorder",value:function(t){for(var e=null,n=this.GA.get(t);2*t<=this.Ni&&((e=2*t)!==this.Ni&&this.GA.get(e+1).compareTo(this.GA.get(e))<0&&e++,this.GA.get(e).compareTo(n)<0);t=e)this.GA.set(t,this.GA.get(e));this.GA.set(t,n)}},{key:"clear",value:function(){this.Ni=0,this.GA.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this.GA.get(1)}},{key:"isEmpty",value:function(){return 0===this.Ni}},{key:"add",value:function(t){this.GA.add(null),this.Ni+=1;var e=this.Ni;for(this.GA.set(0,t);t.compareTo(this.GA.get(Math.trunc(e/2)))<0;e/=2)this.GA.set(e,this.GA.get(Math.trunc(e/2)));this.GA.set(e,t)}}],[{key:"constructor_",value:function(){this.Ni=null,this.GA=null,this.Ni=0,this.GA=new ft,this.GA.add(null)}}]),e}(),Ke=function(){function e(){t(this,e)}return n(e,[{key:"insert",value:function(t,e){}},{key:"remove",value:function(t,e){}},{key:"query",value:function(){}}]),e}(),Ve=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getLevel",value:function(){return this.LA}},{key:"size",value:function(){return this.NA.size()}},{key:"getChildBoundables",value:function(){return this.NA}},{key:"addChildBoundable",value:function(t){G.isTrue(null===this.FA),this.NA.add(t)}},{key:"isEmpty",value:function(){return this.NA.isEmpty()}},{key:"getBounds",value:function(){return null===this.FA&&(this.FA=this.computeBounds()),this.FA}},{key:"interfaces_",get:function(){return[Oe,B]}}],[{key:"constructor_",value:function(){if(this.NA=new ft,this.FA=null,this.LA=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.LA=t}}}]),e}(),Je={reverseOrder:function(){return{compare:function(t,e){return e.compareTo(t)}}},min:function(t){return Je.sort(t),t.get(0)},sort:function(t,e){var n=t.toArray();e?Mt.sort(n,e):Mt.sort(n);for(var i=t.iterator(),r=0,o=n.length;r<o;r++)i.next(),i.set(n[r])},singletonList:function(t){var e=new ft;return e.add(t),e}},Ye=function(){function e(){t(this,e)}return n(e,null,[{key:"maxDistance",value:function(t,n,i,r,o,s,a,A){var u=e.distance(t,n,o,s);return u=Math.max(u,e.distance(t,n,a,A)),u=Math.max(u,e.distance(i,r,o,s)),Math.max(u,e.distance(i,r,a,A))}},{key:"distance",value:function(t,e,n,i){var r=n-t,o=i-e;return Math.sqrt(r*r+o*o)}},{key:"maximumDistance",value:function(t,n){var i=Math.min(t.getMinX(),n.getMinX()),r=Math.min(t.getMinY(),n.getMinY()),o=Math.max(t.getMaxX(),n.getMaxX()),s=Math.max(t.getMaxY(),n.getMaxY());return e.distance(i,r,o,s)}},{key:"minMaxDistance",value:function(t,n){var i=t.getMinX(),r=t.getMinY(),o=t.getMaxX(),s=t.getMaxY(),a=n.getMinX(),A=n.getMinY(),u=n.getMaxX(),h=n.getMaxY(),l=e.maxDistance(i,r,i,s,a,A,a,h);return l=Math.min(l,e.maxDistance(i,r,i,s,a,A,u,A)),l=Math.min(l,e.maxDistance(i,r,i,s,u,h,a,h)),l=Math.min(l,e.maxDistance(i,r,i,s,u,h,u,A)),l=Math.min(l,e.maxDistance(i,r,o,r,a,A,a,h)),l=Math.min(l,e.maxDistance(i,r,o,r,a,A,u,A)),l=Math.min(l,e.maxDistance(i,r,o,r,u,h,a,h)),l=Math.min(l,e.maxDistance(i,r,o,r,u,h,u,A)),l=Math.min(l,e.maxDistance(o,s,i,s,a,A,a,h)),l=Math.min(l,e.maxDistance(o,s,i,s,a,A,u,A)),l=Math.min(l,e.maxDistance(o,s,i,s,u,h,a,h)),l=Math.min(l,e.maxDistance(o,s,i,s,u,h,u,A)),l=Math.min(l,e.maxDistance(o,s,o,r,a,A,a,h)),l=Math.min(l,e.maxDistance(o,s,o,r,a,A,u,A)),l=Math.min(l,e.maxDistance(o,s,o,r,u,h,a,h)),Math.min(l,e.maxDistance(o,s,o,r,u,h,u,A))}}]),e}(),je=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"maximumDistance",value:function(){return Ye.maximumDistance(this.UA.getBounds(),this.TA.getBounds())}},{key:"expandToQueue",value:function(t,n){var i=e.isComposite(this.UA),r=e.isComposite(this.TA);if(i&&r)return e.area(this.UA)>e.area(this.TA)?(this.expand(this.UA,this.TA,!1,t,n),null):(this.expand(this.TA,this.UA,!0,t,n),null);if(i)return this.expand(this.UA,this.TA,!1,t,n),null;if(r)return this.expand(this.TA,this.UA,!0,t,n),null;throw new p("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(e.isComposite(this.UA)||e.isComposite(this.TA))}},{key:"compareTo",value:function(t){var e=t;return this.PA<e.PA?-1:this.PA>e.PA?1:0}},{key:"expand",value:function(t,n,i,r,o){for(var s=t.getChildBoundables().iterator();s.hasNext();){var a=s.next(),A=null;(A=i?new e(n,a,this.qA):new e(a,n,this.qA)).getDistance()<o&&r.add(A)}}},{key:"getBoundable",value:function(t){return 0===t?this.UA:this.TA}},{key:"getDistance",value:function(){return this.PA}},{key:"distance",value:function(){return this.isLeaves()?this.qA.distance(this.UA,this.TA):this.UA.getBounds().distance(this.TA.getBounds())}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.UA=null,this.TA=null,this.PA=null,this.qA=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.UA=t,this.TA=e,this.qA=n,this.PA=this.distance()}},{key:"area",value:function(t){return t.getBounds().getArea()}},{key:"isComposite",value:function(t){return t instanceof Ve}}]),e}(),We=function(){function e(){t(this,e)}return n(e,[{key:"visitItem",value:function(t){}}]),e}(),Xe=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"queryInternal",value:function(){if(nt(arguments[2],We)&&arguments[0]instanceof Object&&arguments[1]instanceof Ve)for(var t=arguments[0],e=arguments[2],n=arguments[1].getChildBoundables(),i=0;i<n.size();i++){var r=n.get(i);this.getIntersectsOp().intersects(r.getBounds(),t)&&(r instanceof Ve?this.queryInternal(t,r,e):r instanceof He?e.visitItem(r.getItem()):G.shouldNeverReachHere())}else if(nt(arguments[2],tt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ve)for(var o=arguments[0],s=arguments[2],a=arguments[1].getChildBoundables(),A=0;A<a.size();A++){var u=a.get(A);this.getIntersectsOp().intersects(u.getBounds(),o)&&(u instanceof Ve?this.queryInternal(o,u,s):u instanceof He?s.add(u.getItem()):G.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this.OA}},{key:"lastNode",value:function(t){return t.get(t.size()-1)}},{key:"size",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();n instanceof Ve?t+=this.size(n):n instanceof He&&(t+=1)}return t}}},{key:"removeItem",value:function(t,e){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof He&&r.getItem()===e&&(n=r)}return null!==n&&(t.getChildBoundables().remove(n),!0)}},{key:"itemsTree",value:function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new ft:t}if(1===arguments.length){for(var e=arguments[0],n=new ft,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Ve){var o=this.itemsTree(r);null!==o&&n.add(o)}else r instanceof He?n.add(r.getItem()):G.shouldNeverReachHere()}return n.size()<=0?null:n}}},{key:"insert",value:function(t,e){G.isTrue(!this.HA,"Cannot insert items into an STR packed R-tree after it has been built."),this.zA.add(new He(t,e))}},{key:"boundablesAtLevel",value:function(){if(1===arguments.length){var t=arguments[0],e=new ft;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(G.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var o=i.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Ve?this.boundablesAtLevel(n,s,r):(G.isTrue(s instanceof He),-1===n&&r.add(s))}return null}}},{key:"query",value:function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new ft;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e),e}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,i)}}},{key:"build",value:function(){if(this.HA)return null;this._root=this.zA.isEmpty()?this.createNode(0):this.createHigherLevels(this.zA,-1),this.zA=null,this.HA=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],o=this.removeItem(i,r);if(o)return!0;for(var s=null,a=i.getChildBoundables().iterator();a.hasNext();){var A=a.next();if(this.getIntersectsOp().intersects(A.getBounds(),n)&&A instanceof Ve&&(o=this.remove(n,A,r))){s=A;break}}return null!==s&&s.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(s),o}}},{key:"createHigherLevels",value:function(t,e){G.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)}},{key:"depth",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();if(n instanceof Ve){var i=this.depth(n);i>t&&(t=i)}}return t+1}}},{key:"createParentBoundables",value:function(t,e){G.isTrue(!t.isEmpty());var n=new ft;n.add(this.createNode(e));var i=new ft(t);Je.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var o=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(o)}return n}},{key:"isEmpty",value:function(){return this.HA?this._root.isEmpty():this.zA.isEmpty()}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this._root=null,this.HA=!1,this.zA=new ft,this.OA=null,0===arguments.length)e.constructor_.call(this,e.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];G.isTrue(t>1,"Node capacity must be greater than 1"),this.OA=t}}},{key:"compareDoubles",value:function(t,e){return t>e?1:t<e?-1:0}}]),e}();Xe.IntersectsOp=function(){},Xe.DEFAULT_NODE_CAPACITY=10;var Ze=function(){function e(){t(this,e)}return n(e,[{key:"distance",value:function(t,e){}}]),e}(),tn=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"createParentBoundablesFromVerticalSlices",value:function(t,e){G.isTrue(t.length>0);for(var n=new ft,i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n}},{key:"nearestNeighbourK",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.nearestNeighbourK(t,M.POSITIVE_INFINITY,e)}if(3===arguments.length){var n=arguments[0],i=arguments[2],r=arguments[1],o=new ze;o.add(n);for(var a=new ze;!o.isEmpty()&&r>=0;){var A=o.poll(),u=A.getDistance();if(u>=r)break;A.isLeaves()?a.size()<i?a.add(A):(a.peek().getDistance()>u&&(a.poll(),a.add(A)),r=a.peek().getDistance()):A.expandToQueue(o,r)}return s.getItems(a)}}},{key:"createNode",value:function(t){return new en(t)}},{key:"size",value:function(){return 0===arguments.length?l(r(s.prototype),"size",this).call(this):l(r(s.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof q))return l(r(s.prototype),"insert",this).apply(this,arguments);var t=arguments[0],e=arguments[1];if(t.isNull())return null;l(r(s.prototype),"insert",this).call(this,t,e)}},{key:"getIntersectsOp",value:function(){return s.intersectsOp}},{key:"verticalSlices",value:function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){i[o]=new ft;for(var s=0;r.hasNext()&&s<n;){var a=r.next();i[o].add(a),s++}}return i}},{key:"query",value:function(){if(1===arguments.length){var t=arguments[0];return l(r(s.prototype),"query",this).call(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];l(r(s.prototype),"query",this).call(this,e,n)}}},{key:"getComparator",value:function(){return s.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(t,e){return l(r(s.prototype),"createParentBoundables",this).call(this,t,e)}},{key:"remove",value:function(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof q){var t=arguments[0],e=arguments[1];return l(r(s.prototype),"remove",this).call(this,t,e)}return l(r(s.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return 0===arguments.length?l(r(s.prototype),"depth",this).call(this):l(r(s.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(t,e){G.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new ft(t);Je.sort(i,s.xComparator);var r=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(r,e)}},{key:"nearestNeighbour",value:function(){if(1===arguments.length){if(nt(arguments[0],Ze)){var t=arguments[0];if(this.isEmpty())return null;var e=new je(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof je){var n=arguments[0],i=M.POSITIVE_INFINITY,r=null,o=new ze;for(o.add(n);!o.isEmpty()&&i>0;){var s=o.poll(),a=s.getDistance();if(a>=i)break;s.isLeaves()?(i=a,r=s):s.expandToQueue(o,i)}return null===r?null:[r.getBoundable(0).getItem(),r.getBoundable(1).getItem()]}}else{if(2===arguments.length){var A=arguments[0],u=arguments[1];if(this.isEmpty()||A.isEmpty())return null;var h=new je(this.getRoot(),A.getRoot(),u);return this.nearestNeighbour(h)}if(3===arguments.length){var l=arguments[2],c=new He(arguments[0],arguments[1]),f=new je(this.getRoot(),c,l);return this.nearestNeighbour(f)[0]}if(4===arguments.length){var d=arguments[2],g=arguments[3],v=new He(arguments[0],arguments[1]),I=new je(this.getRoot(),v,d);return this.nearestNeighbourK(I,g)}}}},{key:"isWithinDistance",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=M.POSITIVE_INFINITY,i=new ze;for(i.add(t);!i.isEmpty();){var r=i.poll(),o=r.getDistance();if(o>e)return!1;if(r.maximumDistance()<=e)return!0;if(r.isLeaves()){if((n=o)<=e)return!0}else r.expandToQueue(i,n)}return!1}if(3===arguments.length){var s=arguments[0],a=arguments[1],A=arguments[2],u=new je(this.getRoot(),s.getRoot(),a);return this.isWithinDistance(u,A)}}},{key:"interfaces_",get:function(){return[Ke,B]}}],[{key:"constructor_",value:function(){if(0===arguments.length)s.constructor_.call(this,s.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];Xe.constructor_.call(this,t)}}},{key:"centreX",value:function(t){return s.avg(t.getMinX(),t.getMaxX())}},{key:"avg",value:function(t,e){return(t+e)/2}},{key:"getItems",value:function(t){for(var e=new Array(t.size()).fill(null),n=0;!t.isEmpty();){var i=t.poll();e[n]=i.getBoundable(0).getItem(),n++}return e}},{key:"centreY",value:function(t){return s.avg(t.getMinY(),t.getMaxY())}}]),s}(Xe),en=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"computeBounds",value:function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new q(n.getBounds()):t.expandToInclude(n.getBounds())}return t}}],[{key:"constructor_",value:function(){var t=arguments[0];Ve.constructor_.call(this,t)}}]),o}(Ve);tn.STRtreeNode=en,tn.xComparator=new(function(){function e(){t(this,e)}return n(e,[{key:"interfaces_",get:function(){return[$]}},{key:"compare",value:function(t,e){return Xe.compareDoubles(tn.centreX(t.getBounds()),tn.centreX(e.getBounds()))}}]),e}()),tn.yComparator=new(function(){function e(){t(this,e)}return n(e,[{key:"interfaces_",get:function(){return[$]}},{key:"compare",value:function(t,e){return Xe.compareDoubles(tn.centreY(t.getBounds()),tn.centreY(e.getBounds()))}}]),e}()),tn.intersectsOp=new(function(){function e(){t(this,e)}return n(e,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(t,e){return t.intersects(e)}}]),e}()),tn.DEFAULT_NODE_CAPACITY=10;var nn=function(){function e(){t(this,e)}return n(e,null,[{key:"relativeSign",value:function(t,e){return t<e?-1:t>e?1:0}},{key:"compare",value:function(t,n,i){if(n.equals2D(i))return 0;var r=e.relativeSign(n.x,i.x),o=e.relativeSign(n.y,i.y);switch(t){case 0:return e.compareValue(r,o);case 1:return e.compareValue(o,r);case 2:return e.compareValue(o,-r);case 3:return e.compareValue(-r,o);case 4:return e.compareValue(-r,-o);case 5:return e.compareValue(-o,-r);case 6:return e.compareValue(-o,r);case 7:return e.compareValue(r,-o)}return G.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0}}]),e}(),rn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:this.KA?e.KA?nn.compare(this.VA,this.coord,e.coord):1:-1}},{key:"isEndPoint",value:function(t){return 0===this.segmentIndex&&!this.KA||this.segmentIndex===t}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this.KA}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.JA=null,this.coord=null,this.segmentIndex=null,this.VA=null,this.KA=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.JA=t,this.coord=new T(e),this.segmentIndex=n,this.VA=i,this.KA=!e.equals2D(t.getCoordinate(n))}}]),e}(),on=function(){function e(){t(this,e)}return n(e,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),e}(),sn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getSplitCoordinates",value:function(){var t=new zt;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var t=new ft;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this.mA.getCoordinate(n),n)}}},{key:"createSplitEdgePts",value:function(t,e){var n=e.segmentIndex-t.segmentIndex+2;if(2===n)return[new T(t.coord),new T(e.coord)];var i=this.mA.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);r||n--;var o=new Array(n).fill(null),s=0;o[s++]=new T(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.mA.getCoordinate(a);return r&&(o[s]=new T(e.coord)),o}},{key:"print",value:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)}},{key:"findCollapsesFromExistingVertices",value:function(t){for(var e=0;e<this.mA.size()-2;e++){var n=this.mA.getCoordinate(e);this.mA.getCoordinate(e+1);var i=this.mA.getCoordinate(e+2);n.equals2D(i)&&t.add(rt.valueOf(e+1))}}},{key:"addEdgeCoordinates",value:function(t,e,n){var i=this.createSplitEdgePts(t,e);n.add(i,!1)}},{key:"iterator",value:function(){return this.YA.values().iterator()}},{key:"addSplitEdges",value:function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}}},{key:"findCollapseIndex",value:function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,1===i&&(n[0]=t.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(t){for(var e=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,e)&&t.add(rt.valueOf(e[0])),i=r}}},{key:"getEdge",value:function(){return this.mA}},{key:"addEndpoints",value:function(){var t=this.mA.size()-1;this.add(this.mA.getCoordinate(0),0),this.add(this.mA.getCoordinate(t),t)}},{key:"createSplitEdge",value:function(t,e){var n=this.createSplitEdgePts(t,e);return new hn(n,this.mA.getData())}},{key:"add",value:function(t,e){var n=new rn(this.mA,t,e,this.mA.getSegmentOctant(e)),i=this.YA.get(n);return null!==i?(G.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this.YA.put(n,n),n)}},{key:"checkSplitEdgesCorrectness",value:function(t){var e=this.mA.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new R("bad split edge start point at "+n);var i=t.get(t.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(e[e.length-1]))throw new R("bad split edge end point at "+r)}}],[{key:"constructor_",value:function(){this.YA=new Fe,this.mA=null;var t=arguments[0];this.mA=t}}]),e}(),an=function(){function e(){t(this,e)}return n(e,null,[{key:"octant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new p("Cannot compute the octant for point ( "+t+", "+n+" )");var i=Math.abs(t),r=Math.abs(n);return t>=0?n>=0?i>=r?0:1:i>=r?7:6:n>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof T&&arguments[1]instanceof T){var o=arguments[0],s=arguments[1],a=s.x-o.x,A=s.y-o.y;if(0===a&&0===A)throw new p("Cannot compute the octant for two identical points "+o);return e.octant(a,A)}}}]),e}(),An=function(){function e(){t(this,e)}return n(e,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(t){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(t){}},{key:"getData",value:function(){}}]),e}(),un=function(){function e(){t(this,e)}return n(e,[{key:"addIntersection",value:function(t,e){}},{key:"interfaces_",get:function(){return[An]}}]),e}(),hn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getCoordinates",value:function(){return this.aA}},{key:"size",value:function(){return this.aA.length}},{key:"getCoordinate",value:function(t){return this.aA[t]}},{key:"isClosed",value:function(){return this.aA[0].equals(this.aA[this.aA.length-1])}},{key:"getSegmentOctant",value:function(t){return t===this.aA.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))}},{key:"setData",value:function(t){this.Oe=t}},{key:"safeOctant",value:function(t,e){return t.equals2D(e)?0:an.octant(t,e)}},{key:"getData",value:function(){return this.Oe}},{key:"addIntersection",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[1],i=arguments[3],r=new T(arguments[0].getIntersection(i));this.addIntersection(r,n)}}},{key:"toString",value:function(){return Ie.toLineString(new jt(this.aA))}},{key:"getNodeList",value:function(){return this.jA}},{key:"addIntersectionNode",value:function(t,e){var n=e,i=n+1;if(i<this.aA.length){var r=this.aA[i];t.equals2D(r)&&(n=i)}return this.jA.add(t,n)}},{key:"addIntersections",value:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)}},{key:"interfaces_",get:function(){return[un]}}],[{key:"constructor_",value:function(){this.jA=new sn(this),this.aA=null,this.Oe=null;var t=arguments[0],e=arguments[1];this.aA=t,this.Oe=e}},{key:"getNodedSubstrings",value:function(){if(1===arguments.length){var t=arguments[0],n=new ft;return e.getNodedSubstrings(t,n),n}if(2===arguments.length)for(var i=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(i)}}]),e}(),ln=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof e){var t=arguments[0],n=ut.index(this.p0,this.p1,t.p0),i=ut.index(this.p0,this.p1,t.p1);return n>=0&&i>=0||n<=0&&i<=0?Math.max(n,i):0}if(arguments[0]instanceof T){var r=arguments[0];return ut.index(this.p0,this.p1,r)}}},{key:"toGeometry",value:function(t){return t.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)}},{key:"intersection",value:function(t){var e=new ye;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof T){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new T(t);var n=this.projectionFactor(t),i=new T;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof e){var r=arguments[0],o=this.projectionFactor(r.p0),s=this.projectionFactor(r.p1);if(o>=1&&s>=1)return null;if(o<=0&&s<=0)return null;var a=this.project(r.p0);o<0&&(a=this.p0),o>1&&(a=this.p1);var A=this.project(r.p1);return s<0&&(A=this.p0),s>1&&(A=this.p1),new e(a,A)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(t){return 0===t?this.p0:this.p1}},{key:"distancePerpendicular",value:function(t){return yt.pointToLinePerpendicular(t,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return e.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=e*e+n*n;return i<=0?M.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/i}},{key:"closestPoints",value:function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),i=M.MAX_VALUE,r=null,o=this.closestPoint(t.p0);i=o.distance(t.p0),n[0]=o,n[1]=t.p0;var s=this.closestPoint(t.p1);(r=s.distance(t.p1))<i&&(i=r,n[0]=s,n[1]=t.p1);var a=t.closestPoint(this.p0);(r=a.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=a);var A=t.closestPoint(this.p1);return(r=A.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=A),n}},{key:"closestPoint",value:function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)}},{key:"reverse",value:function(){var t=this.p0;this.p0=this.p1,this.p1=t}},{key:"equalsTopo",value:function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)}},{key:"lineIntersection",value:function(t){return vt.intersection(this.p0,this.p1,t.p0,t.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(r*r+o*o),a=0,A=0;if(0!==e){if(s<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");a=e*r/s,A=e*o/s}return new T(n-A,i+a)}},{key:"setCoordinates",value:function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}}},{key:"segmentFraction",value:function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||M.isNaN(e))&&(e=1),e}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(t){var e=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),i=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),r=e*e+n*n,o=e*e-n*n,s=t.getX(),a=t.getY();return new T((-o*s-2*e*n*a-2*e*i)/r,(o*a-2*e*n*s-2*n*i)/r)}},{key:"distance",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return yt.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof T){var n=arguments[0];return yt.pointToSegment(n,this.p0,this.p1)}}},{key:"pointAlong",value:function(t){var e=new T;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e}},{key:"hashCode",value:function(){var t=M.doubleToLongBits(this.p0.x);t^=31*M.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=M.doubleToLongBits(this.p1.x);return n^=31*M.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)}},{key:"interfaces_",get:function(){return[w,B]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,0===arguments.length)e.constructor_.call(this,new T,new T);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.p0,t.p1)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.p0=n,this.p1=i}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];e.constructor_.call(this,new T(r,o),new T(s,a))}}},{key:"midPoint",value:function(t,e){return new T((t.x+e.x)/2,(t.y+e.y)/2)}}]),e}(),cn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"overlap",value:function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[3];arguments[0].getLineSegment(t,this.WA),e.getLineSegment(n,this.XA),this.overlap(this.WA,this.XA)}}}],[{key:"constructor_",value:function(){this.WA=new ln,this.XA=new ln}}]),e}(),fn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getLineSegment",value:function(t,e){e.p0=this.aA[t],e.p1=this.aA[t+1]}},{key:"computeSelect",value:function(t,e,n,i){var r=this.aA[e],o=this.aA[n];if(n-e==1)return i.select(this,e),null;if(!t.intersects(r,o))return null;var s=Math.trunc((e+n)/2);e<s&&this.computeSelect(t,e,s,i),s<n&&this.computeSelect(t,s,n,i)}},{key:"getCoordinates",value:function(){for(var t=new Array(this.ZA-this.tu+1).fill(null),e=0,n=this.tu;n<=this.ZA;n++)t[e++]=this.aA[n];return t}},{key:"computeOverlaps",value:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.computeOverlaps(this.tu,this.ZA,t,t.tu,t.ZA,e)}else if(6===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],o=arguments[3],s=arguments[4],a=arguments[5];if(i-n==1&&s-o==1)return a.overlap(this,n,r,o),null;if(!this.overlaps(n,i,r,o,s))return null;var A=Math.trunc((n+i)/2),u=Math.trunc((o+s)/2);n<A&&(o<u&&this.computeOverlaps(n,A,r,o,u,a),u<s&&this.computeOverlaps(n,A,r,u,s,a)),A<i&&(o<u&&this.computeOverlaps(A,i,r,o,u,a),u<s&&this.computeOverlaps(A,i,r,u,s,a))}}},{key:"setId",value:function(t){this._id=t}},{key:"select",value:function(t,e){this.computeSelect(t,this.tu,this.ZA,e)}},{key:"getEnvelope",value:function(){if(null===this.Us){var t=this.aA[this.tu],e=this.aA[this.ZA];this.Us=new q(t,e)}return this.Us}},{key:"overlaps",value:function(t,e,n,i,r){return q.intersects(this.aA[t],this.aA[e],n.aA[i],n.aA[r])}},{key:"getEndIndex",value:function(){return this.ZA}},{key:"getStartIndex",value:function(){return this.tu}},{key:"getContext",value:function(){return this.Ae}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this.aA=null,this.tu=null,this.ZA=null,this.Us=null,this.Ae=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.aA=t,this.tu=e,this.ZA=n,this.Ae=i}}]),e}(),dn=function(){function e(){t(this,e)}return n(e,null,[{key:"findChainEnd",value:function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=Le.quadrant(t[n],t[n+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||Le.quadrant(t[r-1],t[r])===i);)r++;return r-1}},{key:"getChains",value:function(){if(1===arguments.length){var t=arguments[0];return e.getChains(t,null)}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new ft,o=0;do{var s=e.findChainEnd(n,o),a=new fn(n,o,s,i);r.add(a),o=s}while(o<n.length-1);return r}}}]),e}(),gn=function(){function e(){t(this,e)}return n(e,[{key:"computeNodes",value:function(t){}},{key:"getNodedSubstrings",value:function(){}}]),e}(),vn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"setSegmentIntersector",value:function(t){this.eu=t}},{key:"interfaces_",get:function(){return[gn]}}],[{key:"constructor_",value:function(){if(this.eu=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}}}]),e}(),In=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,[{key:"getMonotoneChains",value:function(){return this.nu}},{key:"getNodedSubstrings",value:function(){return hn.getNodedSubstrings(this.iu)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(t){for(var e=dn.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var n=e.next();n.setId(this.ru++),this._index.insert(n.getEnvelope(),n),this.nu.add(n)}}},{key:"computeNodes",value:function(t){this.iu=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var t=new pn(this.eu),e=this.nu.iterator();e.hasNext();)for(var n=e.next(),i=this._index.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,t),this.ou++),this.eu.isDone())return null}}}],[{key:"constructor_",value:function(){if(this.nu=new ft,this._index=new tn,this.ru=0,this.iu=null,this.ou=0,0===arguments.length);else if(1===arguments.length){var t=arguments[0];vn.constructor_.call(this,t)}}}]),o}(vn),pn=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"overlap",value:function(){if(4!==arguments.length)return l(r(s.prototype),"overlap",this).apply(this,arguments);var t=arguments[1],e=arguments[2],n=arguments[3],i=arguments[0].getContext(),o=e.getContext();this.su.processIntersections(i,t,o,n)}}],[{key:"constructor_",value:function(){this.su=null;var t=arguments[0];this.su=t}}]),s}(cn);In.SegmentOverlapAction=pn;var yn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"isDeletable",value:function(t,e,n,i){var r=this.au[t],o=this.au[e],s=this.au[n];return!!this.isConcave(r,o,s)&&!!this.isShallow(r,o,s,i)&&this.isShallowSampled(r,o,t,n,i)}},{key:"deleteShallowConcavities",value:function(){for(var t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this.au.length;){var o=!1;this.isDeletable(t,n,i,this.Au)&&(this.uu[n]=e.DELETE,o=!0,r=!0),t=o?i:n,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n)}return r}},{key:"isShallowConcavity",value:function(t,e,n,i){return ut.index(t,e,n)===this.hu&&yt.pointToSegment(e,t,n)<i}},{key:"isShallowSampled",value:function(t,n,i,r,o){var s=Math.trunc((r-i)/e.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var a=i;a<r;a+=s)if(!this.isShallow(t,n,this.au[a],o))return!1;return!0}},{key:"isConcave",value:function(t,e,n){return ut.index(t,e,n)===this.hu}},{key:"simplify",value:function(t){this.Au=Math.abs(t),t<0&&(this.hu=ut.CLOCKWISE),this.uu=new Array(this.au.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(t){for(var n=t+1;n<this.au.length&&this.uu[n]===e.DELETE;)n++;return n}},{key:"isShallow",value:function(t,e,n,i){return yt.pointToSegment(e,t,n)<i}},{key:"collapseLine",value:function(){for(var t=new zt,n=0;n<this.au.length;n++)this.uu[n]!==e.DELETE&&t.add(this.au[n]);return t.toCoordinateArray()}}],[{key:"constructor_",value:function(){this.au=null,this.Au=null,this.uu=null,this.hu=ut.COUNTERCLOCKWISE;var t=arguments[0];this.au=t}},{key:"simplify",value:function(t,n){return new e(t).simplify(n)}}]),e}();yn.INIT=0,yn.DELETE=1,yn.KEEP=1,yn.NUM_PTS_TO_CHECK=10;var wn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getCoordinates",value:function(){return this.lu.toArray(e.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(t){this.js=t}},{key:"addPt",value:function(t){var e=new T(t);if(this.js.makePrecise(e),this.isRedundant(e))return null;this.lu.add(e)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var i=t.length-1;i>=0;i--)this.addPt(t[i])}},{key:"isRedundant",value:function(t){if(this.lu.size()<1)return!1;var e=this.lu.get(this.lu.size()-1);return t.distance(e)<this.cu}},{key:"toString",value:function(){return(new re).createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this.lu.size()<1)return null;var t=new T(this.lu.get(0)),e=this.lu.get(this.lu.size()-1);if(t.equals(e))return null;this.lu.add(t)}},{key:"setMinimumVertexDistance",value:function(t){this.cu=t}}],[{key:"constructor_",value:function(){this.lu=null,this.js=null,this.cu=0,this.lu=new ft}}]),e}();wn.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Cn=function(){function e(){t(this,e)}return n(e,null,[{key:"toDegrees",value:function(t){return 180*t/Math.PI}},{key:"normalize",value:function(t){for(;t>Math.PI;)t-=e.PI_TIMES_2;for(;t<=-Math.PI;)t+=e.PI_TIMES_2;return t}},{key:"angle",value:function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=n.x-e.x,r=n.y-e.y;return Math.atan2(r,i)}}},{key:"isAcute",value:function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)>0}},{key:"isObtuse",value:function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)<0}},{key:"interiorAngle",value:function(t,n,i){var r=e.angle(n,t),o=e.angle(n,i);return Math.abs(o-r)}},{key:"normalizePositive",value:function(t){if(t<0){for(;t<0;)t+=e.PI_TIMES_2;t>=e.PI_TIMES_2&&(t=0)}else{for(;t>=e.PI_TIMES_2;)t-=e.PI_TIMES_2;t<0&&(t=0)}return t}},{key:"angleBetween",value:function(t,n,i){var r=e.angle(n,t),o=e.angle(n,i);return e.diff(r,o)}},{key:"diff",value:function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n}},{key:"toRadians",value:function(t){return t*Math.PI/180}},{key:"getTurn",value:function(t,n){var i=Math.sin(n-t);return i>0?e.COUNTERCLOCKWISE:i<0?e.CLOCKWISE:e.NONE}},{key:"angleBetweenOriented",value:function(t,n,i){var r=e.angle(n,t),o=e.angle(n,i)-r;return o<=-Math.PI?o+e.PI_TIMES_2:o>Math.PI?o-e.PI_TIMES_2:o}}]),e}();Cn.PI_TIMES_2=2*Math.PI,Cn.PI_OVER_2=Math.PI/2,Cn.PI_OVER_4=Math.PI/4,Cn.COUNTERCLOCKWISE=ut.COUNTERCLOCKWISE,Cn.CLOCKWISE=ut.CLOCKWISE,Cn.NONE=ut.COLLINEAR;var Bn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"addNextSegment",value:function(t,e){if(this.fu=this.du,this.du=this.gu,this.gu=t,this.vu.setCoordinates(this.fu,this.du),this.computeOffsetSegment(this.vu,this.Iu,this.PA,this.pu),this.yu.setCoordinates(this.du,this.gu),this.computeOffsetSegment(this.yu,this.Iu,this.PA,this.wu),this.du.equals(this.gu))return null;var n=ut.index(this.fu,this.du,this.gu),i=n===ut.CLOCKWISE&&this.Iu===W.LEFT||n===ut.COUNTERCLOCKWISE&&this.Iu===W.RIGHT;0===n?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)}},{key:"addLineEndCap",value:function(t,e){var n=new ln(t,e),i=new ln;this.computeOffsetSegment(n,W.LEFT,this.PA,i);var r=new ln;this.computeOffsetSegment(n,W.RIGHT,this.PA,r);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this.Cu.getEndCapStyle()){case v.CAP_ROUND:this.Bu.addPt(i.p1),this.addDirectedFillet(e,a+Math.PI/2,a-Math.PI/2,ut.CLOCKWISE,this.PA),this.Bu.addPt(r.p1);break;case v.CAP_FLAT:this.Bu.addPt(i.p1),this.Bu.addPt(r.p1);break;case v.CAP_SQUARE:var A=new T;A.x=Math.abs(this.PA)*Math.cos(a),A.y=Math.abs(this.PA)*Math.sin(a);var u=new T(i.p1.x+A.x,i.p1.y+A.y),h=new T(r.p1.x+A.x,r.p1.y+A.y);this.Bu.addPt(u),this.Bu.addPt(h)}}},{key:"getCoordinates",value:function(){return this.Bu.getCoordinates()}},{key:"addMitreJoin",value:function(t,e,n,i){var r=vt.intersection(e.p0,e.p1,n.p0,n.p1);if(null!==r&&(i<=0?1:r.distance(t)/Math.abs(i))<=this.Cu.getMitreLimit())return this.Bu.addPt(r),null;this.addLimitedMitreJoin(e,n,i,this.Cu.getMitreLimit())}},{key:"addOutsideTurn",value:function(t,n){if(this.pu.p1.distance(this.wu.p0)<this.PA*e.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.Bu.addPt(this.pu.p1),null;this.Cu.getJoinStyle()===v.JOIN_MITRE?this.addMitreJoin(this.du,this.pu,this.wu,this.PA):this.Cu.getJoinStyle()===v.JOIN_BEVEL?this.addBevelJoin(this.pu,this.wu):(n&&this.Bu.addPt(this.pu.p1),this.addCornerFillet(this.du,this.pu.p1,this.wu.p0,t,this.PA),this.Bu.addPt(this.wu.p0))}},{key:"createSquare",value:function(t){this.Bu.addPt(new T(t.x+this.PA,t.y+this.PA)),this.Bu.addPt(new T(t.x+this.PA,t.y-this.PA)),this.Bu.addPt(new T(t.x-this.PA,t.y-this.PA)),this.Bu.addPt(new T(t.x-this.PA,t.y+this.PA)),this.Bu.closeRing()}},{key:"addSegments",value:function(t,e){this.Bu.addPts(t,e)}},{key:"addFirstSegment",value:function(){this.Bu.addPt(this.wu.p0)}},{key:"addCornerFillet",value:function(t,e,n,i,r){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),A=n.x-t.x,u=n.y-t.y,h=Math.atan2(u,A);i===ut.CLOCKWISE?a<=h&&(a+=2*Math.PI):a>=h&&(a-=2*Math.PI),this.Bu.addPt(e),this.addDirectedFillet(t,a,h,i,r),this.Bu.addPt(n)}},{key:"addLastSegment",value:function(){this.Bu.addPt(this.wu.p1)}},{key:"initSideSegments",value:function(t,e,n){this.du=t,this.gu=e,this.Iu=n,this.yu.setCoordinates(t,e),this.computeOffsetSegment(this.yu,n,this.PA,this.wu)}},{key:"addLimitedMitreJoin",value:function(t,e,n,i){var r=this.vu.p1,o=Cn.angle(r,this.vu.p0),s=Cn.angleBetweenOriented(this.vu.p0,r,this.yu.p1)/2,a=Cn.normalize(o+s),A=Cn.normalize(a+Math.PI),u=i*n,h=n-u*Math.abs(Math.sin(s)),l=r.x+u*Math.cos(A),c=r.y+u*Math.sin(A),f=new T(l,c),d=new ln(r,f),g=d.pointAlongOffset(1,h),v=d.pointAlongOffset(1,-h);this.Iu===W.LEFT?(this.Bu.addPt(g),this.Bu.addPt(v)):(this.Bu.addPt(v),this.Bu.addPt(g))}},{key:"addDirectedFillet",value:function(t,e,n,i,r){var o=i===ut.CLOCKWISE?-1:1,s=Math.abs(e-n),a=Math.trunc(s/this.Eu+.5);if(a<1)return null;for(var A=s/a,u=new T,h=0;h<a;h++){var l=e+o*h*A;u.x=t.x+r*Math.cos(l),u.y=t.y+r*Math.sin(l),this.Bu.addPt(u)}}},{key:"computeOffsetSegment",value:function(t,e,n,i){var r=e===W.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),A=r*n*o/a,u=r*n*s/a;i.p0.x=t.p0.x-u,i.p0.y=t.p0.y+A,i.p1.x=t.p1.x-u,i.p1.y=t.p1.y+A}},{key:"addInsideTurn",value:function(t,n){if(this.mu.computeIntersection(this.pu.p0,this.pu.p1,this.wu.p0,this.wu.p1),this.mu.hasIntersection())this.Bu.addPt(this.mu.getIntersection(0));else if(this.Qu=!0,this.pu.p1.distance(this.wu.p0)<this.PA*e.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.Bu.addPt(this.pu.p1);else{if(this.Bu.addPt(this.pu.p1),this.ku>0){var i=new T((this.ku*this.pu.p1.x+this.du.x)/(this.ku+1),(this.ku*this.pu.p1.y+this.du.y)/(this.ku+1));this.Bu.addPt(i);var r=new T((this.ku*this.wu.p0.x+this.du.x)/(this.ku+1),(this.ku*this.wu.p0.y+this.du.y)/(this.ku+1));this.Bu.addPt(r)}else this.Bu.addPt(this.du);this.Bu.addPt(this.wu.p0)}}},{key:"createCircle",value:function(t){var e=new T(t.x+this.PA,t.y);this.Bu.addPt(e),this.addDirectedFillet(t,0,2*Math.PI,-1,this.PA),this.Bu.closeRing()}},{key:"addBevelJoin",value:function(t,e){this.Bu.addPt(t.p1),this.Bu.addPt(e.p0)}},{key:"init",value:function(t){this.PA=t,this.bu=t*(1-Math.cos(this.Eu/2)),this.Bu=new wn,this.Bu.setPrecisionModel(this.js),this.Bu.setMinimumVertexDistance(t*e.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(t){this.mu.computeIntersection(this.fu,this.du,this.du,this.gu),this.mu.getIntersectionNum()>=2&&(this.Cu.getJoinStyle()===v.JOIN_BEVEL||this.Cu.getJoinStyle()===v.JOIN_MITRE?(t&&this.Bu.addPt(this.pu.p1),this.Bu.addPt(this.wu.p0)):this.addCornerFillet(this.du,this.pu.p1,this.wu.p0,ut.CLOCKWISE,this.PA))}},{key:"closeRing",value:function(){this.Bu.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this.Qu}}],[{key:"constructor_",value:function(){this.bu=0,this.Eu=null,this.ku=1,this.Bu=null,this.PA=0,this.js=null,this.Cu=null,this.mu=null,this.fu=null,this.du=null,this.gu=null,this.vu=new ln,this.yu=new ln,this.pu=new ln,this.wu=new ln,this.Iu=0,this.Qu=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.js=t,this.Cu=n,this.mu=new ye,this.Eu=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===v.JOIN_ROUND&&(this.ku=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)}}]),e}();Bn.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Bn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Bn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Bn.MAX_CLOSING_SEG_LEN_FACTOR=80;var En=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getOffsetCurve",value:function(t,e){if(this.PA=e,0===e)return null;var n=e<0,i=Math.abs(e),r=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,n,r);var o=r.getCoordinates();return n&&Kt.reverse(o),o}},{key:"computeSingleSidedBufferCurve",value:function(t,e,n){var i=this.simplifyTolerance(this.PA);if(e){n.addSegments(t,!0);var r=yn.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],W.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{n.addSegments(t,!1);var a=yn.simplify(t,i),A=a.length-1;n.initSideSegments(a[0],a[1],W.LEFT),n.addFirstSegment();for(var u=2;u<=A;u++)n.addNextSegment(a[u],!0)}n.addLastSegment(),n.closeRing()}},{key:"computeRingBufferCurve",value:function(t,e,n){var i=this.simplifyTolerance(this.PA);e===W.RIGHT&&(i=-i);var r=yn.simplify(t,i),o=r.length-1;n.initSideSegments(r[o-1],r[0],e);for(var s=1;s<=o;s++){var a=1!==s;n.addNextSegment(r[s],a)}n.closeRing()}},{key:"computeLineBufferCurve",value:function(t,e){var n=this.simplifyTolerance(this.PA),i=yn.simplify(t,n),r=i.length-1;e.initSideSegments(i[0],i[1],W.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(i[o],!0);e.addLastSegment(),e.addLineEndCap(i[r-1],i[r]);var s=yn.simplify(t,-n),a=s.length-1;e.initSideSegments(s[a],s[a-1],W.LEFT);for(var A=a-2;A>=0;A--)e.addNextSegment(s[A],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()}},{key:"computePointCurve",value:function(t,e){switch(this.Cu.getEndCapStyle()){case v.CAP_ROUND:e.createCircle(t);break;case v.CAP_SQUARE:e.createSquare(t)}}},{key:"getLineCurve",value:function(t,e){if(this.PA=e,this.isLineOffsetEmpty(e))return null;var n=Math.abs(e),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this.Cu.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,i)}else this.computeLineBufferCurve(t,i);return i.getCoordinates()}},{key:"getBufferParameters",value:function(){return this.Cu}},{key:"simplifyTolerance",value:function(t){return t*this.Cu.getSimplifyFactor()}},{key:"getRingCurve",value:function(t,n,i){if(this.PA=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return e.copyCoordinates(t);var r=this.getSegGen(i);return this.computeRingBufferCurve(t,n,r),r.getCoordinates()}},{key:"computeOffsetCurve",value:function(t,e,n){var i=this.simplifyTolerance(this.PA);if(e){var r=yn.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],W.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{var a=yn.simplify(t,i),A=a.length-1;n.initSideSegments(a[0],a[1],W.LEFT),n.addFirstSegment();for(var u=2;u<=A;u++)n.addNextSegment(a[u],!0)}n.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(t){return 0===t||t<0&&!this.Cu.isSingleSided()}},{key:"getSegGen",value:function(t){return new Bn(this.js,this.Cu,t)}}],[{key:"constructor_",value:function(){this.PA=0,this.js=null,this.Cu=null;var t=arguments[0],e=arguments[1];this.js=t,this.Cu=e}},{key:"copyCoordinates",value:function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new T(t[n]);return e}}]),e}(),mn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"findStabbedSegments",value:function(){if(1===arguments.length){for(var t=arguments[0],e=new ft,n=this._u.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,i.getDirectedEdges(),e)}return e}if(3===arguments.length)if(nt(arguments[2],tt)&&arguments[0]instanceof T&&arguments[1]instanceof Ue){for(var o=arguments[0],s=arguments[1],a=arguments[2],A=s.getEdge().getCoordinates(),u=0;u<A.length-1;u++)if(this.xu.p0=A[u],this.xu.p1=A[u+1],this.xu.p0.y>this.xu.p1.y&&this.xu.reverse(),!(Math.max(this.xu.p0.x,this.xu.p1.x)<o.x||this.xu.isHorizontal()||o.y<this.xu.p0.y||o.y>this.xu.p1.y||ut.index(this.xu.p0,this.xu.p1,o)===ut.RIGHT)){var h=s.getDepth(W.LEFT);this.xu.p0.equals(A[u])||(h=s.getDepth(W.RIGHT));var l=new Qn(this.xu,h);a.add(l)}}else if(nt(arguments[2],tt)&&arguments[0]instanceof T&&nt(arguments[1],tt))for(var c=arguments[0],f=arguments[2],d=arguments[1].iterator();d.hasNext();){var g=d.next();g.isForward()&&this.findStabbedSegments(c,g,f)}}},{key:"getDepth",value:function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Je.min(e).Du}}],[{key:"constructor_",value:function(){this._u=null,this.xu=new ln;var t=arguments[0];this._u=t}}]),e}(),Qn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"compareTo",value:function(t){var e=t;if(this.Su.minX()>=e.Su.maxX())return 1;if(this.Su.maxX()<=e.Su.minX())return-1;var n=this.Su.orientationIndex(e.Su);return 0!==n||0!=(n=-1*e.Su.orientationIndex(this.Su))?n:this.Su.compareTo(e.Su)}},{key:"compareX",value:function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)}},{key:"toString",value:function(){return this.Su.toString()}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.Su=null,this.Du=null;var t=arguments[0],e=arguments[1];this.Su=new ln(t),this.Du=e}}]),e}();mn.DepthSegment=Qn;var kn=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),e=r.call(this),o.constructor_.apply(u(e),arguments),e}return n(o,null,[{key:"constructor_",value:function(){I.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),o}(I),bn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getY",value:function(){var t=this.y/this.w;if(M.isNaN(t)||M.isInfinite(t))throw new kn;return t}},{key:"getX",value:function(){var t=this.x/this.w;if(M.isNaN(t)||M.isInfinite(t))throw new kn;return t}},{key:"getCoordinate",value:function(){var t=new T;return t.x=this.getX(),t.y=this.getY(),t}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],o=arguments[1];this.x=r.y*o.w-o.y*r.w,this.y=o.x*r.w-r.x*o.w,this.w=r.x*o.y-o.x*r.y}else if(arguments[0]instanceof T&&arguments[1]instanceof T){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var A=arguments[0],u=arguments[1],h=arguments[2];this.x=A,this.y=u,this.w=h}else if(4===arguments.length){var l=arguments[0],c=arguments[1],f=arguments[2],d=arguments[3],g=l.y-c.y,v=c.x-l.x,I=l.x*c.y-c.x*l.y,p=f.y-d.y,y=d.x-f.x,w=f.x*d.y-d.x*f.y;this.x=v*w-y*I,this.y=p*I-g*w,this.w=g*y-p*v}}}]),e}(),_n=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"area",value:function(){return e.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return e.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(t){if(null===t)throw new p("Supplied point is null.");return e.interpolateZ(t,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return e.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return e.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return e.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return e.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return e.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return e.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.p0=t,this.p1=e,this.p2=n}},{key:"area",value:function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)}},{key:"signedArea",value:function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2}},{key:"det",value:function(t,e,n,i){return t*i-e*n}},{key:"interpolateZ",value:function(t,e,n,i){var r=e.x,o=e.y,s=n.x-r,a=i.x-r,A=n.y-o,u=i.y-o,h=s*u-a*A,l=t.x-r,c=t.y-o,f=(u*l-a*c)/h,d=(-A*l+s*c)/h;return e.getZ()+f*(n.getZ()-e.getZ())+d*(i.getZ()-e.getZ())}},{key:"longestSideLength",value:function(t,e,n){var i=t.distance(e),r=e.distance(n),o=n.distance(t),s=i;return r>s&&(s=r),o>s&&(s=o),s}},{key:"circumcentreDD",value:function(t,e,n){var i=st.valueOf(t.x).subtract(n.x),r=st.valueOf(t.y).subtract(n.y),o=st.valueOf(e.x).subtract(n.x),s=st.valueOf(e.y).subtract(n.y),a=st.determinant(i,r,o,s).multiply(2),A=i.sqr().add(r.sqr()),u=o.sqr().add(s.sqr()),h=st.determinant(r,A,s,u),l=st.determinant(i,A,o,u),c=st.valueOf(n.x).subtract(h.divide(a)).doubleValue(),f=st.valueOf(n.y).add(l.divide(a)).doubleValue();return new T(c,f)}},{key:"isAcute",value:function(t,e,n){return!!Cn.isAcute(t,e,n)&&!!Cn.isAcute(e,n,t)&&!!Cn.isAcute(n,t,e)}},{key:"circumcentre",value:function(t,n,i){var r=i.x,o=i.y,s=t.x-r,a=t.y-o,A=n.x-r,u=n.y-o,h=2*e.det(s,a,A,u),l=e.det(a,s*s+a*a,u,A*A+u*u),c=e.det(s,s*s+a*a,A,A*A+u*u);return new T(r-l/h,o+c/h)}},{key:"perpendicularBisector",value:function(t,e){var n=e.x-t.x,i=e.y-t.y,r=new bn(t.x+n/2,t.y+i/2,1),o=new bn(t.x-i+n/2,t.y+n+i/2,1);return new bn(r,o)}},{key:"angleBisector",value:function(t,e,n){var i=e.distance(t),r=i/(i+e.distance(n)),o=n.x-t.x,s=n.y-t.y;return new T(t.x+r*o,t.y+r*s)}},{key:"area3D",value:function(t,e,n){var i=e.x-t.x,r=e.y-t.y,o=e.getZ()-t.getZ(),s=n.x-t.x,a=n.y-t.y,A=n.getZ()-t.getZ(),u=r*A-o*a,h=o*s-i*A,l=i*a-r*s,c=u*u+h*h+l*l;return Math.sqrt(c)/2}},{key:"centroid",value:function(t,e,n){var i=(t.x+e.x+n.x)/3,r=(t.y+e.y+n.y)/3;return new T(i,r)}},{key:"inCentre",value:function(t,e,n){var i=e.distance(n),r=t.distance(n),o=t.distance(e),s=i+r+o,a=(i*t.x+r*e.x+o*n.x)/s,A=(i*t.y+r*e.y+o*n.y)/s;return new T(a,A)}}]),e}(),xn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"addRingSide",value:function(t,e,n,i,r){if(0===e&&t.length<Tt.MINIMUM_VALID_SIZE)return null;var o=i,s=r;t.length>=Tt.MINIMUM_VALID_SIZE&&ut.isCCW(t)&&(o=r,s=i,n=W.opposite(n));var a=this.Mu.getRingCurve(t,n,e);this.addCurve(a,o,s)}},{key:"addRingBothSides",value:function(t,e){this.addRingSide(t,e,W.LEFT,H.EXTERIOR,H.INTERIOR),this.addRingSide(t,e,W.RIGHT,H.INTERIOR,H.EXTERIOR)}},{key:"addPoint",value:function(t){if(this.PA<=0)return null;var e=t.getCoordinates(),n=this.Mu.getLineCurve(e,this.PA);this.addCurve(n,H.EXTERIOR,H.INTERIOR)}},{key:"addPolygon",value:function(t){var e=this.PA,n=W.LEFT;this.PA<0&&(e=-this.PA,n=W.RIGHT);var i=t.getExteriorRing(),r=Kt.removeRepeatedPoints(i.getCoordinates());if(this.PA<0&&this.isErodedCompletely(i,this.PA))return null;if(this.PA<=0&&r.length<3)return null;this.addRingSide(r,e,n,H.EXTERIOR,H.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var s=t.getInteriorRingN(o),a=Kt.removeRepeatedPoints(s.getCoordinates());this.PA>0&&this.isErodedCompletely(s,-this.PA)||this.addRingSide(a,e,W.opposite(n),H.INTERIOR,H.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(t,e){var n=new _n(t[0],t[1],t[2]),i=n.inCentre();return yt.pointToSegment(i,n.p0,n.p1)<Math.abs(e)}},{key:"addLineString",value:function(t){if(this.Mu.isLineOffsetEmpty(this.PA))return null;var e=Kt.removeRepeatedPoints(t.getCoordinates());if(Kt.isRing(e)&&!this.Mu.getBufferParameters().isSingleSided())this.addRingBothSides(e,this.PA);else{var n=this.Mu.getLineCurve(e,this.PA);this.addCurve(n,H.EXTERIOR,H.INTERIOR)}}},{key:"addCurve",value:function(t,e,n){if(null===t||t.length<2)return null;var i=new hn(t,new Ee(0,H.BOUNDARY,e,n));this.$u.add(i)}},{key:"getCurves",value:function(){return this.add(this.Ru),this.$u}},{key:"add",value:function(t){if(t.isEmpty())return null;if(t instanceof Rt)this.addPolygon(t);else if(t instanceof _t)this.addLineString(t);else if(t instanceof Dt)this.addPoint(t);else if(t instanceof Ut)this.addCollection(t);else if(t instanceof ie)this.addCollection(t);else if(t instanceof Xt)this.addCollection(t);else{if(!(t instanceof Nt))throw new V(t.getGeometryType());this.addCollection(t)}}},{key:"isErodedCompletely",value:function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var i=t.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>r}},{key:"addCollection",value:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}}}],[{key:"constructor_",value:function(){this.Ru=null,this.PA=null,this.Mu=null,this.$u=new ft;var t=arguments[0],e=arguments[1],n=arguments[2];this.Ru=t,this.PA=e,this.Mu=n}}]),e}(),Dn=function(){function e(){t(this,e)}return n(e,[{key:"locate",value:function(t){}}]),e}(),Sn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"next",value:function(){if(this.Fu)return this.Fu=!1,e.isAtomic(this.Gu)&&this._index++,this.Gu;if(null!==this.Lu){if(this.Lu.hasNext())return this.Lu.next();this.Lu=null}if(this._index>=this.Nu)throw new K;var t=this.Gu.getGeometryN(this._index++);return t instanceof Nt?(this.Lu=new e(t),this.Lu.next()):t}},{key:"remove",value:function(){throw new V(this.getClass().getName())}},{key:"hasNext",value:function(){if(this.Fu)return!0;if(null!==this.Lu){if(this.Lu.hasNext())return!0;this.Lu=null}return!(this._index>=this.Nu)}},{key:"interfaces_",get:function(){return[on]}}],[{key:"constructor_",value:function(){this.Gu=null,this.Fu=null,this.Nu=null,this._index=null,this.Lu=null;var t=arguments[0];this.Gu=t,this.Fu=!0,this._index=0,this.Nu=t.getNumGeometries()}},{key:"isAtomic",value:function(t){return!(t instanceof Nt)}}]),e}(),Mn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"locate",value:function(t){return e.locate(t,this.Uu)}},{key:"interfaces_",get:function(){return[Dn]}}],[{key:"constructor_",value:function(){this.Uu=null;var t=arguments[0];this.Uu=t}},{key:"locatePointInPolygon",value:function(t,n){if(n.isEmpty())return H.EXTERIOR;var i=n.getExteriorRing(),r=e.locatePointInRing(t,i);if(r!==H.INTERIOR)return r;for(var o=0;o<n.getNumInteriorRing();o++){var s=n.getInteriorRingN(o),a=e.locatePointInRing(t,s);if(a===H.BOUNDARY)return H.BOUNDARY;if(a===H.INTERIOR)return H.EXTERIOR}return H.INTERIOR}},{key:"locatePointInRing",value:function(t,e){return e.getEnvelopeInternal().intersects(t)?Ce.locateInRing(t,e.getCoordinates()):H.EXTERIOR}},{key:"containsPointInPolygon",value:function(t,n){return H.EXTERIOR!==e.locatePointInPolygon(t,n)}},{key:"locateInGeometry",value:function(t,n){if(n instanceof Rt)return e.locatePointInPolygon(t,n);if(n instanceof Nt)for(var i=new Sn(n);i.hasNext();){var r=i.next();if(r!==n){var o=e.locateInGeometry(t,r);if(o!==H.EXTERIOR)return o}}return H.EXTERIOR}},{key:"isContained",value:function(t,n){return H.EXTERIOR!==e.locate(t,n)}},{key:"locate",value:function(t,n){return n.isEmpty()?H.EXTERIOR:n.getEnvelopeInternal().intersects(t)?e.locateInGeometry(t,n):H.EXTERIOR}}]),e}(),$n=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getNextCW",value:function(t){this.getEdges();var e=this.Tu.indexOf(t),n=e-1;return 0===e&&(n=this.Tu.size()-1),this.Tu.get(n)}},{key:"propagateSideLabels",value:function(t){for(var e=H.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(t)&&i.getLocation(t,W.LEFT)!==H.NONE&&(e=i.getLocation(t,W.LEFT))}if(e===H.NONE)return null;for(var r=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,W.ON)===H.NONE&&a.setLocation(t,W.ON,r),a.isArea(t)){var A=a.getLocation(t,W.LEFT),u=a.getLocation(t,W.RIGHT);if(u!==H.NONE){if(u!==r)throw new lt("side location conflict",s.getCoordinate());A===H.NONE&&G.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=A}else G.isTrue(a.getLocation(t,W.LEFT)===H.NONE,"found single null side"),a.setLocation(t,W.RIGHT,r),a.setLocation(t,W.LEFT,r)}}}},{key:"getCoordinate",value:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null}},{key:"print",value:function(t){It.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)}},{key:"isAreaLabelsConsistent",value:function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,i=e.get(n).getLabel().getLocation(t,W.LEFT);G.isTrue(i!==H.NONE,"Found unlabelled area edge");for(var r=i,o=this.iterator();o.hasNext();){var s=o.next().getLabel();G.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,W.LEFT),A=s.getLocation(t,W.RIGHT);if(a===A)return!1;if(A!==r)return!1;r=a}return!0}},{key:"findIndex",value:function(t){this.iterator();for(var e=0;e<this.Tu.size();e++)if(this.Tu.get(e)===t)return e;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return null===this.Tu&&(this.Tu=new ft(this.Pu.values())),this.Tu}},{key:"getLocation",value:function(t,e,n){return this.qu[t]===H.NONE&&(this.qu[t]=Mn.locate(e,n[t].getGeometry())),this.qu[t]}},{key:"toString",value:function(){var t=new it;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()}},{key:"computeEdgeEndLabels",value:function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)}},{key:"computeLabelling",value:function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===H.BOUNDARY&&(e[r]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),A=0;A<2;A++)if(a.isAnyNull(A)){var u=H.NONE;if(e[A])u=H.EXTERIOR;else{var h=s.getCoordinate();u=this.getLocation(A,h,t)}a.setAllLocationsIfNull(A,u)}}},{key:"getDegree",value:function(){return this.Pu.size()}},{key:"insertEdgeEnd",value:function(t,e){this.Pu.put(t,e),this.Tu=null}}],[{key:"constructor_",value:function(){this.Pu=new Fe,this.Tu=null,this.qu=[H.NONE,H.NONE]}}]),e}(),Rn=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var t=null,e=null,n=this.Ou,i=0;i<this.Hu.size();i++){var r=this.Hu.get(i),o=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),n){case this.Ou:if(!o.isInResult())continue;e=o,n=this.zu;break;case this.zu:if(!r.isInResult())continue;e.setNext(r),n=this.Ou}}if(n===this.zu){if(null===t)throw new lt("no outgoing dirEdge found",this.getCoordinate());G.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}}},{key:"insert",value:function(t){var e=t;this.insertEdgeEnd(e,e)}},{key:"getRightmostEdge",value:function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var i=t.get(e-1),r=n.getQuadrant(),o=i.getQuadrant();return Le.isNorthern(r)&&Le.isNorthern(o)?n:Le.isNorthern(r)||Le.isNorthern(o)?0!==n.getDy()?n:0!==i.getDy()?i:(G.shouldNeverReachHere("found two horizontal edges incident on node"),null):i}},{key:"print",value:function(t){It.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}}},{key:"getResultAreaEdges",value:function(){if(null!==this.Hu)return this.Hu;this.Hu=new ft;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this.Hu.add(e)}return this.Hu}},{key:"updateLabelling",value:function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var t=null,e=null,n=this.Tu.size()-1;n>=0;n--){var i=this.Tu.get(n),r=i.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=i}e.setNext(t)}},{key:"computeDepths",value:function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=t.getDepth(W.LEFT),i=t.getDepth(W.RIGHT),r=this.computeDepths(e+1,this.Tu.size(),n);if(this.computeDepths(0,e,r)!==i)throw new lt("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var A=this.Tu.get(a);A.setEdgeDepths(W.RIGHT,s),s=A.getDepth(W.LEFT)}return s}}},{key:"mergeSymLabels",value:function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(t){for(var e=null,n=null,i=this.Ou,r=this.Hu.size()-1;r>=0;r--){var o=this.Hu.get(r),s=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),i){case this.Ou:if(s.getEdgeRing()!==t)continue;n=s,i=this.zu;break;case this.zu:if(o.getEdgeRing()!==t)continue;n.setNextMin(o),i=this.Ou}}i===this.zu&&(G.isTrue(null!==e,"found null for first outgoing dirEdge"),G.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))}},{key:"getOutgoingDegree",value:function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var n=arguments[0],i=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===n&&i++;return i}}},{key:"getLabel",value:function(){return this.hA}},{key:"findCoveredLineEdges",value:function(){for(var t=H.NONE,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=H.INTERIOR;break}if(i.isInResult()){t=H.EXTERIOR;break}}}if(t===H.NONE)return null;for(var r=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===H.INTERIOR):(s.isInResult()&&(r=H.EXTERIOR),a.isInResult()&&(r=H.INTERIOR))}}},{key:"computeLabelling",value:function(t){l(r(s.prototype),"computeLabelling",this).call(this,t),this.hA=new Ee(H.NONE);for(var e=this.iterator();e.hasNext();)for(var n=e.next().getEdge().getLabel(),i=0;i<2;i++){var o=n.getLocation(i);o!==H.INTERIOR&&o!==H.BOUNDARY||this.hA.setLocation(i,H.INTERIOR)}}}],[{key:"constructor_",value:function(){this.Hu=null,this.hA=null,this.Ou=1,this.zu=2}}]),s}($n),Fn=function(e){i(o,e);var r=h(o);function o(){return t(this,o),r.call(this)}return n(o,[{key:"createNode",value:function(t){return new _e(t,new Rn)}}]),o}(Te),Gn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"compareTo",value:function(t){var n=t;return e.compareOriented(this.aA,this.Ku,n.aA,n.Ku)}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.aA=null,this.Ku=null;var t=arguments[0];this.aA=t,this.Ku=e.orientation(t)}},{key:"orientation",value:function(t){return 1===Kt.increasingDirection(t)}},{key:"compareOriented",value:function(t,e,n,i){for(var r=e?1:-1,o=i?1:-1,s=e?t.length:-1,a=i?n.length:-1,A=e?0:t.length-1,u=i?0:n.length-1;;){var h=t[A].compareTo(n[u]);if(0!==h)return h;var l=(A+=r)===s,c=(u+=o)===a;if(l&&!c)return-1;if(!l&&c)return 1;if(l&&c)return 0}}}]),e}(),Ln=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"print",value:function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this.cA.size();e++){var n=this.cA.get(e);e>0&&t.print(","),t.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&t.print(","),t.print(i[r].x+" "+i[r].y);t.println(")")}t.print(")  ")}},{key:"addAll",value:function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())}},{key:"findEdgeIndex",value:function(t){for(var e=0;e<this.cA.size();e++)if(this.cA.get(e).equals(t))return e;return-1}},{key:"iterator",value:function(){return this.cA.iterator()}},{key:"getEdges",value:function(){return this.cA}},{key:"get",value:function(t){return this.cA.get(t)}},{key:"findEqualEdge",value:function(t){var e=new Gn(t.getCoordinates());return this.Vu.get(e)}},{key:"add",value:function(t){this.cA.add(t);var e=new Gn(t.getCoordinates());this.Vu.put(e,t)}}],[{key:"constructor_",value:function(){this.cA=new ft,this.Vu=new Fe}}]),e}(),Nn=function(){function e(){t(this,e)}return n(e,[{key:"processIntersections",value:function(t,e,n,i){}},{key:"isDone",value:function(){}}]),e}(),Un=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"isTrivialIntersection",value:function(t,n,i,r){if(t===i&&1===this.mu.getIntersectionNum()){if(e.isAdjacentSegments(n,r))return!0;if(t.isClosed()){var o=t.size()-1;if(0===n&&r===o||0===r&&n===o)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this.Ju}},{key:"hasProperInteriorIntersection",value:function(){return this.Yu}},{key:"getLineIntersector",value:function(){return this.mu}},{key:"hasProperIntersection",value:function(){return this.ju}},{key:"processIntersections",value:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.mu.computeIntersection(r,o,s,a),this.mu.hasIntersection()&&(this.numIntersections++,this.mu.isInteriorIntersection()&&(this.numInteriorIntersections++,this.Wu=!0),this.isTrivialIntersection(t,e,n,i)||(this.Xu=!0,t.addIntersections(this.mu,e,0),n.addIntersections(this.mu,i,1),this.mu.isProper()&&(this.numProperIntersections++,this.ju=!0,this.Yu=!0)))}},{key:"hasIntersection",value:function(){return this.Xu}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this.Wu}},{key:"interfaces_",get:function(){return[Nn]}}],[{key:"constructor_",value:function(){this.Xu=!1,this.ju=!1,this.Yu=!1,this.Wu=!1,this.Ju=null,this.mu=null,this.Zu=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this.mu=t}},{key:"isAdjacentSegments",value:function(t,e){return 1===Math.abs(t-e)}}]),e}(),Tn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)}},{key:"compareTo",value:function(t){var e=t;return this.compare(e.segmentIndex,e.dist)}},{key:"isEndPoint",value:function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new T(t),this.segmentIndex=e,this.dist=n}}]),e}(),Pn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"print",value:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)}},{key:"iterator",value:function(){return this.YA.values().iterator()}},{key:"addSplitEdges",value:function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}}},{key:"addEndpoints",value:function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)}},{key:"createSplitEdge",value:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(i);r||n--;var o=new Array(n).fill(null),s=0;o[s++]=new T(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return r&&(o[s]=e.coord),new Vn(o,new Ee(this.edge.hA))}},{key:"add",value:function(t,e,n){var i=new Tn(t,e,n),r=this.YA.get(i);return null!==r?r:(this.YA.put(i,i),i)}},{key:"isIntersection",value:function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1}}],[{key:"constructor_",value:function(){this.YA=new Fe,this.edge=null;var t=arguments[0];this.edge=t}}]),e}(),qn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(e.isTrue(this.th[H.INTERIOR][H.INTERIOR])||e.isTrue(this.th[H.INTERIOR][H.BOUNDARY])||e.isTrue(this.th[H.BOUNDARY][H.INTERIOR])||e.isTrue(this.th[H.BOUNDARY][H.BOUNDARY]))&&this.th[H.EXTERIOR][H.INTERIOR]===Qt.FALSE&&this.th[H.EXTERIOR][H.BOUNDARY]===Qt.FALSE}},{key:"isCoveredBy",value:function(){return(e.isTrue(this.th[H.INTERIOR][H.INTERIOR])||e.isTrue(this.th[H.INTERIOR][H.BOUNDARY])||e.isTrue(this.th[H.BOUNDARY][H.INTERIOR])||e.isTrue(this.th[H.BOUNDARY][H.BOUNDARY]))&&this.th[H.INTERIOR][H.EXTERIOR]===Qt.FALSE&&this.th[H.BOUNDARY][H.EXTERIOR]===Qt.FALSE}},{key:"set",value:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.th[n][i]=Qt.toDimensionValue(t.charAt(e))}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this.th[r][o]=s}}},{key:"isContains",value:function(){return e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&this.th[H.EXTERIOR][H.INTERIOR]===Qt.FALSE&&this.th[H.EXTERIOR][H.BOUNDARY]===Qt.FALSE}},{key:"setAtLeast",value:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.setAtLeast(n,i,Qt.toDimensionValue(t.charAt(e)))}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this.th[r][o]<s&&(this.th[r][o]=s)}}},{key:"setAtLeastIfValid",value:function(t,e,n){t>=0&&e>=0&&this.setAtLeast(t,e,n)}},{key:"isWithin",value:function(){return e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&this.th[H.INTERIOR][H.EXTERIOR]===Qt.FALSE&&this.th[H.BOUNDARY][H.EXTERIOR]===Qt.FALSE}},{key:"isTouches",value:function(t,n){return t>n?this.isTouches(n,t):(t===Qt.A&&n===Qt.A||t===Qt.L&&n===Qt.L||t===Qt.L&&n===Qt.A||t===Qt.P&&n===Qt.A||t===Qt.P&&n===Qt.L)&&this.th[H.INTERIOR][H.INTERIOR]===Qt.FALSE&&(e.isTrue(this.th[H.INTERIOR][H.BOUNDARY])||e.isTrue(this.th[H.BOUNDARY][H.INTERIOR])||e.isTrue(this.th[H.BOUNDARY][H.BOUNDARY]))}},{key:"isOverlaps",value:function(t,n){return t===Qt.P&&n===Qt.P||t===Qt.A&&n===Qt.A?e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&e.isTrue(this.th[H.INTERIOR][H.EXTERIOR])&&e.isTrue(this.th[H.EXTERIOR][H.INTERIOR]):t===Qt.L&&n===Qt.L&&1===this.th[H.INTERIOR][H.INTERIOR]&&e.isTrue(this.th[H.INTERIOR][H.EXTERIOR])&&e.isTrue(this.th[H.EXTERIOR][H.INTERIOR])}},{key:"isEquals",value:function(t,n){return t===n&&e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&this.th[H.INTERIOR][H.EXTERIOR]===Qt.FALSE&&this.th[H.BOUNDARY][H.EXTERIOR]===Qt.FALSE&&this.th[H.EXTERIOR][H.INTERIOR]===Qt.FALSE&&this.th[H.EXTERIOR][H.BOUNDARY]===Qt.FALSE}},{key:"toString",value:function(){for(var t=new Yt("123456789"),e=0;e<3;e++)for(var n=0;n<3;n++)t.setCharAt(3*e+n,Qt.toDimensionSymbol(this.th[e][n]));return t.toString()}},{key:"setAll",value:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this.th[e][n]=t}},{key:"get",value:function(t,e){return this.th[t][e]}},{key:"transpose",value:function(){var t=this.th[1][0];return this.th[1][0]=this.th[0][1],this.th[0][1]=t,t=this.th[2][0],this.th[2][0]=this.th[0][2],this.th[0][2]=t,t=this.th[2][1],this.th[2][1]=this.th[1][2],this.th[1][2]=t,this}},{key:"matches",value:function(t){if(9!==t.length)throw new p("Should be length 9: "+t);for(var n=0;n<3;n++)for(var i=0;i<3;i++)if(!e.matches(this.th[n][i],t.charAt(3*n+i)))return!1;return!0}},{key:"add",value:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this.setAtLeast(e,n,t.get(e,n))}},{key:"isDisjoint",value:function(){return this.th[H.INTERIOR][H.INTERIOR]===Qt.FALSE&&this.th[H.INTERIOR][H.BOUNDARY]===Qt.FALSE&&this.th[H.BOUNDARY][H.INTERIOR]===Qt.FALSE&&this.th[H.BOUNDARY][H.BOUNDARY]===Qt.FALSE}},{key:"isCrosses",value:function(t,n){return t===Qt.P&&n===Qt.L||t===Qt.P&&n===Qt.A||t===Qt.L&&n===Qt.A?e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&e.isTrue(this.th[H.INTERIOR][H.EXTERIOR]):t===Qt.L&&n===Qt.P||t===Qt.A&&n===Qt.P||t===Qt.A&&n===Qt.L?e.isTrue(this.th[H.INTERIOR][H.INTERIOR])&&e.isTrue(this.th[H.EXTERIOR][H.INTERIOR]):t===Qt.L&&n===Qt.L&&0===this.th[H.INTERIOR][H.INTERIOR]}},{key:"interfaces_",get:function(){return[C]}}],[{key:"constructor_",value:function(){if(this.th=null,0===arguments.length)this.th=Array(3).fill().map((function(){return Array(3)})),this.setAll(Qt.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];e.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof e){var n=arguments[0];e.constructor_.call(this),this.th[H.INTERIOR][H.INTERIOR]=n.th[H.INTERIOR][H.INTERIOR],this.th[H.INTERIOR][H.BOUNDARY]=n.th[H.INTERIOR][H.BOUNDARY],this.th[H.INTERIOR][H.EXTERIOR]=n.th[H.INTERIOR][H.EXTERIOR],this.th[H.BOUNDARY][H.INTERIOR]=n.th[H.BOUNDARY][H.INTERIOR],this.th[H.BOUNDARY][H.BOUNDARY]=n.th[H.BOUNDARY][H.BOUNDARY],this.th[H.BOUNDARY][H.EXTERIOR]=n.th[H.BOUNDARY][H.EXTERIOR],this.th[H.EXTERIOR][H.INTERIOR]=n.th[H.EXTERIOR][H.INTERIOR],this.th[H.EXTERIOR][H.BOUNDARY]=n.th[H.EXTERIOR][H.BOUNDARY],this.th[H.EXTERIOR][H.EXTERIOR]=n.th[H.EXTERIOR][H.EXTERIOR]}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return n===Qt.SYM_DONTCARE||n===Qt.SYM_TRUE&&(t>=0||t===Qt.TRUE)||n===Qt.SYM_FALSE&&t===Qt.FALSE||n===Qt.SYM_P&&t===Qt.P||n===Qt.SYM_L&&t===Qt.L||n===Qt.SYM_A&&t===Qt.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var i=arguments[1];return new e(arguments[0]).matches(i)}}},{key:"isTrue",value:function(t){return t>=0||t===Qt.TRUE}}]),e}(),On=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"size",value:function(){return this.Ni}},{key:"addAll",value:function(t){return null===t||0===t.length?null:(this.ensureCapacity(this.Ni+t.length),It.arraycopy(t,0,this.Oe,this.Ni,t.length),void(this.Ni+=t.length))}},{key:"ensureCapacity",value:function(t){if(t<=this.Oe.length)return null;var e=Math.max(t,2*this.Oe.length);this.Oe=Mt.copyOf(this.Oe,e)}},{key:"toArray",value:function(){var t=new Array(this.Ni).fill(null);return It.arraycopy(this.Oe,0,t,0,this.Ni),t}},{key:"add",value:function(t){this.ensureCapacity(this.Ni+1),this.Oe[this.Ni]=t,++this.Ni}}],[{key:"constructor_",value:function(){if(this.Oe=null,this.Ni=0,0===arguments.length)e.constructor_.call(this,10);else if(1===arguments.length){var t=arguments[0];this.Oe=new Array(t).fill(null)}}}]),e}(),Hn=function(){function e(){t(this,e)}return n(e,[{key:"getChainStartIndices",value:function(t){var e=0,n=new On(Math.trunc(t.length/2));n.add(e);do{var i=this.findChainEnd(t,e);n.add(i),e=i}while(e<t.length-1);return n.toArray()}},{key:"findChainEnd",value:function(t,e){for(var n=Le.quadrant(t[e],t[e+1]),i=e+1;i<t.length&&Le.quadrant(t[i-1],t[i])===n;)i++;return i-1}},{key:"OLDgetChainStartIndices",value:function(t){var n=0,i=new ft;i.add(n);do{var r=this.findChainEnd(t,n);i.add(r),n=r}while(n<t.length-1);return e.toIntArray(i)}}],[{key:"toIntArray",value:function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e}}]),e}(),zn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n}},{key:"getMinX",value:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n}},{key:"computeIntersectsForChain",value:function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],A=arguments[4],u=arguments[5];if(o-r==1&&A-a==1)return u.addIntersections(this.e,r,s.e,a),null;if(!this.overlaps(r,o,s,a,A))return null;var h=Math.trunc((r+o)/2),l=Math.trunc((a+A)/2);r<h&&(a<l&&this.computeIntersectsForChain(r,h,s,a,l,u),l<A&&this.computeIntersectsForChain(r,h,s,l,A,u)),h<o&&(a<l&&this.computeIntersectsForChain(h,o,s,a,l,u),l<A&&this.computeIntersectsForChain(h,o,s,l,A,u))}}},{key:"overlaps",value:function(t,e,n,i,r){return q.intersects(this.pts[t],this.pts[e],n.pts[i],n.pts[r])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Hn;this.startIndex=e.getChainStartIndices(this.pts)}}]),e}(),Kn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"getDepth",value:function(t,e){return this.kA[t][e]}},{key:"setDepth",value:function(t,e,n){this.kA[t][e]=n}},{key:"isNull",value:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(this.kA[t][n]!==e.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this.kA[i][1]===e.NULL_VALUE}if(2===arguments.length){var r=arguments[0],o=arguments[1];return this.kA[r][o]===e.NULL_VALUE}}},{key:"normalize",value:function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this.kA[t][1];this.kA[t][2]<e&&(e=this.kA[t][2]),e<0&&(e=0);for(var n=1;n<3;n++){var i=0;this.kA[t][n]>e&&(i=1),this.kA[t][n]=i}}}},{key:"getDelta",value:function(t){return this.kA[t][W.RIGHT]-this.kA[t][W.LEFT]}},{key:"getLocation",value:function(t,e){return this.kA[t][e]<=0?H.EXTERIOR:H.INTERIOR}},{key:"toString",value:function(){return"A: "+this.kA[0][1]+","+this.kA[0][2]+" B: "+this.kA[1][1]+","+this.kA[1][2]}},{key:"add",value:function(){if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==H.EXTERIOR&&r!==H.INTERIOR||(this.isNull(n,i)?this.kA[n][i]=e.depthAtLocation(r):this.kA[n][i]+=e.depthAtLocation(r))}else if(3===arguments.length){var o=arguments[0],s=arguments[1];arguments[2]===H.INTERIOR&&this.kA[o][s]++}}}],[{key:"constructor_",value:function(){this.kA=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var n=0;n<3;n++)this.kA[t][n]=e.NULL_VALUE}},{key:"depthAtLocation",value:function(t){return t===H.EXTERIOR?0:t===H.INTERIOR?1:e.NULL_VALUE}}]),e}();Kn.NULL_VALUE=-1;var Vn=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"getDepth",value:function(){return this.kA}},{key:"getCollapsedEdge",value:function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new s(t,Ee.toLineLabel(this.hA))}},{key:"isIsolated",value:function(){return this.eh}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(t){this.eh=t}},{key:"setName",value:function(t){this.po=t}},{key:"equals",value:function(t){if(!(t instanceof s))return!1;var e=t;if(this.pts.length!==e.pts.length)return!1;for(var n=!0,i=!0,r=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(e.pts[o])||(n=!1),this.pts[o].equals2D(e.pts[--r])||(i=!1),!n&&!i)return!1;return!0}},{key:"getCoordinate",value:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}}},{key:"print",value:function(t){t.print("edge "+this.po+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this.hA+" "+this.nh)}},{key:"computeIM",value:function(t){s.updateIM(this.hA,t)}},{key:"isCollapsed",value:function(){return!!this.hA.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this.nh}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(t){t.print("edge "+this.po+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")}},{key:"getMonotoneChainEdge",value:function(){return null===this.ih&&(this.ih=new zn(this)),this.ih}},{key:"getEnvelope",value:function(){if(null===this.Us){this.Us=new q;for(var t=0;t<this.pts.length;t++)this.Us.expandToInclude(this.pts[t])}return this.Us}},{key:"addIntersection",value:function(t,e,n,i){var r=new T(t.getIntersection(i)),o=e,s=t.getEdgeDistance(n,i),a=o+1;if(a<this.pts.length){var A=this.pts[a];r.equals2D(A)&&(o=a,s=0)}this.eiList.add(r,o,s)}},{key:"toString",value:function(){var t=new Yt;t.append("edge "+this.po+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this.hA+" "+this.nh),t.toString()}},{key:"isPointwiseEqual",value:function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0}},{key:"setDepthDelta",value:function(t){this.nh=t}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)}}],[{key:"constructor_",value:function(){if(this.pts=null,this.Us=null,this.eiList=new Pn(this),this.po=null,this.ih=null,this.eh=!0,this.kA=new Kn,this.nh=0,1===arguments.length){var t=arguments[0];s.constructor_.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.pts=e,this.hA=n}}},{key:"updateIM",value:function(){if(!(2===arguments.length&&arguments[1]instanceof qn&&arguments[0]instanceof Ee))return l(r(s),"updateIM",this).apply(this,arguments);var t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,W.ON),t.getLocation(1,W.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,W.LEFT),t.getLocation(1,W.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,W.RIGHT),t.getLocation(1,W.RIGHT),2))}}]),s}(be),Jn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"setWorkingPrecisionModel",value:function(t){this.rh=t}},{key:"insertUniqueEdge",value:function(t){var n=this.Tu.findEqualEdge(t);if(null!==n){var i=n.getLabel(),r=t.getLabel();n.isPointwiseEqual(t)||(r=new Ee(t.getLabel())).flip(),i.merge(r);var o=e.depthDelta(r),s=n.getDepthDelta()+o;n.setDepthDelta(s)}else this.Tu.add(t),t.setDepthDelta(e.depthDelta(t.getLabel()))}},{key:"buildSubgraphs",value:function(t,e){for(var n=new ft,i=t.iterator();i.hasNext();){var r=i.next(),o=r.getRightmostCoordinate(),s=new mn(n).getDepth(o);r.computeDepth(s),r.findResultEdges(),n.add(r),e.add(r.getDirectedEdges(),r.getNodes())}}},{key:"createSubgraphs",value:function(t){for(var e=new ft,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new gt;r.create(i),e.add(r)}}return Je.sort(e,Je.reverseOrder()),e}},{key:"createEmptyResultGeometry",value:function(){return this.oh.createPolygon()}},{key:"getNoder",value:function(t){if(null!==this.sh)return this.sh;var e=new In,n=new ye;return n.setPrecisionModel(t),e.setSegmentIntersector(new Un(n)),e}},{key:"buffer",value:function(t,e){var n=this.rh;null===n&&(n=t.getPrecisionModel()),this.oh=t.getFactory();var i=new En(n,this.Cu),r=new xn(t,e,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this.ah=new Pe(new Fn),this.ah.addEdges(this.Tu.getEdges());var o=this.createSubgraphs(this.ah),s=new qe(this.oh);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this.oh.buildGeometry(a)}},{key:"computeNodedEdges",value:function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),o=r.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=r.getData(),a=new Vn(r.getCoordinates(),new Ee(s));this.insertUniqueEdge(a)}}}},{key:"setNoder",value:function(t){this.sh=t}}],[{key:"constructor_",value:function(){this.Cu=null,this.rh=null,this.sh=null,this.oh=null,this.ah=null,this.Tu=new Ln;var t=arguments[0];this.Cu=t}},{key:"depthDelta",value:function(t){var e=t.getLocation(0,W.LEFT),n=t.getLocation(0,W.RIGHT);return e===H.INTERIOR&&n===H.EXTERIOR?1:e===H.EXTERIOR&&n===H.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(t){for(var e=new re,n=new ft;t.hasNext();){var i=t.next(),r=e.createLineString(i.getCoordinates());n.add(r)}return e.buildGeometry(n)}}]),e}(),Yn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"rescale",value:function(){if(nt(arguments[0],z))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],i=0;i<n.length;i++)n[i].x=n[i].x/this.Ah+this.uh,n[i].y=n[i].y/this.Ah+this.hh;2===n.length&&n[0].equals2D(n[1])&&It.out.println(n)}}},{key:"scale",value:function(){if(nt(arguments[0],z)){for(var t=arguments[0],e=new ft(t.size()),n=t.iterator();n.hasNext();){var i=n.next();e.add(new hn(this.scale(i.getCoordinates()),i.getData()))}return e}if(arguments[0]instanceof Array){for(var r=arguments[0],o=new Array(r.length).fill(null),s=0;s<r.length;s++)o[s]=new T(Math.round((r[s].x-this.uh)*this.Ah),Math.round((r[s].y-this.hh)*this.Ah),r[s].getZ());return Kt.removeRepeatedPoints(o)}}},{key:"isIntegerPrecision",value:function(){return 1===this.Ah}},{key:"getNodedSubstrings",value:function(){var t=this.fh.getNodedSubstrings();return this.dh&&this.rescale(t),t}},{key:"computeNodes",value:function(t){var e=t;this.dh&&(e=this.scale(t)),this.fh.computeNodes(e)}},{key:"interfaces_",get:function(){return[gn]}}],[{key:"constructor_",value:function(){if(this.fh=null,this.Ah=null,this.uh=null,this.hh=null,this.dh=!1,2===arguments.length){var t=arguments[0],n=arguments[1];e.constructor_.call(this,t,n,0,0)}else if(4===arguments.length){var i=arguments[0],r=arguments[1];this.fh=i,this.Ah=r,this.dh=!this.isIntegerPrecision()}}}]),e}(),jn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"checkEndPtVertexIntersections",value:function(){if(0===arguments.length)for(var t=this.gh.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this.gh),this.checkEndPtVertexIntersections(e[e.length-1],this.gh)}else if(2===arguments.length)for(var n=arguments[0],i=arguments[1].iterator();i.hasNext();)for(var r=i.next().getCoordinates(),o=1;o<r.length-1;o++)if(r[o].equals(n))throw new R("found endpt/interior pt intersection at index "+o+" :pt "+n)}},{key:"checkInteriorIntersections",value:function(){if(0===arguments.length)for(var t=this.gh.iterator();t.hasNext();)for(var e=t.next(),n=this.gh.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(e,i)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=r.getCoordinates(),a=o.getCoordinates(),A=0;A<s.length-1;A++)for(var u=0;u<a.length-1;u++)this.checkInteriorIntersections(r,A,o,u);else if(4===arguments.length){var h=arguments[0],l=arguments[1],c=arguments[2],f=arguments[3];if(h===c&&l===f)return null;var d=h.getCoordinates()[l],g=h.getCoordinates()[l+1],v=c.getCoordinates()[f],I=c.getCoordinates()[f+1];if(this.mu.computeIntersection(d,g,v,I),this.mu.hasIntersection()&&(this.mu.isProper()||this.hasInteriorIntersection(this.mu,d,g)||this.hasInteriorIntersection(this.mu,v,I)))throw new R("found non-noded intersection at "+d+"-"+g+" and "+v+"-"+I)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(0===arguments.length)for(var t=this.gh.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),i=0;i<n.length-2;i++)this.checkCollapse(n[i],n[i+1],n[i+2])}},{key:"hasInteriorIntersection",value:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++){var r=t.getIntersection(i);if(!r.equals(e)&&!r.equals(n))return!0}return!1}},{key:"checkCollapse",value:function(t,n,i){if(t.equals(i))throw new R("found non-noded collapse at "+e.fact.createLineString([t,n,i]))}}],[{key:"constructor_",value:function(){this.mu=new ye,this.gh=null;var t=arguments[0];this.gh=t}}]),e}();jn.fact=new re;var Wn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"intersectsScaled",value:function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this.Cs<n||this.Es>i||this.Bs<r||this.Qs>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return G.isTrue(!(s&&a),"Found bad envelope test"),a}},{key:"initCorners",value:function(t){var e=.5;this.Es=t.x-e,this.Cs=t.x+e,this.Qs=t.y-e,this.Bs=t.y+e,this.Ih[0]=new T(this.Cs,this.Bs),this.Ih[1]=new T(this.Es,this.Bs),this.Ih[2]=new T(this.Es,this.Qs),this.Ih[3]=new T(this.Cs,this.Qs)}},{key:"intersects",value:function(t,e){return 1===this.Ah?this.intersectsScaled(t,e):(this.copyScaled(t,this.ph),this.copyScaled(e,this.yh),this.intersectsScaled(this.ph,this.yh))}},{key:"scale",value:function(t){return Math.round(t*this.Ah)}},{key:"getCoordinate",value:function(){return this.wh}},{key:"copyScaled",value:function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)}},{key:"getSafeEnvelope",value:function(){if(null===this.Ch){var t=e.SAFE_ENV_EXPANSION_FACTOR/this.Ah;this.Ch=new q(this.wh.x-t,this.wh.x+t,this.wh.y-t,this.wh.y+t)}return this.Ch}},{key:"intersectsPixelClosure",value:function(t,e){return this.mu.computeIntersection(t,e,this.Ih[0],this.Ih[1]),!!(this.mu.hasIntersection()||(this.mu.computeIntersection(t,e,this.Ih[1],this.Ih[2]),this.mu.hasIntersection()||(this.mu.computeIntersection(t,e,this.Ih[2],this.Ih[3]),this.mu.hasIntersection()||(this.mu.computeIntersection(t,e,this.Ih[3],this.Ih[0]),this.mu.hasIntersection()))))}},{key:"intersectsToleranceSquare",value:function(t,e){var n=!1,i=!1;return this.mu.computeIntersection(t,e,this.Ih[0],this.Ih[1]),!!(this.mu.isProper()||(this.mu.computeIntersection(t,e,this.Ih[1],this.Ih[2]),this.mu.isProper()||(this.mu.hasIntersection()&&(n=!0),this.mu.computeIntersection(t,e,this.Ih[2],this.Ih[3]),this.mu.isProper()||(this.mu.hasIntersection()&&(i=!0),this.mu.computeIntersection(t,e,this.Ih[3],this.Ih[0]),this.mu.isProper()||n&&i||t.equals(this.Bh)||e.equals(this.Bh)))))}},{key:"addSnappedNode",value:function(t,e){var n=t.getCoordinate(e),i=t.getCoordinate(e+1);return!!this.intersects(n,i)&&(t.addIntersection(this.getCoordinate(),e),!0)}}],[{key:"constructor_",value:function(){this.mu=null,this.Bh=null,this.wh=null,this.Eh=null,this.ph=null,this.yh=null,this.Ah=null,this.Es=null,this.Cs=null,this.Qs=null,this.Bs=null,this.Ih=new Array(4).fill(null),this.Ch=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this.wh=t,this.Bh=t,this.Ah=e,this.mu=n,e<=0)throw new p("Scale factor must be non-zero");1!==e&&(this.Bh=new T(this.scale(t.x),this.scale(t.y)),this.ph=new T,this.yh=new T),this.initCorners(this.Bh)}}]),e}();Wn.SAFE_ENV_EXPANSION_FACTOR=.75;var Xn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"select",value:function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new ln}}]),e}(),Zn=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"snap",value:function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],s=i.getSafeEnvelope(),a=new ti(i,r,o);return this._index.query(s,new(function(){function e(){t(this,e)}return n(e,[{key:"interfaces_",get:function(){return[We]}},{key:"visitItem",value:function(t){t.select(s,a)}}]),e}())),a.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var t=arguments[0];this._index=t}}]),e}(),ti=function(e){i(s,e);var o=h(s);function s(){var e;return t(this,s),e=o.call(this),s.constructor_.apply(u(e),arguments),e}return n(s,[{key:"isNodeAdded",value:function(){return this.mh}},{key:"select",value:function(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof fn))return l(r(s.prototype),"select",this).apply(this,arguments);var t=arguments[1],e=arguments[0].getContext();if(this.Qh===e&&(t===this.kh||t+1===this.kh))return null;this.mh|=this.bh.addSnappedNode(e,t)}}],[{key:"constructor_",value:function(){this.bh=null,this.Qh=null,this.kh=null,this.mh=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.bh=t,this.Qh=e,this.kh=n}}]),s}(Xn);Zn.HotPixelSnapAction=ti;var ei=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"processIntersections",value:function(t,e,n,i){if(t===n&&e===i)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];if(this.mu.computeIntersection(r,o,s,a),this.mu.hasIntersection()&&this.mu.isInteriorIntersection()){for(var A=0;A<this.mu.getIntersectionNum();A++)this._h.add(this.mu.getIntersection(A));t.addIntersections(this.mu,e,0),n.addIntersections(this.mu,i,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._h}},{key:"interfaces_",get:function(){return[Nn]}}],[{key:"constructor_",value:function(){this.mu=null,this._h=null;var t=arguments[0];this.mu=t,this._h=new ft}}]),e}(),ni=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"checkCorrectness",value:function(t){var e=hn.getNodedSubstrings(t),n=new jn(e);try{n.checkValid()}catch(t){if(!(t instanceof I))throw t;t.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return hn.getNodedSubstrings(this.iu)}},{key:"snapRound",value:function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)}},{key:"findInteriorIntersections",value:function(t,e){var n=new ei(e);return this.fh.setSegmentIntersector(n),this.fh.computeNodes(t),n.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(nt(arguments[0],z))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof hn)for(var n=arguments[0],i=n.getCoordinates(),r=0;r<i.length;r++){var o=new Wn(i[r],this.Ah,this.mu);this.xh.snap(o,n,r)&&n.addIntersection(i[r],r)}}},{key:"computeNodes",value:function(t){this.iu=t,this.fh=new In,this.xh=new Zn(this.fh.getIndex()),this.snapRound(t,this.mu)}},{key:"computeIntersectionSnaps",value:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=new Wn(n,this.Ah,this.mu);this.xh.snap(i)}}},{key:"interfaces_",get:function(){return[gn]}}],[{key:"constructor_",value:function(){this.Dh=null,this.mu=null,this.Ah=null,this.fh=null,this.xh=null,this.iu=null;var t=arguments[0];this.Dh=t,this.mu=new ye,this.mu.setPrecisionModel(t),this.Ah=t.getScale()}}]),e}(),ii=function(){function e(){t(this,e),e.constructor_.apply(this,arguments)}return n(e,[{key:"bufferFixedPrecision",value:function(t){var e=new Yn(new ni(new ee(1)),t.getScale()),n=new Jn(this.Cu);n.setWorkingPrecisionModel(t),n.setNoder(e),this.Sh=n.buffer(this.Mh,this.PA)}},{key:"bufferReducedPrecision",value:function(){if(0===arguments.length){for(var t=e.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(t){if(!(t instanceof lt))throw t;this.$h=t}if(null!==this.Sh)return null}throw this.$h}if(1===arguments.length){var n=arguments[0],i=e.precisionScaleFactor(this.Mh,this.PA,n),r=new ee(i);this.bufferFixedPrecision(r)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),null!==this.Sh)return null;var t=this.Mh.getFactory().getPrecisionModel();t.getType()===ee.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(t){this.Cu.setQuadrantSegments(t)}},{key:"bufferOriginalPrecision",value:function(){try{var t=new Jn(this.Cu);this.Sh=t.buffer(this.Mh,this.PA)}catch(t){if(!(t instanceof R))throw t;this.$h=t}}},{key:"getResultGeometry",value:function(t){return this.PA=t,this.computeGeometry(),this.Sh}},{key:"setEndCapStyle",value:function(t){this.Cu.setEndCapStyle(t)}}],[{key:"constructor_",value:function(){if(this.Mh=null,this.PA=null,this.Cu=new v,this.Sh=null,this.$h=null,1===arguments.length){var t=arguments[0];this.Mh=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.Mh=e,this.Cu=n}}},{key:"bufferOp",value:function(){if(2===arguments.length){var t=arguments[1];return new e(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof O&&"number"==typeof arguments[1]){var n=arguments[1],i=arguments[2],r=new e(arguments[0]);return r.setQuadrantSegments(i),r.getResultGeometry(n)}if(arguments[2]instanceof v&&arguments[0]instanceof O&&"number"==typeof arguments[1]){var o=arguments[1];return new e(arguments[0],arguments[2]).getResultGeometry(o)}}else if(4===arguments.length){var s=arguments[1],a=arguments[2],A=arguments[3],u=new e(arguments[0]);return u.setQuadrantSegments(a),u.setEndCapStyle(A),u.getResultGeometry(s)}}},{key:"precisionScaleFactor",value:function(t,e,n){var i=t.getEnvelopeInternal(),r=pt.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,o)}}]),e}();ii.CAP_ROUND=v.CAP_ROUND,ii.CAP_BUTT=v.CAP_FLAT,ii.CAP_FLAT=v.CAP_FLAT,ii.CAP_SQUARE=v.CAP_SQUARE,ii.MAX_PRECISION_DIGITS=12;var ri=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],oi=function(){function e(n){t(this,e),this.geometryFactory=n||new re}return n(e,[{key:"read",value:function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!si[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==ri.indexOf(n)?si[n].call(this,e.coordinates):"GeometryCollection"===n?si[n].call(this,e.geometries):si[n].call(this,e)}},{key:"write",value:function(t){var e=t.getGeometryType();if(!ai[e])throw new Error("Geometry is not supported");return ai[e].call(this,t)}}]),e}(),si={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var i=t.geometry.type;if(!si[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=si.bbox.call(this,t.bbox)),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.call(this,t.bbox)),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(a(T,c(i)))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new T(t[0],t[1]),new T(t[2],t[1]),new T(t[2],t[3]),new T(t[0],t[3]),new T(t[0],t[1])])},Point:function(t){var e=a(T,c(t));return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(si.Point.call(this,t[n]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=si.coordinates.call(this,t);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(si.LineString.call(this,t[n]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=si.coordinates.call(this,t[0]),n=this.geometryFactory.createLinearRing(e),i=[],r=1;r<t.length;++r){var o=t[r],s=si.coordinates.call(this,o),a=this.geometryFactory.createLinearRing(s);i.push(a)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(si.Polygon.call(this,i))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(this.read(i))}return this.geometryFactory.createGeometryCollection(e)}},ai={coordinate:function(t){var e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e},Point:function(t){return{type:"Point",coordinates:ai.coordinate.call(this,t.getCoordinate())}},MultiPoint:function(t){for(var e=[],n=0;n<t.Hs.length;++n){var i=t.Hs[n],r=ai.Point.call(this,i);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),i=0;i<n.length;++i){var r=n[i];e.push(ai.coordinate.call(this,r))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t.Hs.length;++n){var i=t.Hs[n],r=ai.LineString.call(this,i);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=ai.LineString.call(this,t.qs);e.push(n.coordinates);for(var i=0;i<t.Os.length;++i){var r=t.Os[i],o=ai.LineString.call(this,r);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t.Hs.length;++n){var i=t.Hs[n],r=ai.Polygon.call(this,i);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t.Hs.length;++n){var i=t.Hs[n],r=i.getGeometryType();e.push(ai[r].call(this,i))}return{type:"GeometryCollection",geometries:e}}};return{BufferOp:ii,GeoJSONReader:function(){function e(n){t(this,e),this.parser=new oi(n||new re)}return n(e,[{key:"read",value:function(t){return this.parser.read(t)}}]),e}(),GeoJSONWriter:function(){function e(){t(this,e),this.parser=new oi(this.geometryFactory)}return n(e,[{key:"write",value:function(t){return this.parser.write(t)}}]),e}()}}()}($c)),$c.exports),Fc=Fh(Rc);function Gc(){return new Lc}function Lc(){this.reset()}Lc.prototype={constructor:Lc,reset:function(){this.s=this.t=0},add:function(t){Uc(Nc,t,this.t),Uc(this,Nc.s,this.s),this.s?this.t+=Nc.t:this.s=Nc.t},valueOf:function(){return this.s}};var Nc=new Lc;function Uc(t,e,n){var i=t.s=e+n,r=i-e,o=i-r;t.t=e-o+(n-r)}var Tc=1e-6,Pc=Math.PI,qc=Pc/2,Oc=Pc/4,Hc=2*Pc,zc=180/Pc,Kc=Pc/180,Vc=Math.abs,Jc=Math.atan,Yc=Math.atan2,jc=Math.cos,Wc=Math.sin,Xc=Math.sqrt;function Zc(t){return t>1?0:t<-1?Pc:Math.acos(t)}function tf(t){return t>1?qc:t<-1?-qc:Math.asin(t)}function ef(){}function nf(t,e){t&&af.hasOwnProperty(t.type)&&af[t.type](t,e)}var rf,of,sf={Feature:function(t,e){nf(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)nf(n[i].geometry,e)}},af={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){Af(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)Af(n[i],e,0)},Polygon:function(t,e){uf(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)uf(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)nf(n[i],e)}};function Af(t,e,n){var i,r=-1,o=t.length-n;for(e.lineStart();++r<o;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function uf(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)Af(t[n],e,1);e.polygonEnd()}function hf(t){return[Yc(t[1],t[0]),tf(t[2])]}function lf(t){var e=t[0],n=t[1],i=jc(n);return[i*jc(e),i*Wc(e),Wc(n)]}function cf(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ff(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function df(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function gf(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function vf(t){var e=Xc(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function If(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function pf(t,e){return[t>Pc?t-Hc:t<-Pc?t+Hc:t,e]}function yf(t){return function(e,n){return[(e+=t)>Pc?e-Hc:e<-Pc?e+Hc:e,n]}}function wf(t){var e=yf(t);return e.invert=yf(-t),e}function Cf(t,e){var n=jc(t),i=Wc(t),r=jc(e),o=Wc(e);function s(t,e){var s=jc(e),a=jc(t)*s,A=Wc(t)*s,u=Wc(e),h=u*n+a*i;return[Yc(A*r-h*o,a*n-u*i),tf(h*r+A*o)]}return s.invert=function(t,e){var s=jc(e),a=jc(t)*s,A=Wc(t)*s,u=Wc(e),h=u*r-A*o;return[Yc(A*r+u*o,a*n+h*i),tf(h*n-a*i)]},s}function Bf(t,e){(e=lf(e))[0]-=t,vf(e);var n=Zc(-e[1]);return((-e[2]<0?-n:n)+Hc-Tc)%Hc}function Ef(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:ef,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function mf(t,e){return Vc(t[0]-e[0])<Tc&&Vc(t[1]-e[1])<Tc}function Qf(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function kf(t,e,n,i,r){var o,s,a=[],A=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],s=t[e];if(mf(i,s)){for(r.lineStart(),o=0;o<e;++o)r.point((i=t[o])[0],i[1]);r.lineEnd()}else a.push(n=new Qf(i,t,null,!0)),A.push(n.o=new Qf(i,null,n,!1)),a.push(n=new Qf(s,t,null,!1)),A.push(n.o=new Qf(s,null,n,!0))}})),a.length){for(A.sort(e),bf(a),bf(A),o=0,s=A.length;o<s;++o)A[o].e=n=!n;for(var u,h,l=a[0];;){for(var c=l,f=!0;c.v;)if((c=c.n)===l)return;u=c.z,r.lineStart();do{if(c.v=c.o.v=!0,c.e){if(f)for(o=0,s=u.length;o<s;++o)r.point((h=u[o])[0],h[1]);else i(c.x,c.n.x,1,r);c=c.n}else{if(f)for(u=c.p.z,o=u.length-1;o>=0;--o)r.point((h=u[o])[0],h[1]);else i(c.x,c.p.x,-1,r);c=c.p}u=(c=c.o).z,f=!f}while(!c.v);r.lineEnd()}}}function bf(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function _f(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function xf(t){for(var e,n,i,r=t.length,o=-1,s=0;++o<r;)s+=t[o].length;for(n=new Array(s);--r>=0;)for(e=(i=t[r]).length;--e>=0;)n[--s]=i[e];return n}Gc(),Gc(),Gc(),pf.invert=pf,1===(rf=_f).length&&(of=rf,rf=function(t,e){return _f(of(t),e)});var Df=1e9,Sf=-Df,Mf=Gc();function $f(t){return t}Gc(),Gc(),Gc();var Rf=1/0,Ff=Rf,Gf=-Rf,Lf=Gf,Nf={point:function(t,e){t<Rf&&(Rf=t),t>Gf&&(Gf=t),e<Ff&&(Ff=e),e>Lf&&(Lf=e)},lineStart:ef,lineEnd:ef,polygonStart:ef,polygonEnd:ef,result:function(){var t=[[Rf,Ff],[Gf,Lf]];return Gf=Lf=-(Ff=Rf=1/0),t}};function Uf(t,e,n,i){return function(r,o){var s,a,A,u=e(o),h=r.invert(i[0],i[1]),l=Ef(),c=e(l),f=!1,d={point:g,lineStart:I,lineEnd:p,polygonStart:function(){d.point=y,d.lineStart=w,d.lineEnd=C,a=[],s=[]},polygonEnd:function(){d.point=g,d.lineStart=I,d.lineEnd=p,a=xf(a);var t=function(t,e){var n=e[0],i=e[1],r=[Wc(n),-jc(n),0],o=0,s=0;Mf.reset();for(var a=0,A=t.length;a<A;++a)if(h=(u=t[a]).length)for(var u,h,l=u[h-1],c=l[0],f=l[1]/2+Oc,d=Wc(f),g=jc(f),v=0;v<h;++v,c=p,d=w,g=C,l=I){var I=u[v],p=I[0],y=I[1]/2+Oc,w=Wc(y),C=jc(y),B=p-c,E=B>=0?1:-1,m=E*B,Q=m>Pc,k=d*w;if(Mf.add(Yc(k*E*Wc(m),g*C+k*jc(m))),o+=Q?B+E*Hc:B,Q^c>=n^p>=n){var b=ff(lf(l),lf(I));vf(b);var _=ff(r,b);vf(_);var x=(Q^B>=0?-1:1)*tf(_[2]);(i>x||i===x&&(b[0]||b[1]))&&(s+=Q^B>=0?1:-1)}}return(o<-Tc||o<Tc&&Mf<-Tc)^1&s}(s,h);a.length?(f||(o.polygonStart(),f=!0),kf(a,Pf,t,n,o)):t&&(f||(o.polygonStart(),f=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function g(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&o.point(e,n)}function v(t,e){var n=r(t,e);u.point(n[0],n[1])}function I(){d.point=v,u.lineStart()}function p(){d.point=g,u.lineEnd()}function y(t,e){A.push([t,e]);var n=r(t,e);c.point(n[0],n[1])}function w(){c.lineStart(),A=[]}function C(){y(A[0][0],A[0][1]),c.lineEnd();var t,e,n,i,r=c.clean(),u=l.result(),h=u.length;if(A.pop(),s.push(A),A=null,h)if(1&r){if((e=(n=u[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),t=0;t<e;++t)o.point((i=n[t])[0],i[1]);o.lineEnd()}}else h>1&&2&r&&u.push(u.pop().concat(u.shift())),a.push(u.filter(Tf))}return d}}function Tf(t){return t.length>1}function Pf(t,e){return((t=t.x)[0]<0?t[1]-qc-Tc:qc-t[1])-((e=e.x)[0]<0?e[1]-qc-Tc:qc-e[1])}Gc();var qf=Uf((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Pc:-Pc,A=Vc(o-n);Vc(A-Pc)<Tc?(t.point(n,i=(i+s)/2>0?qc:-qc),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(o,i),e=0):r!==a&&A>=Pc&&(Vc(n-r)<Tc&&(n-=r*Tc),Vc(o-a)<Tc&&(o-=a*Tc),i=function(t,e,n,i){var r,o,s=Wc(t-n);return Vc(s)>Tc?Jc((Wc(e)*(o=jc(i))*Wc(n)-Wc(i)*(r=jc(e))*Wc(t))/(r*o*s)):(e+i)/2}(n,i,o,s),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(n=o,i=s),r=a},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*qc,i.point(-Pc,r),i.point(0,r),i.point(Pc,r),i.point(Pc,0),i.point(Pc,-r),i.point(0,-r),i.point(-Pc,-r),i.point(-Pc,0),i.point(-Pc,r);else if(Vc(t[0]-e[0])>Tc){var o=t[0]<e[0]?Pc:-Pc;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(e[0],e[1])}),[-Pc,-qc]);function Of(t){return function(e){var n=new Hf;for(var i in t)n[i]=t[i];return n.stream=e,n}}function Hf(){}function zf(t,e,n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&sf.hasOwnProperty(t.type)?sf[t.type](t,e):nf(t,e)}(n,t.stream(Nf));var s=Nf.result(),a=Math.min(i/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),A=+e[0][0]+(i-a*(s[1][0]+s[0][0]))/2,u=+e[0][1]+(r-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([A,u])}Hf.prototype={constructor:Hf,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Kf=16,Vf=jc(30*Kc);function Jf(t,e){return+e?function(t,e){function n(i,r,o,s,a,A,u,h,l,c,f,d,g,v){var I=u-i,p=h-r,y=I*I+p*p;if(y>4*e&&g--){var w=s+c,C=a+f,B=A+d,E=Xc(w*w+C*C+B*B),m=tf(B/=E),Q=Vc(Vc(B)-1)<Tc||Vc(o-l)<Tc?(o+l)/2:Yc(C,w),k=t(Q,m),b=k[0],_=k[1],x=b-i,D=_-r,S=p*x-I*D;(S*S/y>e||Vc((I*x+p*D)/y-.5)>.3||s*c+a*f+A*d<Vf)&&(n(i,r,o,s,a,A,b,_,Q,w/=E,C/=E,B,g,v),v.point(b,_),n(b,_,Q,w,C,B,u,h,l,c,f,d,g,v))}}return function(e){var i,r,o,s,a,A,u,h,l,c,f,d,g={point:v,lineStart:I,lineEnd:y,polygonStart:function(){e.polygonStart(),g.lineStart=w},polygonEnd:function(){e.polygonEnd(),g.lineStart=I}};function v(n,i){n=t(n,i),e.point(n[0],n[1])}function I(){h=NaN,g.point=p,e.lineStart()}function p(i,r){var o=lf([i,r]),s=t(i,r);n(h,l,u,c,f,d,h=s[0],l=s[1],u=i,c=o[0],f=o[1],d=o[2],Kf,e),e.point(h,l)}function y(){g.point=v,e.lineEnd()}function w(){I(),g.point=C,g.lineEnd=B}function C(t,e){p(i=t,e),r=h,o=l,s=c,a=f,A=d,g.point=p}function B(){n(h,l,u,c,f,d,r,o,i,s,a,A,Kf,e),g.lineEnd=y,y()}return g}}(t,e):function(t){return Of({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var Yf=Of({point:function(t,e){this.stream.point(t*Kc,e*Kc)}});function jf(t){return function(e,n){var i=jc(e),r=jc(n),o=t(i*r);return[o*r*Wc(e),o*Wc(n)]}}function Wf(t){return function(e,n){var i=Xc(e*e+n*n),r=t(i),o=Wc(r),s=jc(r);return[Yc(e*o,i*s),tf(i&&n*o/i)]}}jf((function(t){return Xc(2/(1+t))})).invert=Wf((function(t){return 2*tf(t/2)}));var Xf=jf((function(t){return(t=Zc(t))&&t/Wc(t)}));function Zf(){return(t=Xf,function(t){var e,n,i,r,o,s,a,A,u,h,l=150,c=480,f=250,d=0,g=0,v=0,I=0,p=0,y=null,w=qf,C=null,B=$f,E=.5,m=Jf(b,E);function Q(t){return[(t=o(t[0]*Kc,t[1]*Kc))[0]*l+n,i-t[1]*l]}function k(t){return(t=o.invert((t[0]-n)/l,(i-t[1])/l))&&[t[0]*zc,t[1]*zc]}function b(t,r){return[(t=e(t,r))[0]*l+n,i-t[1]*l]}function _(){o=If(r=function(t,e,n){return(t%=Hc)?e||n?If(wf(t),Cf(e,n)):wf(t):e||n?Cf(e,n):pf}(v,I,p),e);var t=e(d,g);return n=c-t[0]*l,i=f+t[1]*l,x()}function x(){return u=h=null,Q}return Q.stream=function(t){return u&&h===t?u:u=Yf(w(r,m(B(h=t))))},Q.clipAngle=function(t){return arguments.length?(w=+t?function(t,e){var n=jc(t),i=n>0,r=Vc(n)>Tc;function o(t,e){return jc(t)*jc(e)>n}function s(t,e,i){var r=[1,0,0],o=ff(lf(t),lf(e)),s=cf(o,o),a=o[0],A=s-a*a;if(!A)return!i&&t;var u=n*s/A,h=-n*a/A,l=ff(r,o),c=gf(r,u);df(c,gf(o,h));var f=l,d=cf(c,f),g=cf(f,f),v=d*d-g*(cf(c,c)-1);if(!(v<0)){var I=Xc(v),p=gf(f,(-d-I)/g);if(df(p,c),p=hf(p),!i)return p;var y,w=t[0],C=e[0],B=t[1],E=e[1];C<w&&(y=w,w=C,C=y);var m=C-w,Q=Vc(m-Pc)<Tc;if(!Q&&E<B&&(y=B,B=E,E=y),Q||m<Tc?Q?B+E>0^p[1]<(Vc(p[0]-w)<Tc?B:E):B<=p[1]&&p[1]<=E:m>Pc^(w<=p[0]&&p[0]<=C)){var k=gf(f,(-d+I)/g);return df(k,c),[p,hf(k)]}}}function a(e,n){var r=i?t:Pc-t,o=0;return e<-r?o|=1:e>r&&(o|=2),n<-r?o|=4:n>r&&(o|=8),o}return Uf(o,(function(t){var e,n,A,u,h;return{lineStart:function(){u=A=!1,h=1},point:function(l,c){var f,d=[l,c],g=o(l,c),v=i?g?0:a(l,c):g?a(l+(l<0?Pc:-Pc),c):0;if(!e&&(u=A=g)&&t.lineStart(),g!==A&&(!(f=s(e,d))||mf(e,f)||mf(d,f))&&(d[0]+=Tc,d[1]+=Tc,g=o(d[0],d[1])),g!==A)h=0,g?(t.lineStart(),f=s(d,e),t.point(f[0],f[1])):(f=s(e,d),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(r&&e&&i^g){var I;v&n||!(I=s(d,e,!0))||(h=0,i?(t.lineStart(),t.point(I[0][0],I[0][1]),t.point(I[1][0],I[1][1]),t.lineEnd()):(t.point(I[1][0],I[1][1]),t.lineEnd(),t.lineStart(),t.point(I[0][0],I[0][1])))}!g||e&&mf(e,d)||t.point(d[0],d[1]),e=d,A=g,n=v},lineEnd:function(){A&&t.lineEnd(),e=null},clean:function(){return h|(u&&A)<<1}}}),(function(n,i,r,o){!function(t,e,n,i,r,o){if(n){var s=jc(e),a=Wc(e),A=i*n;null==r?(r=e+i*Hc,o=e-A/2):(r=Bf(s,r),o=Bf(s,o),(i>0?r<o:r>o)&&(r+=i*Hc));for(var u,h=r;i>0?h>o:h<o;h-=A)u=hf([s,-a*jc(h),-a*Wc(h)]),t.point(u[0],u[1])}}(o,t,e,r,n,i)}),i?[0,-t]:[-Pc,t-Pc])}(y=t*Kc,6*Kc):(y=null,qf),x()):y*zc},Q.clipExtent=function(t){return arguments.length?(B=null==t?(C=s=a=A=null,$f):function(t,e,n,i){function r(r,o){return t<=r&&r<=n&&e<=o&&o<=i}function o(r,o,a,u){var h=0,l=0;if(null==r||(h=s(r,a))!==(l=s(o,a))||A(r,o)<0^a>0)do{u.point(0===h||3===h?t:n,h>1?i:e)}while((h=(h+a+4)%4)!==l);else u.point(o[0],o[1])}function s(i,r){return Vc(i[0]-t)<Tc?r>0?0:3:Vc(i[0]-n)<Tc?r>0?2:1:Vc(i[1]-e)<Tc?r>0?1:0:r>0?3:2}function a(t,e){return A(t.x,e.x)}function A(t,e){var n=s(t,1),i=s(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){var A,u,h,l,c,f,d,g,v,I,p,y=s,w=Ef(),C={point:B,lineStart:function(){C.point=E,u&&u.push(h=[]),I=!0,v=!1,d=g=NaN},lineEnd:function(){A&&(E(l,c),f&&v&&w.rejoin(),A.push(w.result())),C.point=B,v&&y.lineEnd()},polygonStart:function(){y=w,A=[],u=[],p=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=u.length;n<r;++n)for(var o,s,a=u[n],A=1,h=a.length,l=a[0],c=l[0],f=l[1];A<h;++A)o=c,s=f,c=(l=a[A])[0],f=l[1],s<=i?f>i&&(c-o)*(i-s)>(f-s)*(t-o)&&++e:f<=i&&(c-o)*(i-s)<(f-s)*(t-o)&&--e;return e}(),n=p&&e,r=(A=xf(A)).length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),r&&kf(A,a,e,o,s),s.polygonEnd()),y=s,A=u=h=null}};function B(t,e){r(t,e)&&y.point(t,e)}function E(o,s){var a=r(o,s);if(u&&h.push([o,s]),I)l=o,c=s,f=a,I=!1,a&&(y.lineStart(),y.point(o,s));else if(a&&v)y.point(o,s);else{var A=[d=Math.max(Sf,Math.min(Df,d)),g=Math.max(Sf,Math.min(Df,g))],w=[o=Math.max(Sf,Math.min(Df,o)),s=Math.max(Sf,Math.min(Df,s))];!function(t,e,n,i,r,o){var s,a=t[0],A=t[1],u=0,h=1,l=e[0]-a,c=e[1]-A;if(s=n-a,l||!(s>0)){if(s/=l,l<0){if(s<u)return;s<h&&(h=s)}else if(l>0){if(s>h)return;s>u&&(u=s)}if(s=r-a,l||!(s<0)){if(s/=l,l<0){if(s>h)return;s>u&&(u=s)}else if(l>0){if(s<u)return;s<h&&(h=s)}if(s=i-A,c||!(s>0)){if(s/=c,c<0){if(s<u)return;s<h&&(h=s)}else if(c>0){if(s>h)return;s>u&&(u=s)}if(s=o-A,c||!(s<0)){if(s/=c,c<0){if(s>h)return;s>u&&(u=s)}else if(c>0){if(s<u)return;s<h&&(h=s)}return u>0&&(t[0]=a+u*l,t[1]=A+u*c),h<1&&(e[0]=a+h*l,e[1]=A+h*c),!0}}}}}(A,w,t,e,n,i)?a&&(y.lineStart(),y.point(o,s),p=!1):(v||(y.lineStart(),y.point(A[0],A[1])),y.point(w[0],w[1]),a||y.lineEnd(),p=!1)}d=o,g=s,v=a}return C}}(C=+t[0][0],s=+t[0][1],a=+t[1][0],A=+t[1][1]),x()):null==C?null:[[C,s],[a,A]]},Q.scale=function(t){return arguments.length?(l=+t,_()):l},Q.translate=function(t){return arguments.length?(c=+t[0],f=+t[1],_()):[c,f]},Q.center=function(t){return arguments.length?(d=t[0]%360*Kc,g=t[1]%360*Kc,_()):[d*zc,g*zc]},Q.rotate=function(t){return arguments.length?(v=t[0]%360*Kc,I=t[1]%360*Kc,p=t.length>2?t[2]%360*Kc:0,_()):[v*zc,I*zc,p*zc]},Q.precision=function(t){return arguments.length?(m=Jf(b,E=t*t),x()):Xc(E)},Q.fitExtent=function(t,e){return zf(Q,t,e)},Q.fitSize=function(t,e){return function(t,e,n){return zf(t,[[0,0],e],n)}(Q,t,e)},function(){return e=t.apply(this,arguments),Q.invert=e.invert&&k,_()}}((function(){return t}))()).scale(79.4188).clipAngle(179.999);var t}function td(t,e){return[t,e]}Xf.invert=Wf((function(t){return t})),td.invert=td;var ed,nd,{BufferOp:id,GeoJSONReader:rd,GeoJSONWriter:od}=Fc;function sd(t,e,n,i){var r=t.properties||{},o="Feature"===t.type?t.geometry:t;if("GeometryCollection"===o.type){var s=[];return Sc(t,(function(t){var r=sd(t,e,n,i);r&&s.push(r)})),Qc(s)}var a=function(t){var e=function(t,e={}){const n=function(t,e={}){if(null!=t.bbox&&!0!==e.recompute)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return xc(t,(t=>{n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])})),n}(t);return function(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_c(t[0])||!_c(t[1]))throw new Error("coordinates must contain numbers");return mc({type:"Point",coordinates:t},e,n)}([(n[0]+n[2])/2,(n[1]+n[3])/2],e.properties,e)}(t).geometry.coordinates,n=[-e[0],-e[1]];return Zf().rotate(n).scale(Bc)}(o),A={type:o.type,coordinates:Ad(o.coordinates,a)},u=(new rd).read(A),h=kc(function(t,e="kilometers"){const n=Ec[e];if(!n)throw new Error(e+" units is invalid");return t/n}(e,n),"meters"),l=id.bufferOp(u,h,i);if(!ad((l=(new od).write(l)).coordinates))return mc({type:l.type,coordinates:ud(l.coordinates,a)},r)}function ad(t){return Array.isArray(t[0])?ad(t[0]):isNaN(t[0])}function Ad(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return Ad(t,e)}))}function ud(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return ud(t,e)}))}class hd extends r.Event{Rh="https://et-api.amap.com";mo={viewer:void 0,adCodes:[],areas:[],clientKey:"",clientSecret:"",time:(new Date).getTime(),style:{slightColor:"#ffff00",severeColor:"#ff0000",slightWidth:5,severeWidth:5}};Fh={};Gh=[];Lh=[];Nh;Uh;constructor(t){super(),this.mo.viewer=t.viewer||this.mo.viewer,this.mo.time=t.time||this.mo.time,this.mo.adCodes=t.adCodes||this.mo.adCodes,this.mo.areas=t.areas||this.mo.areas,this.mo.clientKey=t.clientKey||this.mo.clientKey,this.mo.clientSecret=t.clientSecret||this.mo.clientSecret,this.mo.style=Object.assign(this.mo.style,t.style),this.mo.viewer&&this._n()}getLines(){return{severe:this.Nh,slight:this.Uh}}destroy(){this.Nh?.destroy(),this.Uh?.destroy(),this.Gh=[],this.Lh=[],this.Fh=[]}show(){this.Nh&&(this.Nh.show=!0),this.Uh&&(this.Uh.show=!0)}hide(){this.Nh&&(this.Nh.show=!1),this.Uh&&(this.Uh.show=!1)}update(){this._n()}async _n(){this.Fh=await this.Th(),0!==this.Fh.length&&(this.Ph(),this.qh())}Oh(){if(!this.mo.viewer)return;const t=this.mo.viewer;t.scene.preRender.addEventListener((()=>{var e=new r.EllipsoidGeodesic;let n=t.scene,i=n.canvas.clientWidth,o=n.canvas.clientHeight,s=n.camera.getPickRay(new r.Cartesian2(0,o/2)),a=n.camera.getPickRay(new r.Cartesian2(i,o/2));if(s&&a){let t=n.globe,i=t.pick(s,n),r=t.pick(a,n);if(!i)return;if(!r)return;let o=t.ellipsoid.cartesianToCartographic(i),A=t.ellipsoid.cartesianToCartographic(r);e.setEndPoints(o,A),e.surfaceDistance,this.Nh}}))}qh(){this.mo.viewer&&(0!==this.Gh.length&&(this.Nh=this.Hh(this.Gh,this.mo.style.severeColor,this.mo.style.severeWidth),this.mo.viewer.scene.primitives.add(this.Nh)),0!==this.Lh.length&&(this.Uh=this.Hh(this.Lh,this.mo.style.slightColor,this.mo.style.slightWidth),this.mo.viewer.scene.primitives.add(this.Uh)),this.raiseEvent("loaded"))}Hh(t,e,n){const i=[];return t.forEach((t=>{const o=function(t,e,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return Sc(t,(function(t){var n=sd(t,e,i,r);n&&o.push(n)})),Qc(o);case"FeatureCollection":return Dc(t,(function(t){var n=sd(t,e,i,r);n&&Dc(n,(function(t){t&&o.push(t)}))})),Qc(o)}return sd(t,e,i,r)}({type:"LineString",coordinates:t.lngLats},n/2,{units:"meters"}),s=o?.geometry.coordinates;s&&i.push(new r.GeometryInstance({geometry:new r.PolygonGeometry({polygonHierarchy:new r.PolygonHierarchy(r.Cartesian3.fromDegreesArray(s.flat(3)))}),attributes:{color:r.ColorGeometryInstanceAttribute.fromColor(r.Color.fromCssColorString(e))}}))})),new r.GroundPrimitive({geometryInstances:i,asynchronous:!1})}zh(t,e,n){const i=[];t.forEach((t=>{const e=r.Cartesian3.fromDegreesArray(t.lngLats.flat()),o=new r.GroundPolylineGeometry({positions:e,width:n});o&&i.push(new r.GeometryInstance({geometry:o}))}));const o=new r.PolylineMaterialAppearance({translucent:!1});return o.material=new r.Material({fabric:{type:"Color",uniforms:{color:r.Color.fromCssColorString(e)}}}),new r.GroundPolylinePrimitive({geometryInstances:i,appearance:o,asynchronous:!1})}Ph(){this.Fh.forEach((t=>{t.linkList.forEach((t=>{const e=t.lngLats.split(";").map((t=>{const e=t.split(",");return[+e[0],+e[1]]}));4===t.state?this.Gh.push({roadName:t.roadName,roadType:t.roadType,lngLats:e}):this.Lh.push({roadName:t.roadName,roadType:t.roadType,lngLats:e})}))}))}async Th(){const t=Math.round((new Date).getTime()/1e3),e=`${this.mo.adCodes.join("")}${this.mo.clientKey}${t}`;let n=await async function(t,e){const n=new TextEncoder,i=n.encode(e),r=n.encode(t),o=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=await crypto.subtle.sign("HMAC",o,r);return Array.from(new Uint8Array(s)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(e,this.mo.clientSecret);const i=await fetch(`${this.Rh}/congestion/history?clientKey=${this.mo.clientKey}&timestamp=${t}&digest=${n.toString()}&adCodes=${this.mo.adCodes.join()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adCodes:this.mo.adCodes,areas:this.mo.areas,startTime:this.mo.time/1e3,endTime:this.mo.time/1e3+3600,pageSize:9999,queryList:[{duration:"4",roadType:"0",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"1",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"2",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"3",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"4",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"5",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"6",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"7",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"8",distance:"200",congestRate:"0",congestType:"0"},{duration:"4",roadType:"9",distance:"200",congestRate:"0",congestType:"0"}]})}),r=await i.json();if(0!==r.code)throw new Error("路况数据获取失败:",r.message);return r.data.list}}class ld extends r.Entity{mo;Kh;Vh=0;Jh=0;Yh;jh;Wh;constructor(t){t.eyeOffset=t.eyeOffset||[0,0,0],t.controlOptions=t.controlOptions||{speed:10,steeringSpeed:15};const e=r.Cartesian3.fromDegrees(t.position[0],t.position[1],t.position[2]),n=new r.HeadingPitchRoll(r.Math.toRadians(t.heading-90),0,0);super({position:e,orientation:r.Transforms.headingPitchRollQuaternion(e,n),model:{uri:t.uri,scale:t.scale||1,runAnimations:t.runAnimations}}),this.mo=t}Xh(){const t=r.Cartesian3.fromDegrees(-123.0744619,44.0503706,5e3),e=new r.HeadingPitchRoll,n=r.Transforms.localFrameToFixedFrameGenerator("north","west");r.Transforms.headingPitchRollToFixedFrame(t,e,r.Ellipsoid.WGS84,n)}static Zh=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyA","KeyS","KeyD","KeyW"];static tl;static el=[];static nl=0;static il(t){const e=-1!==ld.Zh.indexOf(t.code);e&&-1==ld.el.indexOf(t.code)&&ld.el.push(t.code),e&&!ld.nl&&(ld.nl=requestAnimationFrame(ld.rl),ld.tl&&(ld.tl.jh=(new Date).getTime()))}static ol(t){const e=-1!==ld.Zh.indexOf(t.code),n=ld.el.indexOf(t.code);e&&-1!==n&&ld.el.splice(n,1)}static rl(){ld.nl=0;const t=ld.tl;if(t)if(ld.el.length){const e=(new Date).getTime();if(t.jh&&e-t.jh){const n=(e-t.jh)/1e3/3600*1e3*t.mo.controlOptions.speed,i=(e-t.jh)/1e3*t.mo.controlOptions.steeringSpeed;if(t.Vh<=1){t.model.runAnimations=!0;let e=0;switch(ld.el.sort().join(",")){case"ArrowUp":case"KeyW":e=0;break;case"ArrowDown":case"KeyS":e=180;break;case"ArrowLeft":case"KeyA":e=-90;break;case"ArrowRight":case"KeyD":e=90;break;case"ArrowDown,ArrowLeft":case"KeyA,KeyS":e=-135;break;case"ArrowDown,ArrowRight":case"KeyD,KeyS":e=135;break;case"ArrowLeft,ArrowUp":case"KeyA,KeyW":e=-45;break;case"ArrowRight,ArrowUp":case"KeyD,KeyW":e=45}const i=180*t.mo.viewer.camera.heading/Math.PI+e,o=new r.HeadingPitchRoll(r.Math.toRadians(i-90),0,0);t.mo.heading=i;const s=Math.sin(i*Math.PI/180)*n,a=Math.cos(i*Math.PI/180)*n,A=jl(new r.Cartesian3(s,a,0),t.mo.position),u=r.Cartographic.fromCartesian(A),h=r.Math.toDegrees(u.longitude),l=r.Math.toDegrees(u.latitude);t.mo.position=[h,l,t.mo.position[2]];const c=r.Cartesian3.fromDegrees(h,l,t.mo.position[2]);t.position=c;const f=r.Transforms.headingPitchRollQuaternion(c,o);t.orientation=f}else{t.model.runAnimations=!1;let e=0,o=0;switch(ld.el.sort().join(",")){case"ArrowUp":case"KeyW":o=1;break;case"ArrowDown":case"KeyS":o=-1;break;case"ArrowLeft":case"KeyA":e=-1;break;case"ArrowRight":case"KeyD":e=1;break;case"ArrowDown,ArrowLeft":case"KeyA,KeyS":e=1,o=-1;break;case"ArrowDown,ArrowRight":case"KeyD,KeyS":e=-1,o=-1;break;case"ArrowLeft,ArrowUp":case"KeyA,KeyW":e=-1,o=1;break;case"ArrowRight,ArrowUp":case"KeyD,KeyW":e=1,o=1}const s=180*t.mo.viewer.camera.heading/Math.PI+i*e,a=new r.HeadingPitchRoll(r.Math.toRadians(s-90),0,0);t.mo.heading=s;const A=Math.sin(s*Math.PI/180)*n*o,u=Math.cos(s*Math.PI/180)*n*o,h=jl(new r.Cartesian3(A,u,0),t.mo.position),l=r.Cartographic.fromCartesian(h),c=r.Math.toDegrees(l.longitude),f=r.Math.toDegrees(l.latitude);t.mo.position=[c,f,t.mo.position[2]];const d=r.Cartesian3.fromDegrees(c,f,t.mo.position[2]);t.position=d;const g=r.Transforms.headingPitchRollQuaternion(d,a);t.orientation=g;const v=jl(new r.Cartesian3(t.mo.eyeOffset[0],t.mo.eyeOffset[1],t.mo.eyeOffset[2]),t.mo.position);t.mo.viewer.camera.setView({destination:v,orientation:{heading:r.Math.toRadians(t.mo.heading),pitch:t.mo.viewer.camera.pitch}})}}ld.nl=requestAnimationFrame(ld.rl),t.jh=e}else t.model.runAnimations=!1,t.jh=void 0}sl(){this.getPrimitive().Al.al.forEach((t=>{t.runtimeChannels.forEach((t=>{t.animate(0)}))}))}getPrimitive(){if(this.Kh)return this.Kh;{const t=this.mo.viewer.scene.primitives.length;for(let e=0;e<t;e+=1){const t=this.mo.viewer.scene.primitives.get(e);if(t.id==this)return this.Kh=t,t}}}startControlModel(t=0){this.Jh||ld.tl!==this&&(ld.tl&&ld.tl.stopControlModel(),ld.tl=this,document.addEventListener("keydown",ld.il),document.addEventListener("keyup",ld.ol),ld.nl=requestAnimationFrame(ld.rl),this.switchTrackingMode(t))}setControlOptions(t){this.mo.controlOptions=t}switchTrackingMode(t){ld.tl==this&&(this.mo.viewer.trackedEntity=void 0,this.Vh=t,0==t?(this.viewFrom=void 0,this.show=!0):1==t?(this.show=!0,this.mo.viewFrom?this.viewFrom=new e.Cartesian3(this.mo.viewFrom[0],this.mo.viewFrom[1],this.mo.viewFrom[2]):this.viewFrom=void 0,this.mo.viewer.trackedEntity=this):(this.mo.viewer.trackedEntity=this,this.show=!1,requestAnimationFrame((()=>{const t=jl(new r.Cartesian3(this.mo.eyeOffset[0],this.mo.eyeOffset[1],this.mo.eyeOffset[2]),this.mo.position);this.mo.viewer.camera.setView({destination:t,orientation:{heading:r.Math.toRadians(this.mo.heading),pitch:0}})}))))}stopControlModel(){document.removeEventListener("keydown",ld.il),document.removeEventListener("keyup",ld.ol),ld.nl&&(cancelAnimationFrame(ld.nl),ld.nl=0),ld.tl=void 0,ld.el=[],this.Vh=0,this.jh=void 0}moveAlong(t,n,i,o,s,a){if(ld.tl!==this&&this.stopControlModel(),o=o||t.ul(),this.Jh)return;n&&(this.mo.viewFrom&&(this.viewFrom=new e.Cartesian3(this.mo.viewFrom[0],this.mo.viewFrom[1],this.mo.viewFrom[2])),this.mo.viewer.trackedEntity=this);const A=this;A.position=t.hl.getValue(o);let u=(new Date).getTime(),h=-1;this.Yh=o;const l=()=>{let n=(new Date).getTime()-u;const f=r.JulianDate.addSeconds(o,n/1e3,new r.JulianDate);this.Yh=f;const d=t.hl.getValue(f);A.position=d;const g=t.ll.getValue(f);if(A.orientation=g,d&&this.Wh){const t=(this.Wh?.steeringSpeed||30)*Math.PI/180,n=r.Matrix3.fromQuaternion(g),i=r.Matrix4.fromRotation(n),o=new e.Cartesian3(-this.Wh.range*Math.cos(this.Wh.pitch*Math.PI/180),0,-this.Wh.range*Math.sin(this.Wh.pitch*Math.PI/180));var v=new r.Cartesian4(o.x,o.y,o.z,1),I=r.Matrix4.multiplyByVector(i,v,new r.Cartesian4),p=new r.Cartesian3(I.x,I.y,I.z);const s=e.Cartesian3.add(d,p,new e.Cartesian3);let a=this.mo.viewer.camera.pitch,A=this.mo.viewer.camera.heading;const u=Wl(s),h=Wl(d),l=Math.atan2(h.lng-u.lng,h.lat-u.lat),f=this.Wh.pitch*Math.PI/180;let y=A,w=a;const C=(new Date).getTime(),B=(C-c)/1e3*t;c=C,Math.abs(f-a)<B?w=f:f>a?w+=B:w-=B;const E=Xl(A,l);Math.abs(E)<B?y=l:E>0?y+=B:y-=B,this.mo.viewer.camera.lookAt(d,new r.HeadingPitchRange(y,w,this.Wh.range))}if(n>=t.cl)i?(u=(new Date).getTime(),this.Jh=requestAnimationFrame(l)):(this.Yh=void 0,this.Jh=0),h!==t.fl.length-1&&a?.call(A,{index:t.fl.length-1}),s?.call(A,{index:t.fl.length-1});else{if(a){const e=t.dl(f);-1!==e&&e!==h&&(h=e,a?.call(A,{index:e}))}this.Jh=requestAnimationFrame(l)}};let c=(new Date).getTime();this.Jh=requestAnimationFrame(l)}follow(t){this.Wh=t?{pitch:-90,range:100,steeringSpeed:30,...t}:void 0}stopFollow(){this.Wh=void 0}stopMoveAlong(){if(this.Jh)return cancelAnimationFrame(this.Jh),this.Jh=0,this.mo.viewer.trackedEntity==this&&(this.mo.viewer.trackedEntity=void 0),this.Yh}}class cd{hl;fl=[];cl;gl;ll;constructor(t){this.gl=t;const e=new r.SampledPositionProperty;this.cl=t[t.length-1].time.getTime()-t[0].time.getTime();for(let n=0,i=t.length;n<i;n+=1){const i=t[n],o=r.JulianDate.fromDate(i.time);this.fl.push(o);const s=r.Cartesian3.fromDegrees(i.position[0],i.position[1],i.position[2]);e.addSample(o,s)}this.ll=new r.VelocityOrientationProperty(e),this.hl=e}ul(){return this.fl[0]}dl(t){for(let e=0;e<this.fl.length;e+=1)if(r.JulianDate.equalsEpsilon(this.fl[e],t,.1))return e;return-1}vl(t){return this.gl[t]}}function fd(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return[...t.geometry.coordinates];if("Point"===t.type)return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dd(t,e,n={}){var i=fd(t),r=fd(e),o=bc(r[1]-i[1]),s=bc(r[0]-i[0]),a=bc(i[1]),A=bc(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(A);return kc(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),n.units)}function gd(t,e={}){return function(t,n,i){var r=0;return function(t,n){!function(t,e){Sc(t,(function(t,n,i,r,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(mc(t,i,{bbox:r,id:o}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var A=0;A<t.coordinates.length;A++){var u=t.coordinates[A];if(!1===e(mc({type:s,coordinates:u},i),n,A))return!1}}))}(t,(function(t,n,i){if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,A=0,u=0;return!1!==xc(t,(function(i,o,h,l,c){if(void 0===s||n>a||l>A||c>u)return s=i,a=n,A=l,u=c,void 0;var f=function(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return mc({type:"LineString",coordinates:t},e,n)}([s,i],t.properties);if(!1===function(t,n,i,o,s){r=((t,n)=>{const i=n.geometry.coordinates;return t+dd(i[0],i[1],e)})(r,t)}(f))return!1;s=i}))&&void 0}}}))}(t),r}(t)}class vd{Bn;Il;pl;yl;wl=0;Wn={};Cl=this.Bl.bind(this);El=this.ml.bind(this);Ql=this.kl.bind(this);bl="";_l=this.xl.bind(this);Dl=this.Sl.bind(this);Ml=this.$l.bind(this);Rl=!1;constructor(t){this.Bn=t.viewer,this.Il=t.line,this.pl=t.moveSpeed,this.yl=0,this._n()}lock(){var t=this.Bn.scene.screenSpaceCameraController;this.Wn={enableTranslate:t.enableTranslate,enableZoom:t.enableZoom,enableRotate:t.enableRotate,enableTilt:t.enableTilt,enableLook:t.enableLook,inertiaSpin:t.inertiaSpin,inertiaTranslate:t.inertiaTranslate,inertiaZoom:t.inertiaZoom},t.enableTranslate=!1,t.enableRotate=!1,t.enableZoom=!1,t.enableLook=!1,t.enableTilt=!1,t.inertiaSpin=0,t.inertiaTranslate=0,t.inertiaZoom=0,this.Fl()}unlock(){var t=this.Bn.scene.screenSpaceCameraController;t.enableTranslate=this.Wn.enableTranslate,t.enableZoom=this.Wn.enableZoom,t.enableRotate=this.Wn.enableRotate,t.enableTilt=this.Wn.enableTilt,t.enableLook=this.Wn.enableLook,t.inertiaSpin=this.Wn.inertiaSpin,t.inertiaTranslate=this.Wn.inertiaTranslate,t.inertiaZoom=this.Wn.inertiaZoom}destroy(){this.unlock(),document.removeEventListener("keydown",this.Cl),document.removeEventListener("keyup",this.El);let t=new r.ScreenSpaceEventHandler(this.Bn.scene.canvas);t.removeInputAction(r.ScreenSpaceEventType.MIDDLE_DOWN),t.removeInputAction(r.ScreenSpaceEventType.MOUSE_MOVE),t.removeInputAction(r.ScreenSpaceEventType.MIDDLE_UP)}_n(){this.wl=1e3*gd({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:this.Il}},{units:"kilometers"}),document.addEventListener("keydown",this.Cl),document.addEventListener("keyup",this.El),this.lock(),this.kl()}Fl(){let t=new r.ScreenSpaceEventHandler(this.Bn.scene.canvas);t.setInputAction(this._l,r.ScreenSpaceEventType.MIDDLE_DOWN),t.setInputAction(this.Dl,r.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(this.Ml,r.ScreenSpaceEventType.MIDDLE_UP)}xl(t){this.Rl=!0}Sl(t){if(!this.Rl)return;const e=t.endPosition.x-t.startPosition.x,n=t.endPosition.y-t.startPosition.y;this.Bn.camera.setView({destination:this.Bn.camera.position,orientation:{heading:this.Bn.camera.heading-e/1e3,pitch:this.Bn.camera.pitch+n/1e3,roll:0}})}$l(t){this.Rl=!1}Gl(){const t=this.Ll(this.Il,this.yl);if(t){const e=r.Cartesian3.fromDegrees(t[0],t[1],t[2]);this.Bn.camera.setView({destination:e,orientation:{heading:this.Bn.camera.heading,pitch:this.Bn.camera.pitch,roll:0}})}}Bl(t){"KeyW"===t.code?this.bl="W":"KeyS"===t.code&&(this.bl="S")}ml(t){"KeyW"!==t.code&&"KeyS"!==t.code||(this.bl="")}kl(){requestAnimationFrame(this.Ql),this.bl&&("W"===this.bl&&(this.yl+=this.pl,this.yl=Math.min(this.yl,this.wl)),"S"===this.bl&&(this.yl-=this.pl,this.yl=Math.max(this.yl,0)),this.Gl())}Ll(t,e){let n=0;for(let i=1;i<t.length;i++){const r=t[i-1],o=t[i],s=1e3*dd({type:"Point",coordinates:r},{type:"Point",coordinates:o},{units:"kilometers"});if(n<=e&&n+s>e){const t=(e-n)/s;return[r[0]+(o[0]-r[0])*t,r[1]+(o[1]-r[1])*t,r[2]+(o[2]-r[2])*t]}n+=s}}}class Id{Bn;mo={viewer:void 0,moveRate:1,rotateRate:1};Nl=!1;Ul={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,lookUp:!1,lookDown:!1,lookLeft:!1,lookRight:!1,twistLeft:!1,twistRight:!1,zoomIn:!1,zoomOut:!1};Tl=this.il.bind(this);Pl=this.ol.bind(this);ql=this.Ol.bind(this);constructor(t){t.viewer&&(this.Bn=t.viewer,this.mo=Object.assign(this.mo,t),this.Hl())}destroy(){const t=this.Bn;t&&(t.clock.onTick.removeEventListener(this.ql),document.removeEventListener("keydown",this.Tl,!1),document.removeEventListener("keyup",this.Pl,!1),t.scene.screenSpaceCameraController.enableRotate=!0,t.scene.screenSpaceCameraController.enableTranslate=!0,t.scene.screenSpaceCameraController.enableZoom=!0,t.scene.screenSpaceCameraController.enableTilt=!0,t.scene.screenSpaceCameraController.enableLook=!0)}Hl(){this.Bn&&(document.addEventListener("keydown",this.Tl,!1),document.addEventListener("keyup",this.Pl,!1),this.Bn.clock.onTick.addEventListener(this.ql),this.zl())}Kl(t){switch(t){case 87:return"moveForward";case 83:return"moveBackward";case 68:return"moveRight";case 65:return"moveLeft";case 81:return"moveUp";case 69:return"moveDown";case 38:return"lookUp";case 40:return"lookDown";case 37:return"lookLeft";case 39:return"lookRight";case 96:return"twistLeft";case 110:return"twistRight";case 107:return"zoomIn";case 109:return"zoomOut";default:return}}il(t){let e=this.Kl(t.keyCode);void 0!==e&&(this.Ul[e]=!0)}ol(t){let e=this.Kl(t.keyCode);void 0!==e&&(this.Ul[e]=!1)}Ol(){if(!this.Bn)return;let t=this.Bn.camera,e=this.Bn.scene.globe.ellipsoid.cartesianToCartographic(t.position).height,n=e/40*this.mo.moveRate;const i=this.Ul;i.moveForward&&t.moveForward(n),i.moveBackward&&t.moveBackward(n),i.moveLeft&&t.moveLeft(n),i.moveRight&&t.moveRight(n),i.moveUp&&t.moveUp(n),i.moveDown&&t.moveDown(n),i.lookUp&&t.lookUp(),i.lookDown&&t.lookDown(),i.lookLeft&&t.lookLeft(),i.lookRight&&t.lookRight(),i.twistLeft&&t.twistLeft(),i.twistRight&&t.twistRight(),i.zoomIn&&t.zoomIn(e/2),i.zoomOut&&t.zoomOut(e/2)}zl(){if(!this.Bn)return;const t=this.Bn;t.scene.screenSpaceCameraController.enableRotate=!1,t.scene.screenSpaceCameraController.enableTranslate=!1,t.scene.screenSpaceCameraController.enableZoom=!1,t.scene.screenSpaceCameraController.enableTilt=!1,t.scene.screenSpaceCameraController.enableLook=!1,t.screenSpaceEventHandler.setInputAction(this.Vl,r.ScreenSpaceEventType.LEFT_DOWN),t.screenSpaceEventHandler.setInputAction(this.Jl,r.ScreenSpaceEventType.MOUSE_MOVE),t.screenSpaceEventHandler.setInputAction(this.Yl,r.ScreenSpaceEventType.LEFT_UP)}Vl=()=>{this.Nl=!0};Yl=()=>{this.Nl=!1};Jl=t=>{if(this.Bn&&this.Nl){const{startPosition:e,endPosition:n}=t,i=(n.x-e.x)/100*this.mo.rotateRate,r=-(n.y-e.y)/100*this.mo.rotateRate;this.Bn.camera.setView({orientation:{heading:this.Bn.camera.heading+i,pitch:this.Bn.camera.pitch+r,roll:this.Bn.camera.roll}})}}}class pd{static runningAnimation;mo;status=t.CameraAnimationStatus.stop;jl;Wl=0;Xl;Zl=-1;constructor(t){this.mo=t}start(e){pd.runningAnimation!==this&&pd.runningAnimation?.stop();const n=this.mo.path;if(e=e||n.ul(),this.status==t.CameraAnimationStatus.running)return;const i=this.mo.viewer,r=n.hl.getValue(e),o=n.tc.getValue(e);i.camera.setView({destination:r,orientation:{heading:o.x,pitch:o.y,roll:o.z}}),this.Xl=(new Date).getTime(),this.Zl=0,this.jl=e,this.status=t.CameraAnimationStatus.running,this.Wl=requestAnimationFrame(this.Xh)}Xh=()=>{const t=this.mo.path,e=(new Date).getTime();let n=e-this.Xl,i=r.JulianDate.addSeconds(this.jl,n/1e3,new r.JulianDate);this.jl=i;const o=this.mo.viewer;if(i>=t.rc())this.mo.repeat?(this.Xl=e,this.jl=t.ul(),i=this.jl,this.Wl=requestAnimationFrame(this.Xh)):(i=t.rc(),this.jl=void 0,this.Wl=0),this.Zl!==t.fl.length-1&&this.mo.onReachKeyNode?.call(this,{index:t.fl.length-1}),this.mo.onEnd?.call(this,{index:t.fl.length-1});else{if(this.mo.onReachKeyNode){const e=t.dl(i);-1!==e&&e!==this.Zl&&(this.Zl=e,this.mo.onReachKeyNode?.call(this,{index:e}))}this.Xl=e,this.Wl=requestAnimationFrame(this.Xh)}const s=t.hl.getValue(i),a=t.tc.getValue(i);o.camera.setView({destination:s,orientation:{heading:a.x,pitch:a.y,roll:a.z}})};stop(){if(this.status===t.CameraAnimationStatus.running)return this.Wl&&cancelAnimationFrame(this.Wl),this.status=t.CameraAnimationStatus.stop,this.jl}pause(){if(this.status===t.CameraAnimationStatus.running)return this.Wl&&cancelAnimationFrame(this.Wl),this.status=t.CameraAnimationStatus.paused,this.jl}resume(e){this.status==t.CameraAnimationStatus.paused&&(this.status=t.CameraAnimationStatus.running,this.jl=e,this.Xl=(new Date).getTime(),this.Wl=requestAnimationFrame(this.Xh))}}class yd{hl;tc;fl=[];gl;constructor(t,e,n){let i;i=t[0].pos?t:t.map((t=>({pos:t}))),e&&n&&this.oc(i,e,n),this.gl=i;const o=new r.SampledPositionProperty,s=new r.SampledProperty(r.Cartesian3);let a;for(let t=0,e=i.length;t<e;t+=1){const e=i[t],n=r.JulianDate.fromDate(e.time);this.fl.push(n);const A=r.Cartesian3.fromDegrees(e.pos.lng,e.pos.lat,e.pos.height);o.addSample(n,A);let u=r.Math.toRadians(e.pos.heading);const h=2*Math.PI;u=(u%h+h)%h,a&&(u=a+Xl(a,u)),a=u;const l=new r.Cartesian3(a,r.Math.toRadians(e.pos.pitch),r.Math.toRadians(e.pos.roll));s.addSample(n,l)}this.hl=o,this.tc=s}oc(t,n,i){let r=(new Date).getTime();t.forEach(((o,s)=>{let a=o;if(s>0){const o=e.Cartesian3.distance(e.Cartesian3.fromDegrees(a.pos.lng,a.pos.lat,a.pos.height),e.Cartesian3.fromDegrees(t[s-1].pos.lng,t[s-1].pos.lat,t[s-1].pos.height)),A=180*Xl(t[s-1].pos.heading,a.pos.heading)/Math.PI;r+=1e3*Math.round(Math.max(o/n,Math.abs(A)/i,Math.abs(a.pos.pitch-t[s-1].pos.pitch)/i))}t[s].time=new Date(r)}))}ul(){return this.fl[0]}rc(){return this.fl[this.fl.length-1]}dl(t){for(let e=0;e<this.fl.length;e+=1)if(r.JulianDate.equalsEpsilon(this.fl[e],t,.1))return e;return-1}vl(t){return this.gl[t]}}t.CameraAnimationStatus=void 0,(ed=t.CameraAnimationStatus||(t.CameraAnimationStatus={}))[ed.stop=0]="stop",ed[ed.running=1]="running",ed[ed.paused=2]="paused";class wd{mo;Wo=new Cd;constructor(t){this.mo=t,this.sc()}sc(){const t=this.mo.viewer.scene.context,e=r.ShaderProgram.fromCache({context:t,vertexShaderSource:"#version 300 es\nprecision highp int;precision highp float;in vec3 position;uniform mat4 u_vp2;void main(){gl_Position=u_vp2*vec4(position,1.0f);}",fragmentShaderSource:"#version 300 es\nprecision highp float;void main(){out_FragColor=vec4(1,0,0,0.3);}",attributeLocations:{position:0}}),n={enabled:!0,equationRgb:r.BlendEquation.ADD,equationAlpha:r.BlendEquation.ADD,functionSourceRgb:r.BlendFunction.SOURCE_ALPHA,functionDestinationRgb:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:r.BlendFunction.ONE,functionDestinationAlpha:r.BlendFunction.ONE_MINUS_SOURCE_ALPHA},i=r.RenderState.fromCache({depthTest:{enabled:!0},blending:n,depthMask:!0,colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),o=r.Cartesian3.fromDegrees(this.mo.enuCenter[0],this.mo.enuCenter[1],this.mo.enuCenter[2]),s={u_vp2:()=>{let t=this.mo.viewer.camera.frustum.projectionMatrix;const e=r.Transforms.eastNorthUpToFixedFrame(o);var n=r.Matrix4.multiply(this.mo.viewer.camera.viewMatrix,e,new r.Matrix4);return r.Matrix4.multiply(t,n,new r.Matrix4)}},a=new r.VertexArray({name:"glbDepth",context:t,attributes:[{index:0,vertexBuffer:r.Buffer.createVertexBuffer({usage:r.BufferUsage.STATIC_DRAW,typedArray:new Float32Array(this.mo.vertices),context:t}),componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT}],indexBuffer:r.Buffer.createIndexBuffer({context:t,typedArray:new Uint32Array(this.mo.faces),usage:r.BufferUsage.STATIC_DRAW,indexDatatype:r.IndexDatatype.UNSIGNED_INT})}),A=new r.DrawCommand({vertexArray:a,shaderProgram:e,uniformMap:s,renderState:i,pass:r.Pass.OPAQUE,count:this.mo.faces.length});this.Wo.je=A,this.mo.viewer.scene.primitives.add(this.Wo)}}class Cd{je;Xe=!0;fe=!1;constructor(){}update(t){this.fe||this.Xe&&t.commandList.push(this.je)}isDestroyed(){return this.fe}show(){0==this.Xe&&(this.Xe=!0)}hide(){this.Xe&&(this.Xe=!1)}destroy(){this.fe=!0,this.je.vertexArray.getAttribute(1).vertexBuffer.destroy(),this.je.vertexArray.rn=[],this.je.vertexArray.destroy()}}class Bd extends r.Event{mo={viewer:void 0,uri:"",adcode:"110000",bounds:[-90,-180,180,90],startTime:"20240901102940",endTime:"20240908102940",meshUri:"",meshEnuCenter:[120.14099999999999,30.240000000000002,0],meshHeight:0,style:{modelUri:"",modelScale:1}};Fh={};Ac=[];uc;constructor(t){super(),this.mo.viewer=t.viewer||this.mo.viewer,this.mo.meshEnuCenter=t.meshEnuCenter||this.mo.meshEnuCenter,this.mo.uri=t.uri||this.mo.uri,this.mo.meshUri=t.meshUri||this.mo.meshUri,this.mo.startTime=t.startTime||this.mo.startTime,this.mo.adcode=t.adcode||this.mo.adcode,this.mo.bounds=t.bounds||this.mo.bounds,this.mo.meshHeight=t.meshHeight||this.mo.meshHeight,this.mo.style=Object.assign(this.mo.style,t.style),this.mo.viewer&&this._n()}destroy(){this.Fh=[],this.Ac.forEach((t=>{this.mo.viewer?.entities.remove(t)}))}show(){this.Ac.forEach((t=>{t.show=!0}))}hide(){this.Ac.forEach((t=>{t.show=!1}))}update(){this._n()}async _n(){this.Fh=await this.Th(),this.lc(),this.gc()}lc(){const t=this.mo.viewer;if(!t)return;const e=["./car0.glb","./car1.glb","./car4.glb","./car5.glb","./car6.glb","./car13.glb"];for(let n=0;n<this.Fh.length;n++){const i=this.Fh[n],o=r.Cartesian3.fromDegrees(i[0].point[0],i[0].point[1],this.mo.meshHeight),s=t.entities.add({name:`Model ${n}`,position:o,orientation:r.Transforms.headingPitchRollQuaternion(o,new r.HeadingPitchRoll(0,0,0)),model:{uri:this.mo.style.modelUri||e[0],scale:this.mo.style.modelScale||1,heightReference:r.HeightReference.RELATIVE_TO_TERRAIN}});this.Ac.push(s)}}gc(){const t=this.mo.viewer;if(!t)return;let e=1/0,n=0;for(let t=0;t<this.Fh.length;t++){const i=this.Fh[t];e=Math.min(e,i[0].time),n=Math.max(n,i[i.length-1].time)}const i=r.JulianDate.now();for(let t=0;t<this.Fh.length;t++){const e=this.Fh[t],n=new r.SampledPositionProperty;for(let t=1;t<e.length;t++){const o=e[t].point,s=e[t].time,a=r.JulianDate.addSeconds(i,s,new r.JulianDate),A=r.Cartesian3.fromDegrees(o[0],o[1],this.mo.meshHeight);n.addSample(a,A)}const o=this.Ac[t];o.position=n;const s=new r.VelocityOrientationProperty(n,r.Ellipsoid.WGS84);o.orientation=s}const o=t.clock;o.shouldAnimate=!0,o.startTime=r.JulianDate.addSeconds(i,e,new r.JulianDate),o.currentTime=o.startTime,o.stopTime=r.JulianDate.addSeconds(i,n,new r.JulianDate),o.clockRange=r.ClockRange.LOOP_STOP,o.multiplier=1}async Th(){const t=await fetch(this.mo.uri,{method:"GET"}),e=await t.json();if(0!==e.code)throw new Error("浮动车数据获取失败:"+e.message);return e.data.trackPoint}async vc(){if(!this.mo.viewer)return;const t=await this.Ic();this.uc=new wd({viewer:this.mo.viewer,enuCenter:this.mo.meshEnuCenter,vertices:t.vertices,faces:t.faces})}async Ic(){const t=await fetch(this.mo.meshUri,{method:"GET"}),e=await t.json();if(!e.faces||!e.vertices)throw new Error("Mesh 模型数据获取失败:"+e.message);return e}}!function(t){t[t.distance=0]="distance",t[t.groundArea=1]="groundArea"}(nd||(nd={}));class Ed{yc=nd.distance;wc;Cc;Bc=[];zr="closed";Ec=[];Qc;Jn=[];Bn;mo;fe=!1;constructor(t,n){this.mo={unit:"米",precision:.1,...n},this.Bn=t;const i=e=>{let n;return this.yc===nd.distance?n=t.entities.add({polyline:{positions:e,width:5,material:new r.PolylineOutlineMaterialProperty({color:new r.Color(0,98/255,254/255,1),outlineColor:r.Color.WHITE,outlineWidth:2}),depthFailMaterial:new r.PolylineOutlineMaterialProperty({color:new r.Color(0,98/255,254/255,1),outlineColor:r.Color.WHITE,outlineWidth:2})}}):this.yc===nd.groundArea&&(n=t.entities.add({polygon:{hierarchy:e,material:new r.ColorMaterialProperty(new r.Color(0,98/255,254/255,.3))}})),t.scene.requestRender(),n};this.wc=new e.ScreenSpaceEventHandler(t.canvas);const o=e=>{let n=t.scene.pickPosition(e);if(!n){const i=t.scene.pick(e,1,1);!i||i.id!=this.Qc&&-1===this.Jn.indexOf(i.id)||(n=i.id.position.getValue(r.JulianDate.now()))}return n};this.wc.setInputAction((t=>{if("open"!==this.zr)return;const e=o(t.position);if(r.defined(e))if(this.Cc){this.Ec.pop();const t=this.Ec[this.Ec.length-1];if(this.Ec.push(e,e),this.yc==nd.distance){let n=r.Cartesian3.distance(e,t);const i=this.mo.unit;if("分米"==i&&(n*=10),"厘米"==i&&(n*=100),"毫米"==i&&(n*=1e3),"dm"==i&&(n*=10),"cm"==i&&(n*=100),"mm"==i&&(n*=1e3),this.mo.precision<=1){const t=Math.round(1/this.mo.precision);n=Math.round(n*t)/t}else n=Math.round(n/this.mo.precision)*this.mo.precision;const o=new r.Cartesian3;r.Cartesian3.add(t,e,o),r.Cartesian3.divideByScalar(o,2,o),this.Jn.push(this._c(o,n+" "+i))}this.Jn.push(this.xc(e))}else{this.Qc=this.xc(e);const t=[e,e],n=new r.CallbackProperty((()=>{if(this.Cc)return this.yc===nd.groundArea?new r.PolygonHierarchy(this.Ec):this.Ec}),!1);this.Cc=i(n),this.Ec=t,this.Jn.push(this.xc(e))}}),r.ScreenSpaceEventType.LEFT_CLICK),this.wc.setInputAction((t=>{if("open"===this.zr&&r.defined(this.Qc)){const e=o(t.endPosition);r.defined(e)&&(this.Qc.position.setValue(e),this.Ec.pop(),this.Ec.push(e),this.Bn.scene.requestRender())}}),r.ScreenSpaceEventType.MOUSE_MOVE),this.wc.setInputAction((t=>{this.Dc()}),r.ScreenSpaceEventType.RIGHT_CLICK)}destroy(){this.stop(!0),this.wc.destroy(),this.fe=!0}Sc(){if(this.Cc)if(this.yc===nd.distance)this.Cc.polyline.positions=this.Ec,this.Ec.length<2?(this.Bn.entities.remove(this.Cc),this.Jn.forEach((t=>{this.Bn.entities.remove(t)}))):(this.Bc.push(this.Cc),this.Bc.push.apply(this.Bc,this.Jn),this.Jn=[]);else if(this.yc===nd.groundArea)if(this.Cc.polygon.hierarchy=new r.PolygonHierarchy(this.Ec),this.Ec.length<3)this.Bn.entities.remove(this.Cc),this.Jn.forEach((t=>{this.Bn.entities.remove(t)}));else{this.Bc.push(this.Cc),this.Bc.push.apply(this.Bc,this.Jn);const t=new r.Cartesian3;this.Ec.forEach((e=>{t.x+=e.x,t.y+=e.y,t.z+=e.z})),r.Cartesian3.divideByScalar(t,this.Ec.length,t),this.Bc.push(this._c(t,"100")),this.Jn=[]}return this.Bn.scene.requestRender(),this.Cc}xc(t){const e=this.Bn.entities.add({position:t,point:{color:new r.Color(0,98/255,254/255,1),outlineColor:r.Color.WHITE,outlineWidth:1.5,pixelSize:5}});return this.Bn.scene.requestRender(),e}_c(t,e){const n=this.Bn.entities.add({position:t,label:{text:e,font:"12px sans-serif",horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.CENTER,fillColor:r.Color.GHOSTWHITE,showBackground:!0,backgroundColor:new r.Color(0,98/255,254/255,1),backgroundPadding:new r.Cartesian2(4,4),pixelOffset:new r.Cartesian2(0,-20),disableDepthTestDistance:Number.POSITIVE_INFINITY}});return this.Bn.scene.requestRender(),n}Dc(){"open"===this.zr&&(this.Ec.pop(),this.Bn.entities.remove(this.Qc),this.Qc=void 0,this.Sc(),this.Cc=void 0,this.Ec=[])}Mc(){this.fe||(this.zr="open")}distance(t=!1){this.Cc&&this.Dc(),this.yc=nd.distance,this.Mc()}area(t=!1){this.Cc&&this.Dc(),this.yc=nd.groundArea,this.Mc()}stop(t){this.zr="closed",t&&this.clear()}clear(){this.Dc(),this.Qc&&this.Bn.entities.remove(this.Qc),this.Jn.forEach((t=>{this.Bn.entities.remove(t)})),this.Cc&&this.Bn.entities.remove(this.Cc),this.Bc.forEach((t=>{this.Bn.entities.remove(t)})),this.Bn.scene.requestRender()}}Math.PI;const md=180/Math.PI,Qd=6378137,kd=20037508.342789244,bd=t=>{const e=t[0],n=t[1];return[e/Qd*md,(2*Math.atan(Math.exp(n/Qd))-Math.PI/2)*md]},_d=t=>2*kd/2**t,xd=bd,Dd=(t,e,n)=>{const i=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244];let r;return r=void 0===n?40075016.68557849:256*Math.pow(2,n),[t=(t/r-.5)*i[2]*2,e=-(e/r-.5)*i[2]*2]},Sd=t=>bd((t=>{const e=t[0],n=_d(e),i=t[1],r=t[2];return[(i+.5)*n-kd,kd-(r+.5)*n]})(t)),Md=(t,e=!1)=>{const n=t[0],i=_d(n),r=t[1],o=t[2],s=r*i-kd,a=s+i,A=kd-o*i,u=bd([s,A-i]),h=bd([a,A]),l=[u[0],u[1],h[0],h[1]];return e?[u,[h[0],u[1]],h,[u[0],h[1]]]:l};class $d{Io;po="栅格图";yo=!1;wo;Co;Bo;_show=!0;Eo;Bn;$c;Rc;Fc=0;Gc=0;mo;constructor(t){this.mo=t,this.Bn=t.viewer,this.wo=new r.Event,this.Co=new r.Event,this.Rc=new rc({Ni:100,Gi:(t,e)=>{e.entity&&this.Io.remove(e.entity)}}),this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this.$c=[[4,11,5],[4,12,5],[4,13,5],[4,11,6],[4,12,6],[4,13,6],[4,12,7],[4,13,7]]}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}update(){const t=(new Date).getTime();if(t-this.Fc<1e3)return!0;this.Fc=t;const e=this.Io,n=this.Bn,i=n.scene.canvas,o=new r.Cartesian2(i.clientWidth/2,i.clientHeight/2),s=n.scene.pickPosition(o);if(s){const i=n.scene.camera,o=r.Cartesian3.distance(i.positionWC,s),a=Math.min(this.mo.zooms[1],Math.round(Math.log2(2400/o))+16);if(a>=this.mo.zooms[0]&&this.show){const n=r.Cartographic.fromCartesian(s).height;if(n>=-400){if(e.suspendEvents(),e.removeAll(),this.mo.forceUpdateTime&&this.Gc){const e=Math.floor(t/(1e3*this.mo.forceUpdateTime));e!==this.Gc&&(this.Rc.ye(),this.Gc=e)}const o=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC).planes;(new Date).getTime();const s=[],A=t=>{let e=!1,u=!1;const h=Md(t),l=Sd(t);let c=[l[0],l[1],n];const f=c[0],d=c[1],g=c[2],v=zl([h[0],h[1],n],c),I=zl([h[2],h[3],n],c),p=[v.x,v.y,v.z,I.x,I.y,Math.max(n,I.z)],y=4800*2**(16-t[0]),w=r.Cartesian3.fromDegrees(f,d,g),C=r.Transforms.eastNorthUpToFixedFrame(w),B=r.Matrix4.inverse(C,new r.Matrix4),E=o.map((t=>{const e=new r.Cartesian3(t.x,t.y,t.z),n=t.w,i=r.Matrix4.multiplyByPointAsVector(B,e,new r.Cartesian3),o=r.Cartesian3.multiplyByScalar(e,-n,new r.Cartesian3),s=r.Matrix4.multiplyByPoint(B,o,new r.Cartesian3),a=-r.Cartesian3.dot(i,s);return new r.Cartesian4(i.x,i.y,i.z,a)})),m=new r.Cartesian3(p[0],p[1],p[2]),Q=new r.Cartesian3(p[3],p[4],p[5]),k=new r.AxisAlignedBoundingBox(m,Q);if(e=new r.CullingVolume(E).computeVisibility(k)!==r.Intersect.OUTSIDE,e){const e=((t,e,n)=>{const i=Yl(t,n);return((t,e,n,i,r,o,s,a,A)=>{let u=Math.max(t-s,0,s-i),h=Math.max(e-a,0,a-r),l=Math.max(n-A,0,A-o);return Math.sqrt(u*u+h*h+l*l)})(e[0],e[1],e[2],e[3],e[4],e[5],i.x,i.y,i.z)})(i.positionWC,p,c);if(u=e<=y,u)if(t[0]<a){const e=t[0]+1,n=[[e,t[1]<<1,t[2]<<1],[e,t[1]<<1,1+(t[2]<<1)],[e,1+(t[1]<<1),t[2]<<1],[e,1+(t[1]<<1),1+(t[2]<<1)]];for(let t=0;t<n.length;t+=1){const e=n[t];A(e)}}else s.push(t)}return[e,u,!1,!1]};for(let t=0;t<this.$c.length;t+=1){const e=this.$c[t];A(e)}s.forEach((t=>{t.join("_");const n=this.mo.getTileUrl(t,new Date),i=this.Rc.Yi(n,!1);if(i)"loaded"==i.status&&(e.contains(i.entity)||(e.add(i.entity),this.mo.viewer.scene.requestRender()));else{const i=document.createElement("img");i.crossOrigin="anonymous",i.src=n;const o=Md(t);i.onload=()=>{const s=new r.Entity({id:n,rectangle:{coordinates:r.Rectangle.fromDegrees(o[0],o[1],o[2],o[3]),material:new r.ImageMaterialProperty({image:i}),zIndex:t[0]}});e.add(s),this.mo.viewer.scene.requestRender();const a=this.Rc.Yi(n,!0);a.entity=s,a.status="loaded"},i.onerror=()=>{this.Rc.Yi(n,!0).status="error"};const s={status:"loading",entity:null};this.Rc.Wi(n,s)}})),e.resumeEvents()}}else e.removeAll()}return!0}}class Rd{Bn;Mo;fe=!1;constructor(t){const e=t.viewer;this.Bn=e,this.Mo=new $d(t),e.dataSources.add(this.Mo)}setVisibility(t,e){this.Mo&&(this.Mo.show=e)}hide(){this.Mo&&(this.Mo.show=!1)}show(){this.Mo&&(this.Mo.show=!0)}destory(){this.Mo&&(this.Mo.entities.removeAll(),this.Bn?.dataSources.remove(this.Mo),this.Mo=void 0),this.fe=!0,this.Bn=void 0}}class Fd extends Rd{constructor(t){super({name:"交通预测栅格图",viewer:t,forceUpdateTime:300,zooms:[8,17],getTileUrl:(t,e)=>`https://history.traffic.amap.com/traffic?type=2&day=${e.getDay()}&hh=${e.getHours()}&mm=${5*Math.floor(e.getMinutes()/5)}&x=${t[1]}&y=${t[2]}&z=${t[0]}`})}}class Gd extends Rd{constructor(t){super({name:"路网栅格图",viewer:t,forceUpdateTime:0,zooms:[3,18],getTileUrl:t=>`https://wprd0${(t[1]+t[2])%4+1}.is.autonavi.com/appmaptile?x=${t[1]}&y=${t[2]}&z=${t[0]}&lang=zh_cn&size=1&scl=1&style=8`})}}var Ld,Nd,Ud,Td,Pd=function(){if(Nd)return Ld;Nd=1;var t=3.141592653589793,e=6378245,n=.006693421622965943;function i(e,n){var i=2*e-100+3*n+.2*n*n+.1*e*n+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,(i+=2*(20*Math.sin(n*t)+40*Math.sin(n/3*t))/3)+2*(160*Math.sin(n/12*t)+320*Math.sin(n*t/30))/3}function r(e,n){var i=300+e+2*n+.1*e*e+.1*e*n+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,(i+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3)+2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3}return Ld={wgs84ToGcj02:function(o,s){var a=i(o-105,s-35),A=r(o-105,s-35),u=s/180*t,h=Math.sin(u);h=1-n*h*h;var l=Math.sqrt(h);return a=180*a/(e*(1-n)/(h*l)*t),[o+(A=180*A/(e/l*Math.cos(u)*t)),s+a]},gcj02ToWgs84:function(o,s){var a=i(o-105,s-35),A=r(o-105,s-35),u=s/180*t,h=Math.sin(u);h=1-n*h*h;var l=Math.sqrt(h);return a=180*a/(e*(1-n)/(h*l)*t),{lng:2*o-(o+(A=180*A/(e/l*Math.cos(u)*t))),lat:2*s-(s+a)}}}}();class qd{Io;po="矢量实时路况";yo=!1;wo;Co;Bo;_show=!0;Eo;Bn;$c;Rc;Fc=0;Gc=0;mo;constructor(t){this.mo=t,this.Bn=t.viewer,this.wo=new r.Event,this.Co=new r.Event,this.Rc=new rc({Ni:100,Gi:(t,e)=>{e.entity&&this.Io.remove(e.entity)}}),this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this.$c=[[4,11,5],[4,12,5],[4,13,5],[4,11,6],[4,12,6],[4,13,6],[4,12,7],[4,13,7]]}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}update(){const t={0:"fff93a43",1:"fffcac19",2:"ff20a962",3:"ff83171c",4:"ffadadad"},e=(new Date).getTime();if(e-this.Fc<1e3)return!0;this.Fc=e;const n=this.Io,i=this.Bn,o=i.scene.canvas,s=new r.Cartesian2(o.clientWidth/2,o.clientHeight/2),a=i.scene.pickPosition(s);if(a){const o=i.scene.camera,s=r.Cartesian3.distance(o.positionWC,a),A=Math.min(this.mo.zooms[1],Math.round(Math.log2(2400/s))+16);if(A>=this.mo.zooms[0]&&this.show){const i=10;r.Cartographic.fromCartesian(a).height;{n.suspendEvents(),n.removeAll();const s=Math.floor(e/12e4);s!==this.Gc&&(this.Gc=s);const a=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC).planes;(new Date).getTime();const u=[],h=t=>{let e=!1,n=!1;const s=Md(t),l=Sd(t);let c=[l[0],l[1],i];const f=c[0],d=c[1],g=c[2],v=zl([s[0],s[1],i],c),I=zl([s[2],s[3],i],c),p=[v.x,v.y,v.z,I.x,I.y,Math.max(i,I.z)],y=4800*2**(16-t[0]),w=r.Cartesian3.fromDegrees(f,d,g),C=r.Transforms.eastNorthUpToFixedFrame(w),B=r.Matrix4.inverse(C,new r.Matrix4),E=a.map((t=>{const e=new r.Cartesian3(t.x,t.y,t.z),n=t.w,i=r.Matrix4.multiplyByPointAsVector(B,e,new r.Cartesian3),o=r.Cartesian3.multiplyByScalar(e,-n,new r.Cartesian3),s=r.Matrix4.multiplyByPoint(B,o,new r.Cartesian3),a=-r.Cartesian3.dot(i,s);return new r.Cartesian4(i.x,i.y,i.z,a)})),m=new r.Cartesian3(p[0],p[1],p[2]),Q=new r.Cartesian3(p[3],p[4],p[5]),k=new r.AxisAlignedBoundingBox(m,Q);if(e=new r.CullingVolume(E).computeVisibility(k)!==r.Intersect.OUTSIDE,e){const e=((t,e,n)=>{const i=Yl(t,n);return((t,e,n,i,r,o,s,a,A)=>{let u=Math.max(t-s,0,s-i),h=Math.max(e-a,0,a-r),l=Math.max(n-A,0,A-o);return Math.sqrt(u*u+h*h+l*l)})(e[0],e[1],e[2],e[3],e[4],e[5],i.x,i.y,i.z)})(o.positionWC,p,c);if(n=e<=y,n)if(t[0]<A){const e=t[0]+1,n=[[e,t[1]<<1,t[2]<<1],[e,t[1]<<1,1+(t[2]<<1)],[e,1+(t[1]<<1),t[2]<<1],[e,1+(t[1]<<1),1+(t[2]<<1)]];for(let t=0;t<n.length;t+=1){const e=n[t];h(e)}}else u.push(t)}return[e,n,!1,!1]};for(let t=0;t<this.$c.length;t+=1){const e=this.$c[t];h(e)}u.forEach((e=>{const i=function(t,e,n){let i,r,o,s,a,A;return s=Math.floor(n/2),o=n-s,i=(1<<s)-1<<o,r=(1<<o)-1,A=e&i|t&r,a=t&i|e&r,[n,a,A]}(e[1],e[2],e[0]),o="https://vdata.amap.com/traffic?key="+this.mo.key+"&v=YunJingCesium&t="+i,s=o+"&w="+12e4*this.Gc;let a=this.Rc.Yi(o,!1),A=!1;a?("loaded"==a.status&&(a.entities.forEach((t=>{n.add(t)})),this.mo.viewer.scene.requestRender()),a.Gc!==this.Gc&&(A=!0)):(A=!0,a={status:"loading",entities:[]},this.Rc.Wi(o,a)),A&&fetch(s).then((n=>{try{n.json().then((n=>{const a=this.Rc.Yi(o,!1);if(a&&(a.status="loaded",a.entities=[],n.data)){n=(n=n.data)[i.join("_")];const o=(A=e[0],2*kd/256/Math.pow(2,A));for(let i=0,A=n.length;i<A;i++){const A=n[i],u=tc(t[i]);for(let t=0,n=A.length;t<n;t++){const n=A[t],i=.6*n[0]*this.mo.lineWidthFactor;for(let t=0,A=n[1].length;t<A;t++){const A=[],h=ec(n[1][t]);for(let t=0,n=h.length;t<n;t+=2){const n=o*(256*e[1]+h[t]),i=o*(256*e[2]+h[t+1]),s=xd(Dd(n,i)),a=Pd.gcj02ToWgs84(s[0],s[1]),u=r.Cartesian3.fromDegrees(a.lng,a.lat,0);A.push(u)}const l=new r.Entity({id:s+"_"+a.entities.length,polyline:{positions:A,clampToGround:!0,material:new r.Color(...u),zIndex:e[0],width:3*i}});a.entities.push(l)}}}a.Gc=this.Gc}var A}))}catch(t){const e=this.Rc.Yi(o,!1);if(e)return void(e.status="loaded")}}))})),n.resumeEvents()}}else n.removeAll()}return!0}}class Od{Bn;Mo;fe=!1;constructor(t){t.zooms=t.zooms||[7,17],t.zooms=[Math.max(7,t.zooms[0]),Math.min(17,t.zooms[1])],t.lineWidthFactor=t.lineWidthFactor||1;const e=t.viewer;this.Bn=e,this.Mo=new qd(t),e.dataSources.add(this.Mo)}setVisibility(t,e){this.Mo&&(this.Mo.show=e)}hide(){this.Mo&&(this.Mo.show=!1)}show(){this.Mo&&(this.Mo.show=!0)}destroy(){this.Mo&&(this.Mo.entities.removeAll(),this.Bn?.dataSources.remove(this.Mo),this.Mo=void 0),this.fe=!0,this.Bn=void 0}}class Hd{Io;po="单体化图层";yo=!1;wo;Co;Bo;_show=!0;Eo;Bn;mo;Qo;Ut;ko;bo;_o;xo;So;constructor(t){this.mo=t,this.So=t.cb,this.Bn=t.viewer,this.Ut=t.tiles,this.Qo=t.api_url,this.xo={},this.ko=[],this.bo={},this._o=new rc({Ni:10,Gi:this.onDrop}),this.wo=new r.Event,this.Co=new r.Event,this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this.init()}init(){this.So&&this.So(this.Io)}drawMonomer(t,e,n){const i=e.id.toString().split("@")[0];if(void 0!==n[i])return;let o=[],s=e.min_height;const a=e.contours;for(let t of a){const n=parseFloat(t[0]),i=parseFloat(t[1]);o.push(n),o.push(i),o.push(e.max_height)}t.add({name:"polygon",polygon:{hierarchy:r.Cartesian3.fromDegreesArrayHeights(o),material:r.Color.BLUE.withAlpha(.3),extrudedHeight:s,perPositionHeight:!0}}),n[i]=e}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}onDrop=(t,e)=>{delete this.bo[t],this.xo=[],this.ko=[],this.Io.removeAll();for(let t in this.bo)this.ko=this.ko.concat(this.bo[t]);for(let t of this.ko)this.drawMonomer(this.Io,t,this.xo);return!0};updateData(t){for(let e of t)this._o.Xi(e)||(this._o.Wi(e,"1"),fetch(this.Qo+e+".json").then((t=>t.json())).then((t=>{this.bo[e]=t,this.ko=[];for(let t in this.bo)this.ko=this.ko.concat(this.bo[t]);for(let t of this.ko)this.drawMonomer(this.Io,t,this.xo)})).catch((t=>{})));return!0}update(){return!0}pick(t){var e=this.Bn.scene.pick(t);return e?null!=e?.id?.id?this.xo[e.id.id]:void 0:null}}class zd{Bn;Mo;fe=!1;constructor(t){const e=t.viewer;this.Bn=e,this.Mo=new Hd(t),e.dataSources.add(this.Mo)}setVisibility(t,e){this.Mo&&(this.Mo.show=e)}hide(){this.Mo&&(this.Mo.entities.show=!1)}show(){this.Mo&&(this.Mo.entities.show=!0)}destory(){this.Mo&&(this.Mo.entities.removeAll(),this.Bn?.dataSources.remove(this.Mo),this.Mo=void 0),this.fe=!0,this.Bn=void 0}getEntities(){return this.Mo?.entities}update(t){return this.Mo?.updateData(t)}pick(t){return this.Mo?.pick(t)}}var Kd=function(){if(Td)return Ud;Td=1,Ud=function(n,i){i||(i={});var r,o,s,a,A,u,h,l,c,f,d,g=null==i.cutoff?.25:i.cutoff,v=null==i.radius?8:i.radius,I=i.channel||0;if(ArrayBuffer.isView(n)||Array.isArray(n)){if(!i.width||!i.height)throw Error("For raw data width and height should be provided by options");r=i.width,o=i.height,a=n,u=i.stride?i.stride:Math.floor(n.length/r/o)}else window.HTMLCanvasElement&&n instanceof window.HTMLCanvasElement?(h=(l=n).getContext("2d"),r=l.width,o=l.height,a=(c=h.getImageData(0,0,r,o)).data,u=4):window.CanvasRenderingContext2D&&n instanceof window.CanvasRenderingContext2D?(h=n,r=(l=n.canvas).width,o=l.height,a=(c=h.getImageData(0,0,r,o)).data,u=4):window.ImageData&&n instanceof window.ImageData&&(c=n,r=n.width,o=n.height,a=c.data,u=4);if(s=Math.max(r,o),window.Uint8ClampedArray&&a instanceof window.Uint8ClampedArray||window.Uint8Array&&a instanceof window.Uint8Array)for(A=a,a=Array(r*o),f=0,d=Math.floor(A.length/u);f<d;f++)a[f]=A[f*u+I]/255;else if(1!==u)throw Error("Raw data can have only 1 value per pixel");var p=Array(r*o),y=Array(r*o),w=Array(s),C=Array(s),B=Array(s+1),E=Array(s);for(f=0,d=r*o;f<d;f++){var m=a[f];p[f]=1===m?0:0===m?t:Math.pow(Math.max(0,.5-m),2),y[f]=1===m?t:0===m?0:Math.pow(Math.max(0,m-.5),2)}e(p,r,o,w,C,E,B),e(y,r,o,w,C,E,B);var Q=window.Float32Array?new Float32Array(r*o):new Array(r*o);for(f=0,d=r*o;f<d;f++)Q[f]=Math.min(Math.max(1-((p[f]-y[f])/v+g),0),1);return Q};var t=1e20;function e(t,e,i,r,o,s,a){for(var A=0;A<e;A++){for(var u=0;u<i;u++)r[u]=t[u*e+A];for(n(r,o,s,a,i),u=0;u<i;u++)t[u*e+A]=o[u]}for(u=0;u<i;u++){for(A=0;A<e;A++)r[A]=t[u*e+A];for(n(r,o,s,a,e),A=0;A<e;A++)t[u*e+A]=Math.sqrt(o[A])}}function n(e,n,i,r,o){i[0]=0,r[0]=-t,r[1]=+t;for(var s=1,a=0;s<o;s++){for(var A=(e[s]+s*s-(e[i[a]]+i[a]*i[a]))/(2*s-2*i[a]);A<=r[a];)a--,A=(e[s]+s*s-(e[i[a]]+i[a]*i[a]))/(2*s-2*i[a]);i[++a]=s,r[a]=A,r[a+1]=+t}for(s=0,a=0;s<o;s++){for(;r[a+1]<s;)a++;n[s]=(s-i[a])*(s-i[a])+e[i[a]]}}return Ud}(),Vd=Fh(Kd);function Jd(t){return t===e.HeightReference.CLAMP_TO_GROUND||t===e.HeightReference.CLAMP_TO_3D_TILE||t===e.HeightReference.CLAMP_TO_TERRAIN}const Yd=e.Billboard.SHOW_INDEX,jd=e.Billboard.POSITION_INDEX,Wd=e.Billboard.PIXEL_OFFSET_INDEX,Xd=e.Billboard.EYE_OFFSET_INDEX,Zd=e.Billboard.HORIZONTAL_ORIGIN_INDEX,tg=e.Billboard.VERTICAL_ORIGIN_INDEX,eg=e.Billboard.SCALE_INDEX,ng=e.Billboard.IMAGE_INDEX_INDEX,ig=e.Billboard.COLOR_INDEX,rg=e.Billboard.ROTATION_INDEX,og=e.Billboard.ALIGNED_AXIS_INDEX,sg=e.Billboard.SCALE_BY_DISTANCE_INDEX,ag=e.Billboard.TRANSLUCENCY_BY_DISTANCE_INDEX,Ag=e.Billboard.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,ug=e.Billboard.DISTANCE_DISPLAY_CONDITION,hg=e.Billboard.DISABLE_DEPTH_DISTANCE,lg=e.Billboard.TEXTURE_COORDINATE_BOUNDS,cg=e.Billboard.SDF_INDEX,fg=e.Billboard.NUMBER_OF_PROPERTIES;let dg;const gg={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},vg={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12,roadDirection:13};function Ig(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._scene=t.scene,this._batchTable=t.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(fg),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new e.BoundingSphere,this._baseVolumeWC=new e.BoundingSphere,this._baseVolume2D=new e.BoundingSphere,this._boundingVolume=new e.BoundingSphere,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=e.defaultValue(t.show,!0),this.modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY)),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this.debugShowBoundingVolume=e.defaultValue(t.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=e.defaultValue(t.debugShowTextureAtlas,!1),this.blendOption=e.defaultValue(t.blendOption,e.BlendOption.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=e.SceneMode.SCENE3D,this._buffersUsage=[e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW,e.BufferUsage.STATIC_DRAW],this._highlightColor=e.Color.clone(e.Color.WHITE);const n=this;this._uniforms={u_atlas:function(){return n._textureAtlas.texture},u_highlightColor:function(){return n._highlightColor}};const i=this._scene;e.defined(i)&&e.defined(i.terrainProviderChanged)&&(this._removeCallbackFunc=i.terrainProviderChanged.addEventListener((function(){const t=this._billboards,n=t.length;for(let i=0;i<n;++i)e.defined(t[i])&&t[i]._updateClamping()}),this))}function pg(t){const e=t.length;for(let n=0;n<e;++n)t[n]&&t[n]._destroy()}function yg(t){if(t._billboardsRemoved){t._billboardsRemoved=!1;const n=[],i=t._billboards,r=i.length;for(let t=0,o=0;t<r;++t){const r=i[t];e.defined(r)&&(r._index=o++,n.push(r))}t._billboards=n}}let wg;function Cg(t){let n=t.cache.billboardCollection_indexBufferBatched;if(e.defined(n))return n;const i=new Uint16Array(98298);for(let t=0,e=0;t<98298;t+=6,e+=4)i[t]=e,i[t+1]=e+1,i[t+2]=e+2,i[t+3]=e+0,i[t+4]=e+2,i[t+5]=e+3;return n=e.Buffer.createIndexBuffer({context:t,typedArray:i,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,t.cache.billboardCollection_indexBufferBatched=n,n}function Bg(t){let n=t.cache.billboardCollection_indexBufferInstanced2;return e.defined(n)||(n=e.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,t.cache.billboardCollection_indexBufferInstanced2=n),n}function Eg(t){let n=t.cache.billboardCollection_vertexBufferInstanced2;return e.defined(n)||(n=e.Buffer.createVertexBuffer({context:t,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:e.BufferUsage.STATIC_DRAW}),n.vertexArrayDestroyable=!1,t.cache.billboardCollection_vertexBufferInstanced2=n),n}Object.defineProperties(Ig.prototype,{length:{get:function(){return yg(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(t){this._textureAtlas!==t&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=t,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(t){this._destroyTextureAtlas=t}}}),Ig.prototype.add=function(t){const n=new e.Billboard(t,this);return n._index=this._billboards.length,this._billboards.push(n),this._createVertexArray=!0,n},Ig.prototype.remove=function(t){return!!this.contains(t)&&(this._billboards[t._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,t._destroy(),!0)},Ig.prototype.removeAll=function(){pg(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},Ig.prototype._updateBillboard=function(t,e){t._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=t),++this._propertiesChanged[e]},Ig.prototype.contains=function(t){return e.defined(t)&&t._billboardCollection===this},Ig.prototype.get=function(t){return e.Check.typeOf.number("index",t),yg(this),this._billboards[t]},Ig.prototype.computeNewBuffersUsage=function(){const t=this._buffersUsage;let n=!1;const i=this._propertiesChanged;for(let r=0;r<fg;++r){const o=0===i[r]?e.BufferUsage.STATIC_DRAW:e.BufferUsage.STREAM_DRAW;n=n||t[r]!==o,t[r]=o}return n};const mg=new e.EncodedCartesian3;function Qg(t,n,i,r,o){let s;const a=r[dg.positionHighAndScale],A=r[dg.positionLowAndRotation],u=o._getActualPosition();t._mode===e.SceneMode.SCENE3D&&(e.BoundingSphere.expand(t._baseVolume,u,t._baseVolume),t._boundingVolumeDirty=!0),e.EncodedCartesian3.fromCartesian(u,mg);const h=o.scale,l=o.rotation;0!==l&&(t._shaderRotation=!0),t._maxScale=Math.max(t._maxScale,h);const c=mg.high,f=mg.low;t._instanced?(s=o._index,a(s,c.x,c.y,c.z,h),A(s,f.x,f.y,f.z,l)):(s=4*o._index,a(s+0,c.x,c.y,c.z,h),a(s+1,c.x,c.y,c.z,h),a(s+2,c.x,c.y,c.z,h),a(s+3,c.x,c.y,c.z,h),A(s+0,f.x,f.y,f.z,l),A(s+1,f.x,f.y,f.z,l),A(s+2,f.x,f.y,f.z,l),A(s+3,f.x,f.y,f.z,l))}const kg=new e.Cartesian2,bg=32768,_g=65536,xg=4096,Dg=256,Sg=128,Mg=32,$g=8,Rg=4,Fg=1/256,Gg=0,Lg=2,Ng=3,Ug=1;function Tg(t,n,i,r,o){let s;const a=r[dg.compressedAttribute0],A=o.pixelOffset,u=A.x,h=A.y,l=o._translate,c=l.x,f=l.y;t._maxPixelOffset=Math.max(t._maxPixelOffset,Math.abs(u+c),Math.abs(-h+f));const d=o.horizontalOrigin;let g=o._verticalOrigin,v=o.show&&o.clusterShow;0===o.color.alpha&&(v=!1),g===e.VerticalOrigin.BASELINE&&(g=e.VerticalOrigin.BOTTOM),t._allHorizontalCenter=t._allHorizontalCenter&&d===e.HorizontalOrigin.CENTER,t._allVerticalCenter=t._allVerticalCenter&&g===e.VerticalOrigin.CENTER;let I=0,p=0,y=0,w=0;const C=o._imageIndex;if(-1!==C){const t=i[C];if(!e.defined(t))throw new e.DeveloperError(`Invalid billboard image index: ${C}`);I=t.x,p=t.y,y=t.width,w=t.height}const B=I+y,E=p+w;let m=Math.floor(e.Math.clamp(u,-bg,bg)+bg)*Sg;m+=(d+1)*Mg,m+=(g+1)*$g,m+=(v?1:0)*Rg;let Q=Math.floor(e.Math.clamp(h,-bg,bg)+bg)*Dg,k=Math.floor(e.Math.clamp(c,-bg,bg)+bg)*Dg;const b=(e.Math.clamp(f,-bg,bg)+bg)*Fg,_=Math.floor(b);Q+=_,k+=Math.floor((b-_)*Dg),kg.x=I,kg.y=p;const x=e.AttributeCompression.compressTextureCoordinates(kg);kg.x=B;const D=e.AttributeCompression.compressTextureCoordinates(kg);kg.y=E;const S=e.AttributeCompression.compressTextureCoordinates(kg);kg.x=I;const M=e.AttributeCompression.compressTextureCoordinates(kg);t._instanced?(s=o._index,a(s,m,Q,k,x)):(s=4*o._index,a(s+0,m+Gg,Q,k,x),a(s+1,m+Lg,Q,k,D),a(s+2,m+Ng,Q,k,S),a(s+3,m+Ug,Q,k,M))}function Pg(t,n,i,r,o){let s;const a=r[dg.compressedAttribute1],A=o.alignedAxis;e.Cartesian3.equals(A,e.Cartesian3.ZERO)||(t._shaderAlignedAxis=!0);let u=0,h=1,l=1,c=1;const f=o.translucencyByDistance;e.defined(f)&&(u=f.near,h=f.nearValue,l=f.far,c=f.farValue,1===h&&1===c||(t._shaderTranslucencyByDistance=!0));let d=0;const g=o._imageIndex;if(-1!==g){const t=i[g];if(!e.defined(t))throw new e.DeveloperError(`Invalid billboard image index: ${g}`);d=t.width}const v=t._textureAtlas.texture.width,I=Math.round(e.defaultValue(o.width,v*d));t._maxSize=Math.max(t._maxSize,I);let p=e.Math.clamp(I,0,_g),y=0;Math.abs(e.Cartesian3.magnitudeSquared(A)-1)<e.Math.EPSILON6&&(y=e.AttributeCompression.octEncodeFloat(A)),h=e.Math.clamp(h,0,1),h=1===h?255:255*h|0,p=p*Dg+h,c=e.Math.clamp(c,0,1),c=1===c?255:255*c|0,y=y*Dg+c,t._instanced?(s=o._index,a(s,p,y,u,l)):(s=4*o._index,a(s+0,p,y,u,l),a(s+1,p,y,u,l),a(s+2,p,y,u,l),a(s+3,p,y,u,l))}function qg(t,n,i,r,o){let s;const a=r[dg.compressedAttribute2],A=o.color,u=e.defined(t._batchTable)?e.Color.WHITE:o.getPickId(n.context).color,h=o.sizeInMeters?1:0,l=Math.abs(e.Cartesian3.magnitudeSquared(o.alignedAxis)-1)<e.Math.EPSILON6?1:0;t._allSizedInMeters=t._allSizedInMeters&&1===h;let c=0;const f=o._imageIndex;if(-1!==f){const t=i[f];if(!e.defined(t))throw new e.DeveloperError(`Invalid billboard image index: ${f}`);c=t.height}const d=t._textureAtlas.texture.dimensions,g=Math.round(e.defaultValue(o.height,d.y*c));t._maxSize=Math.max(t._maxSize,g);let v=e.defaultValue(o._labelHorizontalOrigin,-2);v+=2;const I=g*Rg+v;let p=e.Color.floatToByte(A.red),y=e.Color.floatToByte(A.green),w=e.Color.floatToByte(A.blue);const C=p*_g+y*Dg+w;p=e.Color.floatToByte(u.red),y=e.Color.floatToByte(u.green),w=e.Color.floatToByte(u.blue);const B=p*_g+y*Dg+w;let E=e.Color.floatToByte(A.alpha)*_g+e.Color.floatToByte(u.alpha)*Dg;E+=2*h+l,t._instanced?(s=o._index,a(s,C,B,E,I)):(s=4*o._index,a(s+0,C,B,E,I),a(s+1,C,B,E,I),a(s+2,C,B,E,I),a(s+3,C,B,E,I))}function Og(t,n,i,r,o){let s;const a=r[dg.eyeOffset],A=o.eyeOffset;let u=A.z;if(o._heightReference!==e.HeightReference.NONE&&(u*=1.005),t._maxEyeOffset=Math.max(t._maxEyeOffset,Math.abs(A.x),Math.abs(A.y),Math.abs(u)),t._instanced){let t=0,n=0;const r=o._imageIndex;if(-1!==r){const o=i[r];if(!e.defined(o))throw new e.DeveloperError(`Invalid billboard image index: ${r}`);t=o.width,n=o.height}kg.x=t,kg.y=n;const h=e.AttributeCompression.compressTextureCoordinates(kg);s=o._index,a(s,A.x,A.y,u,h)}else s=4*o._index,a(s+0,A.x,A.y,u,0),a(s+1,A.x,A.y,u,0),a(s+2,A.x,A.y,u,0),a(s+3,A.x,A.y,u,0)}function Hg(t,n,i,r,o){let s;const a=r[dg.scaleByDistance];let A=0,u=1,h=1,l=1;const c=o.scaleByDistance;e.defined(c)&&(A=c.near,u=c.nearValue,h=c.far,l=c.farValue,1===u&&1===l||(t._shaderScaleByDistance=!0)),t._instanced?(s=o._index,a(s,A,u,h,l)):(s=4*o._index,a(s+0,A,u,h,l),a(s+1,A,u,h,l),a(s+2,A,u,h,l),a(s+3,A,u,h,l))}function zg(t,n,i,r,o){let s;const a=r[dg.pixelOffsetScaleByDistance];let A=0,u=1,h=1,l=1;const c=o.pixelOffsetScaleByDistance;e.defined(c)&&(A=c.near,u=c.nearValue,h=c.far,l=c.farValue,1===u&&1===l||(t._shaderPixelOffsetScaleByDistance=!0)),t._instanced?(s=o._index,a(s,A,u,h,l)):(s=4*o._index,a(s+0,A,u,h,l),a(s+1,A,u,h,l),a(s+2,A,u,h,l),a(s+3,A,u,h,l))}function Kg(t,n,i,r,o){let s;const a=r[dg.compressedAttribute3];let A=0,u=Number.MAX_VALUE;const h=o.distanceDisplayCondition;e.defined(h)&&(A=h.near,u=h.far,A*=A,u*=u,t._shaderDistanceDisplayCondition=!0);let l=o.disableDepthTestDistance;const c=Jd(o.heightReference)&&n.context.depthTexture;let f,d;if(e.defined(l)||(l=c?5e3:0),l*=l,(c||l>0)&&(t._shaderDisableDepthDistance=!0,l===Number.POSITIVE_INFINITY&&(l=-1)),e.defined(o._labelDimensions))d=o._labelDimensions.x,f=o._labelDimensions.y;else{let n=0,r=0;const s=o._imageIndex;if(-1!==s){const t=i[s];if(!e.defined(t))throw new e.DeveloperError(`Invalid billboard image index: ${s}`);n=t.height,r=t.width}f=Math.round(e.defaultValue(o.height,t._textureAtlas.texture.dimensions.y*n));const a=t._textureAtlas.texture.width;d=Math.round(e.defaultValue(o.width,a*r))}const g=Math.floor(e.Math.clamp(d,0,xg)),v=Math.floor(e.Math.clamp(f,0,xg)),I=g*xg+v;t._instanced?(s=o._index,a(s,A,u,l,I)):(s=4*o._index,a(s+0,A,u,l,I),a(s+1,A,u,l,I),a(s+2,A,u,l,I),a(s+3,A,u,l,I))}function Vg(t,n,i,r,o){if(Jd(o.heightReference)){const i=t._scene,r=n.context,o=n.globeTranslucencyState.translucent,s=e.defined(i.globe)&&i.globe.depthTestAgainstTerrain;t._shaderClampToGround=r.depthTexture&&!o&&s}let s;const a=r[dg.textureCoordinateBoundsOrLabelTranslate];if(e.ContextLimits.maximumVertexTextureImageUnits>0){let n=0,i=0;return e.defined(o._labelTranslate)&&(n=o._labelTranslate.x,i=o._labelTranslate.y),void(t._instanced?(s=o._index,a(s,n,i,0,0)):(s=4*o._index,a(s+0,n,i,0,0),a(s+1,n,i,0,0),a(s+2,n,i,0,0),a(s+3,n,i,0,0)))}let A=0,u=0,h=0,l=0;const c=o._imageIndex;if(-1!==c){const t=i[c];if(!e.defined(t))throw new e.DeveloperError(`Invalid billboard image index: ${c}`);A=t.x,u=t.y,h=t.width,l=t.height}const f=A+h,d=u+l;t._instanced?(s=o._index,a(s,A,u,f,d)):(s=4*o._index,a(s+0,A,u,f,d),a(s+1,A,u,f,d),a(s+2,A,u,f,d),a(s+3,A,u,f,d))}function Jg(t,n,i,r,o){if(!t._sdf)return;let s;const a=r[dg.sdf],A=o.outlineColor,u=o.outlineWidth,h=e.Color.floatToByte(A.red),l=e.Color.floatToByte(A.green),c=e.Color.floatToByte(A.blue),f=h*_g+l*Dg+c,d=u/e.SDFSettings.RADIUS,g=e.Color.floatToByte(A.alpha)*_g+e.Color.floatToByte(d)*Dg;t._instanced?(s=o._index,a(s,f,g)):(s=4*o._index,a(s+0,f+Gg,g),a(s+1,f+Lg,g),a(s+2,f+Ng,g),a(s+3,f+Ug,g))}function Yg(t,n,i,r,o){Qg(t,0,0,r,o),Tg(t,0,i,r,o),Pg(t,0,i,r,o),qg(t,n,i,r,o),Og(t,0,i,r,o),Hg(t,0,0,r,o),zg(t,0,0,r,o),Kg(t,n,i,r,o),Vg(t,n,i,r,o),function(t,n,i,r,o){if(!e.defined(t._batchTable))return;const s=r[dg.a_batchId],a=o._batchIndex;let A;t._instanced?(A=o._index,s(A,a)):(A=4*o._index,s(A+0,a),s(A+1,a),s(A+2,a),s(A+3,a))}(t,0,0,r,o),Jg(t,0,0,r,o),function(t,e,n,i,r){if(!t._sdf)return;const o=i[dg.roadDirection],s=r.roadDirection;o(r._index,s.x,s.y,s.z,s.w)}(t,0,0,r,o)}function jg(t,n,i,r,o,s){let a;r.mode===e.SceneMode.SCENE3D?(a=t._baseVolume,t._boundingVolumeDirty=!0):a=t._baseVolume2D;const A=[];for(let t=0;t<i;++t){const i=n[t],u=i.position,h=e.Billboard._computeActualPosition(i,u,r,o);e.defined(h)&&(i._setActualPosition(h),s?A.push(h):e.BoundingSphere.expand(a,h,a))}s&&e.BoundingSphere.fromPoints(A,a)}const Wg=[];Ig.prototype.update=function(t){if(yg(this),!this.show)return;let n=this._billboards,i=n.length;const r=t.context;this._instanced=r.instancedArrays,dg=this._instanced?vg:gg,wg=this._instanced?Bg:Cg;let o=this._textureAtlas;if(!e.defined(o)){o=this._textureAtlas=new e.TextureAtlas({context:r});for(let t=0;t<i;++t)n[t]._loadImage()}const s=o.textureCoordinates;if(0===s.length)return;!function(t,n){const i=n.mode,r=t._billboards,o=t._billboardsToUpdate,s=t._modelMatrix;t._createVertexArray||t._mode!==i||i!==e.SceneMode.SCENE3D&&!e.Matrix4.equals(s,t.modelMatrix)?(t._mode=i,e.Matrix4.clone(t.modelMatrix,s),t._createVertexArray=!0,i!==e.SceneMode.SCENE3D&&i!==e.SceneMode.SCENE2D&&i!==e.SceneMode.COLUMBUS_VIEW||jg(t,r,r.length,n,s,!0)):i===e.SceneMode.MORPHING?jg(t,r,r.length,n,s,!0):i!==e.SceneMode.SCENE2D&&i!==e.SceneMode.COLUMBUS_VIEW||jg(t,o,t._billboardsToUpdateIndex,n,s,!1)}(this,t),n=this._billboards,i=n.length;const a=this._billboardsToUpdate,A=this._billboardsToUpdateIndex,u=this._propertiesChanged,h=o.guid,l=this._createVertexArray||this._textureAtlasGUID!==h;let c;this._textureAtlasGUID=h;const f=t.passes,d=f.pick;if(l||!d&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let t=0;t<fg;++t)u[t]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),i>0){this._vaf=function(t,n,i,r,o,s){const a=[{index:dg.positionHighAndScale,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[jd]},{index:dg.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[jd]},{index:dg.compressedAttribute0,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[Wd]},{index:dg.compressedAttribute1,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[ag]},{index:dg.compressedAttribute2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[ig]},{index:dg.eyeOffset,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[Xd]},{index:dg.scaleByDistance,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[sg]},{index:dg.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[Ag]},{index:dg.compressedAttribute3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[ug]},{index:dg.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[lg]}];r&&a.push({index:dg.direction,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,vertexBuffer:Eg(t)}),e.defined(o)&&a.push({index:dg.a_batchId,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,bufferUsage:e.BufferUsage.STATIC_DRAW}),s&&(a.push({index:dg.sdf,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,usage:i[cg]}),a.push({index:dg.roadDirection,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,usage:e.BufferUsage.STATIC_DRAW}));const A=r?n:4*n;return new e.VertexArrayFacade(t,a,A,r)}(r,i,this._buffersUsage,this._instanced,this._batchTable,this._sdf),c=this._vaf.writers;for(let e=0;e<i;++e){const n=this._billboards[e];n._dirty=!1,Yg(this,t,s,c,n)}this._vaf.commit(wg(r))}this._billboardsToUpdateIndex=0}else if(A>0){const e=Wg;e.length=0,(u[jd]||u[rg]||u[eg])&&e.push(Qg),(u[ng]||u[Wd]||u[Zd]||u[tg]||u[Yd])&&(e.push(Tg),this._instanced&&e.push(Og)),(u[ng]||u[og]||u[ag])&&(e.push(Pg),e.push(qg)),(u[ng]||u[ig])&&e.push(qg),u[Xd]&&e.push(Og),u[sg]&&e.push(Hg),u[Ag]&&e.push(zg),(u[ug]||u[hg]||u[ng]||u[jd])&&e.push(Kg),(u[ng]||u[jd])&&e.push(Vg),u[cg]&&e.push(Jg);const n=e.length;if(c=this._vaf.writers,A/i>.1){for(let i=0;i<A;++i){const r=a[i];r._dirty=!1;for(let i=0;i<n;++i)e[i](this,t,s,c,r)}this._vaf.commit(wg(r))}else{for(let i=0;i<A;++i){const r=a[i];r._dirty=!1;for(let i=0;i<n;++i)e[i](this,t,s,c,r);this._instanced?this._vaf.subCommit(r._index,1):this._vaf.subCommit(4*r._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(A>1.5*i&&(a.length=i),!e.defined(this._vaf)||!e.defined(this._vaf.va))return;let g;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,e.BoundingSphere.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let v=e.Matrix4.IDENTITY;t.mode===e.SceneMode.SCENE3D?(v=this.modelMatrix,g=e.BoundingSphere.clone(this._baseVolumeWC,this._boundingVolume)):g=e.BoundingSphere.clone(this._baseVolume2D,this._boundingVolume),function(t,e,n){let i=1;t._allSizedInMeters&&0===t._maxPixelOffset||(i=e.camera.getPixelSize(n,e.context.drawingBufferWidth,e.context.drawingBufferHeight));let r=i*t._maxScale*t._maxSize*2;t._allHorizontalCenter&&t._allVerticalCenter&&(r*=.5);const o=i*t._maxPixelOffset+t._maxEyeOffset;n.radius+=r+o}(this,t,g);const I=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,I){this._blendOption===e.BlendOption.OPAQUE||this._blendOption===e.BlendOption.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=e.RenderState.fromCache({depthTest:{enabled:!0,func:e.WebGLConstants.LESS},depthMask:!0}):this._rsOpaque=void 0;const t=this._blendOption===e.BlendOption.TRANSLUCENT;this._blendOption===e.BlendOption.TRANSLUCENT||this._blendOption===e.BlendOption.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=e.RenderState.fromCache({depthTest:{enabled:!1,func:t?e.WebGLConstants.LEQUAL:e.WebGLConstants.LESS},depthMask:!1,blending:e.BlendingState.ALPHA_BLEND}):this._rsTranslucent=void 0}let p,y,w,C,B;this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==t.minimumDisableDepthTestDistance;const E=e.ContextLimits.maximumVertexTextureImageUnits>0;if(I||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){p="#ifdef INSTANCED\nin vec2 direction;\n#endif\nin vec4 positionHighAndScale;in vec4 positionLowAndRotation;in vec4 compressedAttribute0;in vec4 compressedAttribute1;in vec4 compressedAttribute2;in vec4 eyeOffset;in vec4 scaleByDistance;in vec4 pixelOffsetScaleByDistance;in vec4 compressedAttribute3;in vec2 sdf;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nin vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nin float a_batchId;\n#endif\n#ifdef SDF\nin vec4 roadDirection;\n#endif\nout vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nout vec4 v_textureCoordinateBounds;out vec4 v_originTextureCoordinateAndTranslate;out vec4 v_compressed;out mat2 v_rotationMatrix;\n#endif\nout vec4 v_pickColor;out vec4 v_color;\n#ifdef SDF\nout vec4 v_outlineColor;out float v_outlineWidth;\n#endif\nout float v_discard;const float UPPER_BOUND=32768.0;const float SHIFT_LEFT16=65536.0;const float SHIFT_LEFT12=4096.0;const float SHIFT_LEFT8=256.0;const float SHIFT_LEFT7=128.0;const float SHIFT_LEFT5=32.0;const float SHIFT_LEFT3=8.0;const float SHIFT_LEFT2=4.0;const float SHIFT_LEFT1=2.0;const float SHIFT_RIGHT12=1.0/4096.0;const float SHIFT_RIGHT8=1.0/256.0;const float SHIFT_RIGHT7=1.0/128.0;const float SHIFT_RIGHT5=1.0/32.0;const float SHIFT_RIGHT3=1.0/8.0;const float SHIFT_RIGHT2=1.0/4.0;const float SHIFT_RIGHT1=1.0/2.0;vec4 addScreenSpaceOffset(vec4 positionEC,vec2 imageSize,float scale,vec2 direction,vec2 origin,vec2 translate,vec2 pixelOffset,vec3 alignedAxis,bool validAlignedAxis,float rotation,bool sizeInMeters,out mat2 rotationMatrix,out float mpp){vec2 halfSize=imageSize*scale*0.5;halfSize*=((direction*2.0)-1.0);vec2 originTranslate=origin*abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif(validAlignedAxis||rotation!=0.0){float angle=rotation;if(validAlignedAxis){vec4 projectedAlignedAxis=czm_modelView3D*vec4(alignedAxis,0.0);angle+=sign(-projectedAlignedAxis.x)*acos(sign(projectedAlignedAxis.y)*(projectedAlignedAxis.y*projectedAlignedAxis.y)/(projectedAlignedAxis.x*projectedAlignedAxis.x+projectedAlignedAxis.y*projectedAlignedAxis.y));}float cosTheta=cos(angle);float sinTheta=sin(angle);rotationMatrix=mat2(cosTheta,sinTheta,-sinTheta,cosTheta);halfSize=rotationMatrix*halfSize;}else{rotationMatrix=mat2(1.0,0.0,0.0,1.0);}\n#endif\nmpp=czm_metersPerPixel(positionEC);positionEC.xy+=(originTranslate+halfSize)*czm_branchFreeTernary(sizeInMeters,1.0,mpp);positionEC.xy+=(translate+pixelOffset)*mpp;return positionEC;}float getGlobeDepth(vec4 positionEC){vec4 posWC=czm_eyeToWindowCoordinates(positionEC);float globeDepth=czm_unpackDepth(texture(czm_globeDepthTexture,posWC.xy/czm_viewport.zw));if(globeDepth==0.0){return 0.0;}vec4 eyeCoordinate=czm_windowToEyeCoordinates(posWC.xy,globeDepth);return eyeCoordinate.z/eyeCoordinate.w;}float crossProduct(vec2 a,vec2 b){return a.x*b.y-a.y*b.x;}void main(){vec3 positionHigh=positionHighAndScale.xyz;vec3 positionLow=positionLowAndRotation.xyz;float scale=positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation=positionLowAndRotation.w;\n#else\nfloat rotation=0.0;\n#endif\nfloat compressed=compressedAttribute0.x;vec2 pixelOffset;pixelOffset.x=floor(compressed*SHIFT_RIGHT7);compressed-=pixelOffset.x*SHIFT_LEFT7;pixelOffset.x-=UPPER_BOUND;vec2 origin;origin.x=floor(compressed*SHIFT_RIGHT5);compressed-=origin.x*SHIFT_LEFT5;origin.y=floor(compressed*SHIFT_RIGHT3);compressed-=origin.y*SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin=origin.xy;\n#endif\norigin-=vec2(1.0);float show=floor(compressed*SHIFT_RIGHT2);compressed-=show*SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft=czm_decompressTextureCoordinates(compressedAttribute0.w);vec2 textureCoordinatesRange=czm_decompressTextureCoordinates(eyeOffset.w);vec2 textureCoordinates=textureCoordinatesBottomLeft+direction*textureCoordinatesRange;\n#else\nvec2 direction;direction.x=floor(compressed*SHIFT_RIGHT1);direction.y=compressed-direction.x*SHIFT_LEFT1;vec2 textureCoordinates=czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp=compressedAttribute0.y*SHIFT_RIGHT8;pixelOffset.y=-(floor(temp)-UPPER_BOUND);vec2 translate;translate.y=(temp-floor(temp))*SHIFT_LEFT16;temp=compressedAttribute0.z*SHIFT_RIGHT8;translate.x=floor(temp)-UPPER_BOUND;translate.y+=(temp-floor(temp))*SHIFT_LEFT8;translate.y-=UPPER_BOUND;temp=compressedAttribute1.x*SHIFT_RIGHT8;float temp2=floor(compressedAttribute2.w*SHIFT_RIGHT2);vec2 imageSize=vec2(floor(temp),temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin=floor(compressedAttribute2.w-(temp2*SHIFT_LEFT2));float applyTranslate=0.0;if(labelHorizontalOrigin!=0.0){applyTranslate=1.0;labelHorizontalOrigin-=2.0;depthOrigin.x=labelHorizontalOrigin+1.0;}depthOrigin=vec2(1.0)-(depthOrigin*0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;translucencyByDistance.x=compressedAttribute1.z;translucencyByDistance.z=compressedAttribute1.w;translucencyByDistance.y=((temp-floor(temp))*SHIFT_LEFT8)/255.0;temp=compressedAttribute1.y*SHIFT_RIGHT8;translucencyByDistance.w=((temp-floor(temp))*SHIFT_LEFT8)/255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp=compressedAttribute3.w;temp=temp*SHIFT_RIGHT12;vec2 dimensions;dimensions.y=(temp-floor(temp))*SHIFT_LEFT12;dimensions.x=floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis=czm_octDecode(floor(compressedAttribute1.y*SHIFT_RIGHT8));temp=compressedAttribute2.z*SHIFT_RIGHT5;bool validAlignedAxis=(temp-floor(temp))*SHIFT_LEFT1>0.0;\n#else\nvec3 alignedAxis=vec3(0.0);bool validAlignedAxis=false;\n#endif\nvec4 pickColor;vec4 color;temp=compressedAttribute2.y;temp=temp*SHIFT_RIGHT8;pickColor.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;pickColor.g=(temp-floor(temp))*SHIFT_LEFT8;pickColor.r=floor(temp);temp=compressedAttribute2.x;temp=temp*SHIFT_RIGHT8;color.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;color.g=(temp-floor(temp))*SHIFT_LEFT8;color.r=floor(temp);temp=compressedAttribute2.z*SHIFT_RIGHT8;bool sizeInMeters=floor((temp-floor(temp))*SHIFT_LEFT7)>0.0;temp=floor(temp)*SHIFT_RIGHT8;pickColor.a=(temp-floor(temp))*SHIFT_LEFT8;pickColor/=255.0;color.a=floor(temp);color/=255.0;vec4 p=czm_translateRelativeToEye(positionHigh,positionLow);vec4 positionEC=czm_modelViewRelativeToEye*p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth=positionEC.z;\n#endif\npositionEC=czm_eyeOffset(positionEC,eyeOffset.xyz);positionEC.xyz*=show;vec4 rawPosition=positionEC;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;if(czm_sceneMode==czm_sceneMode2D){lengthSq=czm_eyeHeight2D.y;}else{lengthSq=dot(positionEC.xyz,positionEC.xyz);}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale=czm_nearFarScalar(scaleByDistance,lengthSq);scale*=distanceScale;translate*=distanceScale;if(scale==0.0){positionEC.xyz=vec3(0.0);}\n#endif\nfloat translucency=1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency=czm_nearFarScalar(translucencyByDistance,lengthSq);if(translucency==0.0){positionEC.xyz=vec3(0.0);}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale=czm_nearFarScalar(pixelOffsetScaleByDistance,lengthSq);pixelOffset*=pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq=compressedAttribute3.x;float farSq=compressedAttribute3.y;if(lengthSq<nearSq||lengthSq>farSq){positionEC.xyz=vec3(0.0);}\n#endif\nmat2 rotationMatrix;float mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance=compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif(lengthSq<disableDepthTestDistance){float depthsilon=10.0;vec2 labelTranslate=textureCoordinateBoundsOrLabelTranslate.xy;vec4 pEC1=addScreenSpaceOffset(positionEC,dimensions,scale,vec2(0.0),origin,labelTranslate,pixelOffset,alignedAxis,validAlignedAxis,rotation,sizeInMeters,rotationMatrix,mpp);float globeDepth1=getGlobeDepth(pEC1);if(globeDepth1!=0.0&&pEC1.z+depthsilon<globeDepth1){vec4 pEC2=addScreenSpaceOffset(positionEC,dimensions,scale,vec2(0.0,1.0),origin,labelTranslate,pixelOffset,alignedAxis,validAlignedAxis,rotation,sizeInMeters,rotationMatrix,mpp);float globeDepth2=getGlobeDepth(pEC2);if(globeDepth2!=0.0&&pEC2.z+depthsilon<globeDepth2){vec4 pEC3=addScreenSpaceOffset(positionEC,dimensions,scale,vec2(1.0),origin,labelTranslate,pixelOffset,alignedAxis,validAlignedAxis,rotation,sizeInMeters,rotationMatrix,mpp);float globeDepth3=getGlobeDepth(pEC3);if(globeDepth3!=0.0&&pEC3.z+depthsilon<globeDepth3){positionEC.xyz=vec3(0.0);}}}}\n#endif\npositionEC=addScreenSpaceOffset(positionEC,imageSize,scale,direction,origin,translate,pixelOffset,alignedAxis,validAlignedAxis,rotation,sizeInMeters,rotationMatrix,mpp);\n#ifdef SDF\nif(roadDirection.w>0.0){vec4 projectedPosition=czm_projection*rawPosition;vec4 worldPosition=czm_inverseView*rawPosition;vec4 endPosition=vec4(worldPosition.xyz+roadDirection.xyz,1.0);vec4 projectedEndPosition=czm_viewProjection*endPosition;vec4 ndcPos=projectedPosition/projectedPosition.w;vec4 ndcEndPos=projectedEndPosition/projectedEndPosition.w;vec2 screenPos=(czm_viewportTransformation*ndcPos).xy;vec2 screenEndPos=(czm_viewportTransformation*ndcEndPos).xy;vec2 screenDir=normalize(screenEndPos-screenPos);vec2 originDir=vec2(1.0f,0.0f);float cosThetaValue=dot(originDir,screenDir);float sign=crossProduct(originDir,screenDir);float theta=czm_branchFreeTernary(sign>0.0,1.0,-1.0)*acos(cosThetaValue);if(theta>czm_piOverTwo){theta=theta-czm_pi;}if(theta<-czm_piOverTwo){theta=theta+czm_pi;}float cosTheta=cos(theta);float sinTheta=sin(theta);mat4 T=mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,-rawPosition.x,-rawPosition.y,-rawPosition.z,1.0);mat4 R=mat4(cosTheta,sinTheta,0.0,0.0,-sinTheta,cosTheta,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0);mat4 invT=mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,rawPosition.x,rawPosition.y,rawPosition.z,1.0);positionEC=invT*R*T*positionEC;}\n#endif\ngl_Position=czm_projection*positionEC;v_textureCoordinates=textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif(disableDepthTestDistance==0.0&&czm_minimumDisableDepthTestDistance!=0.0){disableDepthTestDistance=czm_minimumDisableDepthTestDistance;}if(disableDepthTestDistance!=0.0){float zclip=gl_Position.z/gl_Position.w;bool clipped=(zclip<-1.0||zclip>1.0);if(!clipped&&(disableDepthTestDistance<0.0||(lengthSq>0.0&&lengthSq<disableDepthTestDistance))){gl_Position.z=-gl_Position.w;\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne=1.0;\n#endif\n}}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif(sizeInMeters){translate/=mpp;dimensions/=mpp;imageSize/=mpp;}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix=rotationMatrix;\n#else\nv_rotationMatrix=mat2(1.0,0.0,0.0,1.0);\n#endif\nfloat enableDepthCheck=0.0;if(lengthSq<disableDepthTestDistance){enableDepthCheck=1.0;}float dw=floor(clamp(dimensions.x,0.0,SHIFT_LEFT12));float dh=floor(clamp(dimensions.y,0.0,SHIFT_LEFT12));float iw=floor(clamp(imageSize.x,0.0,SHIFT_LEFT12));float ih=floor(clamp(imageSize.y,0.0,SHIFT_LEFT12));v_compressed.x=eyeDepth;v_compressed.y=applyTranslate*SHIFT_LEFT1+enableDepthCheck;v_compressed.z=dw*SHIFT_LEFT12+dh;v_compressed.w=iw*SHIFT_LEFT12+ih;v_originTextureCoordinateAndTranslate.xy=depthOrigin;v_originTextureCoordinateAndTranslate.zw=translate;v_textureCoordinateBounds=textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef SDF\nvec4 outlineColor;float outlineWidth;temp=sdf.x;temp=temp*SHIFT_RIGHT8;outlineColor.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;outlineColor.g=(temp-floor(temp))*SHIFT_LEFT8;outlineColor.r=floor(temp);temp=sdf.y;temp=temp*SHIFT_RIGHT8;float temp3=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;outlineWidth=(temp-floor(temp))*SHIFT_LEFT8;outlineColor.a=floor(temp);outlineColor/=255.0;v_outlineWidth=outlineWidth/255.0;v_outlineColor=outlineColor;v_outlineColor.a*=translucency;\n#endif\nv_pickColor=pickColor;v_color=color;v_color.a*=translucency;v_discard=0.0f;if(lengthSq<disableDepthTestDistance){float sceneDepth=getGlobeDepth(rawPosition);if(positionEC.z+10.f<sceneDepth){v_discard=1.0f;}}}",y="uniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nin vec2 v_textureCoordinates;in vec4 v_pickColor;in vec4 v_color;\n#ifdef SDF\nin vec4 v_outlineColor;in float v_outlineWidth;\n#endif\nin float v_discard;\n#ifdef FRAGMENT_DEPTH_CHECK\nin vec4 v_textureCoordinateBounds;in vec4 v_originTextureCoordinateAndTranslate;in vec4 v_compressed;in mat2 v_rotationMatrix;const float SHIFT_LEFT12=4096.0;const float SHIFT_LEFT1=2.0;const float SHIFT_RIGHT12=1.0/4096.0;const float SHIFT_RIGHT1=1.0/2.0;float getGlobeDepth(vec2 adjustedST,vec2 depthLookupST,bool applyTranslate,vec2 dimensions,vec2 imageSize){vec2 lookupVector=imageSize*(depthLookupST-adjustedST);lookupVector=v_rotationMatrix*lookupVector;vec2 labelOffset=(dimensions-imageSize)*(depthLookupST-vec2(0.0,v_originTextureCoordinateAndTranslate.y));vec2 translation=v_originTextureCoordinateAndTranslate.zw;if(applyTranslate){translation+=(dimensions*v_originTextureCoordinateAndTranslate.xy*vec2(1.0,0.0));}vec2 st=((lookupVector-translation+labelOffset)+gl_FragCoord.xy)/czm_viewport.zw;float logDepthOrDepth=czm_unpackDepth(texture(czm_globeDepthTexture,st));if(logDepthOrDepth==0.0){return 0.0;}vec4 eyeCoordinate=czm_windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);return eyeCoordinate.z/eyeCoordinate.w;}\n#endif\n#ifdef SDF\nfloat getDistance(vec2 position){return texture(u_atlas,position).r;}vec4 getSDFColor(vec2 position,float outlineWidth,vec4 outlineColor,float smoothing){float distance=getDistance(position);if(outlineWidth>0.0){float outlineEdge=clamp(SDF_EDGE-outlineWidth,0.0,SDF_EDGE);float outlineFactor=smoothstep(SDF_EDGE-smoothing,SDF_EDGE+smoothing,distance);vec4 sdfColor=mix(outlineColor,v_color,outlineFactor);float alpha=smoothstep(outlineEdge-smoothing,outlineEdge+smoothing,distance);return vec4(sdfColor.rgb,sdfColor.a*alpha);}else{float alpha=smoothstep(SDF_EDGE-smoothing,SDF_EDGE+smoothing,distance);return vec4(v_color.rgb,v_color.a*alpha);}}\n#endif\nvoid main(){if(v_discard>0.0f){discard;return;}vec4 color=texture(u_atlas,v_textureCoordinates);\n#ifdef SDF\nfloat outlineWidth=v_outlineWidth;vec4 outlineColor=v_outlineColor;float distance=getDistance(v_textureCoordinates);\n#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))\nfloat smoothing=fwidth(distance);vec2 sampleOffset=0.354*vec2(dFdx(v_textureCoordinates)+dFdy(v_textureCoordinates));vec4 center=getSDFColor(v_textureCoordinates,outlineWidth,outlineColor,smoothing);vec4 color1=getSDFColor(v_textureCoordinates+vec2(sampleOffset.x,sampleOffset.y),outlineWidth,outlineColor,smoothing);vec4 color2=getSDFColor(v_textureCoordinates+vec2(-sampleOffset.x,sampleOffset.y),outlineWidth,outlineColor,smoothing);vec4 color3=getSDFColor(v_textureCoordinates+vec2(-sampleOffset.x,-sampleOffset.y),outlineWidth,outlineColor,smoothing);vec4 color4=getSDFColor(v_textureCoordinates+vec2(sampleOffset.x,-sampleOffset.y),outlineWidth,outlineColor,smoothing);color=(center+color1+color2+color3+color4)/5.0;\n#else\nfloat smoothing=1.0/32.0;color=getSDFColor(v_textureCoordinates,outlineWidth,outlineColor,smoothing);\n#endif\ncolor=czm_gammaCorrect(color);\n#else\ncolor=czm_gammaCorrect(color);color*=czm_gammaCorrect(v_color);\n#endif\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif(color.a<0.005){discard;}\n#else\n#ifdef OPAQUE\nif(color.a<0.995){discard;}\n#else\nif(color.a>=0.995){discard;}\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor*=u_highlightColor;\n#endif\nout_FragColor=color;\n#ifdef LOG_DEPTH\nczm_writeLogDepth();\n#endif\n}",B=[],e.defined(this._batchTable)&&(B.push("VECTOR_TILE"),p=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(p),y=this._batchTable.getFragmentShaderCallback(!1,void 0)(y)),w=new e.ShaderSource({defines:B,sources:[p]}),this._instanced&&w.defines.push("INSTANCED"),this._shaderRotation&&w.defines.push("ROTATION"),this._shaderAlignedAxis&&w.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&w.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&w.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&w.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&w.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&w.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(E?w.defines.push("VERTEX_DEPTH_CHECK"):w.defines.push("FRAGMENT_DEPTH_CHECK"));const t=1-e.SDFSettings.CUTOFF;this._sdf&&w.defines.push("SDF");const n=e.defined(this._batchTable)?"VECTOR_TILE":"";this._blendOption===e.BlendOption.OPAQUE_AND_TRANSLUCENT&&(C=new e.ShaderSource({defines:["OPAQUE",n],sources:[y]}),this._shaderClampToGround&&(E?C.defines.push("VERTEX_DEPTH_CHECK"):C.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(C.defines.push("SDF"),C.defines.push(`SDF_EDGE ${t}`)),this._sp=e.ShaderProgram.replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:w,fragmentShaderSource:C,attributeLocations:dg}),C=new e.ShaderSource({defines:["TRANSLUCENT",n],sources:[y]}),this._shaderClampToGround&&(E?C.defines.push("VERTEX_DEPTH_CHECK"):C.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(C.defines.push("SDF"),C.defines.push(`SDF_EDGE ${t}`)),this._spTranslucent=e.ShaderProgram.replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:w,fragmentShaderSource:C,attributeLocations:dg})),this._blendOption===e.BlendOption.OPAQUE&&(C=new e.ShaderSource({defines:[n],sources:[y]}),this._shaderClampToGround&&(E?C.defines.push("VERTEX_DEPTH_CHECK"):C.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(C.defines.push("SDF"),C.defines.push(`SDF_EDGE ${t}`)),this._sp=e.ShaderProgram.replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:w,fragmentShaderSource:C,attributeLocations:dg})),this._blendOption===e.BlendOption.TRANSLUCENT&&(C=new e.ShaderSource({defines:[n],sources:[y]}),this._shaderClampToGround&&(E?C.defines.push("VERTEX_DEPTH_CHECK"):C.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(C.defines.push("SDF"),C.defines.push(`SDF_EDGE ${t}`)),this._spTranslucent=e.ShaderProgram.replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:w,fragmentShaderSource:C,attributeLocations:dg})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}const m=t.commandList;if(f.render||f.pick){const n=this._colorCommands,r=this._blendOption===e.BlendOption.OPAQUE,o=this._blendOption===e.BlendOption.OPAQUE_AND_TRANSLUCENT,s=this._vaf.va,a=s.length;let A,u=this._uniforms;e.defined(this._batchTable)?(u=this._batchTable.getUniformMapCallback()(u),A=this._batchTable.getPickId()):A="v_pickColor",n.length=a;const h=o?2*a:a;for(let t=0;t<h;++t){let a=n[t];e.defined(a)||(a=n[t]=new e.DrawCommand);const h=r||o&&t%2==0;a.pass=h||!o?e.Pass.OPAQUE:e.Pass.TRANSLUCENT,a.owner=this;const l=o?Math.floor(t/2):t;a.boundingVolume=g,a.modelMatrix=v,a.count=s[l].indicesCount,a.shaderProgram=h?this._sp:this._spTranslucent,a.uniformMap=u,a.vertexArray=s[l].va,a.renderState=h?this._rsOpaque:this._rsTranslucent,a.debugShowBoundingVolume=this.debugShowBoundingVolume,a.pickId=A,this._instanced&&(a.count=6,a.instanceCount=i),m.push(a)}this.debugShowTextureAtlas&&(e.defined(this.debugCommand)||(this.debugCommand=function(t,n){const i=n.createViewportQuadCommand("uniform sampler2D billboard_texture; \nin vec2 v_textureCoordinates; \nvoid main() \n{ \n    out_FragColor = texture(billboard_texture, v_textureCoordinates); \n} \n",{uniformMap:{billboard_texture:function(){return t._textureAtlas.texture}}});return i.pass=e.Pass.OVERLAY,i}(this,t.context)),m.push(this.debugCommand))}},Ig.prototype.isDestroyed=function(){return!1},Ig.prototype.destroy=function(){return e.defined(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),pg(this._billboards),e.destroyObject(this)};var Xg,Zg={exports:{}},tv=(Xg||(Xg=1,function(t){t.exports&&(t.exports=function(){var t=3,e=4,n=12,i=13,r=16,o=17;function s(t,e){void 0===e&&(e=0);var n=t.charCodeAt(e);if(55296<=n&&n<=56319&&e<t.length-1){var i=n;return 56320<=(r=t.charCodeAt(e+1))&&r<=57343?1024*(i-55296)+(r-56320)+65536:i}if(56320<=n&&n<=57343&&e>=1){var r=n;return 55296<=(i=t.charCodeAt(e-1))&&i<=56319?1024*(i-55296)+(r-56320)+65536:r}return n}function a(s,a,A){var u=[s].concat(a).concat([A]),h=u[u.length-2],l=A,c=u.lastIndexOf(14);if(c>1&&u.slice(1,c).every((function(e){return e==t}))&&-1==[t,i,o].indexOf(s))return 2;var f=u.lastIndexOf(e);if(f>0&&u.slice(1,f).every((function(t){return t==e}))&&-1==[n,e].indexOf(h))return u.filter((function(t){return t==e})).length%2==1?3:4;if(0==h&&1==l)return 0;if(2==h||0==h||1==h)return 14==l&&a.every((function(e){return e==t}))?2:1;if(2==l||0==l||1==l)return 1;if(6==h&&(6==l||7==l||9==l||10==l))return 0;if(!(9!=h&&7!=h||7!=l&&8!=l))return 0;if((10==h||8==h)&&8==l)return 0;if(l==t||15==l)return 0;if(5==l)return 0;if(h==n)return 0;var d=-1!=u.indexOf(t)?u.lastIndexOf(t)-1:u.length-2;return-1!=[i,o].indexOf(u[d])&&u.slice(d+1,-1).every((function(e){return e==t}))&&14==l||15==h&&-1!=[r,o].indexOf(l)?0:-1!=a.indexOf(e)?2:h==e&&l==e?0:1}function A(s){return 1536<=s&&s<=1541||1757==s||1807==s||2274==s||3406==s||69821==s||70082<=s&&s<=70083||72250==s||72326<=s&&s<=72329||73030==s?n:13==s?0:10==s?1:0<=s&&s<=9||11<=s&&s<=12||14<=s&&s<=31||127<=s&&s<=159||173==s||1564==s||6158==s||8203==s||8206<=s&&s<=8207||8232==s||8233==s||8234<=s&&s<=8238||8288<=s&&s<=8292||8293==s||8294<=s&&s<=8303||55296<=s&&s<=57343||65279==s||65520<=s&&s<=65528||65529<=s&&s<=65531||113824<=s&&s<=113827||119155<=s&&s<=119162||917504==s||917505==s||917506<=s&&s<=917535||917632<=s&&s<=917759||918e3<=s&&s<=921599?2:768<=s&&s<=879||1155<=s&&s<=1159||1160<=s&&s<=1161||1425<=s&&s<=1469||1471==s||1473<=s&&s<=1474||1476<=s&&s<=1477||1479==s||1552<=s&&s<=1562||1611<=s&&s<=1631||1648==s||1750<=s&&s<=1756||1759<=s&&s<=1764||1767<=s&&s<=1768||1770<=s&&s<=1773||1809==s||1840<=s&&s<=1866||1958<=s&&s<=1968||2027<=s&&s<=2035||2070<=s&&s<=2073||2075<=s&&s<=2083||2085<=s&&s<=2087||2089<=s&&s<=2093||2137<=s&&s<=2139||2260<=s&&s<=2273||2275<=s&&s<=2306||2362==s||2364==s||2369<=s&&s<=2376||2381==s||2385<=s&&s<=2391||2402<=s&&s<=2403||2433==s||2492==s||2494==s||2497<=s&&s<=2500||2509==s||2519==s||2530<=s&&s<=2531||2561<=s&&s<=2562||2620==s||2625<=s&&s<=2626||2631<=s&&s<=2632||2635<=s&&s<=2637||2641==s||2672<=s&&s<=2673||2677==s||2689<=s&&s<=2690||2748==s||2753<=s&&s<=2757||2759<=s&&s<=2760||2765==s||2786<=s&&s<=2787||2810<=s&&s<=2815||2817==s||2876==s||2878==s||2879==s||2881<=s&&s<=2884||2893==s||2902==s||2903==s||2914<=s&&s<=2915||2946==s||3006==s||3008==s||3021==s||3031==s||3072==s||3134<=s&&s<=3136||3142<=s&&s<=3144||3146<=s&&s<=3149||3157<=s&&s<=3158||3170<=s&&s<=3171||3201==s||3260==s||3263==s||3266==s||3270==s||3276<=s&&s<=3277||3285<=s&&s<=3286||3298<=s&&s<=3299||3328<=s&&s<=3329||3387<=s&&s<=3388||3390==s||3393<=s&&s<=3396||3405==s||3415==s||3426<=s&&s<=3427||3530==s||3535==s||3538<=s&&s<=3540||3542==s||3551==s||3633==s||3636<=s&&s<=3642||3655<=s&&s<=3662||3761==s||3764<=s&&s<=3769||3771<=s&&s<=3772||3784<=s&&s<=3789||3864<=s&&s<=3865||3893==s||3895==s||3897==s||3953<=s&&s<=3966||3968<=s&&s<=3972||3974<=s&&s<=3975||3981<=s&&s<=3991||3993<=s&&s<=4028||4038==s||4141<=s&&s<=4144||4146<=s&&s<=4151||4153<=s&&s<=4154||4157<=s&&s<=4158||4184<=s&&s<=4185||4190<=s&&s<=4192||4209<=s&&s<=4212||4226==s||4229<=s&&s<=4230||4237==s||4253==s||4957<=s&&s<=4959||5906<=s&&s<=5908||5938<=s&&s<=5940||5970<=s&&s<=5971||6002<=s&&s<=6003||6068<=s&&s<=6069||6071<=s&&s<=6077||6086==s||6089<=s&&s<=6099||6109==s||6155<=s&&s<=6157||6277<=s&&s<=6278||6313==s||6432<=s&&s<=6434||6439<=s&&s<=6440||6450==s||6457<=s&&s<=6459||6679<=s&&s<=6680||6683==s||6742==s||6744<=s&&s<=6750||6752==s||6754==s||6757<=s&&s<=6764||6771<=s&&s<=6780||6783==s||6832<=s&&s<=6845||6846==s||6912<=s&&s<=6915||6964==s||6966<=s&&s<=6970||6972==s||6978==s||7019<=s&&s<=7027||7040<=s&&s<=7041||7074<=s&&s<=7077||7080<=s&&s<=7081||7083<=s&&s<=7085||7142==s||7144<=s&&s<=7145||7149==s||7151<=s&&s<=7153||7212<=s&&s<=7219||7222<=s&&s<=7223||7376<=s&&s<=7378||7380<=s&&s<=7392||7394<=s&&s<=7400||7405==s||7412==s||7416<=s&&s<=7417||7616<=s&&s<=7673||7675<=s&&s<=7679||8204==s||8400<=s&&s<=8412||8413<=s&&s<=8416||8417==s||8418<=s&&s<=8420||8421<=s&&s<=8432||11503<=s&&s<=11505||11647==s||11744<=s&&s<=11775||12330<=s&&s<=12333||12334<=s&&s<=12335||12441<=s&&s<=12442||42607==s||42608<=s&&s<=42610||42612<=s&&s<=42621||42654<=s&&s<=42655||42736<=s&&s<=42737||43010==s||43014==s||43019==s||43045<=s&&s<=43046||43204<=s&&s<=43205||43232<=s&&s<=43249||43302<=s&&s<=43309||43335<=s&&s<=43345||43392<=s&&s<=43394||43443==s||43446<=s&&s<=43449||43452==s||43493==s||43561<=s&&s<=43566||43569<=s&&s<=43570||43573<=s&&s<=43574||43587==s||43596==s||43644==s||43696==s||43698<=s&&s<=43700||43703<=s&&s<=43704||43710<=s&&s<=43711||43713==s||43756<=s&&s<=43757||43766==s||44005==s||44008==s||44013==s||64286==s||65024<=s&&s<=65039||65056<=s&&s<=65071||65438<=s&&s<=65439||66045==s||66272==s||66422<=s&&s<=66426||68097<=s&&s<=68099||68101<=s&&s<=68102||68108<=s&&s<=68111||68152<=s&&s<=68154||68159==s||68325<=s&&s<=68326||69633==s||69688<=s&&s<=69702||69759<=s&&s<=69761||69811<=s&&s<=69814||69817<=s&&s<=69818||69888<=s&&s<=69890||69927<=s&&s<=69931||69933<=s&&s<=69940||70003==s||70016<=s&&s<=70017||70070<=s&&s<=70078||70090<=s&&s<=70092||70191<=s&&s<=70193||70196==s||70198<=s&&s<=70199||70206==s||70367==s||70371<=s&&s<=70378||70400<=s&&s<=70401||70460==s||70462==s||70464==s||70487==s||70502<=s&&s<=70508||70512<=s&&s<=70516||70712<=s&&s<=70719||70722<=s&&s<=70724||70726==s||70832==s||70835<=s&&s<=70840||70842==s||70845==s||70847<=s&&s<=70848||70850<=s&&s<=70851||71087==s||71090<=s&&s<=71093||71100<=s&&s<=71101||71103<=s&&s<=71104||71132<=s&&s<=71133||71219<=s&&s<=71226||71229==s||71231<=s&&s<=71232||71339==s||71341==s||71344<=s&&s<=71349||71351==s||71453<=s&&s<=71455||71458<=s&&s<=71461||71463<=s&&s<=71467||72193<=s&&s<=72198||72201<=s&&s<=72202||72243<=s&&s<=72248||72251<=s&&s<=72254||72263==s||72273<=s&&s<=72278||72281<=s&&s<=72283||72330<=s&&s<=72342||72344<=s&&s<=72345||72752<=s&&s<=72758||72760<=s&&s<=72765||72767==s||72850<=s&&s<=72871||72874<=s&&s<=72880||72882<=s&&s<=72883||72885<=s&&s<=72886||73009<=s&&s<=73014||73018==s||73020<=s&&s<=73021||73023<=s&&s<=73029||73031==s||92912<=s&&s<=92916||92976<=s&&s<=92982||94095<=s&&s<=94098||113821<=s&&s<=113822||119141==s||119143<=s&&s<=119145||119150<=s&&s<=119154||119163<=s&&s<=119170||119173<=s&&s<=119179||119210<=s&&s<=119213||119362<=s&&s<=119364||121344<=s&&s<=121398||121403<=s&&s<=121452||121461==s||121476==s||121499<=s&&s<=121503||121505<=s&&s<=121519||122880<=s&&s<=122886||122888<=s&&s<=122904||122907<=s&&s<=122913||122915<=s&&s<=122916||122918<=s&&s<=122922||125136<=s&&s<=125142||125252<=s&&s<=125258||917536<=s&&s<=917631||917760<=s&&s<=917999?t:127462<=s&&s<=127487?e:2307==s||2363==s||2366<=s&&s<=2368||2377<=s&&s<=2380||2382<=s&&s<=2383||2434<=s&&s<=2435||2495<=s&&s<=2496||2503<=s&&s<=2504||2507<=s&&s<=2508||2563==s||2622<=s&&s<=2624||2691==s||2750<=s&&s<=2752||2761==s||2763<=s&&s<=2764||2818<=s&&s<=2819||2880==s||2887<=s&&s<=2888||2891<=s&&s<=2892||3007==s||3009<=s&&s<=3010||3014<=s&&s<=3016||3018<=s&&s<=3020||3073<=s&&s<=3075||3137<=s&&s<=3140||3202<=s&&s<=3203||3262==s||3264<=s&&s<=3265||3267<=s&&s<=3268||3271<=s&&s<=3272||3274<=s&&s<=3275||3330<=s&&s<=3331||3391<=s&&s<=3392||3398<=s&&s<=3400||3402<=s&&s<=3404||3458<=s&&s<=3459||3536<=s&&s<=3537||3544<=s&&s<=3550||3570<=s&&s<=3571||3635==s||3763==s||3902<=s&&s<=3903||3967==s||4145==s||4155<=s&&s<=4156||4182<=s&&s<=4183||4228==s||6070==s||6078<=s&&s<=6085||6087<=s&&s<=6088||6435<=s&&s<=6438||6441<=s&&s<=6443||6448<=s&&s<=6449||6451<=s&&s<=6456||6681<=s&&s<=6682||6741==s||6743==s||6765<=s&&s<=6770||6916==s||6965==s||6971==s||6973<=s&&s<=6977||6979<=s&&s<=6980||7042==s||7073==s||7078<=s&&s<=7079||7082==s||7143==s||7146<=s&&s<=7148||7150==s||7154<=s&&s<=7155||7204<=s&&s<=7211||7220<=s&&s<=7221||7393==s||7410<=s&&s<=7411||7415==s||43043<=s&&s<=43044||43047==s||43136<=s&&s<=43137||43188<=s&&s<=43203||43346<=s&&s<=43347||43395==s||43444<=s&&s<=43445||43450<=s&&s<=43451||43453<=s&&s<=43456||43567<=s&&s<=43568||43571<=s&&s<=43572||43597==s||43755==s||43758<=s&&s<=43759||43765==s||44003<=s&&s<=44004||44006<=s&&s<=44007||44009<=s&&s<=44010||44012==s||69632==s||69634==s||69762==s||69808<=s&&s<=69810||69815<=s&&s<=69816||69932==s||70018==s||70067<=s&&s<=70069||70079<=s&&s<=70080||70188<=s&&s<=70190||70194<=s&&s<=70195||70197==s||70368<=s&&s<=70370||70402<=s&&s<=70403||70463==s||70465<=s&&s<=70468||70471<=s&&s<=70472||70475<=s&&s<=70477||70498<=s&&s<=70499||70709<=s&&s<=70711||70720<=s&&s<=70721||70725==s||70833<=s&&s<=70834||70841==s||70843<=s&&s<=70844||70846==s||70849==s||71088<=s&&s<=71089||71096<=s&&s<=71099||71102==s||71216<=s&&s<=71218||71227<=s&&s<=71228||71230==s||71340==s||71342<=s&&s<=71343||71350==s||71456<=s&&s<=71457||71462==s||72199<=s&&s<=72200||72249==s||72279<=s&&s<=72280||72343==s||72751==s||72766==s||72873==s||72881==s||72884==s||94033<=s&&s<=94078||119142==s||119149==s?5:4352<=s&&s<=4447||43360<=s&&s<=43388?6:4448<=s&&s<=4519||55216<=s&&s<=55238?7:4520<=s&&s<=4607||55243<=s&&s<=55291?8:44032==s||44060==s||44088==s||44116==s||44144==s||44172==s||44200==s||44228==s||44256==s||44284==s||44312==s||44340==s||44368==s||44396==s||44424==s||44452==s||44480==s||44508==s||44536==s||44564==s||44592==s||44620==s||44648==s||44676==s||44704==s||44732==s||44760==s||44788==s||44816==s||44844==s||44872==s||44900==s||44928==s||44956==s||44984==s||45012==s||45040==s||45068==s||45096==s||45124==s||45152==s||45180==s||45208==s||45236==s||45264==s||45292==s||45320==s||45348==s||45376==s||45404==s||45432==s||45460==s||45488==s||45516==s||45544==s||45572==s||45600==s||45628==s||45656==s||45684==s||45712==s||45740==s||45768==s||45796==s||45824==s||45852==s||45880==s||45908==s||45936==s||45964==s||45992==s||46020==s||46048==s||46076==s||46104==s||46132==s||46160==s||46188==s||46216==s||46244==s||46272==s||46300==s||46328==s||46356==s||46384==s||46412==s||46440==s||46468==s||46496==s||46524==s||46552==s||46580==s||46608==s||46636==s||46664==s||46692==s||46720==s||46748==s||46776==s||46804==s||46832==s||46860==s||46888==s||46916==s||46944==s||46972==s||47e3==s||47028==s||47056==s||47084==s||47112==s||47140==s||47168==s||47196==s||47224==s||47252==s||47280==s||47308==s||47336==s||47364==s||47392==s||47420==s||47448==s||47476==s||47504==s||47532==s||47560==s||47588==s||47616==s||47644==s||47672==s||47700==s||47728==s||47756==s||47784==s||47812==s||47840==s||47868==s||47896==s||47924==s||47952==s||47980==s||48008==s||48036==s||48064==s||48092==s||48120==s||48148==s||48176==s||48204==s||48232==s||48260==s||48288==s||48316==s||48344==s||48372==s||48400==s||48428==s||48456==s||48484==s||48512==s||48540==s||48568==s||48596==s||48624==s||48652==s||48680==s||48708==s||48736==s||48764==s||48792==s||48820==s||48848==s||48876==s||48904==s||48932==s||48960==s||48988==s||49016==s||49044==s||49072==s||49100==s||49128==s||49156==s||49184==s||49212==s||49240==s||49268==s||49296==s||49324==s||49352==s||49380==s||49408==s||49436==s||49464==s||49492==s||49520==s||49548==s||49576==s||49604==s||49632==s||49660==s||49688==s||49716==s||49744==s||49772==s||49800==s||49828==s||49856==s||49884==s||49912==s||49940==s||49968==s||49996==s||50024==s||50052==s||50080==s||50108==s||50136==s||50164==s||50192==s||50220==s||50248==s||50276==s||50304==s||50332==s||50360==s||50388==s||50416==s||50444==s||50472==s||50500==s||50528==s||50556==s||50584==s||50612==s||50640==s||50668==s||50696==s||50724==s||50752==s||50780==s||50808==s||50836==s||50864==s||50892==s||50920==s||50948==s||50976==s||51004==s||51032==s||51060==s||51088==s||51116==s||51144==s||51172==s||51200==s||51228==s||51256==s||51284==s||51312==s||51340==s||51368==s||51396==s||51424==s||51452==s||51480==s||51508==s||51536==s||51564==s||51592==s||51620==s||51648==s||51676==s||51704==s||51732==s||51760==s||51788==s||51816==s||51844==s||51872==s||51900==s||51928==s||51956==s||51984==s||52012==s||52040==s||52068==s||52096==s||52124==s||52152==s||52180==s||52208==s||52236==s||52264==s||52292==s||52320==s||52348==s||52376==s||52404==s||52432==s||52460==s||52488==s||52516==s||52544==s||52572==s||52600==s||52628==s||52656==s||52684==s||52712==s||52740==s||52768==s||52796==s||52824==s||52852==s||52880==s||52908==s||52936==s||52964==s||52992==s||53020==s||53048==s||53076==s||53104==s||53132==s||53160==s||53188==s||53216==s||53244==s||53272==s||53300==s||53328==s||53356==s||53384==s||53412==s||53440==s||53468==s||53496==s||53524==s||53552==s||53580==s||53608==s||53636==s||53664==s||53692==s||53720==s||53748==s||53776==s||53804==s||53832==s||53860==s||53888==s||53916==s||53944==s||53972==s||54e3==s||54028==s||54056==s||54084==s||54112==s||54140==s||54168==s||54196==s||54224==s||54252==s||54280==s||54308==s||54336==s||54364==s||54392==s||54420==s||54448==s||54476==s||54504==s||54532==s||54560==s||54588==s||54616==s||54644==s||54672==s||54700==s||54728==s||54756==s||54784==s||54812==s||54840==s||54868==s||54896==s||54924==s||54952==s||54980==s||55008==s||55036==s||55064==s||55092==s||55120==s||55148==s||55176==s?9:44033<=s&&s<=44059||44061<=s&&s<=44087||44089<=s&&s<=44115||44117<=s&&s<=44143||44145<=s&&s<=44171||44173<=s&&s<=44199||44201<=s&&s<=44227||44229<=s&&s<=44255||44257<=s&&s<=44283||44285<=s&&s<=44311||44313<=s&&s<=44339||44341<=s&&s<=44367||44369<=s&&s<=44395||44397<=s&&s<=44423||44425<=s&&s<=44451||44453<=s&&s<=44479||44481<=s&&s<=44507||44509<=s&&s<=44535||44537<=s&&s<=44563||44565<=s&&s<=44591||44593<=s&&s<=44619||44621<=s&&s<=44647||44649<=s&&s<=44675||44677<=s&&s<=44703||44705<=s&&s<=44731||44733<=s&&s<=44759||44761<=s&&s<=44787||44789<=s&&s<=44815||44817<=s&&s<=44843||44845<=s&&s<=44871||44873<=s&&s<=44899||44901<=s&&s<=44927||44929<=s&&s<=44955||44957<=s&&s<=44983||44985<=s&&s<=45011||45013<=s&&s<=45039||45041<=s&&s<=45067||45069<=s&&s<=45095||45097<=s&&s<=45123||45125<=s&&s<=45151||45153<=s&&s<=45179||45181<=s&&s<=45207||45209<=s&&s<=45235||45237<=s&&s<=45263||45265<=s&&s<=45291||45293<=s&&s<=45319||45321<=s&&s<=45347||45349<=s&&s<=45375||45377<=s&&s<=45403||45405<=s&&s<=45431||45433<=s&&s<=45459||45461<=s&&s<=45487||45489<=s&&s<=45515||45517<=s&&s<=45543||45545<=s&&s<=45571||45573<=s&&s<=45599||45601<=s&&s<=45627||45629<=s&&s<=45655||45657<=s&&s<=45683||45685<=s&&s<=45711||45713<=s&&s<=45739||45741<=s&&s<=45767||45769<=s&&s<=45795||45797<=s&&s<=45823||45825<=s&&s<=45851||45853<=s&&s<=45879||45881<=s&&s<=45907||45909<=s&&s<=45935||45937<=s&&s<=45963||45965<=s&&s<=45991||45993<=s&&s<=46019||46021<=s&&s<=46047||46049<=s&&s<=46075||46077<=s&&s<=46103||46105<=s&&s<=46131||46133<=s&&s<=46159||46161<=s&&s<=46187||46189<=s&&s<=46215||46217<=s&&s<=46243||46245<=s&&s<=46271||46273<=s&&s<=46299||46301<=s&&s<=46327||46329<=s&&s<=46355||46357<=s&&s<=46383||46385<=s&&s<=46411||46413<=s&&s<=46439||46441<=s&&s<=46467||46469<=s&&s<=46495||46497<=s&&s<=46523||46525<=s&&s<=46551||46553<=s&&s<=46579||46581<=s&&s<=46607||46609<=s&&s<=46635||46637<=s&&s<=46663||46665<=s&&s<=46691||46693<=s&&s<=46719||46721<=s&&s<=46747||46749<=s&&s<=46775||46777<=s&&s<=46803||46805<=s&&s<=46831||46833<=s&&s<=46859||46861<=s&&s<=46887||46889<=s&&s<=46915||46917<=s&&s<=46943||46945<=s&&s<=46971||46973<=s&&s<=46999||47001<=s&&s<=47027||47029<=s&&s<=47055||47057<=s&&s<=47083||47085<=s&&s<=47111||47113<=s&&s<=47139||47141<=s&&s<=47167||47169<=s&&s<=47195||47197<=s&&s<=47223||47225<=s&&s<=47251||47253<=s&&s<=47279||47281<=s&&s<=47307||47309<=s&&s<=47335||47337<=s&&s<=47363||47365<=s&&s<=47391||47393<=s&&s<=47419||47421<=s&&s<=47447||47449<=s&&s<=47475||47477<=s&&s<=47503||47505<=s&&s<=47531||47533<=s&&s<=47559||47561<=s&&s<=47587||47589<=s&&s<=47615||47617<=s&&s<=47643||47645<=s&&s<=47671||47673<=s&&s<=47699||47701<=s&&s<=47727||47729<=s&&s<=47755||47757<=s&&s<=47783||47785<=s&&s<=47811||47813<=s&&s<=47839||47841<=s&&s<=47867||47869<=s&&s<=47895||47897<=s&&s<=47923||47925<=s&&s<=47951||47953<=s&&s<=47979||47981<=s&&s<=48007||48009<=s&&s<=48035||48037<=s&&s<=48063||48065<=s&&s<=48091||48093<=s&&s<=48119||48121<=s&&s<=48147||48149<=s&&s<=48175||48177<=s&&s<=48203||48205<=s&&s<=48231||48233<=s&&s<=48259||48261<=s&&s<=48287||48289<=s&&s<=48315||48317<=s&&s<=48343||48345<=s&&s<=48371||48373<=s&&s<=48399||48401<=s&&s<=48427||48429<=s&&s<=48455||48457<=s&&s<=48483||48485<=s&&s<=48511||48513<=s&&s<=48539||48541<=s&&s<=48567||48569<=s&&s<=48595||48597<=s&&s<=48623||48625<=s&&s<=48651||48653<=s&&s<=48679||48681<=s&&s<=48707||48709<=s&&s<=48735||48737<=s&&s<=48763||48765<=s&&s<=48791||48793<=s&&s<=48819||48821<=s&&s<=48847||48849<=s&&s<=48875||48877<=s&&s<=48903||48905<=s&&s<=48931||48933<=s&&s<=48959||48961<=s&&s<=48987||48989<=s&&s<=49015||49017<=s&&s<=49043||49045<=s&&s<=49071||49073<=s&&s<=49099||49101<=s&&s<=49127||49129<=s&&s<=49155||49157<=s&&s<=49183||49185<=s&&s<=49211||49213<=s&&s<=49239||49241<=s&&s<=49267||49269<=s&&s<=49295||49297<=s&&s<=49323||49325<=s&&s<=49351||49353<=s&&s<=49379||49381<=s&&s<=49407||49409<=s&&s<=49435||49437<=s&&s<=49463||49465<=s&&s<=49491||49493<=s&&s<=49519||49521<=s&&s<=49547||49549<=s&&s<=49575||49577<=s&&s<=49603||49605<=s&&s<=49631||49633<=s&&s<=49659||49661<=s&&s<=49687||49689<=s&&s<=49715||49717<=s&&s<=49743||49745<=s&&s<=49771||49773<=s&&s<=49799||49801<=s&&s<=49827||49829<=s&&s<=49855||49857<=s&&s<=49883||49885<=s&&s<=49911||49913<=s&&s<=49939||49941<=s&&s<=49967||49969<=s&&s<=49995||49997<=s&&s<=50023||50025<=s&&s<=50051||50053<=s&&s<=50079||50081<=s&&s<=50107||50109<=s&&s<=50135||50137<=s&&s<=50163||50165<=s&&s<=50191||50193<=s&&s<=50219||50221<=s&&s<=50247||50249<=s&&s<=50275||50277<=s&&s<=50303||50305<=s&&s<=50331||50333<=s&&s<=50359||50361<=s&&s<=50387||50389<=s&&s<=50415||50417<=s&&s<=50443||50445<=s&&s<=50471||50473<=s&&s<=50499||50501<=s&&s<=50527||50529<=s&&s<=50555||50557<=s&&s<=50583||50585<=s&&s<=50611||50613<=s&&s<=50639||50641<=s&&s<=50667||50669<=s&&s<=50695||50697<=s&&s<=50723||50725<=s&&s<=50751||50753<=s&&s<=50779||50781<=s&&s<=50807||50809<=s&&s<=50835||50837<=s&&s<=50863||50865<=s&&s<=50891||50893<=s&&s<=50919||50921<=s&&s<=50947||50949<=s&&s<=50975||50977<=s&&s<=51003||51005<=s&&s<=51031||51033<=s&&s<=51059||51061<=s&&s<=51087||51089<=s&&s<=51115||51117<=s&&s<=51143||51145<=s&&s<=51171||51173<=s&&s<=51199||51201<=s&&s<=51227||51229<=s&&s<=51255||51257<=s&&s<=51283||51285<=s&&s<=51311||51313<=s&&s<=51339||51341<=s&&s<=51367||51369<=s&&s<=51395||51397<=s&&s<=51423||51425<=s&&s<=51451||51453<=s&&s<=51479||51481<=s&&s<=51507||51509<=s&&s<=51535||51537<=s&&s<=51563||51565<=s&&s<=51591||51593<=s&&s<=51619||51621<=s&&s<=51647||51649<=s&&s<=51675||51677<=s&&s<=51703||51705<=s&&s<=51731||51733<=s&&s<=51759||51761<=s&&s<=51787||51789<=s&&s<=51815||51817<=s&&s<=51843||51845<=s&&s<=51871||51873<=s&&s<=51899||51901<=s&&s<=51927||51929<=s&&s<=51955||51957<=s&&s<=51983||51985<=s&&s<=52011||52013<=s&&s<=52039||52041<=s&&s<=52067||52069<=s&&s<=52095||52097<=s&&s<=52123||52125<=s&&s<=52151||52153<=s&&s<=52179||52181<=s&&s<=52207||52209<=s&&s<=52235||52237<=s&&s<=52263||52265<=s&&s<=52291||52293<=s&&s<=52319||52321<=s&&s<=52347||52349<=s&&s<=52375||52377<=s&&s<=52403||52405<=s&&s<=52431||52433<=s&&s<=52459||52461<=s&&s<=52487||52489<=s&&s<=52515||52517<=s&&s<=52543||52545<=s&&s<=52571||52573<=s&&s<=52599||52601<=s&&s<=52627||52629<=s&&s<=52655||52657<=s&&s<=52683||52685<=s&&s<=52711||52713<=s&&s<=52739||52741<=s&&s<=52767||52769<=s&&s<=52795||52797<=s&&s<=52823||52825<=s&&s<=52851||52853<=s&&s<=52879||52881<=s&&s<=52907||52909<=s&&s<=52935||52937<=s&&s<=52963||52965<=s&&s<=52991||52993<=s&&s<=53019||53021<=s&&s<=53047||53049<=s&&s<=53075||53077<=s&&s<=53103||53105<=s&&s<=53131||53133<=s&&s<=53159||53161<=s&&s<=53187||53189<=s&&s<=53215||53217<=s&&s<=53243||53245<=s&&s<=53271||53273<=s&&s<=53299||53301<=s&&s<=53327||53329<=s&&s<=53355||53357<=s&&s<=53383||53385<=s&&s<=53411||53413<=s&&s<=53439||53441<=s&&s<=53467||53469<=s&&s<=53495||53497<=s&&s<=53523||53525<=s&&s<=53551||53553<=s&&s<=53579||53581<=s&&s<=53607||53609<=s&&s<=53635||53637<=s&&s<=53663||53665<=s&&s<=53691||53693<=s&&s<=53719||53721<=s&&s<=53747||53749<=s&&s<=53775||53777<=s&&s<=53803||53805<=s&&s<=53831||53833<=s&&s<=53859||53861<=s&&s<=53887||53889<=s&&s<=53915||53917<=s&&s<=53943||53945<=s&&s<=53971||53973<=s&&s<=53999||54001<=s&&s<=54027||54029<=s&&s<=54055||54057<=s&&s<=54083||54085<=s&&s<=54111||54113<=s&&s<=54139||54141<=s&&s<=54167||54169<=s&&s<=54195||54197<=s&&s<=54223||54225<=s&&s<=54251||54253<=s&&s<=54279||54281<=s&&s<=54307||54309<=s&&s<=54335||54337<=s&&s<=54363||54365<=s&&s<=54391||54393<=s&&s<=54419||54421<=s&&s<=54447||54449<=s&&s<=54475||54477<=s&&s<=54503||54505<=s&&s<=54531||54533<=s&&s<=54559||54561<=s&&s<=54587||54589<=s&&s<=54615||54617<=s&&s<=54643||54645<=s&&s<=54671||54673<=s&&s<=54699||54701<=s&&s<=54727||54729<=s&&s<=54755||54757<=s&&s<=54783||54785<=s&&s<=54811||54813<=s&&s<=54839||54841<=s&&s<=54867||54869<=s&&s<=54895||54897<=s&&s<=54923||54925<=s&&s<=54951||54953<=s&&s<=54979||54981<=s&&s<=55007||55009<=s&&s<=55035||55037<=s&&s<=55063||55065<=s&&s<=55091||55093<=s&&s<=55119||55121<=s&&s<=55147||55149<=s&&s<=55175||55177<=s&&s<=55203?10:9757==s||9977==s||9994<=s&&s<=9997||127877==s||127938<=s&&s<=127940||127943==s||127946<=s&&s<=127948||128066<=s&&s<=128067||128070<=s&&s<=128080||128110==s||128112<=s&&s<=128120||128124==s||128129<=s&&s<=128131||128133<=s&&s<=128135||128170==s||128372<=s&&s<=128373||128378==s||128400==s||128405<=s&&s<=128406||128581<=s&&s<=128583||128587<=s&&s<=128591||128675==s||128692<=s&&s<=128694||128704==s||128716==s||129304<=s&&s<=129308||129310<=s&&s<=129311||129318==s||129328<=s&&s<=129337||129341<=s&&s<=129342||129489<=s&&s<=129501?i:127995<=s&&s<=127999?14:8205==s?15:9792==s||9794==s||9877<=s&&s<=9878||9992==s||10084==s||127752==s||127806==s||127859==s||127891==s||127908==s||127912==s||127979==s||127981==s||128139==s||128187<=s&&s<=128188||128295==s||128300==s||128488==s||128640==s||128658==s?r:128102<=s&&s<=128105?o:11}return this.nextBreak=function(t,e){if(void 0===e&&(e=0),e<0)return 0;if(e>=t.length-1)return t.length;for(var n,i,r=A(s(t,e)),o=[],u=e+1;u<t.length;u++)if(i=u-1,!(55296<=(n=t).charCodeAt(i)&&n.charCodeAt(i)<=56319&&56320<=n.charCodeAt(i+1)&&n.charCodeAt(i+1)<=57343)){var h=A(s(t,u));if(a(r,o,h))return u;o.push(h)}return t.length},this.splitGraphemes=function(t){for(var e,n=[],i=0;(e=this.nextBreak(t,i))<t.length;)n.push(t.slice(i,e)),i=e;return i<t.length&&n.push(t.slice(i)),n},this.iterateGraphemes=function(t){var e=0,n={next:function(){var n,i;return(i=this.nextBreak(t,e))<t.length?(n=t.slice(e,i),e=i,{value:n,done:!1}):e<t.length?(n=t.slice(e),e=t.length,{value:n,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return n}),n},this.countGraphemes=function(t){for(var e,n=0,i=0;(e=this.nextBreak(t,i))<t.length;)i=e,n++;return i<t.length&&n++,n},this})}(Zg)),Zg.exports),ev=Fh(tv);function nv(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function iv(t,e,n){this.labelCollection=t,this.index=e,this.dimensions=n}const rv="ID_WHITE_PIXEL",ov=new e.Cartesian2(4,4),sv=new e.BoundingRectangle(1,1,1,1),av={};function Av(t,n,i,r,o,s,a){return av.font=n,av.fillColor=i,av.strokeColor=r,av.strokeWidth=o,av.padding=e.SDFSettings.PADDING,a===e.VerticalOrigin.CENTER?av.textBaseline="middle":a===e.VerticalOrigin.TOP?av.textBaseline="top":av.textBaseline="bottom",av.fill=s===e.LabelStyle.FILL||s===e.LabelStyle.FILL_AND_OUTLINE,av.stroke=s===e.LabelStyle.OUTLINE||s===e.LabelStyle.FILL_AND_OUTLINE,av.backgroundColor=e.Color.BLACK,e.writeTextToCanvas(t,av)}function uv(t,n){n.textureInfo=void 0,n.dimensions=void 0;const i=n.billboard;e.defined(i)&&(i.show=!1,i.image=void 0,e.defined(i._removeCallbackFunc)&&(i._removeCallbackFunc(),i._removeCallbackFunc=void 0),t._reuseBillboards&&t._spareBillboards.push(i),n.billboard=void 0)}function hv(t,e,n,i){i.index=t.addImageSync(e,n)}const lv=new ev;function cv(t,n){const i=n._renderedText,r=lv.splitGraphemes(i),o=r.length,s=n._glyphs,a=s.length;let A,u,h;if(n._relativeSize=n._fontSize/e.SDFSettings.FONT_SIZE,o<a)for(u=o;u<a;++u)uv(t,s[u]);s.length=o;const l=n.show&&n._showBackground&&i.split("\n").join("").length>0;let c=n._backgroundBillboard;const f=t._backgroundBillboardCollection;l?(e.defined(c)||(c=f.add({collection:t,image:rv,imageSubRegion:sv}),n._backgroundBillboard=c),c.color=n._backgroundColor,c.show=n._show,c.position=n._position,c.eyeOffset=n._eyeOffset,c.pixelOffset=n._pixelOffset,c.horizontalOrigin=e.HorizontalOrigin.LEFT,c.verticalOrigin=n._verticalOrigin,c.heightReference=n._heightReference,c.scale=n.totalScale,c.pickPrimitive=n,c.id=n._id,c.translucencyByDistance=n._translucencyByDistance,c.pixelOffsetScaleByDistance=n._pixelOffsetScaleByDistance,c.scaleByDistance=n._scaleByDistance,c.distanceDisplayCondition=n._distanceDisplayCondition,c.disableDepthTestDistance=n._disableDepthTestDistance,c.clusterShow=n.clusterShow):e.defined(c)&&(f.remove(c),n._backgroundBillboard=c=void 0);const d=t._glyphTextureCache;for(h=0;h<o;++h){const i=r[h],o=n._verticalOrigin,a=JSON.stringify([i,n._fontFamily,n._fontStyle,n._fontWeight,+o]);let u=d[a];if(!e.defined(u)){const r=Av(i,`${n._fontStyle} ${n._fontWeight} ${e.SDFSettings.FONT_SIZE}px ${n._fontFamily}`,e.Color.WHITE,e.Color.WHITE,0,e.LabelStyle.FILL,o);if(u=new iv(t,-1,r.dimensions),d[a]=u,r.width>0&&r.height>0){const n=Vd(r,{cutoff:e.SDFSettings.CUTOFF,radius:e.SDFSettings.RADIUS}),o=r.getContext("2d"),s=r.width,A=r.height,h=o.getImageData(0,0,s,A);for(let t=0;t<s;t++)for(let e=0;e<A;e++){const i=e*s+t,r=255*n[i],o=4*i;h.data[o+0]=r,h.data[o+1]=r,h.data[o+2]=r,h.data[o+3]=r}o.putImageData(h,0,0)," "!==i&&hv(t._textureAtlas,a,r,u)}}if(A=s[h],e.defined(A)?-1===u.index?uv(t,A):e.defined(A.textureInfo)&&(A.textureInfo=void 0):(A=new nv,s[h]=A),A.textureInfo=u,A.dimensions=u.dimensions,-1!==u.index){let i=A.billboard;const r=t._spareBillboards;e.defined(i)||(r.length>0?i=r.pop():(i=t._billboardCollection.add({collection:t}),i._labelDimensions=new e.Cartesian2,i._labelTranslate=new e.Cartesian2),A.billboard=i),i.show=n._show,i.position=n._position,i.eyeOffset=n._eyeOffset,i.pixelOffset=n._pixelOffset,i.horizontalOrigin=e.HorizontalOrigin.LEFT,i.verticalOrigin=n._verticalOrigin,i.heightReference=n._heightReference,i.scale=n.totalScale,i.pickPrimitive=n,i.id=n._id,i.image=a,i.translucencyByDistance=n._translucencyByDistance,i.pixelOffsetScaleByDistance=n._pixelOffsetScaleByDistance,i.scaleByDistance=n._scaleByDistance,i.distanceDisplayCondition=n._distanceDisplayCondition,i.disableDepthTestDistance=n._disableDepthTestDistance,i._batchIndex=n._batchIndex,i.outlineColor=n.outlineColor,i.roadDirection=n.roadDirection||Cesium.Cartesian4.ZERO.clone(),n.style===e.LabelStyle.FILL_AND_OUTLINE?(i.color=n._fillColor,i.outlineWidth=n.outlineWidth):n.style===e.LabelStyle.FILL?(i.color=n._fillColor,i.outlineWidth=0):n.style===e.LabelStyle.OUTLINE&&(i.color=e.Color.TRANSPARENT,i.outlineWidth=n.outlineWidth)}}n._repositionAllGlyphs=!0}function fv(t,n,i){return n===e.HorizontalOrigin.CENTER?-t/2:n===e.HorizontalOrigin.RIGHT?-(t+i.x):i.x}const dv=new e.Cartesian2,gv=new e.Cartesian2;function vv(t){const n=t._glyphs,i=t._renderedText;let r,o,s=0,a=0;const A=[];let u,h=Number.NEGATIVE_INFINITY,l=0,c=1;const f=n.length,d=t._backgroundBillboard,g=e.Cartesian2.clone(e.defined(d)?t._backgroundPadding:e.Cartesian2.ZERO,gv);for(g.x/=t._relativeSize,g.y/=t._relativeSize,u=0;u<f;++u)"\n"===i.charAt(u)?(A.push(s),++c,s=0):(r=n[u],o=r.dimensions,l=Math.max(l,o.height-o.descent),h=Math.max(h,o.descent),s+=o.width-o.minx,u<f-1&&(s+=n[u+1].dimensions.minx),a=Math.max(a,s));A.push(s);const v=l+h,I=t.totalScale,p=t._horizontalOrigin,y=t._verticalOrigin;let w=0,C=A[w],B=fv(C,p,g);const E=(e.defined(t._lineHeight)?t._lineHeight:1.2*t._fontSize)/t._relativeSize,m=E*(c-1);let Q=a,k=v+m;e.defined(d)&&(Q+=2*g.x,k+=2*g.y,d._labelHorizontalOrigin=p),dv.x=B*I,dv.y=0;let b=!0,_=0;for(u=0;u<f;++u)if("\n"===i.charAt(u))++w,_+=E,C=A[w],B=fv(C,p,g),dv.x=B*I,b=!0;else if(r=n[u],o=r.dimensions,y===e.VerticalOrigin.TOP?(dv.y=o.height-l-g.y,dv.y+=e.SDFSettings.PADDING):y===e.VerticalOrigin.CENTER?dv.y=(m+o.height-l)/2:y===e.VerticalOrigin.BASELINE?(dv.y=m,dv.y-=e.SDFSettings.PADDING):(dv.y=m+h+g.y,dv.y-=e.SDFSettings.PADDING),dv.y=(dv.y-o.descent-_)*I,b&&(dv.x-=e.SDFSettings.PADDING*I,b=!1),e.defined(r.billboard)&&(r.billboard._setTranslate(dv),r.billboard._labelDimensions.x=Q,r.billboard._labelDimensions.y=k,r.billboard._labelHorizontalOrigin=p),u<f-1){const t=n[u+1];dv.x+=(o.width-o.minx+t.dimensions.minx)*I}if(e.defined(d)&&i.split("\n").join("").length>0&&(B=p===e.HorizontalOrigin.CENTER?-a/2-g.x:p===e.HorizontalOrigin.RIGHT?-(a+2*g.x):0,dv.x=B*I,y===e.VerticalOrigin.TOP?dv.y=v-l-h:y===e.VerticalOrigin.CENTER?dv.y=(v-l)/2-h:y===e.VerticalOrigin.BASELINE?dv.y=-g.y-h:dv.y=0,dv.y=dv.y*I,d.width=Q,d.height=k,d._setTranslate(dv),d._labelTranslate=e.Cartesian2.clone(dv,d._labelTranslate)),(x=t.heightReference)===e.HeightReference.CLAMP_TO_GROUND||x===e.HeightReference.CLAMP_TO_3D_TILE||x===e.HeightReference.CLAMP_TO_TERRAIN)for(u=0;u<f;++u){r=n[u];const t=r.billboard;e.defined(t)&&(t._labelTranslate=e.Cartesian2.clone(dv,t._labelTranslate))}var x}function Iv(t,n){const i=n._glyphs;for(let e=0,n=i.length;e<n;++e)uv(t,i[e]);e.defined(n._backgroundBillboard)&&(t._backgroundBillboardCollection.remove(n._backgroundBillboard),n._backgroundBillboard=void 0),n._labelCollection=void 0,e.defined(n._removeCallbackFunc)&&n._removeCallbackFunc(),e.destroyObject(n)}function pv(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.preloadSDF=!!t.preloadSDF,this.preloadSDFTextureUrl=e.defaultValue(t.preloadSDFTextureUrl,""),this.preloadSDFConfigUrl=e.defaultValue(t.preloadSDFConfigUrl,""),this._reuseBillboards=e.defaultValue(t.reuseBillboards,!0),this._scene=t.scene,this._batchTable=t.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._backgroundBillboardCollection=new Ig({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._billboardCollection=new Ig({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=e.Color.clone(e.Color.WHITE),this.show=e.defaultValue(t.show,!0),this.modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY)),this.debugShowBoundingVolume=e.defaultValue(t.debugShowBoundingVolume,!1),this.blendOption=e.defaultValue(t.blendOption,e.BlendOption.OPAQUE_AND_TRANSLUCENT),this.preloadSDF?this.preload():this.preloaded=!0}Object.defineProperties(pv.prototype,{length:{get:function(){return this._labels.length}}}),pv.prototype.add=function(t){const n=new e.Label(t,this);return this._labels.push(n),this._labelsToUpdate.push(n),n},pv.prototype.remove=function(t){if(e.defined(t)&&t._labelCollection===this){const e=this._labels.indexOf(t);if(-1!==e)return this._labels.splice(e,1),Iv(this,t),!0}return!1},pv.prototype.removeAll=function(){const t=this._labels;for(let e=0,n=t.length;e<n;++e)Iv(this,t[e]);t.length=0},pv.prototype.contains=function(t){return e.defined(t)&&t._labelCollection===this},pv.prototype.get=function(t){if(!e.defined(t))throw new e.DeveloperError("index is required.");return this._labels[t]},pv.prototype.update=function(t){if(!this.show)return;const n=this._billboardCollection,i=this._backgroundBillboardCollection;n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume,i.modelMatrix=this.modelMatrix,i.debugShowBoundingVolume=this.debugShowBoundingVolume;const r=t.context;e.defined(this._textureAtlas)||(this._textureAtlas=new e.TextureAtlas({context:r}),n.textureAtlas=this._textureAtlas),e.defined(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new e.TextureAtlas({context:r,initialSize:ov}),i.textureAtlas=this._backgroundTextureAtlas,function(t){const e=document.createElement("canvas");e.width=ov.x,e.height=ov.y;const n=e.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,e.width,e.height),t.addImage(rv,e)}(this._backgroundTextureAtlas));const o=this._labelsToUpdate.length;for(let t=0;t<o;++t){const e=this._labelsToUpdate[t];if(e.isDestroyed())continue;const n=e._glyphs.length;e._rebindAllGlyphs&&(cv(this,e),e._rebindAllGlyphs=!1),e._repositionAllGlyphs&&(vv(e),e._repositionAllGlyphs=!1);const i=e._glyphs.length-n;this._totalGlyphCount+=i}const s=i.length>0?e.BlendOption.TRANSLUCENT:this.blendOption;n.blendOption=s,i.blendOption=s,n._highlightColor=this._highlightColor,i._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,i.update(t),n.update(t)},pv.prototype.isDestroyed=function(){return!1},pv.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),e.destroyObject(this)};const yv=new RegExp(/[\u0000-\u0008\u000E-\u001F\u00ad\u202a-\u206f\u200b-\u200f]/,"g"),wv={};function Cv(t,e,n=0,i=t.length-1,r=Ev){for(;i>n;){if(i-n>600){const o=i-n+1,s=e-n+1,a=Math.log(o),A=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*A*(o-A)/o)*(s-o/2<0?-1:1);Cv(t,e,Math.max(n,Math.floor(e-s*A/o+u)),Math.min(i,Math.floor(e+(o-s)*A/o+u)),r)}const o=t[e];let s=n,a=i;for(Bv(t,n,e),r(t[i],o)>0&&Bv(t,n,i);s<a;){for(Bv(t,s,a),s++,a--;r(t[s],o)<0;)s++;for(;r(t[a],o)>0;)a--}0===r(t[n],o)?Bv(t,n,a):(a++,Bv(t,a,i)),a<=e&&(n=a+1),e<=a&&(i=a-1)}}function Bv(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Ev(t,e){return t<e?-1:t>e?1:0}pv.prototype.computeLabelSize=function(t){const n=`${t.fontSize}:${t.text}`;if(wv[n])return wv[n];e.defined(this._textureAtlas)||(this._textureAtlas=new e.TextureAtlas({context:this._scene.context}),this._billboardCollection.textureAtlas=this._textureAtlas);const i=t.text.replace(yv,""),r=lv.splitGraphemes(i),o=r.length,s=[];let a,A;s.length=o;const u=this._glyphTextureCache;for(A=0;A<o;++A){const n=r[A],i=t.verticalOrigin,o=JSON.stringify([n,t.fontFamily,t.fontStyle,t.fontWeight,+i]);let h=u[o];if(!e.defined(h)){const r=Av(n,`${t.fontStyle} ${t.fontWeight} ${e.SDFSettings.FONT_SIZE}px ${t.fontFamily}`,e.Color.WHITE,e.Color.WHITE,0,e.LabelStyle.FILL,i);if(h=new iv(this,-1,r.dimensions),u[o]=h,r.width>0&&r.height>0){const t=Vd(r,{cutoff:e.SDFSettings.CUTOFF,radius:e.SDFSettings.RADIUS}),i=r.getContext("2d"),s=r.width,a=r.height,A=i.getImageData(0,0,s,a);for(let e=0;e<s;e++)for(let n=0;n<a;n++){const i=n*s+e,r=255*t[i],o=4*i;A.data[o+0]=r,A.data[o+1]=r,A.data[o+2]=r,A.data[o+3]=r}i.putImageData(A,0,0)," "!==n&&hv(this._textureAtlas,o,r,h)}}a=new nv,s[A]=a,a.textureInfo=h,a.dimensions=h.dimensions}let h,l,c=0,f=0,d=Number.NEGATIVE_INFINITY,g=0,v=1;const I=s.length;for(l=0;l<I;++l)"\n"===i.charAt(l)?(++v,c=0):(a=s[l],h=a.dimensions,g=Math.max(g,h.height-h.descent),d=Math.max(d,h.descent),c+=h.width-h.minx,l<I-1&&(c+=s[l+1].dimensions.minx),f=Math.max(f,c));let p=g+d+(e.defined(t.lineHeight)?t.lineHeight:1.2*t.fontSize)/t.relativeSize*(v-1);const y={width:f*t.totalScale,height:p*t.totalScale};return wv[n]=y,y},pv.prototype.preload=async function(){const t=t=>fetch(t).then((t=>t.json()));try{const[i,r]=await Promise.all([(n=this.preloadSDFTextureUrl,new Promise(((t,e)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{t(i)},i.onerror=()=>{e()},i.src=n}))),t(this.preloadSDFConfigUrl)]),o=new e.TextureAtlas({context:this._scene.context,initialSize:new e.Cartesian2(r.dimensions.x,r.dimensions.y)}),s=[...r.font];s.unshift("");const a={},A={};Object.keys(r.indexHash).forEach((t=>{s[0]=t;const e=JSON.stringify(s);a[e]=r.indexHash[t],A[e]=Promise.resolve(r.indexHash[t])})),o._indexHash=a,o._idHash=A,o._root=r.root,o._textureCoordinates=r.textureCoordinates.map((t=>new e.BoundingRectangle(t[0],t[1],t[2],t[3])));const u=new e.Texture({context:this._scene.context,width:r.dimensions.x,height:r.dimensions.y,pixelFormat:o._pixelFormat});u.copyFrom({width:r.dimensions.x,height:r.dimensions.y,source:i}),o._texture=u,this._textureAtlas=o,this._billboardCollection._textureAtlas=o,Object.keys(r.glyphTextureCache).forEach((t=>{s[0]=t;const e=JSON.stringify(s),n={width:r.glyphTextureCache[t][0],height:r.glyphTextureCache[t][1],ascent:r.glyphTextureCache[t][2],descent:r.glyphTextureCache[t][3],minx:r.glyphTextureCache[t][4]},i=r.glyphTextureCache[t][5];this._glyphTextureCache[e]=new iv(this,i,n)})),this.preloaded=!0}catch(t){this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=void 0,this._billboardCollection._textureAtlas=void 0,this._glyphTextureCache={},this.preloaded=!0}var n};class mv{constructor(t=9){this.Lc=Math.max(4,t),this.Nc=Math.max(2,Math.ceil(.4*this.Lc)),this.clear()}all(){return this.Uc(this.data,[])}search(t){let e=this.data;const n=[];if(!Fv(t,e))return n;const i=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],a=e.leaf?i(s):s;Fv(t,a)&&(e.leaf?n.push(s):Rv(t,a)?this.Uc(s,n):r.push(s))}e=r.pop()}return n}collides(t){let e=this.data;if(!Fv(t,e))return!1;const n=[];for(;e;){for(let i=0;i<e.children.length;i++){const r=e.children[i],o=e.leaf?this.toBBox(r):r;if(Fv(t,o)){if(e.leaf||Rv(t,o))return!0;n.push(r)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this.Nc){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this.Tc(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this.Pc(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this.qc(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this.qc(t,this.data.height-1),this}clear(){return this.data=Gv([]),this}remove(t,e){if(!t)return this;let n=this.data;const i=this.toBBox(t),r=[],o=[];let s,a,A;for(;n||r.length;){if(n||(n=r.pop(),a=r[r.length-1],s=o.pop(),A=!0),n.leaf){const i=Qv(t,n.children,e);if(-1!==i)return n.children.splice(i,1),r.push(n),this.Oc(r),this}A||n.leaf||!Rv(n,i)?a?(s++,n=a.children[s],A=!1):n=null:(r.push(n),o.push(s),s=0,a=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}Uc(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}Tc(t,e,n,i){const r=n-e+1;let o,s=this.Lc;if(r<=s)return o=Gv(t.slice(e,n+1)),kv(o,this.toBBox),o;i||(i=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,i-1))),o=Gv([]),o.leaf=!1,o.height=i;const a=Math.ceil(r/s),A=a*Math.ceil(Math.sqrt(s));Lv(t,e,n,A,this.compareMinX);for(let r=e;r<=n;r+=A){const e=Math.min(r+A-1,n);Lv(t,r,e,a,this.compareMinY);for(let n=r;n<=e;n+=a){const r=Math.min(n+a-1,e);o.children.push(this.Tc(t,n,r,i-1))}}return kv(o,this.toBBox),o}Hc(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){let n,i=1/0,s=1/0;for(let a=0;a<e.children.length;a++){const A=e.children[a],u=Sv(A),h=(r=t,o=A,(Math.max(o.maxX,r.maxX)-Math.min(o.minX,r.minX))*(Math.max(o.maxY,r.maxY)-Math.min(o.minY,r.minY))-u);h<s?(s=h,i=u<i?u:i,n=A):h===s&&u<i&&(i=u,n=A)}e=n||e.children[0]}var r,o;return e}qc(t,e,n){const i=n?t:this.toBBox(t),r=[],o=this.Hc(i,this.data,e,r);for(o.children.push(t),_v(o,i);e>=0&&r[e].children.length>this.Lc;)this.zc(r,e),e--;this.Kc(i,r,e)}zc(t,e){const n=t[e],i=n.children.length,r=this.Nc;this.Vc(n,r,i);const o=this.Jc(n,r,i),s=Gv(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,kv(n,this.toBBox),kv(s,this.toBBox),e?t[e-1].children.push(s):this.Pc(n,s)}Pc(t,e){this.data=Gv([t,e]),this.data.height=t.height+1,this.data.leaf=!1,kv(this.data,this.toBBox)}Jc(t,e,n){let i,r=1/0,o=1/0;for(let s=e;s<=n-e;s++){const e=bv(t,0,s,this.toBBox),a=bv(t,s,n,this.toBBox),A=$v(e,a),u=Sv(e)+Sv(a);A<r?(r=A,i=s,o=u<o?u:o):A===r&&u<o&&(o=u,i=s)}return i||n-e}Vc(t,e,n){const i=t.leaf?this.compareMinX:xv,r=t.leaf?this.compareMinY:Dv;this.Yc(t,e,n,i)<this.Yc(t,e,n,r)&&t.children.sort(i)}Yc(t,e,n,i){t.children.sort(i);const r=this.toBBox,o=bv(t,0,e,r),s=bv(t,n-e,n,r);let a=Mv(o)+Mv(s);for(let i=e;i<n-e;i++){const e=t.children[i];_v(o,t.leaf?r(e):e),a+=Mv(o)}for(let i=n-e-1;i>=e;i--){const e=t.children[i];_v(s,t.leaf?r(e):e),a+=Mv(s)}return a}Kc(t,e,n){for(let i=n;i>=0;i--)_v(e[i],t)}Oc(t){for(let e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():kv(t[n],this.toBBox)}}function Qv(t,e,n){if(!n)return e.indexOf(t);for(let i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function kv(t,e){bv(t,0,t.children.length,e,t)}function bv(t,e,n,i,r){r||(r=Gv(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<n;o++){const e=t.children[o];_v(r,t.leaf?i(e):e)}return r}function _v(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function xv(t,e){return t.minX-e.minX}function Dv(t,e){return t.minY-e.minY}function Sv(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Mv(t){return t.maxX-t.minX+(t.maxY-t.minY)}function $v(t,e){const n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function Rv(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Fv(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Gv(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Lv(t,e,n,i,r){const o=[e,n];for(;o.length;){if((n=o.pop())-(e=o.pop())<=i)continue;const s=e+Math.ceil((n-e)/i/2)*i;Cv(t,s,e,n,r),o.push(e,s,s,n)}}var Nv,Uv,Tv,Pv,qv,Ov,Hv={},zv=function(){if(Nv)return Hv;Nv=1;var t=Hv.Poi={};t.read=function(e,n){return e.readFields(t.jc,{minzoom:0,maxzoom:0,pos:[],poiid:"",indoorid:"",name:"",rank:0,name_zh:"",name_en:"",name_local:"",local_lang:"",character:[],character_en:[],name_spilt:[],altitude:0},n)},t.jc=function(t,e,n){1===t?e.minzoom=n.readVarint():2===t?e.maxzoom=n.readVarint():3===t?n.readPackedVarint(e.pos,!0):4===t?e.poiid=n.readString():5===t?e.indoorid=n.readString():6===t?e.name=n.readString():7===t?e.rank=n.readVarint():8===t?e.name_zh=n.readString():9===t?e.name_en=n.readString():10===t?e.name_local=n.readString():11===t?e.local_lang=n.readString():12===t?n.readPackedVarint(e.character):13===t?n.readPackedVarint(e.character_en):14===t?n.readPackedVarint(e.name_spilt):15===t&&(e.altitude=n.readVarint(!0))},t.write=function(t,e){t.minzoom&&e.writeVarintField(1,t.minzoom),t.maxzoom&&e.writeVarintField(2,t.maxzoom),t.pos&&e.writePackedVarint(3,t.pos),t.poiid&&e.writeStringField(4,t.poiid),t.indoorid&&e.writeStringField(5,t.indoorid),t.name&&e.writeStringField(6,t.name),t.rank&&e.writeVarintField(7,t.rank),t.name_zh&&e.writeStringField(8,t.name_zh),t.name_en&&e.writeStringField(9,t.name_en),t.name_local&&e.writeStringField(10,t.name_local),t.local_lang&&e.writeStringField(11,t.local_lang),t.character&&e.writePackedVarint(12,t.character),t.character_en&&e.writePackedVarint(13,t.character_en),t.name_spilt&&e.writePackedVarint(14,t.name_spilt),t.altitude&&e.writeVarintField(15,t.altitude)};var e=Hv.PoiSameStyle={};e.read=function(t,n){return t.readFields(e.jc,{styleid:"",items:[],resolution:0},n)},e.jc=function(e,n,i){1===e?n.styleid=i.readString():2===e?n.items.push(t.read(i,i.readVarint()+i.pos)):3===e&&(n.resolution=i.readVarint())},e.write=function(e,n){if(e.styleid&&n.writeStringField(1,e.styleid),e.items)for(var i=0;i<e.items.length;i++)n.writeMessage(2,t.write,e.items[i]);e.resolution&&n.writeVarintField(3,e.resolution)};var n=Hv.PoiLayer={};return n.read=function(t,e){return t.readFields(n.jc,{poilabel:[]},e)},n.jc=function(t,n,i){1===t&&n.poilabel.push(e.read(i,i.readVarint()+i.pos))},n.write=function(t,n){if(t.poilabel)for(var i=0;i<t.poilabel.length;i++)n.writeMessage(1,e.write,t.poilabel[i])},Hv}(),Kv=function(){if(Tv)return Uv;Tv=1;const t=2147483648,e=180;function n(t,e){const n=function(t,e,n,o){const s=r(t,e);let a=i(180),A=i(90);const u=a/(1<<s),h=A/(1<<s);return a=u>0?Math.floor(u+.5):Math.floor(u-.5),A=h>0?Math.floor(h+.5):Math.floor(h-.5),[a,A]}(t,e);return[2*n[0],2*n[1]]}function i(n){return Math.floor(n*t/e+.5)}function r(t,e){return 33-e-t}function o(n){return n*e/t}function s(t,e){const i=n(t.z,e),r=i[0],o=i[1],s=1<<t.z;return[-r/2+t.x*r/s,o/2-(t.y+1)*o/s]}function a(e,n,i){const a=s(e,n),A=r(e.z,n);for(var u=[],h=0;h<i.length;h+=2){const e=i[h]+a[0];let n=e<<A;const r=i[h+1]+a[1]<<A;e>0&&n<0&&(n=t-1);const s=o(n),l=o(r);u.push([s,l])}return u}function A(t){for(var e=0,n=2,i=t.length;n<i;n+=2)e+=((t[n]-t[n-2])**2+(t[n+1]-t[n-1])**2)**.5;return e}function u(t,e){for(var n=0,i=0,r=t.length;i<r;i+=2){var o=A(t.slice(i,i+4));if(!(o+n<e)){var s=(e-n)/o;return[Math.round(t[i]+s*(t[i+2]-t[i])),Math.round(t[i+1]+s*(t[i+3]-t[i+1])),i]}n+=o}return null}function h(t,e){e=e/180*Math.PI;let n=0,i=0,r=0;for(var o=2,s=t.length;o<s;o+=2){var a=t[o]-t[o-2],A=t[o+1]-t[o-1],u=(a**2+A**2)**.5;if(2==o)n=a,i=A,r=u;else{if(Math.acos((a*n+A*i)/u/r)>e)return!1;n=a,i=A,r=u}}return!0}return Uv={getWorldSize:n,riseLevel:function(t,e,n,o){var A=function(t,e,n){var o=t.z;const a=s(t,e),A=r(o,e);for(var u=[],h=0;h<n.length;h+=1){var l=n[h][0],c=n[h][1];c<-90&&(c=-90),c>90&&(c=90),l<-180&&(l=-180),l>180&&(l=180);let t=i(l),e=i(c);const r=t/(1<<A),o=e/(1<<A);t=r>0?Math.floor(r+.5):Math.floor(r-.5),e=o>0?Math.floor(o+.5):Math.floor(o-.5),t-=a[0],e-=a[1],u.push(t,e)}return u}(o,n-1,a(e,n,t));return A},ptsLength:A,getSmoothSlice:function(t,e,n){for(var i=function(t,e){var n=[],i=[],r=A(t);if(r>=e){for(var o=Math.floor(r/e),s=1;s<=o;s+=1)n.push(u(t,e*s));var a=[],h=[],l=0,c=void 0;for(s=0;s<n.length;s+=1){c=n[s][2]+2;var f=t.slice(l,c);h=[n[s][0],n[s][1]];for(var d=a.concat(f).concat(h),g=2;g<d.length;g+=2)d[g]===d[g-2]&&d[g+1]===d[g-1]&&(d.splice(g,2),g-=2);i.push(d),a=h,l=c}return i}}(t,e)||[],r=0;r<i.length;r+=1)h(i[r],n)||(i.splice(r,1),r-=1);return i},tileInnerCoords2LngLat:a,tileInnerCoord2LngLat:function(e,n,i,a){const A=s(e,n),u=i+A[0],h=a+A[1],l=r(e.z,n);return i=u<<l,a=h<<l,u>0&&i<0&&(i=t-1),[o(i),o(a)]}},Uv}(),Vv={},Jv=function(){if(Ov)return qv;Ov=1,qv=e;var t=(Pv||(Pv=1,Vv.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,A=(1<<a)-1,u=A>>1,h=-7,l=n?r-1:0,c=n?-1:1,f=t[e+l];for(l+=c,o=f&(1<<-h)-1,f>>=-h,h+=a;h>0;o=256*o+t[e+l],l+=c,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=i;h>0;s=256*s+t[e+l],l+=c,h-=8);if(0===o)o=1-u;else{if(o===A)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=u}return(f?-1:1)*s*Math.pow(2,o-i)},Vv.write=function(t,e,n,i,r,o){var s,a,A,u=8*o-r-1,h=(1<<u)-1,l=h>>1,c=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-s))<1&&(s--,A*=2),(e+=s+l>=1?c/A:c*Math.pow(2,1-l))*A>=2&&(s++,A/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(e*A-1)*Math.pow(2,r),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,r),s=0));r>=8;t[n+f]=255&a,f+=d,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[n+f]=255&s,f+=d,s/=256,u-=8);t[n+f-d]|=128*g}),Vv);function e(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var n=4294967296,i=1/n,r="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function o(t){return t.type===e.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function A(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function u(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function h(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function c(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function I(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function p(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=I(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=I(this.buf,this.pos)+I(this.buf,this.pos+4)*n;return this.pos+=8,t},readSFixed64:function(){var t=I(this.buf,this.pos)+y(this.buf,this.pos+4)*n;return this.pos+=8,t},readFloat:function(){var e=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return s(t,i,e);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return s(t,i,e);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return s(t,i,e);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return s(t,i,e);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return s(t,i,e);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return s(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&r?function(t,e,n){return r.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var i="",r=e;r<n;){var o,s,a,A=t[r],u=null,h=A>239?4:A>223?3:A>191?2:1;if(r+h>n)break;1===h?A<128&&(u=A):2===h?128==(192&(o=t[r+1]))&&(u=(31&A)<<6|63&o)<=127&&(u=null):3===h?(o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&((u=(15&A)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&A)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),r+=h}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,n){if(this.type!==e.Bytes)return t.push(this.readVarint(n));var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(n));return t},readPackedSVarint:function(t){if(this.type!==e.Bytes)return t.push(this.readSVarint());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==e.Bytes)return t.push(this.readBoolean());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==e.Bytes)return t.push(this.readFloat());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==e.Bytes)return t.push(this.readDouble());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed32());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed32());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed64());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed64());var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed64());return t},skip:function(t){var n=7&t;if(n===e.Varint)for(;this.buf[this.pos++]>127;);else if(n===e.Bytes)this.pos=this.readVarint()+this.pos;else if(n===e.Fixed32)this.pos+=4;else{if(n!==e.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),p(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),p(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),p(this.buf,-1&t,this.pos),p(this.buf,Math.floor(t*i),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),p(this.buf,-1&t,this.pos),p(this.buf,Math.floor(t*i),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&a(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),t.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),t.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&a(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,n,i){this.writeTag(t,e.Bytes),this.writeRawMessage(n,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,A,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writeBytesField:function(t,n){this.writeTag(t,e.Bytes),this.writeBytes(n)},writeFixed32Field:function(t,n){this.writeTag(t,e.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(t,n){this.writeTag(t,e.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(t,n){this.writeTag(t,e.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(t,n){this.writeTag(t,e.Fixed64),this.writeSFixed64(n)},writeVarintField:function(t,n){this.writeTag(t,e.Varint),this.writeVarint(n)},writeSVarintField:function(t,n){this.writeTag(t,e.Varint),this.writeSVarint(n)},writeStringField:function(t,n){this.writeTag(t,e.Bytes),this.writeString(n)},writeFloatField:function(t,n){this.writeTag(t,e.Fixed32),this.writeFloat(n)},writeDoubleField:function(t,n){this.writeTag(t,e.Fixed64),this.writeDouble(n)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},qv}(),Yv=Fh(Jv);class jv{Io;po="PoiDataSource";yo=!1;wo;Co;Bo;_show=!0;Eo;_scene;_id=0;Oe;Wc=1;Xc={};Zc;Fc=0;tf={};tilesetUrl;tileset;SSE;constructor(t){this.wo=new r.Event,this.Co=new r.Event,this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this._scene=t.scene,this.tilesetUrl=t.tileset,this.Zc=this.tilesetUrl.substring(0,this.tilesetUrl.lastIndexOf("/")),this.SSE=t.SSE,this.Oe=new rc({Ni:30,Gi:this.onDrop})}ef=!1;onDrop=(t,e)=>{delete this.Xc[t],this.ef=!0};async loadTileset(){try{const t=await fetch(this.tilesetUrl),e=await t.json();this.tileset=e}catch(t){}}getViewFrustum(){const t=this._scene.camera,e=this.tileset.metadata.enuCenterGCJ02,n=t.frustum.computeCullingVolume(t.positionWC,t.directionWC,t.upWC).planes,i=r.Cartesian3.fromDegrees(...e),o=r.Transforms.eastNorthUpToFixedFrame(i),s=r.Matrix4.inverse(o,new r.Matrix4),a=n.map((t=>{const e=new r.Cartesian3(t.x,t.y,t.z),n=t.w,i=r.Matrix4.multiplyByPointAsVector(s,e,new r.Cartesian3),o=r.Cartesian3.multiplyByScalar(e,-n,new r.Cartesian3),a=r.Matrix4.multiplyByPoint(s,o,new r.Cartesian3),A=-r.Cartesian3.dot(i,a);return new r.Cartesian4(i.x,i.y,i.z,A)}));return new r.CullingVolume(a)}getTileKey(t){return t.coord.join("-")}computeTilesToRender(){if(!this.tileset)return{};const t=this._scene.camera,e=t.frustum.sseDenominator,n=this._scene.context.drawingBufferHeight,{enuCenterGCJ02:i}=this.tileset.metadata,o=this.getViewFrustum(),s=this.tileset.root,a=Yl(t.position,i),A=t=>{const e=new r.Cartesian3(t[0],t[1],t[2]),n=new r.Cartesian3(t[0]-t[3],t[1]-t[7],t[2]-t[11]),i=new r.Cartesian3(t[0]+t[3],t[1]-t[7],t[2]-t[11]),o=new r.Cartesian3(t[0]-t[3],t[1]+t[7],t[2]-t[11]),s=new r.Cartesian3(t[0]+t[3],t[1]+t[7],t[2]-t[11]);return Math.min(r.Cartesian3.distance(a,e),r.Cartesian3.distance(a,n),r.Cartesian3.distance(a,i),r.Cartesian3.distance(a,o),r.Cartesian3.distance(a,s))},u={},h={},l=[s];for(;l.length;){let t=l.length;for(let i=0;i<t;i++){const t=l.shift(),i=t.boundingVolume.box,a=new r.Cartesian3(i[0]-i[3],i[1]-i[7],i[2]-i[11]),c=new r.Cartesian3(i[0]+i[3],i[1]+i[7],i[2]+i[11]),f=new r.AxisAlignedBoundingBox(a,c);if(o.computeVisibility(f)!==r.Intersect.OUTSIDE){const r=A(i),o=t.geometricError*n/(r*e),a=t.children.length>0;if(t===s||o>this.SSE&&a){let e;if(t.coord){const n=t.content.uri,i=n.startsWith("http")?n:this.Zc+"/"+n,r=this.getTileKey(t);u[r]=i,h[r]&&delete u[h[r]],e=r}for(let n=0;n<t.children.length;n++)l.push(t.children[n]),e&&(h[this.getTileKey(t.children[n])]=e)}else if(t.coord){const e=t.content.uri,n=e.startsWith("http")?e:this.Zc+"/"+e,i=this.getTileKey(t);u[i]=n,h[i]&&delete u[h[i]]}}}}return u}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}update(){const t=Date.now();if(t-this.Fc<1e3)return!0;if(this.Fc=t,!this.tileset&&2!==this.Wc)return this.loadTileset(),!0;const e=this.computeTilesToRender(),n=this.tileChanged(this.tf,e);if(this.tf=e,!n&&!this.ef)return!0;this.ef=!1;const i=Object.keys(e);for(let t=0;t<i.length;t++){const n=i[t];this.Oe.Xi(n)||2===this.Xc[n]||this.fetchTile(n,e[n])}return!0}tileChanged(t,e){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!0;for(let t=0;t<n.length;t++)if(!e[n[t]])return!0;return!1}async fetchTile(t,e){try{this.Xc[t]=2;const n=await fetch(e),i=await n.arrayBuffer(),o=new Yv(i),s=zv.PoiLayer.read(o),a=t.split("-").map((t=>parseInt(t,10))),A={z:a[0],x:a[1],y:a[2]};let u=[];for(let t=0;t<s.poilabel.length;t++){const e=s.poilabel[t],n=[];e.items.forEach((t=>{n.push(t.pos[0],t.pos[1])}));const i=Kv.tileInnerCoords2LngLat(A,e.resolution,n);e.items.forEach(((t,n)=>{u.push({position:r.Cartesian3.fromDegrees(i[n][0],i[n][1],t.altitude),name:t.name,rank:t.rank,poiid:t.poiid,minzoom:t.minzoom,maxzoom:t.maxzoom,id:++this._id,coord:[A.z,A.x,A.y],styleId:e.styleid,type:"poi"})}))}this.Oe.Wi(t,u),this.Xc[t]=3,this.changedEvent.raiseEvent(t)}catch(e){this.Xc[t]=4}}getData(){const t=this.tf,e=Object.keys(t);let n=[];for(let t=0;t<e.length;t++){const i=this.Oe.Yi(e[t],!1);i&&(n=n.concat(i))}return n.sort(((t,e)=>t.rank!=e.rank?t.rank<e.rank:t.coord[0]!=e.coord[0]?t.coord[0]>e.coord[0]:t.id<e.id)),n}}var Wv,Xv={},Zv=function(){if(Wv)return Xv;Wv=1;var t=Xv.Road={};t.read=function(e,n){return e.readFields(t.jc,{minzoom:0,maxzoom:0,path:[],shield:"",shieldType:0,name:"",rank:0,name_zh:"",name_en:"",name_local:"",local_lang:"",character:[],id:0},n)},t.jc=function(t,e,n){1===t?e.minzoom=n.readVarint():2===t?e.maxzoom=n.readVarint():3===t?n.readPackedVarint(e.path,!0):4===t?e.shield=n.readString():5===t?e.shieldType=n.readVarint():6===t?e.name=n.readString():7===t?e.rank=n.readVarint():8===t?e.name_zh=n.readString():9===t?e.name_en=n.readString():10===t?e.name_local=n.readString():11===t?e.local_lang=n.readString():12===t?n.readPackedVarint(e.character):13===t&&(e.id=n.readVarint())},t.write=function(t,e){t.minzoom&&e.writeVarintField(1,t.minzoom),t.maxzoom&&e.writeVarintField(2,t.maxzoom),t.path&&e.writePackedVarint(3,t.path),t.shield&&e.writeStringField(4,t.shield),t.shieldType&&e.writeVarintField(5,t.shieldType),t.name&&e.writeStringField(6,t.name),t.rank&&e.writeVarintField(7,t.rank),t.name_zh&&e.writeStringField(8,t.name_zh),t.name_en&&e.writeStringField(9,t.name_en),t.name_local&&e.writeStringField(10,t.name_local),t.local_lang&&e.writeStringField(11,t.local_lang),t.character&&e.writePackedVarint(12,t.character),t.id&&e.writeVarintField(13,t.id)};var e=Xv.RoadSameStyle={};e.read=function(t,n){return t.readFields(e.jc,{styleid:"",items:[],resolution:0},n)},e.jc=function(e,n,i){1===e?n.styleid=i.readString():2===e?n.items.push(t.read(i,i.readVarint()+i.pos)):3===e&&(n.resolution=i.readVarint())},e.write=function(e,n){if(e.styleid&&n.writeStringField(1,e.styleid),e.items)for(var i=0;i<e.items.length;i++)n.writeMessage(2,t.write,e.items[i]);e.resolution&&n.writeVarintField(3,e.resolution)};var n=Xv.RoadLayer={};return n.read=function(t,e){return t.readFields(n.jc,{road:[]},e)},n.jc=function(t,n,i){1===t&&n.road.push(e.read(i,i.readVarint()+i.pos))},n.write=function(t,n){if(t.road)for(var i=0;i<t.road.length;i++)n.writeMessage(1,e.write,t.road[i])},Xv}();class tI{Io;po="RoadDataSource";yo=!1;wo;Co;Bo;_show=!0;Eo;_scene;_id=0;Oe;Wc=1;Xc={};Zc;Fc=0;tf={};tilesetUrl;tileset;SSE;constructor(t){this.wo=new r.Event,this.Co=new r.Event,this.yo=!1,this.Bo=new r.Event,this.Io=new r.EntityCollection,this.Eo=new r.EntityCluster,this._scene=t.scene,this.tilesetUrl=t.tileset,this.Zc=this.tilesetUrl.substring(0,this.tilesetUrl.lastIndexOf("/")),this.SSE=t.SSE,this.Oe=new rc({Ni:30,Gi:this.onDrop})}ef=!1;onDrop=(t,e)=>{delete this.Xc[t],this.ef=!0};async loadTileset(){try{const t=await fetch(this.tilesetUrl),e=await t.json();this.tileset=e}catch(t){}}getViewFrustum(){const t=this._scene.camera,e=this.tileset.metadata.enuCenterGCJ02,n=t.frustum.computeCullingVolume(t.positionWC,t.directionWC,t.upWC).planes,i=r.Cartesian3.fromDegrees(...e),o=r.Transforms.eastNorthUpToFixedFrame(i),s=r.Matrix4.inverse(o,new r.Matrix4),a=n.map((t=>{const e=new r.Cartesian3(t.x,t.y,t.z),n=t.w,i=r.Matrix4.multiplyByPointAsVector(s,e,new r.Cartesian3),o=r.Cartesian3.multiplyByScalar(e,-n,new r.Cartesian3),a=r.Matrix4.multiplyByPoint(s,o,new r.Cartesian3),A=-r.Cartesian3.dot(i,a);return new r.Cartesian4(i.x,i.y,i.z,A)}));return new r.CullingVolume(a)}getTileKey(t){return t.coord.join("-")}computeTilesToRender(){if(!this.tileset)return{};const t=this._scene.camera,e=t.frustum.sseDenominator,n=this._scene.context.drawingBufferHeight,{enuCenterGCJ02:i}=this.tileset.metadata,o=this.getViewFrustum(),s=this.tileset.root,a=Yl(t.position,i),A=t=>{const e=new r.Cartesian3(t[0],t[1],t[2]),n=new r.Cartesian3(t[0]-t[3],t[1]-t[7],t[2]-t[11]),i=new r.Cartesian3(t[0]+t[3],t[1]-t[7],t[2]-t[11]),o=new r.Cartesian3(t[0]-t[3],t[1]+t[7],t[2]-t[11]),s=new r.Cartesian3(t[0]+t[3],t[1]+t[7],t[2]-t[11]);return Math.min(r.Cartesian3.distance(a,e),r.Cartesian3.distance(a,n),r.Cartesian3.distance(a,i),r.Cartesian3.distance(a,o),r.Cartesian3.distance(a,s))},u={},h={},l=[s];for(;l.length;){let t=l.length;for(let i=0;i<t;i++){const t=l.shift(),i=t.boundingVolume.box,a=new r.Cartesian3(i[0]-i[3],i[1]-i[7],i[2]-i[11]),c=new r.Cartesian3(i[0]+i[3],i[1]+i[7],i[2]+i[11]),f=new r.AxisAlignedBoundingBox(a,c);if(o.computeVisibility(f)!==r.Intersect.OUTSIDE){const r=A(i),o=t.geometricError*n/(r*e),a=t.children.length>0;if(t===s||o>this.SSE&&a){let e;if(t.coord){const n=t.content.uri,i=n.startsWith("http")?n:this.Zc+"/"+n,r=this.getTileKey(t);u[r]=i,h[r]&&delete h[r],e=r}for(let n=0;n<t.children.length;n++)l.push(t.children[n]),e&&(h[this.getTileKey(t.children[n])]=e)}else if(t.coord){const e=t.content.uri,n=e.startsWith("http")?e:this.Zc+"/"+e,i=this.getTileKey(t);u[i]=n,h[i]&&delete h[i]}}}}return u}get name(){return this.po}clock=null;get entities(){return this.Io}get isLoading(){return this.yo}get changedEvent(){return this.wo}get errorEvent(){return this.Co}get loadingEvent(){return this.Bo}get show(){return this._show}set show(t){this._show=t}get clustering(){return this.Eo}set clustering(t){if(!r.defined(t))throw new r.DeveloperError("value must be defined.");this.Eo=t}update(){const t=Date.now();if(t-this.Fc<1e3)return!0;if(this.Fc=t,!this.tileset&&2!==this.Wc)return this.loadTileset(),!0;const e=this.computeTilesToRender(),n=this.tileChanged(this.tf,e);if(this.tf=e,!n&&!this.ef)return!0;this.ef=!1;const i=Object.keys(e);for(let t=0;t<i.length;t++){const n=i[t];this.Oe.Xi(n)||2===this.Xc[n]||this.fetchTile(n,e[n])}return!0}tileChanged(t,e){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!0;for(let t=0;t<n.length;t++)if(!e[n[t]])return!0;return!1}async fetchTile(t,e){try{this.Xc[t]=2;const n=await fetch(e),i=await n.arrayBuffer(),o=new Yv(i),s=Zv.RoadLayer.read(o),a=t.split("-").map((t=>parseInt(t,10))),A={z:a[0],x:a[1],y:a[2]};let u=[];for(let t=0;t<s.road.length;t++){const e=s.road[t],{resolution:n,styleid:i,items:o}=e;if(20015===parseInt(i.split(":")[0],10))continue;let a,h;for(let t=0;t<o.length&&(!a||!h);t++){const e=o[t];!h&&e.shield?h=e:!a&&e.name&&(a=e)}if(a){const{rank:t,minzoom:e,maxzoom:o,path:s,name:h}=a,l=[s[0],s[1],s[2]],c=[s[s.length-3],s[s.length-2],s[s.length-1]],f=Kv.tileInnerCoords2LngLat(A,n,[l[0],l[1],c[0],c[1]]),d=f[0],g=f[f.length-1],v=r.Cartesian3.fromDegrees(d[0],d[1],l[2]),I=r.Cartesian3.fromDegrees(g[0],g[1],c[2]),p=r.Cartesian3.subtract(I,v,new r.Cartesian3),y=r.Cartesian3.magnitude(p);let w;w=y<100?new r.Cartesian3(v.x+100/y*p.x,v.y+100/y*p.y,v.z+100/y*p.z):I;const C={coord:A,name:h,styleId:i,rank:t,minzoom:e,maxzoom:o,position:v,start:v,end:w,id:++this._id,type:"road",subType:"roadname"};u.push(C)}if(h){const{rank:t,minzoom:e,maxzoom:i,shield:o,shieldType:s,path:a}=h,l=[a[0],a[1],a[2]],c=Kv.tileInnerCoords2LngLat(A,n,[l[0],l[1]])[0],f={coord:A,name:o,styleId:`40001:${s}`,rank:t,minzoom:e,maxzoom:i,position:r.Cartesian3.fromDegrees(c[0],c[1],l[2]),id:++this._id,type:"road",subType:"guideboard"};u.push(f)}}this.Oe.Wi(t,u),this.Xc[t]=3,this.changedEvent.raiseEvent(t)}catch(e){this.Xc[t]=4}}getData(){const t=this.tf,e=Object.keys(t);let n=[];for(let t=0;t<e.length;t++){const i=this.Oe.Yi(e[t],!1);i&&(n=n.concat(i))}return n.sort(((t,e)=>t.rank!=e.rank?t.rank<e.rank:t.coord[0]!=e.coord[0]?t.coord[0]>e.coord[0]:t.id<e.id)),n}}var eI,nI,iI,rI=function(){if(nI)return eI;nI=1;var t=/^\s+|\s+$/g,e=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,i=/^0o[0-7]+$/i,r=parseInt,o="object"==typeof Rh&&Rh&&Rh.Object===Object&&Rh,s="object"==typeof self&&self&&self.Object===Object&&self,a=o||s||Function("","return this")(),A={}.toString,u=Math.max,h=Math.min,l=function(){return a.Date.now()};function c(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function f(o){if("number"==typeof o)return o;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==A.call(t)}(o))return NaN;if(c(o)){var s="function"==typeof o.valueOf?o.valueOf():o;o=c(s)?s+"":s}if("string"!=typeof o)return 0===o?o:+o;o=o.replace(t,"");var a=n.test(o);return a||i.test(o)?r(o.slice(2),a?2:8):e.test(o)?NaN:+o}return eI=function(t,e,n){var i,r,o,s,a,A,d=0,g=!1,v=!1,I=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=i,o=r;return i=r=void 0,d=e,s=t.apply(o,n)}function y(t){var n=t-A;return void 0===A||n>=e||n<0||v&&t-d>=o}function w(){var t=l();if(y(t))return C(t);a=setTimeout(w,function(t){var n=e-(t-A);return v?h(n,o-(t-d)):n}(t))}function C(t){return a=void 0,I&&i?p(t):(i=r=void 0,s)}function B(){var t=l(),n=y(t);if(i=arguments,r=this,A=t,n){if(void 0===a)return function(t){return d=t,a=setTimeout(w,e),g?p(t):s}(A);if(v)return a=setTimeout(w,e),p(A)}return void 0===a&&(a=setTimeout(w,e)),s}return e=f(e)||0,c(n)&&(g=!!n.leading,o=(v="maxWait"in n)?u(f(n.maxWait)||0,e):o,I="trailing"in n?!!n.trailing:I),B.cancel=function(){void 0!==a&&clearTimeout(a),d=0,i=A=r=a=void 0},B.flush=function(){return void 0===a?s:C(l())},B},eI}(),oI=Fh(rI),sI={exports:{}},aI=(iI||(iI=1,function(t){!function(){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function n(t){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(t)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function i(t,e){t.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function r(t){var e=t.g.offsetWidth,n=e+100;return t.j.style.width=n+"px",t.i.scrollLeft=n,t.h.scrollLeft=t.h.scrollWidth+100,t.l!==e&&(t.l=e,!0)}function o(t,n){function i(){var t=o;r(t)&&null!==t.g.parentNode&&n(t.l)}var o=t;e(t.h,i),e(t.i,i),r(t)}function s(t,e,n){e=e||{},n=n||window,this.family=t,this.style=e.style||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"normal",this.context=n}var a=null,A=null,u=null,h=null;function l(t){return null===h&&(h=!!t.document.fonts),h}function c(t,e){var n=t.style,i=t.weight;if(null===u){var r=document.createElement("div");try{r.style.font="condensed 100px sans-serif"}catch(t){}u=""!==r.style.font}return[n,i,u?t.stretch:"","100px",e].join(" ")}s.prototype.load=function(t,e){var r=this,s=t||"BESbswy",u=0,h=e||3e3,f=(new Date).getTime();return new Promise((function(t,e){if(l(r.context)&&!function(t){return null===A&&(l(t)&&/Apple/.test(window.navigator.vendor)?(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),A=!!t&&603>parseInt(t[1],10)):A=!1),A}(r.context)){var d=new Promise((function(t,e){!function n(){(new Date).getTime()-f>=h?e(Error(h+"ms timeout exceeded")):r.context.document.fonts.load(c(r,'"'+r.family+'"'),s).then((function(e){1<=e.length?t():setTimeout(n,25)}),e)}()})),g=new Promise((function(t,e){u=setTimeout((function(){e(Error(h+"ms timeout exceeded"))}),h)}));Promise.race([g,d]).then((function(){clearTimeout(u),t(r)}),e)}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function A(){var e;(e=-1!=v&&-1!=I||-1!=v&&-1!=p||-1!=I&&-1!=p)&&((e=v!=I&&v!=p&&I!=p)||(null===a&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=a&&(v==y&&I==y&&p==y||v==w&&I==w&&p==w||v==C&&I==C&&p==C)),e=!e),e&&(null!==B.parentNode&&B.parentNode.removeChild(B),clearTimeout(u),t(r))}var l=new n(s),d=new n(s),g=new n(s),v=-1,I=-1,p=-1,y=-1,w=-1,C=-1,B=document.createElement("div");B.dir="ltr",i(l,c(r,"sans-serif")),i(d,c(r,"serif")),i(g,c(r,"monospace")),B.appendChild(l.g),B.appendChild(d.g),B.appendChild(g.g),r.context.document.body.appendChild(B),y=l.g.offsetWidth,w=d.g.offsetWidth,C=g.g.offsetWidth,function t(){if((new Date).getTime()-f>=h)null!==B.parentNode&&B.parentNode.removeChild(B),e(Error(h+"ms timeout exceeded"));else{var n=r.context.document.hidden;!0!==n&&void 0!==n||(v=l.g.offsetWidth,I=d.g.offsetWidth,p=g.g.offsetWidth,A()),u=setTimeout(t,50)}}(),o(l,(function(t){v=t,A()})),i(l,c(r,'"'+r.family+'",sans-serif')),o(d,(function(t){I=t,A()})),i(d,c(r,'"'+r.family+'",serif')),o(g,(function(t){p=t,A()})),i(g,c(r,'"'+r.family+'",monospace'))}))}))},t.exports=s}()}(sI)),sI.exports),AI=Fh(aI);class uI{Bn;_scene;_labels;nf;if;rf;sf={};af={};disableDepthTestDistance=2e3;fontSize="20";fontFamily="AlibabaPuHuiTi";styleUrl="https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/static/3dgs/cesiumjs-sdk/dist/style.json";styles=null;fontStyle="normal";fontWeight="800";iconSize=24;iconTextSpacing=4;lineHeight=void 0;Af;tileset;uf=200;fe=!1;hf=[];lf=12e4;cf=!1;ff=1e3;collisionBuffer=new r.Cartesian2(20,20);df=0;set SSE(t){this.uf=t,this.poiDataSource.SSE=this.uf,this.roadDataSource.SSE=this.uf}get SSE(){return this.uf}poiDataSource;roadDataSource;_dirty=!0;gf=new r.Cartesian3(0,0,0);vf=new r.Cartesian3(0,0,0);preloadSDF=!0;preloadSDFTextureUrl="https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/static/3dgs/cesiumjs-sdk/AlibabaPuHuiTi-2-55-Regular/SDF.png";preloadSDFConfigUrl="https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/static/3dgs/cesiumjs-sdk/AlibabaPuHuiTi-2-55-Regular/SDF.json";constructor(t){this.Af=new mv,this.preloadSDF=!1!==t.preloadSDF,this._labels=new pv({blendOption:e.BlendOption.TRANSLUCENT,scene:t.viewer.scene,preloadSDF:this.preloadSDF,preloadSDFTextureUrl:this.preloadSDFTextureUrl,preloadSDFConfigUrl:this.preloadSDFConfigUrl}),this.if=new pv({blendOption:e.BlendOption.TRANSLUCENT,scene:t.viewer.scene,reuseBillboards:!1}),this.nf=new Ig({blendOption:e.BlendOption.TRANSLUCENT}),this.rf=new Ig({blendOption:e.BlendOption.TRANSLUCENT}),this.Bn=t.viewer,this._scene=t.viewer.scene,this.poiDataSource=new jv({scene:this._scene,tileset:t.poiTileset,SSE:this.SSE}),this.roadDataSource=new tI({scene:this._scene,tileset:t.roadTileset,SSE:this.SSE}),this.Bn.dataSources.add(this.poiDataSource),this.Bn.dataSources.add(this.roadDataSource),this.onData=oI(this.onData,500,{maxWait:1e3}),this.poiDataSource.changedEvent.addEventListener(this.onData),this.roadDataSource.changedEvent.addEventListener(this.onData),this.If(),this.pf(),this.Bn.camera.moveEnd.addEventListener(this.requestRender)}set show(t){this._labels.show=!!t,this.if.show=!!t,this.nf.show=!!t,this.rf.show=!!t}get show(){return this._labels.show}onData=()=>{this.fe||(this._dirty=!0,this.requestRender())};update(t){if(!this.styles||!this.show||!this.cf)return;if(!this._labels.preloaded)return;const e=this._scene.camera.position.clone(),{heading:n,pitch:i,roll:o}=this._scene.camera,s=new r.Cartesian3(n,i,o),a=r.Cartesian3.distance(e,this.gf)<1&&r.Cartesian3.equalsEpsilon(s,this.vf,Math.PI/180),A=Date.now();if(A-this.df>this.ff&&(!a||this._dirty)){this.df=A,this.gf=e,this.vf=s,this._dirty=!1;let t=this.poiDataSource.getData();this.hf.length&&(t=[].concat(this.hf).concat(t));const n=this.roadDataSource.getData(),i=this.computeItemsToRender(t,n),{pois:r,roads:o}=i;this.updateRoads(this.af,o),this.updatePois(this.sf,r)}this.rf.update(t),this.if.update(t),this.nf.update(t),this._labels.update(t)}isDestroyed(){return this.fe}destroy(){this._labels.destroy(),this.nf.destroy(),this.if.destroy(),this.rf.destroy(),this.sf={},this.af={},this.poiDataSource.changedEvent.removeEventListener(this.onData),this.roadDataSource.changedEvent.removeEventListener(this.onData),this.fe=!0,this.Bn.camera.moveEnd.removeEventListener(this.requestRender)}addPoi(t){const n=`${Math.min(Math.floor(this.getZoom()),20)}:${t.styleId}`,i={...this.styles[n]};if(i)if(0===i.layout){const e=this.iconSize*i.transform[0],n=this.iconSize*i.transform[1],o=this.getIconUrl(i.file),s=this.nf.add({position:t.position,image:o,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.CENTER,width:e,height:n,disableDepthTestDistance:this.disableDepthTestDistance});this.sf[t.id]={icon:s}}else if(1===i.layout){const n=t.name,o={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${i.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:i.size/e.SDFSettings.FONT_SIZE,relativeSize:i.size/e.SDFSettings.FONT_SIZE},s=this._labels.computeLabelSize(o),a=new e.Cartesian2(-s.width/2,-s.height/2),A=this.lineHeight?`/${this.lineHeight}px`:"",u=`${this.fontStyle} ${this.fontWeight} ${i.size}px${A} ${this.fontFamily}`,h=this._labels.add({position:t.position,text:n,font:u,horizontalOrigin:r.HorizontalOrigin.LEFT,verticalOrigin:r.VerticalOrigin.TOP,fillColor:r.Color.fromCssColorString(i.fill),style:r.LabelStyle.FILL_AND_OUTLINE,disableDepthTestDistance:this.disableDepthTestDistance,outlineColor:r.Color.fromCssColorString(i.haloFill),outlineWidth:i.haloRadius,pixelOffset:a});this.sf[t.id]={label:h}}else if(2===i.layout){const n=t.name,o=this.iconSize*i.transform[0],s=this.iconSize*i.transform[1],a=this.getIconUrl(i.file),A=this.nf.add({position:t.position,image:a,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.CENTER,width:o,height:s,disableDepthTestDistance:this.disableDepthTestDistance,pixelOffset:new r.Cartesian2(0,i.shieldDy)}),u={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${i.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:i.size/e.SDFSettings.FONT_SIZE,relativeSize:i.size/e.SDFSettings.FONT_SIZE},h=this._labels.computeLabelSize(u),l=new e.Cartesian2(-h.width/2,-h.height/2),c=this.lineHeight?`/${this.lineHeight}px`:"",f=`${this.fontStyle} ${this.fontWeight} ${i.size}px${c} ${this.fontFamily}`,d=this._labels.add({position:t.position,text:n,font:f,horizontalOrigin:r.HorizontalOrigin.LEFT,verticalOrigin:r.VerticalOrigin.TOP,fillColor:r.Color.fromCssColorString(i.fill),style:r.LabelStyle.FILL_AND_OUTLINE,disableDepthTestDistance:this.disableDepthTestDistance,outlineColor:r.Color.fromCssColorString(i.haloFill),outlineWidth:i.haloRadius,pixelOffset:l});this.sf[t.id]={icon:A,label:d}}else if(3===i.layout){const n=t.name,o=this.iconSize*i.transform[0],s=this.iconSize*i.transform[1],a=this.getIconUrl(i.file),A=this.nf.add({position:t.position,image:a,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.CENTER,width:o,height:s,disableDepthTestDistance:t.external?1/0:this.disableDepthTestDistance,pixelOffset:new r.Cartesian2(0,i.shieldDy)}),u={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${i.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:i.size/e.SDFSettings.FONT_SIZE,relativeSize:i.size/e.SDFSettings.FONT_SIZE},h=this._labels.computeLabelSize(u),l=new e.Cartesian2(o/2+this.iconTextSpacing,i.shieldDy-h.height/2),c=this.lineHeight?`/${this.lineHeight}px`:"",f=`${this.fontStyle} ${this.fontWeight} ${i.size}px${c} ${this.fontFamily}`,d=this._labels.add({position:t.position,text:n,font:f,horizontalOrigin:r.HorizontalOrigin.LEFT,verticalOrigin:r.VerticalOrigin.TOP,fillColor:r.Color.fromCssColorString(i.fill),style:r.LabelStyle.FILL_AND_OUTLINE,disableDepthTestDistance:t.external?1/0:this.disableDepthTestDistance,outlineColor:r.Color.fromCssColorString(i.haloFill),outlineWidth:i.haloRadius,pixelOffset:l});this.sf[t.id]={icon:A,label:d}}}addRoad(t){const n=`${Math.min(Math.floor(this.getZoom()),20)}:${t.styleId}`,i=this.styles[n];if(!i)return;const o=t.subType;if("roadname"===o){const n=t.name,o={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${i.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:i.size/e.SDFSettings.FONT_SIZE,relativeSize:i.size/e.SDFSettings.FONT_SIZE},s=this._labels.computeLabelSize(o),a=new e.Cartesian2(-s.width/2,-s.height/2),A=this.lineHeight?`/${this.lineHeight}px`:"",u=`${this.fontStyle} ${this.fontWeight} ${i.size}px${A} ${this.fontFamily}`,h=this.if.add({position:t.position,text:n,font:u,horizontalOrigin:r.HorizontalOrigin.LEFT,verticalOrigin:r.VerticalOrigin.TOP,fillColor:r.Color.fromCssColorString(i.fill),style:r.LabelStyle.FILL_AND_OUTLINE,disableDepthTestDistance:this.disableDepthTestDistance,outlineColor:r.Color.fromCssColorString(i.haloFill),outlineWidth:i.haloRadius,pixelOffset:a});h.roadDirection=new r.Cartesian4(t.end.x-t.position.x,t.end.y-t.position.y,t.end.z-t.position.z,1),this.af[t.id]={label:h}}else if("guideboard"===o){const n=t.name,o=this.iconSize*i.transform[0],s=this.iconSize*i.transform[1],a=this.getIconUrl(i.file),A=this.rf.add({position:t.position,image:a,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.CENTER,width:o,height:s,disableDepthTestDistance:this.disableDepthTestDistance}),u={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${i.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:i.size/e.SDFSettings.FONT_SIZE,relativeSize:i.size/e.SDFSettings.FONT_SIZE},h=this._labels.computeLabelSize(u),l=new e.Cartesian2(-h.width/2,-h.height/2),c=this.lineHeight?`/${this.lineHeight}px`:"",f=`${this.fontStyle} ${this.fontWeight} ${i.size}px${c} ${this.fontFamily}`,d=this.if.add({position:t.position,text:n,font:f,horizontalOrigin:r.HorizontalOrigin.LEFT,verticalOrigin:r.VerticalOrigin.TOP,fillColor:r.Color.fromCssColorString(i.fill),style:r.LabelStyle.FILL_AND_OUTLINE,disableDepthTestDistance:this.disableDepthTestDistance,outlineColor:r.Color.fromCssColorString(i.haloFill),outlineWidth:i.haloRadius,pixelOffset:l});this.af[t.id]={icon:A,label:d}}}getIconUrl(t){return"https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/static/3dgs/cesiumjs-sdk"+t.substring(1)}debugShowOrigin(t){this.Bn.entities.add({position:t,point:{pixelSize:1,color:r.Color.RED,outlineColor:r.Color.WHITE,outlineWidth:1}})}computeScreenSpaceSize(t){const n=this.Bn.scene,i=r.SceneTransforms.worldToWindowCoordinates(n,t.position);if(!i)return;const o=`${Math.min(Math.floor(this.getZoom()),20)}:${t.styleId}`,s=this.styles[o];if(s){if(0===s.layout){const t=this.iconSize*s.transform[0],e=this.iconSize*s.transform[1];return new r.BoundingRectangle(i.x-t/2,i.y-e/2,t,e)}if(1===s.layout){const n={text:t.name,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${s.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:s.size/e.SDFSettings.FONT_SIZE,relativeSize:s.size/e.SDFSettings.FONT_SIZE},o=this._labels.computeLabelSize(n);return new r.BoundingRectangle(i.x-o.width/2,i.y-o.height/2,o.width,o.height)}if(2===s.layout){const n=t.name,o=this.iconSize*s.transform[0],a=this.iconSize*s.transform[1],A={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${s.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:s.size/e.SDFSettings.FONT_SIZE,relativeSize:s.size/e.SDFSettings.FONT_SIZE},u=this._labels.computeLabelSize(A),h=Math.max(o,u.width),l=Math.max(a,u.height);return new r.BoundingRectangle(i.x-h/2,i.y-l/2,h,l)}if(3===s.layout){const n=t.name,o=this.iconSize*s.transform[0],a=this.iconSize*s.transform[1],A={text:n,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${s.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:s.size/e.SDFSettings.FONT_SIZE,relativeSize:s.size/e.SDFSettings.FONT_SIZE},u=this._labels.computeLabelSize(A),h=Math.max(a,u.height);return new r.BoundingRectangle(i.x-o/2,i.y-h/2+s.shieldDy,o+u.width+this.iconTextSpacing,h)}}}computeScreenSpaceSizeRoad(t){const n=this.Bn.scene,i=`${Math.min(Math.floor(this.getZoom()),20)}:${t.styleId}`,o=this.styles[i];if(o){if("guideboard"===t.subType){const i=r.SceneTransforms.worldToWindowCoordinates(n,t.position);if(!i)return;const s=t.name,a=this.iconSize*o.transform[0],A=this.iconSize*o.transform[1],u={text:s,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${o.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:o.size/e.SDFSettings.FONT_SIZE,relativeSize:o.size/e.SDFSettings.FONT_SIZE},h=this._labels.computeLabelSize(u),l=Math.max(a,h.width),c=Math.max(A,h.height);return new r.BoundingRectangle(i.x-l/2,i.y-c/2,l,c)}if("roadname"===t.subType){const i=r.SceneTransforms.worldToWindowCoordinates(n,t.position),s=r.SceneTransforms.worldToWindowCoordinates(n,t.end);if(!i||!s)return;t.screenPos=i,t.endScreenPos=s;const a=r.Cartesian2.subtract(s,i,new r.Cartesian2);a.y*=-1;const A=r.Cartesian2.normalize(a,new r.Cartesian2),u=new r.Cartesian2(1,0),h=r.Cartesian2.dot(u,A),l=(r.Cartesian2.cross(u,A)>0?1:-1)*Math.acos(h),c={text:t.name,fontStyle:this.fontStyle,fontWeight:this.fontWeight,fontSize:`${o.size}`,fontFamily:this.fontFamily,verticalOrigin:e.VerticalOrigin.TOP,totalScale:o.size/e.SDFSettings.FONT_SIZE,relativeSize:o.size/e.SDFSettings.FONT_SIZE},f=this._labels.computeLabelSize(c),d=[-f.width/2,f.height/2],g=[f.width/2,f.height/2],v=[-f.width/2,-f.height/2],I=[f.width/2,-f.height/2],p=Math.cos(l),y=Math.sin(l),w=[p*d[0]-y*d[1],y*d[0]+p*d[1]],C=[p*g[0]-y*g[1],y*g[0]+p*g[1]],B=[p*v[0]-y*v[1],y*v[0]+p*v[1]],E=[p*I[0]-y*I[1],y*I[0]+p*I[1]];return r.BoundingRectangle.fromPoints([new r.Cartesian2(i.x+w[0],i.y-w[1]),new r.Cartesian2(i.x+C[0],i.y-C[1]),new r.Cartesian2(i.x+B[0],i.y-B[1]),new r.Cartesian2(i.x+E[0],i.y-E[1])])}}}computePoiToRender(t){const e=this.getZoom();this.Af.clear();const n=new r.BoundingRectangle;n.x=0,n.y=0,n.width=this._scene.canvas.clientWidth,n.height=this._scene.canvas.clientHeight;const i=[];for(let o=0;o<t.length;o++){const s=t[o],a=20===s.maxzoom?999:s.maxzoom;if(e<s.minzoom||e>a)continue;const A=this.computeScreenSpaceSize(s);if(!A)continue;const{x:u,y:h,width:l,height:c}=A;if(n.intersect(A)===r.Intersect.OUTSIDE)continue;const f={minX:u-this.collisionBuffer.x,minY:h-this.collisionBuffer.y,maxX:u+l+this.collisionBuffer.x,maxY:h+c+this.collisionBuffer.y};this.Af.collides(f)||(this.Af.insert(f),i.push(s))}return i}computeItemsToRender(t,e){const n=this.getZoom();this.Af.clear();const i=new r.BoundingRectangle;i.x=0,i.y=0,i.width=this._scene.canvas.clientWidth,i.height=this._scene.canvas.clientHeight;const o=[];for(let t=0;t<e.length;t++){const s=e[t],a=20===s.maxzoom?999:s.maxzoom;if(n<s.minzoom||n>a)continue;const A=this.computeScreenSpaceSizeRoad(s);if(!A)continue;const{x:u,y:h,width:l,height:c}=A;if(i.intersect(A)===r.Intersect.OUTSIDE)continue;const f={minX:u-this.collisionBuffer.x,minY:h-this.collisionBuffer.y,maxX:u+l+this.collisionBuffer.x,maxY:h+c+this.collisionBuffer.y,data:s};this.Af.collides(f)||(this.Af.insert(f),o.push(s),s.bbox=A)}const s=[];for(let e=0;e<t.length;e++){const o=t[e],a=20===o.maxzoom?999:o.maxzoom;if(n<o.minzoom||n>a)continue;const A=this.computeScreenSpaceSize(o);if(!A)continue;const{x:u,y:h,width:l,height:c}=A;if(i.intersect(A)===r.Intersect.OUTSIDE)continue;const f={minX:u-this.collisionBuffer.x,minY:h-this.collisionBuffer.y,maxX:u+l+this.collisionBuffer.x,maxY:h+c+this.collisionBuffer.y,data:o};if(!o.external){if(this.Af.collides(f))continue;this.Af.insert(f)}s.push(o),o.bbox=A}return{pois:s,roads:o}}diff(t,e){const n=e.reduce(((t,e)=>(t[e.id]=e,t)),{}),i=Object.keys(t),r=[],o=[];for(let t=0;t<i.length;t++)n[i[t]]||r.push(i[t]);for(let n=0;n<e.length;n++)t[e[n].id]||o.push(e[n]);return{add:o,remove:r}}getZoom(){const t=this._scene.camera.position,e=r.Ellipsoid.WGS84.cartesianToCartographic(t).height;return Math.log2(169066473.75/e)}updateRoads(t,e){const{add:n,remove:i}=this.diff(t,e);for(let t=0;t<i.length;t++){const e=i[t],{label:n,icon:r}=this.af[e];n&&this.if.remove(n),r&&this.rf.remove(r),delete this.af[e]}for(let t=0;t<n.length;t++){const e=n[t];this.addRoad(e)}}updatePois(t,e){const{add:n,remove:i}=this.diff(t,e);for(let t=0;t<i.length;t++){const e=i[t];if(this.sf[e]){const{icon:t,label:n}=this.sf[e];t&&this.nf.remove(t),n&&this._labels.remove(n),delete this.sf[e]}}for(let t=0;t<n.length;t++){const e=n[t];this.addPoi(e)}}If(){const t=document.createElement("style");t.id="AlibabaPuHuiTi",t.innerHTML='\n      @font-face {\n        font-family: "AlibabaPuHuiTi";\n        src: url("https://amappc.oss-cn-zhangjiakou.aliyuncs.com/gis/static/3dgs/cesiumjs-sdk/AlibabaPuHuiTi-2-55-Regular/AlibabaPuHuiTi-2-55-Regular.woff2")\n          format("woff2");\n        font-weight: normal;\n        font-style: normal;\n      }\n    ',document.head.appendChild(t),new AI("AlibabaPuHuiTi").load(null,this.lf).then((()=>{this.cf=!0,this.requestRender()}))}async pf(){try{const t=await fetch(this.styleUrl),e=await t.json();this.styles=e}catch(t){}}pick(t){const e={minX:t.x,minY:t.y,maxX:t.x+1,maxY:t.y+1},n=this.Af.search(e)[0];if("poi"===n?.data?.type)return n.data.poiid}setExtraPois(t){this.hf=t,this._dirty=!0,this.requestRender()}yf=null;requestRender=()=>{clearTimeout(this.yf);const t=Date.now()-this.df;t>this.ff?this.Bn.scene.requestRender():this.yf=setTimeout((()=>{this.Bn.scene.requestRender()}),this.ff-t+1)}}var hI,lI={exports:{}},cI=(hI||(hI=1,function(t,e){!function(t){function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t){if(Array.isArray(t))return t}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){return n(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}}(t,e)||r(t,e)||o()}function a(t,e,n,i,r,o,s){try{var a=t[o](s),A=a.value}catch(t){return void n(t)}a.done?e(A):Promise.resolve(A).then(i,r)}function A(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){a(o,i,r,s,A,"next",t)}function A(t){a(o,i,r,s,A,"throw",t)}s(void 0)}))}}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t,e){if(e&&("object"===f(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function I(t,e,n){return I=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&l(r,n.prototype),r},I.apply(null,arguments)}function p(t){var e="function"==typeof Map?new Map:void 0;return p=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return I(t,arguments,v(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),l(i,t)},p(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var w={exports:{}};!function(t){var e=function(t){var e,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function A(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{A({},"")}catch(t){A=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var r=e&&e.prototype instanceof I?e:I,o=Object.create(r.prototype),s=new x(i||[]);return o.wf=function(t,e,n){var i=l;return function(r,o){if(i===d)throw new Error("Generator is already running");if(i===g){if("throw"===r)throw o;return S()}for(n.method=r,n.arg=o;;){var s=n.delegate;if(s){var a=k(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n.Cf=n.arg;else if("throw"===n.method){if(i===l)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var A=h(t,e,n);if("normal"===A.type){if(i=n.done?g:c,A.arg===v)continue;return{value:A.arg,done:n.done}}"throw"===A.type&&(i=g,n.method="throw",n.arg=A.arg)}}}(t,n,s),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l="suspendedStart",c="suspendedYield",d="executing",g="completed",v={};function I(){}function p(){}function y(){}var w={};A(w,o,(function(){return this}));var C=Object.getPrototypeOf,B=C&&C(C(D([])));B&&B!==n&&i.call(B,o)&&(w=B);var E=y.prototype=I.prototype=Object.create(w);function m(t){["next","throw","return"].forEach((function(e){A(t,e,(function(t){return this.wf(e,t)}))}))}function Q(t,e){function n(r,o,s,a){var A=h(t[r],t,o);if("throw"!==A.type){var u=A.arg,l=u.value;return l&&"object"===f(l)&&i.call(l,"__await")?e.resolve(l.Bf).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(l).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(A.arg)}var r;this.wf=function(t,i){function o(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(o,o):o()}}function k(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var r=h(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function D(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:S}}function S(){return{value:e,done:!0}}return p.prototype=y,A(E,"constructor",y),A(y,"constructor",p),p.displayName=A(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,A(t,a,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{Bf:t}},m(Q.prototype),A(Q.prototype,s,(function(){return this})),t.AsyncIterator=Q,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var s=new Q(u(e,n,i,r),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},m(E),A(E,a,"Generator"),A(E,o,(function(){return this})),A(E,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=D,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Cf=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return a.type="throw",a.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var A=i.call(s,"catchLoc"),u=i.call(s,"finallyLoc");if(A&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(A){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;_(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:D(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":f(globalThis))?globalThis.regeneratorRuntime=e:Function("n","regeneratorRuntime=n")(e)}}(w);var C=w.exports;function B(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function E(t){return function(t){if(Array.isArray(t))return i(t)}(t)||B(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}for(var m=new ArrayBuffer(4),Q=new Float32Array(m),k=new Uint32Array(m),b=new Uint32Array(512),_=new Uint32Array(512),x=0;x<256;++x){var D=x-127;D<-27?(b[x]=0,b[256|x]=32768,_[x]=24,_[256|x]=24):D<-14?(b[x]=1024>>-D-14,b[256|x]=1024>>-D-14|32768,_[x]=-D-1,_[256|x]=-D-1):D<=15?(b[x]=D+15<<10,b[256|x]=D+15<<10|32768,_[x]=13,_[256|x]=13):D<128?(b[x]=31744,b[256|x]=64512,_[x]=24,_[256|x]=24):(b[x]=31744,b[256|x]=64512,_[x]=13,_[256|x]=13)}var S=new Uint32Array(2048),M=new Uint32Array(64),$=new Uint32Array(64);S[0]=0;for(var R=1;R<1024;++R){for(var F=R<<13,G=0;!(8388608&F);)G-=8388608,F<<=1;F&=-8388609,G+=947912704,S[R]=F|G}for(var L=1024;L<2048;++L)S[L]=939524096+(L-1024<<13);M[0]=0;for(var N=1;N<31;++N)M[N]=N<<23;M[31]=1199570944,M[32]=2147483648;for(var U=33;U<63;++U)M[U]=2147483648+(U-32<<23);M[63]=3347054592,$[0]=0;for(var T=1;T<64;++T)$[T]=32===T?0:1024;var P=Reflect.getPrototypeOf(Uint8Array).prototype,q=Reflect.getOwnPropertyDescriptor(P,Symbol.toStringTag).get,O={}.toString;function H(t,e){if(!function(t){return!!ArrayBuffer.isView(t)&&!function(t){return void 0!==q.call(t)}(t)&&"[object DataView]"===O.call(t)}(t))throw new TypeError("First argument to getFloat16 function must be a DataView");for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return function(t){var e=t>>10;return k[0]=S[$[e]+(1023&t)]+M[e],Q[0]}(t.getUint16.apply(t,[e].concat(i)))}var z=function(t,e,n){var i="object"===f(t)?t.outer:t,r="".concat(e,'\\="([^"]*)"'),o=new RegExp(r).exec(i);if(o)return o[1]},K=function(t,e,n){var i=new RegExp(e).exec(t.slice(n));return i?n+i.index:-1},V=function(t,e,n){n&&n.debug;var i=n&&n.startIndex||0,r=K(t,"<".concat(e,"[ >]"),i);if(-1!==r){var o=t.slice(r+e.length),s=K(o,"[ /]"+e+">",0),a=-1===s;a&&(s=K(o,"[ /]>",0));var A=r+e.length+s+1+(a?0:e.length)+1;if(-1!==A){var u=t.slice(r,A);return{inner:a?null:u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),outer:u,start:r,end:A}}}},J={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Y={};for(var j in J)J.hasOwnProperty(j)&&(Y[J[j]]=parseInt(j,10));var W={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",297:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",3072:"SHORT",3073:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34264:"DOUBLE",34665:"LONG",34735:"SHORT",34736:"DOUBLE",34737:"ASCII",42113:"ASCII"},X=[Y.BitsPerSample,Y.ExtraSamples,Y.SampleFormat,Y.StripByteCounts,Y.StripOffsets,Y.StripRowCounts,Y.TileByteCounts,Y.TileOffsets,Y.SubIFDs],Z={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},tt={};for(var et in Z)Z.hasOwnProperty(et)&&(tt[Z[et]]=parseInt(et,10));var nt={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},it={Unspecified:0,Assocalpha:1,Unassalpha:2},rt={Version:0,AddCompression:1},ot={None:0,Deflate:1,Zstandard:2},st={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},at={};for(var At in st)st.hasOwnProperty(At)&&(at[st[At]]=parseInt(At,10));var ut=Object.freeze({__proto__:null,fieldTagNames:J,fieldTags:Y,fieldTagTypes:W,arrayFields:X,fieldTypeNames:Z,fieldTypes:tt,photometricInterpretations:nt,ExtraSamplesValues:it,LercParameters:rt,LercAddCompression:ot,geoKeyNames:st,geoKeys:at});function ht(t,e){for(var n,i=t.width,r=t.height,o=new Uint8Array(i*r*3),s=0,a=0;s<t.length;++s,a+=3)n=256-t[s]/e*256,o[a]=n,o[a+1]=n,o[a+2]=n;return o}function lt(t,e){for(var n,i=t.width,r=t.height,o=new Uint8Array(i*r*3),s=0,a=0;s<t.length;++s,a+=3)n=t[s]/e*256,o[a]=n,o[a+1]=n,o[a+2]=n;return o}function ct(t,e){for(var n=t.width,i=t.height,r=new Uint8Array(n*i*3),o=e.length/3,s=e.length/3*2,a=0,A=0;a<t.length;++a,A+=3){var u=t[a];r[A]=e[u]/65536*256,r[A+1]=e[u+o]/65536*256,r[A+2]=e[u+s]/65536*256}return r}function ft(t){for(var e=t.width,n=t.height,i=new Uint8Array(e*n*3),r=0,o=0;r<t.length;r+=4,o+=3){var s=t[r],a=t[r+1],A=t[r+2],u=t[r+3];i[o]=(255-s)/256*255*((255-u)/256),i[o+1]=(255-a)/256*255*((255-u)/256),i[o+2]=(255-A)/256*255*((255-u)/256)}return i}function dt(t){for(var e=t.width,n=t.height,i=new Uint8ClampedArray(e*n*3),r=0,o=0;r<t.length;r+=3,o+=3){var s=t[r],a=t[r+1],A=t[r+2];i[o]=s+1.402*(A-128),i[o+1]=s-.34414*(a-128)-.71414*(A-128),i[o+2]=s+1.772*(a-128)}return i}function gt(t){for(var e=t.width,n=t.height,i=new Uint8Array(e*n*3),r=0,o=0;r<t.length;r+=3,o+=3){var s=(t[r+0]+16)/116,a=(t[r+1]<<24>>24)/500+s,A=s-(t[r+2]<<24>>24)/200,u=void 0,h=void 0,l=void 0;h=-.9689*(a=.95047*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+1.8758*(s=1*(s*s*s>.008856?s*s*s:(s-16/116)/7.787))+.0415*(A=1.08883*(A*A*A>.008856?A*A*A:(A-16/116)/7.787)),l=.0557*a+-.204*s+1.057*A,u=(u=3.2406*a+-1.5372*s+-.4986*A)>.0031308?1.055*Math.pow(u,1/2.4)-.055:12.92*u,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:12.92*h,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,i[o]=255*Math.max(0,Math.min(1,u)),i[o+1]=255*Math.max(0,Math.min(1,h)),i[o+2]=255*Math.max(0,Math.min(1,l))}return i}var vt=Object.freeze({__proto__:null,fromWhiteIsZero:ht,fromBlackIsZero:lt,fromPalette:ct,fromCMYK:ft,fromYCbCr:dt,fromCIELab:gt}),It=new Map;function pt(t,e){Array.isArray(t)||(t=[t]),t.forEach((function(t){return It.set(t,e)}))}function yt(t){return wt.apply(this,arguments)}function wt(){return(wt=A(C.mark((function t(e){var n,i;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=It.get(e.Compression)){t.next=3;break}throw new Error("Unknown compression method identifier: ".concat(e.Compression));case 3:return t.next=5,n();case 5:return i=t.sent,t.abrupt("return",new i(e));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ct(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new(Object.getPrototypeOf(t).constructor)(e*n*i)}function Bt(t,e,n){return(1-n)*t+n*e}function Et(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"nearest";switch(o.toLowerCase()){case"nearest":return function(t,e,n,i,r){var o=e/i,s=n/r;return t.map((function(t){for(var a=Ct(t,i,r),A=0;A<r;++A)for(var u=Math.min(Math.round(s*A),n-1),h=0;h<i;++h){var l=Math.min(Math.round(o*h),e-1),c=t[u*e+l];a[A*i+h]=c}return a}))}(t,e,n,i,r);case"bilinear":case"linear":return function(t,e,n,i,r){var o=e/i,s=n/r;return t.map((function(t){for(var a=Ct(t,i,r),A=0;A<r;++A)for(var u=s*A,h=Math.floor(u),l=Math.min(Math.ceil(u),n-1),c=0;c<i;++c){var f=o*c,d=f%1,g=Math.floor(f),v=Math.min(Math.ceil(f),e-1),I=t[h*e+g],p=t[h*e+v],y=t[l*e+g],w=t[l*e+v],C=Bt(Bt(I,p,d),Bt(y,w,d),u%1);a[A*i+c]=C}return a}))}(t,e,n,i,r);default:throw new Error("Unsupported resampling method: '".concat(o,"'"))}}function mt(t,e,n,i,r,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"nearest";switch(s.toLowerCase()){case"nearest":return function(t,e,n,i,r,o){for(var s=e/i,a=n/r,A=Ct(t,i,r,o),u=0;u<r;++u)for(var h=Math.min(Math.round(a*u),n-1),l=0;l<i;++l)for(var c=Math.min(Math.round(s*l),e-1),f=0;f<o;++f){var d=t[h*e*o+c*o+f];A[u*i*o+l*o+f]=d}return A}(t,e,n,i,r,o);case"bilinear":case"linear":return function(t,e,n,i,r,o){for(var s=e/i,a=n/r,A=Ct(t,i,r,o),u=0;u<r;++u)for(var h=a*u,l=Math.floor(h),c=Math.min(Math.ceil(h),n-1),f=0;f<i;++f)for(var d=s*f,g=d%1,v=Math.floor(d),I=Math.min(Math.ceil(d),e-1),p=0;p<o;++p){var y=t[l*e*o+v*o+p],w=t[l*e*o+I*o+p],C=t[c*e*o+v*o+p],B=t[c*e*o+I*o+p],E=Bt(Bt(y,w,g),Bt(C,B,g),h%1);A[u*i*o+f*o+p]=E}return A}(t,e,n,i,r,o);default:throw new Error("Unsupported resampling method: '".concat(s,"'"))}}function Qt(t,e,n){for(var i=0,r=e;r<n;++r)i+=t[r];return i}function kt(t,e,n){switch(t){case 1:if(e<=8)return new Uint8Array(n);if(e<=16)return new Uint16Array(n);if(e<=32)return new Uint32Array(n);break;case 2:if(8===e)return new Int8Array(n);if(16===e)return new Int16Array(n);if(32===e)return new Int32Array(n);break;case 3:switch(e){case 16:case 32:return new Float32Array(n);case 64:return new Float64Array(n)}}throw Error("Unsupported data format/bitsPerSample")}function bt(t,e){return(1!==t&&2!==t||!(e<=32)||e%8!=0)&&(3!==t||16!==e&&32!==e&&64!==e)}function _t(t,e,n,i,r,o,s){var a=new DataView(t),A=2===n?1:i,u=kt(e,r,2===n?s*o:s*o*i),h=parseInt("1".repeat(r),2);if(1===e){var l=o*(1===n?i*r:r);7&l&&(l=l+7&-8);for(var c=0;c<s;++c)for(var f=c*l,d=0;d<o;++d)for(var g=f+d*A*r,v=0;v<A;++v){var I=g+v*r,p=(c*o+d)*A+v,y=Math.floor(I/8),w=I%8;if(w+r<=8)u[p]=a.getUint8(y)>>8-r-w&h;else if(w+r<=16)u[p]=a.getUint16(y)>>16-r-w&h;else if(w+r<=24){var C=a.getUint16(y)<<8|a.getUint8(y+2);u[p]=C>>24-r-w&h}else u[p]=a.getUint32(y)>>32-r-w&h}}return u.buffer}pt([void 0,1],(function(){return Promise.resolve().then((function(){return wn})).then((function(t){return t.default}))})),pt(5,(function(){return Promise.resolve().then((function(){return En})).then((function(t){return t.default}))})),pt(6,(function(){throw new Error("old style JPEG compression is not supported.")})),pt(7,(function(){return Promise.resolve().then((function(){return Nn})).then((function(t){return t.default}))})),pt([8,32946],(function(){return Promise.resolve().then((function(){return er})).then((function(t){return t.default}))})),pt(32773,(function(){return Promise.resolve().then((function(){return ir})).then((function(t){return t.default}))})),pt(34887,(function(){return Promise.resolve().then((function(){return dr})).then(function(){var t=A(C.mark((function t(e){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.zstd.init();case 2:return t.abrupt("return",e);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(t){return t.default}))})),pt(50001,(function(){return Promise.resolve().then((function(){return vr})).then((function(t){return t.default}))}));var xt=function(){function t(e,n,i,r,o,s){y(this,t),this.fileDirectory=e,this.geoKeys=n,this.dataView=i,this.littleEndian=r,this.tiles=o?{}:null,this.isTiled=!e.StripOffsets;var a=e.PlanarConfiguration;if(this.planarConfiguration=void 0===a?1:a,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=s}var e,n,i,r;return h(t,[{key:"getFileDirectory",value:function(){return this.fileDirectory}},{key:"getGeoKeys",value:function(){return this.geoKeys}},{key:"getWidth",value:function(){return this.fileDirectory.ImageWidth}},{key:"getHeight",value:function(){return this.fileDirectory.ImageLength}},{key:"getSamplesPerPixel",value:function(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}},{key:"getTileWidth",value:function(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}},{key:"getTileHeight",value:function(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}},{key:"getBlockWidth",value:function(){return this.getTileWidth()}},{key:"getBlockHeight",value:function(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}},{key:"getBytesPerPixel",value:function(){for(var t=0,e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}},{key:"getSampleByteSize",value:function(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError("Sample index ".concat(t," is out of range."));return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}},{key:"getReaderForSample",value:function(t){var e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(t,e){return H(this,t,e)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}},{key:"getSampleFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}},{key:"getBitsPerSample",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.fileDirectory.BitsPerSample[t]}},{key:"getArrayForSample",value:function(t,e){return kt(this.getSampleFormat(t),this.getBitsPerSample(t),e)}},{key:"getTileOrStrip",value:(r=A(C.mark((function t(e,n,i,r,o){var s,a,u,h,l,c,f,d,g=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight()),h=this.tiles,1===this.planarConfiguration?u=n*s+e:2===this.planarConfiguration&&(u=i*s*a+n*s+e),this.isTiled?(l=this.fileDirectory.TileOffsets[u],c=this.fileDirectory.TileByteCounts[u]):(l=this.fileDirectory.StripOffsets[u],c=this.fileDirectory.StripByteCounts[u]),t.next=7,this.source.fetch([{offset:l,length:c}],o);case 7:return f=t.sent[0],null!==h&&h[u]?d=h[u]:(d=A(C.mark((function t(){var e,i,o;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.decode(g.fileDirectory,f);case 2:return e=t.sent,i=g.getSampleFormat(),o=g.getBitsPerSample(),bt(i,o)&&(e=_t(e,i,g.planarConfiguration,g.getSamplesPerPixel(),o,g.getTileWidth(),g.getBlockHeight(n))),t.abrupt("return",e);case 7:case"end":return t.stop()}}),t)})))(),null!==h&&(h[u]=d)),t.t0=e,t.t1=n,t.t2=i,t.next=14,d;case 14:return t.t3=t.sent,t.abrupt("return",{x:t.t0,y:t.t1,sample:t.t2,data:t.t3});case 16:case"end":return t.stop()}}),t,this)}))),function(t,e,n,i,o){return r.apply(this,arguments)})},{key:"_readRaster",value:(i=A(C.mark((function t(e,n,i,r,o,s,a,A,u){var h,l,c,f,d,g,v,I,p,y,w,B,E,m,Q,k,b,_,x,D,S,M=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(h=this.getTileWidth(),l=this.getTileHeight(),c=this.getWidth(),f=this.getHeight(),d=Math.max(Math.floor(e[0]/h),0),g=Math.min(Math.ceil(e[2]/h),Math.ceil(c/h)),v=Math.max(Math.floor(e[1]/l),0),I=Math.min(Math.ceil(e[3]/l),Math.ceil(f/l)),p=e[2]-e[0],y=this.getBytesPerPixel(),w=[],B=[],E=0;E<n.length;++E)1===this.planarConfiguration?w.push(Qt(this.fileDirectory.BitsPerSample,0,n[E])/8):w.push(0),B.push(this.getReaderForSample(n[E]));for(m=[],Q=this.littleEndian,k=v;k<I;++k)for(b=d;b<g;++b)for(_=void 0,1===this.planarConfiguration&&(_=this.getTileOrStrip(b,k,0,o,u)),x=function(t){var s=t,a=n[t];2===M.planarConfiguration&&(y=M.getSampleByteSize(a),_=M.getTileOrStrip(b,k,a,o,u));var A=_.then((function(t){for(var o=t.data,a=new DataView(o),A=M.getBlockHeight(t.y),u=t.y*l,d=t.x*h,g=u+A,v=(t.x+1)*h,I=B[s],C=Math.min(A,A-(g-e[3]),f-u),E=Math.min(h,h-(v-e[2]),c-d),m=Math.max(0,e[1]-u);m<C;++m)for(var k=Math.max(0,e[0]-d);k<E;++k){var b=(m*h+k)*y,_=I.call(a,b+w[s],Q),x=void 0;r?(x=(m+u-e[1])*p*n.length+(k+d-e[0])*n.length+s,i[x]=_):(x=(m+u-e[1])*p+k+d-e[0],i[s][x]=_)}}));m.push(A)},D=0;D<n.length;++D)x(D);return t.next=18,Promise.all(m);case 18:if(!(s&&e[2]-e[0]!==s||a&&e[3]-e[1]!==a)){t.next=23;break}return(S=r?mt(i,e[2]-e[0],e[3]-e[1],s,a,n.length,A):Et(i,e[2]-e[0],e[3]-e[1],s,a,A)).width=s,S.height=a,t.abrupt("return",S);case 23:return i.width=s||e[2]-e[0],i.height=a||e[3]-e[1],t.abrupt("return",i);case 26:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r,o,s,a,A,u){return i.apply(this,arguments)})},{key:"readRasters",value:(n=A(C.mark((function t(){var e,n,i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,B,E,m,Q,k,b,_=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(e=_.length>0&&void 0!==_[0]?_[0]:{}).window,i=e.samples,r=void 0===i?[]:i,o=e.interleave,s=e.pool,a=void 0===s?null:s,A=e.width,u=e.height,h=e.resampleMethod,l=e.fillValue,c=e.signal,!((f=n||[0,0,this.getWidth(),this.getHeight()])[0]>f[2]||f[1]>f[3])){t.next=4;break}throw new Error("Invalid subsets");case 4:if(d=f[2]-f[0],g=f[3]-f[1],v=d*g,I=this.getSamplesPerPixel(),r&&r.length){t.next=12;break}for(p=0;p<I;++p)r.push(p);t.next=19;break;case 12:y=0;case 13:if(!(y<r.length)){t.next=19;break}if(!(r[y]>=I)){t.next=16;break}return t.abrupt("return",Promise.reject(new RangeError("Invalid sample index '".concat(r[y],"'."))));case 16:++y,t.next=13;break;case 19:if(o)B=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample),w=kt(B,E,v*r.length),l&&w.fill(l);else for(w=[],m=0;m<r.length;++m)Q=this.getArrayForSample(r[m],v),Array.isArray(l)&&m<l.length?Q.fill(l[m]):l&&!Array.isArray(l)&&Q.fill(l),w.push(Q);if(t.t0=a,t.t0){t.next=25;break}return t.next=24,yt(this.fileDirectory);case 24:t.t0=t.sent;case 25:return k=t.t0,t.next=28,this.Ef(f,r,w,o,k,A,u,h,c);case 28:return b=t.sent,t.abrupt("return",b);case 30:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"readRGB",value:(e=A(C.mark((function t(){var e,n,i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,B,E,m,Q,k,b,_,x=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(e=x.length>0&&void 0!==x[0]?x[0]:{}).window,i=e.interleave,r=void 0===i||i,o=e.pool,s=void 0===o?null:o,a=e.width,A=e.height,u=e.resampleMethod,h=e.enableAlpha,l=void 0!==h&&h,c=e.signal,!((f=n||[0,0,this.getWidth(),this.getHeight()])[0]>f[2]||f[1]>f[3])){t.next=4;break}throw new Error("Invalid subsets");case 4:if((d=this.fileDirectory.PhotometricInterpretation)!==nt.RGB){t.next=9;break}if(g=[0,1,2],this.fileDirectory.ExtraSamples!==it.Unspecified&&l)for(g=[],v=0;v<this.fileDirectory.BitsPerSample.length;v+=1)g.push(v);return t.abrupt("return",this.readRasters({window:n,interleave:r,samples:g,pool:s,width:a,height:A,resampleMethod:u,signal:c}));case 9:t.t0=d,t.next=t.t0===nt.WhiteIsZero||t.t0===nt.BlackIsZero||t.t0===nt.Palette?12:t.t0===nt.CMYK?14:t.t0===nt.YCbCr||t.t0===nt.CIELab?16:18;break;case 12:return I=[0],t.abrupt("break",19);case 14:return I=[0,1,2,3],t.abrupt("break",19);case 16:return I=[0,1,2],t.abrupt("break",19);case 18:throw new Error("Invalid or unsupported photometric interpretation.");case 19:return p={window:f,interleave:!0,samples:I,pool:s,width:a,height:A,resampleMethod:u,signal:c},y=this.fileDirectory,t.next=23,this.readRasters(p);case 23:w=t.sent,B=Math.pow(2,this.fileDirectory.BitsPerSample[0]),t.t1=d,t.next=t.t1===nt.WhiteIsZero?28:t.t1===nt.BlackIsZero?30:t.t1===nt.Palette?32:t.t1===nt.CMYK?34:t.t1===nt.YCbCr?36:t.t1===nt.CIELab?38:40;break;case 28:return E=ht(w,B),t.abrupt("break",41);case 30:return E=lt(w,B),t.abrupt("break",41);case 32:return E=ct(w,y.ColorMap),t.abrupt("break",41);case 34:return E=ft(w),t.abrupt("break",41);case 36:return E=dt(w),t.abrupt("break",41);case 38:return E=gt(w),t.abrupt("break",41);case 40:throw new Error("Unsupported photometric interpretation.");case 41:if(!r){for(m=new Uint8Array(E.length/3),Q=new Uint8Array(E.length/3),k=new Uint8Array(E.length/3),b=0,_=0;b<E.length;b+=3,++_)m[_]=E[b],Q[_]=E[b+1],k[_]=E[b+2];E=[m,Q,k]}return E.width=w.width,E.height=w.height,t.abrupt("return",E);case 45:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getTiePoints",value:function(){if(!this.fileDirectory.ModelTiepoint)return[];for(var t=[],e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}},{key:"getGDALMetadata",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={};if(!this.fileDirectory.GDAL_METADATA)return null;var n=function(t,e,n){for(var i,r=[],o=0;i=V(t,"Item",{debug:!1,startIndex:o});)o=i.end,r.push(i);return r}(this.fileDirectory.GDAL_METADATA);n=null===t?n.filter((function(t){return void 0===z(t,"sample")})):n.filter((function(e){return Number(z(e,"sample"))===t}));for(var i=0;i<n.length;++i){var r=n[i];e[z(r,"name")]=r.inner}return e}},{key:"getGDALNoData",value:function(){if(!this.fileDirectory.GDAL_NODATA)return null;var t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}},{key:"getOrigin",value:function(){var t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&6===t.length)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}},{key:"getResolution",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return 0===n[1]&&0===n[4]?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(t){var i=s(t.getResolution(),3),r=i[0],o=i[1],a=i[2];return[r*t.getWidth()/this.getWidth(),o*t.getHeight()/this.getHeight(),a*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}},{key:"pixelIsArea",value:function(){return 1===this.geoKeys.GTRasterTypeGeoKey}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!t){var i=s(this.fileDirectory.ModelTransformation,8),r=i[0],o=i[1];i[2];var a=i[3],A=i[4],u=i[5];i[6];var h=i[7],l=[[0,0],[0,e],[n,0],[n,e]].map((function(t){var e=s(t,2),n=e[0],i=e[1];return[a+r*n+o*i,h+A*n+u*i]})),c=l.map((function(t){return t[0]})),f=l.map((function(t){return t[1]}));return[Math.min.apply(Math,E(c)),Math.min.apply(Math,E(f)),Math.max.apply(Math,E(c)),Math.max.apply(Math,E(f))]}var d=this.getOrigin(),g=this.getResolution(),v=d[0],I=d[1],p=v+g[0]*n,y=I+g[1]*e;return[Math.min(v,p),Math.min(I,y),Math.max(v,p),Math.max(I,y)]}}]),t}(),Dt=xt,St=function(){function t(e){y(this,t),this.mf=new DataView(e)}return h(t,[{key:"buffer",get:function(){return this.mf.buffer}},{key:"getUint64",value:function(t,e){var n,i=this.getUint32(t,e),r=this.getUint32(t+4,e);if(e){if(n=i+Math.pow(2,32)*r,!Number.isSafeInteger(n))throw new Error("".concat(n," exceeds MAX_SAFE_INTEGER. ")+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return n}if(n=Math.pow(2,32)*i+r,!Number.isSafeInteger(n))throw new Error("".concat(n," exceeds MAX_SAFE_INTEGER. ")+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return n}},{key:"getInt64",value:function(t,e){for(var n=0,i=(128&this.mf.getUint8(t+(e?7:0)))>0,r=!0,o=0;o<8;o++){var s=this.mf.getUint8(t+(e?o:7-o));i&&(r?0!==s&&(s=255&~(s-1),r=!1):s=255&~s),n+=s*Math.pow(256,o)}return i&&(n=-n),n}},{key:"getUint8",value:function(t,e){return this.mf.getUint8(t,e)}},{key:"getInt8",value:function(t,e){return this.mf.getInt8(t,e)}},{key:"getUint16",value:function(t,e){return this.mf.getUint16(t,e)}},{key:"getInt16",value:function(t,e){return this.mf.getInt16(t,e)}},{key:"getUint32",value:function(t,e){return this.mf.getUint32(t,e)}},{key:"getInt32",value:function(t,e){return this.mf.getInt32(t,e)}},{key:"getFloat16",value:function(t,e){return H(this.mf,t,e)}},{key:"getFloat32",value:function(t,e){return this.mf.getFloat32(t,e)}},{key:"getFloat64",value:function(t,e){return this.mf.getFloat64(t,e)}}]),t}(),Mt=function(){function t(e,n,i,r){y(this,t),this.mf=new DataView(e),this.Qf=n,this.kf=i,this.bf=r}return h(t,[{key:"sliceOffset",get:function(){return this.Qf}},{key:"sliceTop",get:function(){return this.Qf+this.buffer.byteLength}},{key:"littleEndian",get:function(){return this.kf}},{key:"bigTiff",get:function(){return this.bf}},{key:"buffer",get:function(){return this.mf.buffer}},{key:"covers",value:function(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}},{key:"readUint8",value:function(t){return this.mf.getUint8(t-this.Qf,this.kf)}},{key:"readInt8",value:function(t){return this.mf.getInt8(t-this.Qf,this.kf)}},{key:"readUint16",value:function(t){return this.mf.getUint16(t-this.Qf,this.kf)}},{key:"readInt16",value:function(t){return this.mf.getInt16(t-this.Qf,this.kf)}},{key:"readUint32",value:function(t){return this.mf.getUint32(t-this.Qf,this.kf)}},{key:"readInt32",value:function(t){return this.mf.getInt32(t-this.Qf,this.kf)}},{key:"readFloat32",value:function(t){return this.mf.getFloat32(t-this.Qf,this.kf)}},{key:"readFloat64",value:function(t){return this.mf.getFloat64(t-this.Qf,this.kf)}},{key:"readUint64",value:function(t){var e,n=this.readUint32(t),i=this.readUint32(t+4);if(this.kf){if(e=n+Math.pow(2,32)*i,!Number.isSafeInteger(e))throw new Error("".concat(e," exceeds MAX_SAFE_INTEGER. ")+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return e}if(e=Math.pow(2,32)*n+i,!Number.isSafeInteger(e))throw new Error("".concat(e," exceeds MAX_SAFE_INTEGER. ")+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return e}},{key:"readInt64",value:function(t){for(var e=0,n=(128&this.mf.getUint8(t+(this.kf?7:0)))>0,i=!0,r=0;r<8;r++){var o=this.mf.getUint8(t+(this.kf?r:7-r));n&&(i?0!==o&&(o=255&~(o-1),i=!1):o=255&~o),e+=o*Math.pow(256,r)}return n&&(e=-e),e}},{key:"readOffset",value:function(t){return this.bf?this.readUint64(t):this.readUint32(t)}}]),t}(),$t="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,Rt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$t,i=arguments.length>1?arguments[1]:void 0;y(this,t),this.workers=null,this._f=null,this.size=n,this.messageId=0,n&&(this._f=i?Promise.resolve(i):new Promise((function(t){Promise.resolve().then((function(){return pr})).then((function(e){t(e.create)}))})),this._f.then((function(t){e._f=null,e.workers=[];for(var i=0;i<n;i++)e.workers.push({worker:t(),idle:!0})})))}var e;return h(t,[{key:"decode",value:(e=A(C.mark((function t(e,n){var i=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._f){t.next=3;break}return t.next=3,this._f;case 3:return t.abrupt("return",0===this.size?yt(e).then((function(t){return t.decode(e,n)})):new Promise((function(t){var r=i.workers.find((function(t){return t.idle}))||i.workers[Math.floor(Math.random()*i.size)];r.idle=!1;var o=i.messageId++;r.worker.addEventListener("message",(function e(n){n.data.id===o&&(r.idle=!0,t(n.data.decoded),r.worker.removeEventListener("message",e))})),r.worker.postMessage({fileDirectory:e,buffer:n,id:o},[n])})));case 4:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.workers&&(this.workers.forEach((function(t){t.worker.terminate()})),this.workers=null)}}]),t}(),Ft=Rt;function Gt(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Nt(t){if(void 0!==Object.fromEntries)return Object.fromEntries(t);var e,n={},i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Lt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lt(t,e):void 0}}(t))){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(t);try{for(i.s();!(e=i.n()).done;){var r=s(e.value,2),o=r[0],a=r[1];n[o.toLowerCase()]=a}}catch(t){i.e(t)}finally{i.f()}return n}function Ut(t){return Nt(t.split("\r\n").map((function(t){var e=t.split(":").map((function(t){return t.trim()}));return e[0]=e[0].toLowerCase(),e})))}function Tt(t){var e,i=t.split(";").map((function(t){return t.trim()})),s=n(e=i)||B(e)||r(e)||o();return{type:s[0],params:Nt(s.slice(1).map((function(t){return t.split("=")})))}}function Pt(t){var e,n,i;if(t){var r=s(t.match(/bytes (\d+)-(\d+)\/(\d+)/),4);e=r[1],n=r[2],i=r[3],e=parseInt(e,10),n=parseInt(n,10),i=parseInt(i,10)}return{start:e,end:n,total:i}}function qt(t,e){for(var n=null,i=new TextDecoder("ascii"),r=[],o="--".concat(e),s="".concat(o,"--"),a=0;a<10;++a)i.decode(new Uint8Array(t,a,o.length))===o&&(n=a);if(null===n)throw new Error("Could not find initial boundary");for(;n<t.byteLength;){var A=i.decode(new Uint8Array(t,n,Math.min(o.length+1024,t.byteLength-n)));if(0===A.length||A.startsWith(s))break;if(!A.startsWith(o))throw new Error("Part does not start with boundary");var u=A.substr(o.length+2);if(0===u.length)break;var h=u.indexOf("\r\n\r\n"),l=Ut(u.substr(0,h)),c=Pt(l["content-range"]),f=c.start,d=c.end,g=c.total,v=n+o.length+h+4,I=parseInt(d,10)+1-parseInt(f,10);r.push({headers:l,data:t.slice(v,v+I),offset:f,length:I,fileSize:g}),n=v+I+4}return r}var Ot=function(){function t(){y(this,t)}var e,n,i;return h(t,[{key:"fetch",value:(i=A(C.mark((function t(e){var n,i=this,r=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:void 0,t.abrupt("return",Promise.all(e.map((function(t){return i.fetchSlice(t,n)}))));case 2:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"fetchSlice",value:(n=A(C.mark((function t(e){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("fetching of slice ".concat(e," not possible, not implemented"));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"fileSize",get:function(){return null}},{key:"close",value:(e=A(C.mark((function t(){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})}]),t}();function Ht(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return zt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zt(t,e):void 0}}(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Kt=function(t,e,n){c(r,t);var i=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(r);function r(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(y(this,r),t=i.call(this),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");return t.maxSize=e.maxSize,t.maxAge=e.maxAge||Number.POSITIVE_INFINITY,t.onEviction=e.onEviction,t.cache=new Map,t.oldCache=new Map,t.Ni=0,t}return h(r,[{key:"_emitEvictions",value:function(t){if("function"==typeof this.onEviction){var e,n=Ht(t);try{for(n.s();!(e=n.n()).done;){var i=s(e.value,2),r=i[0],o=i[1];this.onEviction(r,o.value)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"_deleteIfExpired",value:function(t,e){return"number"==typeof e.expiry&&e.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(t,e.value),this.delete(t))}},{key:"_getOrDeleteIfExpired",value:function(t,e){if(!1===this.xf(t,e))return e.value}},{key:"_getItemValue",value:function(t,e){return e.expiry?this.Df(t,e):e.value}},{key:"_peek",value:function(t,e){var n=e.get(t);return this.Sf(t,n)}},{key:"_set",value:function(t,e){this.cache.set(t,e),this.Ni++,this.Ni>=this.maxSize&&(this.Ni=0,this.Mf(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}},{key:"_moveToRecent",value:function(t,e){this.oldCache.delete(t),this.Wi(t,e)}},{key:"_entriesAscending",value:C.mark((function t(){var e,n,i,r,o,a,A,u,h,l,c,f;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ht(this.oldCache),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=13;break}if(i=n.value,r=s(i,2),o=r[0],a=r[1],this.cache.has(o)){t.next=11;break}if(!1!==this.xf(o,a)){t.next=11;break}return t.next=11,i;case 11:t.next=3;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),e.e(t.t0);case 18:return t.prev=18,e.f(),t.finish(18);case 21:A=Ht(this.cache),t.prev=22,A.s();case 24:if((u=A.n()).done){t.next=33;break}if(h=u.value,l=s(h,2),c=l[0],f=l[1],!1!==this.xf(c,f)){t.next=31;break}return t.next=31,h;case 31:t.next=24;break;case 33:t.next=38;break;case 35:t.prev=35,t.t1=t.catch(22),A.e(t.t1);case 38:return t.prev=38,A.f(),t.finish(38);case 41:case"end":return t.stop()}}),t,this,[[1,15,18,21],[22,35,38,41]])}))},{key:"get",value:function(t){if(this.cache.has(t)){var e=this.cache.get(t);return this.Sf(t,e)}if(this.oldCache.has(t)){var n=this.oldCache.get(t);if(!1===this.xf(t,n))return this.$f(t,n),n.value}}},{key:"set",value:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).maxAge,i=void 0===n?this.maxAge:n,r="number"==typeof i&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;this.cache.has(t)?this.cache.set(t,{value:e,expiry:r}):this.Wi(t,{value:e,expiry:r})}},{key:"has",value:function(t){return this.cache.has(t)?!this.xf(t,this.cache.get(t)):!!this.oldCache.has(t)&&!this.xf(t,this.oldCache.get(t))}},{key:"peek",value:function(t){return this.cache.has(t)?this.Rf(t,this.cache):this.oldCache.has(t)?this.Rf(t,this.oldCache):void 0}},{key:"delete",value:function(t){var e=this.cache.delete(t);return e&&this.Ni--,this.oldCache.delete(t)||e}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this.Ni=0}},{key:"resize",value:function(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");var e=E(this.Ff()),n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this.Ni=e.length):(n>0&&this.Mf(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this.Ni=0),this.maxSize=t}},{key:"keys",value:C.mark((function t(){var e,n,i,r;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ht(this),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return i=s(n.value,1),r=i[0],t.next=7,r;case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))},{key:"values",value:C.mark((function t(){var e,n,i,r;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ht(this),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return i=s(n.value,2),r=i[1],t.next=7,r;case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))},{key:e,value:C.mark((function(){var t,e,n,i,r,o,a,A,u,h,l,c;return C.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:t=Ht(this.cache),f.prev=1,t.s();case 3:if((e=t.n()).done){f.next=12;break}if(n=e.value,i=s(n,2),r=i[0],o=i[1],!1!==this.xf(r,o)){f.next=10;break}return f.next=10,[r,o.value];case 10:f.next=3;break;case 12:f.next=17;break;case 14:f.prev=14,f.t0=f.catch(1),t.e(f.t0);case 17:return f.prev=17,t.f(),f.finish(17);case 20:a=Ht(this.oldCache),f.prev=21,a.s();case 23:if((A=a.n()).done){f.next=33;break}if(u=A.value,h=s(u,2),l=h[0],c=h[1],this.cache.has(l)){f.next=31;break}if(!1!==this.xf(l,c)){f.next=31;break}return f.next=31,[l,c.value];case 31:f.next=23;break;case 33:f.next=38;break;case 35:f.prev=35,f.t1=f.catch(21),a.e(f.t1);case 38:return f.prev=38,a.f(),f.finish(38);case 41:case"end":return f.stop()}}),o,this,[[1,14,17,20],[21,35,38,41]])}))},{key:"entriesDescending",value:C.mark((function t(){var e,n,i,r,o,a,A,u,h,l,c;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=E(this.cache),n=e.length-1;case 2:if(!(n>=0)){t.next=12;break}if(i=e[n],r=s(i,2),o=r[0],a=r[1],!1!==this.xf(o,a)){t.next=9;break}return t.next=9,[o,a.value];case 9:--n,t.next=2;break;case 12:e=E(this.oldCache),A=e.length-1;case 14:if(!(A>=0)){t.next=25;break}if(u=e[A],h=s(u,2),l=h[0],c=h[1],this.cache.has(l)){t.next=22;break}if(!1!==this.xf(l,c)){t.next=22;break}return t.next=22,[l,c.value];case 22:--A,t.next=14;break;case 25:case"end":return t.stop()}}),t,this)}))},{key:"entriesAscending",value:C.mark((function t(){var e,n,i,r,o;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ht(this.Ff()),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return i=s(n.value,2),r=i[0],o=i[1],t.next=7,[r,o.value];case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))},{key:"size",get:function(){if(!this.Ni)return this.oldCache.size;var t,e=0,n=Ht(this.oldCache.keys());try{for(n.s();!(t=n.n()).done;){var i=t.value;this.cache.has(i)||e++}}catch(t){n.e(t)}finally{n.f()}return Math.min(this.Ni+e,this.maxSize)}},{key:"entries",value:function(){return this.entriesAscending()}},{key:"forEach",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=Ht(this.entriesAscending());try{for(i.s();!(e=i.n()).done;){var r=s(e.value,2),o=r[0],a=r[1];t.call(n,a,o,this)}}catch(t){i.e(t)}finally{i.f()}}},{key:n,get:function(){return JSON.stringify(E(this.entriesAscending()))}}]),r}(p(Map),Symbol.iterator,Symbol.toStringTag);function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function Jt(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function Yt(t,e){return!(t.length<e.length)&&t.substr(t.length-e.length)===e}function jt(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function Wt(t,e){for(var n=[],i=0;i<t;i++)n.push(e(i));return n}function Xt(t){return Zt.apply(this,arguments)}function Zt(){return(Zt=A(C.mark((function t(e){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function te(t,e){var n=Array.isArray(t)?t:Array.from(t),i=Array.isArray(e)?e:Array.from(e);return n.map((function(t,e){return[t,i[e]]}))}var ee=function(t){c(n,t);var e=Vt(n);function n(t){var i;return y(this,n),i=e.call(this,t),Error.captureStackTrace&&Error.captureStackTrace(d(i),n),i.name="AbortError",i}return n}(p(Error)),ne=function(t){c(n,t);var e=Vt(n);function n(t,i){var r;return y(this,n),(r=e.call(this,i)).errors=t,r.message=i,r.name="AggregateError",r}return n}(p(Error));function ie(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return re(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(t,e):void 0}}(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function re(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var oe=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y(this,t),this.offset=e,this.length=n,this.data=i}return h(t,[{key:"top",get:function(){return this.offset+this.length}}]),t}(),se=function t(e,n,i){y(this,t),this.offset=e,this.length=n,this.blockIds=i},ae=function(t){c(i,t);var e,n=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(i);function i(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.blockSize,s=void 0===o?65536:o,a=r.cacheSize,A=void 0===a?100:a;return y(this,i),(e=n.call(this)).source=t,e.blockSize=s,e.blockCache=new Kt({maxSize:A,onEviction:function(t,n){e.evictedBlocks.set(t,n)}}),e.evictedBlocks=new Map,e.blockRequests=new Map,e.blockIdsToFetch=new Set,e.abortedBlockIds=new Set,e}return h(i,[{key:"fileSize",get:function(){return this.source.fileSize}},{key:"fetch",value:(e=A(C.mark((function t(e,n){var i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,B,E,m,Q,k,b,_,x,D=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=[],r=[],o=[],this.evictedBlocks.clear(),s=ie(e);try{for(s.s();!(a=s.n()).done;)for(A=a.value,u=A.offset,h=A.length,l=u+h,null!==(c=this.fileSize)&&(l=Math.min(l,c)),f=Math.floor(u/this.blockSize)*this.blockSize,d=f;d<l;d+=this.blockSize)g=Math.floor(d/this.blockSize),this.blockCache.has(g)||this.blockRequests.has(g)||(this.blockIdsToFetch.add(g),r.push(g)),this.blockRequests.has(g)&&i.push(this.blockRequests.get(g)),o.push(g)}catch(t){s.e(t)}finally{s.f()}return t.next=8,Xt();case 8:for(this.fetchBlocks(n),v=[],I=0,p=r;I<p.length;I++)y=p[I],this.blockRequests.has(y)&&v.push(this.blockRequests.get(y));return t.next=13,Promise.allSettled(i);case 13:return t.next=15,Promise.allSettled(v);case 15:if(w=[],(B=o.filter((function(t){return D.abortedBlockIds.has(t)||!D.blockCache.has(t)}))).forEach((function(t){return D.blockIdsToFetch.add(t)})),!(B.length>0&&n)||n.aborted){t.next=41;break}this.fetchBlocks(null),E=ie(B),t.prev=21,E.s();case 23:if((m=E.n()).done){t.next=31;break}if(Q=m.value,k=this.blockRequests.get(Q)){t.next=28;break}throw new Error("Block ".concat(Q," is not in the block requests"));case 28:w.push(k);case 29:t.next=23;break;case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(21),E.e(t.t0);case 36:return t.prev=36,E.f(),t.finish(36);case 39:return t.next=41,Promise.allSettled(w);case 41:if(!n||!n.aborted){t.next=43;break}throw new ee("Request was aborted");case 43:if(b=o.map((function(t){return D.blockCache.get(t)||D.evictedBlocks.get(t)})),_=b.filter((function(t){return!t})),!_.length){t.next=47;break}throw new ne(_,"Request failed");case 47:return x=new Map(te(o,b)),t.abrupt("return",this.readSliceData(e,x));case 49:case"end":return t.stop()}}),t,this,[[21,33,36,39]])}))),function(t,n){return e.apply(this,arguments)})},{key:"fetchBlocks",value:function(t){var e=this;this.blockIdsToFetch.size>0&&function(){for(var n=e.groupBlocks(e.blockIdsToFetch),i=e.source.fetch(n,t),r=function(r){var o,s=ie(n[r].blockIds);try{var a=function(){var n=o.value;e.blockRequests.set(n,A(C.mark((function o(){var s,a,A,u,h,l;return C.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,i;case 3:o.t0=r,s=o.sent[o.t0],a=n*e.blockSize,A=a-s.offset,u=Math.min(A+e.blockSize,s.data.byteLength),h=s.data.slice(A,u),l=new oe(a,h.byteLength,h,n),e.blockCache.set(n,l),e.abortedBlockIds.delete(n),o.next=23;break;case 14:if(o.prev=14,o.t1=o.catch(0),"AbortError"!==o.t1.name){o.next=22;break}o.t1.signal=t,e.blockCache.delete(n),e.abortedBlockIds.add(n),o.next=23;break;case 22:throw o.t1;case 23:return o.prev=23,e.blockRequests.delete(n),o.finish(23);case 26:case"end":return o.stop()}}),o,null,[[0,14,23,26]])})))())};for(s.s();!(o=s.n()).done;)a()}catch(t){s.e(t)}finally{s.f()}},o=0;o<n.length;++o)r(o);e.blockIdsToFetch.clear()}()}},{key:"groupBlocks",value:function(t){var e=Array.from(t).sort((function(t,e){return t-e}));if(0===e.length)return[];var n,i=[],r=null,o=[],s=ie(e);try{for(s.s();!(n=s.n()).done;){var a=n.value;null===r||r+1===a?(i.push(a),r=a):(o.push(new se(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[a],r=a)}}catch(t){s.e(t)}finally{s.f()}return o.push(new se(i[0]*this.blockSize,i.length*this.blockSize,i)),o}},{key:"readSliceData",value:function(t,e){var n=this;return t.map((function(t){var i=t.offset+t.length;null!==n.fileSize&&(i=Math.min(n.fileSize,i));for(var r=Math.floor(t.offset/n.blockSize),o=Math.floor(i/n.blockSize),s=new ArrayBuffer(t.length),a=new Uint8Array(s),A=r;A<=o;++A){var u,h=e.get(A),l=h.offset-t.offset,c=0,f=0;l<0?c=-l:l>0&&(f=l),u=h.top-i<0?h.length-c:i-h.offset-c;var d=new Uint8Array(h.data,c,u);a.set(d,f)}return s}))}}]),i}(Ot),Ae=function(){function t(){y(this,t)}var e;return h(t,[{key:"ok",get:function(){return this.status>=200&&this.status<=299}},{key:"status",get:function(){throw new Error("not implemented")}},{key:"getHeader",value:function(t){throw new Error("not implemented")}},{key:"getData",value:(e=A(C.mark((function t(){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("not implemented");case 1:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})}]),t}(),ue=function(){function t(e){y(this,t),this.url=e}var e;return h(t,[{key:"request",value:(e=A(C.mark((function t(){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("request is not implemented");case 2:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})}]),t}();function he(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}var le=function(t){c(i,t);var e,n=he(i);function i(t){var e;return y(this,i),(e=n.call(this)).response=t,e}return h(i,[{key:"status",get:function(){return this.response.status}},{key:"getHeader",value:function(t){return this.response.headers.get(t)}},{key:"getData",value:(e=A(C.mark((function t(){var e;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.response.arrayBuffer){t.next=6;break}return t.next=3,this.response.arrayBuffer();case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,this.response.buffer();case 8:t.t0=t.sent.buffer;case 9:return e=t.t0,t.abrupt("return",e);case 11:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(Ae),ce=function(t){c(i,t);var e,n=he(i);function i(t,e){var r;return y(this,i),(r=n.call(this,t)).credentials=e,r}return h(i,[{key:"request",value:(e=A(C.mark((function t(){var e,n,i,r,o=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=o.length>0&&void 0!==o[0]?o[0]:{}).headers,i=e.signal,t.next=3,fetch(this.url,{headers:n,credentials:this.credentials,signal:i});case 3:return r=t.sent,t.abrupt("return",new le(r));case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(ue);function fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}var de=function(t){c(i,t);var e,n=fe(i);function i(t,e){var r;return y(this,i),(r=n.call(this)).xhr=t,r.data=e,r}return h(i,[{key:"status",get:function(){return this.xhr.status}},{key:"getHeader",value:function(t){return this.xhr.getResponseHeader(t)}},{key:"getData",value:(e=A(C.mark((function t(){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.data);case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(Ae),ge=function(t){c(i,t);var e,n=fe(i);function i(){return y(this,i),n.apply(this,arguments)}return h(i,[{key:"constructRequest",value:function(t,e){var n=this;return new Promise((function(i,r){var o=new XMLHttpRequest;o.open("GET",n.url),o.responseType="arraybuffer";for(var a=0,A=Object.entries(t);a<A.length;a++){var u=s(A[a],2),h=u[0],l=u[1];o.setRequestHeader(h,l)}o.onload=function(){var t=o.response;i(new de(o,t))},o.onerror=r,o.onabort=function(){return r(new ee("Request aborted"))},o.send(),e&&(e.aborted&&o.abort(),e.addEventListener("abort",(function(){return o.abort()})))}))}},{key:"request",value:(e=A(C.mark((function t(){var e,n,i,r,o=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=o.length>0&&void 0!==o[0]?o[0]:{}).headers,i=e.signal,t.next=3,this.constructRequest(n,i);case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(ue),ve={};function Ie(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function pe(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Ie(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ie(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}var we=function(t){c(i,t);var e,n=ye(i);function i(t,e){var r;return y(this,i),(r=n.call(this)).response=t,r.dataPromise=e,r}return h(i,[{key:"status",get:function(){return this.response.statusCode}},{key:"getHeader",value:function(t){return this.response.headers[t]}},{key:"getData",value:(e=A(C.mark((function t(){var e;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dataPromise;case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(Ae),Ce=function(t){c(i,t);var e,n=ye(i);function i(t){var e;return y(this,i),(e=n.call(this,t)).parsedUrl=ve.parse(e.url),e.httpApi=(e.parsedUrl.protocol,ve),e}return h(i,[{key:"constructRequest",value:function(t,e){var n=this;return new Promise((function(i,r){var o=n.httpApi.get(pe(pe({},n.parsedUrl),{},{headers:t}),(function(t){var e=new Promise((function(e){var n=[];t.on("data",(function(t){n.push(t)})),t.on("end",(function(){var t=Buffer.concat(n).buffer;e(t)})),t.on("error",r)}));i(new we(t,e))}));o.on("error",r),e&&(e.aborted&&o.destroy(new ee("Request aborted")),e.addEventListener("abort",(function(){return o.destroy(new ee("Request aborted"))})))}))}},{key:"request",value:(e=A(C.mark((function t(){var e,n,i,r,o=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=o.length>0&&void 0!==o[0]?o[0]:{}).headers,i=e.signal,t.next=3,this.constructRequest(n,i);case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),i}(ue),Be=["headers","credentials","maxRanges","allowFullFile"],Ee=["headers","maxRanges","allowFullFile"],me=["headers","maxRanges","allowFullFile"],Qe=["headers","maxRanges","allowFullFile"],ke=["forceXHR"];function be(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _e(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?be(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var xe=function(t){c(o,t);var e,n,i,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(o);function o(t,e,n,i){var s;return y(this,o),(s=r.call(this)).client=t,s.headers=e,s.maxRanges=n,s.allowFullFile=i,s.Gf=null,s}return h(o,[{key:"fetch",value:(i=A(C.mark((function t(e,n){var i=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.maxRanges>=e.length)){t.next=4;break}return t.abrupt("return",this.fetchSlices(e,n));case 4:this.maxRanges>0&&e.length;case 5:return t.abrupt("return",Promise.all(e.map((function(t){return i.fetchSlice(t,n)}))));case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"fetchSlices",value:(n=A(C.mark((function t(e,n){var i,r,o,s,a,A,u,h,l,c,f,d,g,v=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.client.request({headers:_e(_e({},this.headers),{},{Range:"bytes=".concat(e.map((function(t){var e=t.offset,n=t.length;return"".concat(e,"-").concat(e+n)})).join(","))}),signal:n});case 2:if((i=t.sent).ok){t.next=7;break}throw new Error("Error fetching data.");case 7:if(206!==i.status){t.next=32;break}if(r=Tt(i.getHeader("content-type")),o=r.type,s=r.params,"multipart/byteranges"!==o){t.next=18;break}return t.t0=qt,t.next=13,i.getData();case 13:return t.t1=t.sent,t.t2=s.boundary,a=(0,t.t0)(t.t1,t.t2),this.Gf=a[0].fileSize||null,t.abrupt("return",a);case 18:return t.next=20,i.getData();case 20:if(A=t.sent,u=Pt(i.getHeader("content-range")),h=u.start,l=u.end,c=u.total,this.Gf=c||null,f=[{data:A,offset:h,length:l-h}],!(e.length>1)){t.next=29;break}return t.next=27,Promise.all(e.slice(1).map((function(t){return v.fetchSlice(t,n)})));case 27:return d=t.sent,t.abrupt("return",f.concat(d));case 29:return t.abrupt("return",f);case 32:if(this.allowFullFile){t.next=34;break}throw new Error("Server responded with full file");case 34:return t.next=36,i.getData();case 36:return g=t.sent,this.Gf=g.byteLength,t.abrupt("return",[{data:g,offset:0,length:g.byteLength}]);case 39:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"fetchSlice",value:(e=A(C.mark((function t(e,n){var i,r,o,s,a,A,u;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.offset,r=e.length,t.next=3,this.client.request({headers:_e(_e({},this.headers),{},{Range:"bytes=".concat(i,"-").concat(i+r)}),signal:n});case 3:if((o=t.sent).ok){t.next=8;break}throw new Error("Error fetching data.");case 8:if(206!==o.status){t.next=17;break}return t.next=11,o.getData();case 11:return s=t.sent,a=Pt(o.getHeader("content-range")),A=a.total,this.Gf=A||null,t.abrupt("return",{data:s,offset:i,length:r});case 17:if(this.allowFullFile){t.next=19;break}throw new Error("Server responded with full file");case 19:return t.next=21,o.getData();case 21:return u=t.sent,this.Gf=u.byteLength,t.abrupt("return",{data:u,offset:0,length:u.byteLength});case 24:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"fileSize",get:function(){return this.Gf}}]),o}(Ot);function De(t,e){var n=e.blockSize,i=e.cacheSize;return null===n?t:new ae(t,{blockSize:n,cacheSize:i})}function Se(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.headers,i=void 0===n?{}:n,r=e.maxRanges,o=void 0===r?0:r,s=e.allowFullFile,a=void 0!==s&&s,A=Gt(e,Qe);return De(new xe(t,i,o,a),A)}function Me(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.forceXHR,i=void 0!==n&&n,r=Gt(e,ke);return"function"!=typeof fetch||i?"undefined"!=typeof XMLHttpRequest?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.headers,i=void 0===n?{}:n,r=e.maxRanges,o=void 0===r?0:r,s=e.allowFullFile,a=void 0!==s&&s,A=Gt(e,Ee),u=new ge(t);return De(new xe(u,i,o,a),A)}(t,r):function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.headers,i=void 0===n?{}:n,r=e.maxRanges,o=void 0===r?0:r,s=e.allowFullFile,a=void 0!==s&&s,A=Gt(e,me),u=new Ce(t);return De(new xe(u,i,o,a),A)}(t,r):function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.headers,i=void 0===n?{}:n,r=e.credentials,o=e.maxRanges,s=void 0===o?0:o,a=e.allowFullFile,A=void 0!==a&&a,u=Gt(e,Be),h=new ce(t,r);return De(new xe(h,i,s,A),u)}(t,r)}var $e=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(t){var i;return y(this,n),(i=e.call(this)).arrayBuffer=t,i}return h(n,[{key:"fetchSlice",value:function(t,e){if(e&&e.aborted)throw new ee("Request aborted");return this.arrayBuffer.slice(t.offset,t.offset+t.length)}}]),n}(Ot);function Re(t){return new $e(t)}var Fe=function(t){c(i,t);var e,n=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(i);function i(t){var e;return y(this,i),(e=n.call(this)).file=t,e}return h(i,[{key:"fetchSlice",value:(e=A(C.mark((function t(e,n){var i=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var o=i.file.slice(e.offset,e.offset+e.length),s=new FileReader;s.onload=function(e){return t(e.target.result)},s.onerror=r,s.onabort=r,s.readAsArrayBuffer(o),n&&n.addEventListener("abort",(function(){return s.abort()}))})));case 1:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})}]),i}(Ot);function Ge(t){return new Fe(t)}function Le(t){return new Promise((function(e,n){ve.close(t,(function(t){t?n(t):e()}))}))}function Ne(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new Promise((function(t,n){ve.read.apply(ve,e.concat([function(e,i,r){e?n(e):t({bytesRead:i,buffer:r})}]))}))}var Ue=function(t){c(r,t);var e,n,i=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(r);function r(t){var e;return y(this,r),(e=i.call(this)).path=t,e.openRequest=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return new Promise((function(i,r){ve.open(t,e,n,(function(t,e){t?r(t):i(e)}))}))}(t,"r"),e}return h(r,[{key:"fetchSlice",value:(n=A(C.mark((function t(e){var n,i,r;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openRequest;case 2:return n=t.sent,t.next=5,Ne(n,Buffer.alloc(e.length),0,e.length,e.offset);case 5:return i=t.sent,r=i.buffer,t.abrupt("return",r.buffer);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"close",value:(e=A(C.mark((function t(){var e;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.openRequest;case 2:return e=t.sent,t.next=5,Le(e);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),r}(Ot);function Te(t){return new Ue(t)}function Pe(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return qe(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(t,e):void 0}}(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function qe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Oe=jt(J),He=jt(st),ze={};Jt(ze,Oe),Jt(ze,He);var Ke=jt(Z),Ve=1e3,Je={nextZero:function(t,e){for(var n=e;0!==t[n];)n++;return n},readUshort:function(t,e){return t[e]<<8|t[e+1]},readShort:function(t,e){var n=Je.ui8;return n[0]=t[e+1],n[1]=t[e+0],Je.i16[0]},readInt:function(t,e){var n=Je.ui8;return n[0]=t[e+3],n[1]=t[e+2],n[2]=t[e+1],n[3]=t[e+0],Je.i32[0]},readUint:function(t,e){var n=Je.ui8;return n[0]=t[e+3],n[1]=t[e+2],n[2]=t[e+1],n[3]=t[e+0],Je.ui32[0]},readASCII:function(t,e,n){return n.map((function(n){return String.fromCharCode(t[e+n])})).join("")},readFloat:function(t,e){var n=Je.ui8;return Wt(4,(function(i){n[i]=t[e+3-i]})),Je.fl32[0]},readDouble:function(t,e){var n=Je.ui8;return Wt(8,(function(i){n[i]=t[e+7-i]})),Je.fl64[0]},writeUshort:function(t,e,n){t[e]=n>>8&255,t[e+1]=255&n},writeUint:function(t,e,n){t[e]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},writeASCII:function(t,e,n){Wt(n.length,(function(i){t[e+i]=n.charCodeAt(i)}))},ui8:new Uint8Array(8)};Je.fl64=new Float64Array(Je.ui8.buffer),Je.writeDouble=function(t,e,n){Je.fl64[0]=n,Wt(8,(function(n){t[e+n]=Je.ui8[7-n]}))};var Ye=[["Compression",1],["PlanarConfiguration",1],["ExtraSamples",0]];var je=function(){function t(){y(this,t)}return h(t,[{key:"log",value:function(){}},{key:"debug",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}},{key:"time",value:function(){}},{key:"timeEnd",value:function(){}}]),t}();function We(t,e){var n=t.length-e,i=0;do{for(var r=e;r>0;r--)t[i+e]+=t[i],i++;n-=e}while(n>0)}function Xe(t,e,n){for(var i=0,r=t.length,o=r/n;r>e;){for(var s=e;s>0;--s)t[i+e]+=t[i],++i;r-=e}for(var a=t.slice(),A=0;A<o;++A)for(var u=0;u<n;++u)t[n*A+u]=a[(n-u-1)*o+A]}function Ze(t,e,n,i,r,o){if(!e||1===e)return t;for(var s=0;s<r.length;++s){if(r[s]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(r[s]!==r[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var a=r[0]/8,A=2===o?1:r.length,u=0;u<i&&!(u*A*n*a>=t.byteLength);++u){var h=void 0;if(2===e){switch(r[0]){case 8:h=new Uint8Array(t,u*A*n*a,A*n*a);break;case 16:h=new Uint16Array(t,u*A*n*a,A*n*a/2);break;case 32:h=new Uint32Array(t,u*A*n*a,A*n*a/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(r[0]," bits per sample."))}We(h,A)}else 3===e&&Xe(h=new Uint8Array(t,u*A*n*a,A*n*a),A,a)}return t}new je;var tn=function(){function t(){y(this,t)}var e;return h(t,[{key:"decode",value:(e=A(C.mark((function t(e,n){var i,r,o,s,a;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.decodeBlock(n);case 2:if(i=t.sent,1===(r=e.Predictor||1)){t.next=9;break}return o=!e.StripOffsets,s=o?e.TileWidth:e.ImageWidth,a=o?e.TileLength:e.RowsPerStrip||e.ImageLength,t.abrupt("return",Ze(i,r,s,a,e.BitsPerSample,e.PlanarConfiguration));case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})}]),t}();function en(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function nn(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?en(Object(i),!0).forEach((function(n){e(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):en(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function rn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function on(t){switch(t){case tt.BYTE:case tt.ASCII:case tt.SBYTE:case tt.UNDEFINED:return 1;case tt.SHORT:case tt.SSHORT:return 2;case tt.LONG:case tt.SLONG:case tt.FLOAT:case tt.IFD:return 4;case tt.RATIONAL:case tt.SRATIONAL:case tt.DOUBLE:case tt.LONG8:case tt.SLONG8:case tt.IFD8:return 8;default:throw new RangeError("Invalid field type: ".concat(t))}}function sn(t){var e=t.GeoKeyDirectory;if(!e)return null;for(var n={},i=4;i<=4*e[3];i+=4){var r=st[e[i]],o=e[i+1]?J[e[i+1]]:null,s=e[i+2],a=e[i+3],A=null;if(o){if(null==(A=t[o]))throw new Error("Could not get value of geoKey '".concat(r,"'."));"string"==typeof A?A=A.substring(a,a+s-1):A.subarray&&(A=A.subarray(a,a+s),1===s&&(A=A[0]))}else A=a;n[r]=A}return n}function an(t,e,n,i){var r=null,o=null,s=on(e);switch(e){case tt.BYTE:case tt.ASCII:case tt.UNDEFINED:r=new Uint8Array(n),o=t.readUint8;break;case tt.SBYTE:r=new Int8Array(n),o=t.readInt8;break;case tt.SHORT:r=new Uint16Array(n),o=t.readUint16;break;case tt.SSHORT:r=new Int16Array(n),o=t.readInt16;break;case tt.LONG:case tt.IFD:r=new Uint32Array(n),o=t.readUint32;break;case tt.SLONG:r=new Int32Array(n),o=t.readInt32;break;case tt.LONG8:case tt.IFD8:r=new Array(n),o=t.readUint64;break;case tt.SLONG8:r=new Array(n),o=t.readInt64;break;case tt.RATIONAL:r=new Uint32Array(2*n),o=t.readUint32;break;case tt.SRATIONAL:r=new Int32Array(2*n),o=t.readInt32;break;case tt.FLOAT:r=new Float32Array(n),o=t.readFloat32;break;case tt.DOUBLE:r=new Float64Array(n),o=t.readFloat64;break;default:throw new RangeError("Invalid field type: ".concat(e))}if(e!==tt.RATIONAL&&e!==tt.SRATIONAL)for(var a=0;a<n;++a)r[a]=o.call(t,i+a*s);else for(var A=0;A<n;A+=2)r[A]=o.call(t,i+A*s),r[A+1]=o.call(t,i+(A*s+4));return e===tt.ASCII?new TextDecoder("utf-8").decode(r):r}var An=function t(e,n,i){y(this,t),this.fileDirectory=e,this.geoKeyDirectory=n,this.nextIFDByteOffset=i},un=function(t){c(n,t);var e=rn(n);function n(t){var i;return y(this,n),(i=e.call(this,"No image at index ".concat(t))).index=t,i}return n}(p(Error)),hn=function(){function t(){y(this,t)}var e;return h(t,[{key:"readRasters",value:(e=A(C.mark((function t(){var e,n,i,r,o,a,A,u,h,l,c,f,d,g,v,I,p,y,w,B,E,m,Q,k,b,_,x,D,S,M,$,R,F,G,L,N,U,T,P,q=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(e=q.length>0&&void 0!==q[0]?q[0]:{}).window,i=e.width,r=e.height,o=e.resX,a=e.resY,A=e.bbox,t.next=5,this.getImage();case 5:return u=t.sent,h=u,t.next=9,this.getImageCount();case 9:if(l=t.sent,c=u.getBoundingBox(),!n||!A){t.next=13;break}throw new Error('Both "bbox" and "window" passed.');case 13:if(!i&&!r){t.next=24;break}if(n&&(f=u.getOrigin(),d=s(f,2),g=d[0],v=d[1],I=u.getResolution(),p=s(I,2),y=p[0],w=p[1],A=[g+n[0]*y,v+n[1]*w,g+n[2]*y,v+n[3]*w]),B=A||c,!i){t.next=20;break}if(!o){t.next=19;break}throw new Error("Both width and resX passed");case 19:o=(B[2]-B[0])/i;case 20:if(!r){t.next=24;break}if(!a){t.next=23;break}throw new Error("Both width and resY passed");case 23:a=(B[3]-B[1])/r;case 24:if(!o&&!a){t.next=48;break}E=[],m=0;case 27:if(!(m<l)){t.next=36;break}return t.next=30,this.getImage(m);case 30:Q=t.sent,k=Q.fileDirectory,b=k.SubfileType,_=k.NewSubfileType,(0===m||2===b||1&_)&&E.push(Q);case 33:++m,t.next=27;break;case 36:E.sort((function(t,e){return t.getWidth()-e.getWidth()})),x=0;case 38:if(!(x<E.length)){t.next=48;break}if(D=E[x],S=(c[2]-c[0])/D.getWidth(),M=(c[3]-c[1])/D.getHeight(),h=D,!(o&&o>S||a&&a>M)){t.next=45;break}return t.abrupt("break",48);case 45:++x,t.next=38;break;case 48:return $=n,A&&(R=u.getOrigin(),F=s(R,2),G=F[0],L=F[1],N=h.getResolution(u),U=s(N,2),T=U[0],P=U[1],$=[Math.round((A[0]-G)/T),Math.round((A[1]-L)/P),Math.round((A[2]-G)/T),Math.round((A[3]-L)/P)],$=[Math.min($[0],$[2]),Math.min($[1],$[3]),Math.max($[0],$[2]),Math.max($[1],$[3])]),t.abrupt("return",h.readRasters(nn(nn({},e),{},{window:$})));case 51:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),ln=function(t){c(f,t);var e,n,i,r,o,a,u,l=rn(f);function f(t,e,n,i){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return y(this,f),(r=l.call(this)).source=t,r.littleEndian=e,r.bigTiff=n,r.firstIFDOffset=i,r.cache=o.cache||!1,r.ifdRequests=[],r.ghostValues=null,r}return h(f,[{key:"getSlice",value:(u=A(C.mark((function t(e,n){var i;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.bigTiff?4048:1024,t.t0=Mt,t.next=4,this.source.fetch([{offset:e,length:void 0!==n?n:i}]);case 4:return t.t1=t.sent[0],t.t2=e,t.t3=this.littleEndian,t.t4=this.bigTiff,t.abrupt("return",new t.t0(t.t1,t.t2,t.t3,t.t4));case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"parseFileDirectoryAt",value:(a=A(C.mark((function t(e){var n,i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,B;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.bigTiff?20:12,i=this.bigTiff?8:2,t.next=4,this.getSlice(e);case 4:if(r=t.sent,o=this.bigTiff?r.readUint64(e):r.readUint16(e),s=o*n+(this.bigTiff?16:6),r.covers(e,s)){t.next=11;break}return t.next=10,this.getSlice(e,s);case 10:r=t.sent;case 11:a={},A=e+(this.bigTiff?8:2),u=0;case 14:if(!(u<o)){t.next=41;break}if(h=r.readUint16(A),l=r.readUint16(A+2),c=this.bigTiff?r.readUint64(A+4):r.readUint32(A+4),f=void 0,d=void 0,g=on(l),v=A+(this.bigTiff?12:8),!(g*c<=(this.bigTiff?8:4))){t.next=26;break}f=an(r,l,c,v),t.next=36;break;case 26:if(I=r.readOffset(v),p=on(l)*c,!r.covers(I,p)){t.next=32;break}f=an(r,l,c,I),t.next=36;break;case 32:return t.next=34,this.getSlice(I,p);case 34:y=t.sent,f=an(y,l,c,I);case 36:d=1===c&&-1===X.indexOf(h)&&l!==tt.RATIONAL&&l!==tt.SRATIONAL?f[0]:f,a[J[h]]=d;case 38:A+=n,++u,t.next=14;break;case 41:return w=sn(a),B=r.readOffset(e+i+n*o),t.abrupt("return",new An(a,w,B));case 44:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"requestIFD",value:(o=A(C.mark((function t(e){var n=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.ifdRequests[e]){t.next=4;break}return t.abrupt("return",this.ifdRequests[e]);case 4:if(0!==e){t.next=9;break}return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),t.abrupt("return",this.ifdRequests[e]);case 9:if(this.ifdRequests[e-1]){t.next=19;break}t.prev=10,this.ifdRequests[e-1]=this.requestIFD(e-1),t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(10),!(t.t0 instanceof un)){t.next=18;break}throw new un(e);case 18:throw t.t0;case 19:return this.ifdRequests[e]=A(C.mark((function t(){var i;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.ifdRequests[e-1];case 2:if(0!==(i=t.sent).nextIFDByteOffset){t.next=5;break}throw new un(e);case 5:return t.abrupt("return",n.parseFileDirectoryAt(i.nextIFDByteOffset));case 6:case"end":return t.stop()}}),t)})))(),t.abrupt("return",this.ifdRequests[e]);case 21:case"end":return t.stop()}}),t,this,[[10,14]])}))),function(t){return o.apply(this,arguments)})},{key:"getImage",value:(r=A(C.mark((function t(){var e,n,i=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:0,t.next=3,this.requestIFD(e);case 3:return n=t.sent,t.abrupt("return",new Dt(n.fileDirectory,n.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source));case 5:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"getImageCount",value:(i=A(C.mark((function t(){var e,n;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0,n=!0;case 2:if(!n){t.next=18;break}return t.prev=3,t.next=6,this.requestIFD(e);case 6:++e,t.next=16;break;case 9:if(t.prev=9,t.t0=t.catch(3),!(t.t0 instanceof un)){t.next=15;break}n=!1,t.next=16;break;case 15:throw t.t0;case 16:t.next=2;break;case 18:return t.abrupt("return",e);case 19:case"end":return t.stop()}}),t,this,[[3,9]])}))),function(){return i.apply(this,arguments)})},{key:"getGhostValues",value:(n=A(C.mark((function t(){var e,n,i,r,o,a,A,u,h=this;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.bigTiff?16:8,!this.ghostValues){t.next=3;break}return t.abrupt("return",this.ghostValues);case 3:return i=(n="GDAL_STRUCTURAL_METADATA_SIZE=").length+100,t.next=7,this.getSlice(e,i);case 7:if(r=t.sent,n!==an(r,tt.ASCII,n.length,e)){t.next=19;break}if(o=an(r,tt.ASCII,i,e),a=o.split("\n")[0],!((A=Number(a.split("=")[1].split(" ")[0])+a.length)>i)){t.next=16;break}return t.next=15,this.getSlice(e,A);case 15:r=t.sent;case 16:u=an(r,tt.ASCII,A,e),this.ghostValues={},u.split("\n").filter((function(t){return t.length>0})).map((function(t){return t.split("=")})).forEach((function(t){var e=s(t,2),n=e[0],i=e[1];h.ghostValues[n]=i}));case 19:return t.abrupt("return",this.ghostValues);case 20:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){return"function"==typeof this.source.close&&this.source.close()}}],[{key:"fromSource",value:(e=A(C.mark((function t(e,n,i){var r,o,s,a,A,u,h;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetch([{offset:0,length:1024}],i);case 2:if(r=t.sent[0],o=new St(r),18761!==(s=o.getUint16(0,0))){t.next=9;break}a=!0,t.next=14;break;case 9:if(19789!==s){t.next=13;break}a=!1,t.next=14;break;case 13:throw new TypeError("Invalid byte order value.");case 14:if(42!==(A=o.getUint16(2,a))){t.next=19;break}u=!1,t.next=27;break;case 19:if(43!==A){t.next=26;break}if(u=!0,8===o.getUint16(4,a)){t.next=24;break}throw new Error("Unsupported offset byte-size.");case 24:t.next=27;break;case 26:throw new TypeError("Invalid magic number.");case 27:return h=u?o.getUint64(8,a):o.getUint32(4,a),t.abrupt("return",new f(e,a,u,h,n));case 29:case"end":return t.stop()}}),t)}))),function(t,n,i){return e.apply(this,arguments)})}]),f}(hn),cn=function(t){c(o,t);var e,n,i,r=rn(o);function o(t,e){var n;return y(this,o),(n=r.call(this)).mainFile=t,n.overviewFiles=e,n.imageFiles=[t].concat(e),n.fileDirectoriesPerFile=null,n.fileDirectoriesPerFileParsing=null,n.imageCount=null,n}return h(o,[{key:"parseFileDirectoriesPerFile",value:(i=A(C.mark((function t(){var e;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map((function(t){return t.parseFileDirectoryAt(t.firstIFDOffset)}))),t.next=3,Promise.all(e);case 3:return this.fileDirectoriesPerFile=t.sent,t.abrupt("return",this.fileDirectoriesPerFile);case 5:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"getImage",value:(n=A(C.mark((function t(){var e,n,i,r,o,s,a,A=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=A.length>0&&void 0!==A[0]?A[0]:0,t.next=3,this.getImageCount();case 3:return t.next=5,this.parseFileDirectoriesPerFile();case 5:n=0,i=0,r=0;case 8:if(!(r<this.imageFiles.length)){t.next=26;break}o=this.imageFiles[r],s=0;case 11:if(!(s<this.imageCounts[r])){t.next=22;break}if(e!==n){t.next=17;break}return t.next=15,o.requestIFD(i);case 15:return a=t.sent,t.abrupt("return",new Dt(a.fileDirectory,a.geoKeyDirectory,o.dataView,o.littleEndian,o.cache,o.source));case 17:n++,i++;case 19:s++,t.next=11;break;case 22:i=0;case 23:r++,t.next=8;break;case 26:throw new RangeError("Invalid image index");case 27:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"getImageCount",value:(e=A(C.mark((function t(){var e;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===this.imageCount){t.next=2;break}return t.abrupt("return",this.imageCount);case 2:return e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map((function(t){return t.getImageCount()}))),t.next=5,Promise.all(e);case 5:return this.imageCounts=t.sent,this.imageCount=this.imageCounts.reduce((function(t,e){return t+e}),0),t.abrupt("return",this.imageCount);case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),o}(hn);function fn(){return fn=A(C.mark((function t(e){var n,i,r=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},i=r.length>2?r[2]:void 0,t.abrupt("return",ln.fromSource(Me(e,n),i));case 3:case"end":return t.stop()}}),t)}))),fn.apply(this,arguments)}function dn(){return dn=A(C.mark((function t(e){var n,i,r=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},i=r.length>2?r[2]:void 0,t.abrupt("return",ln.fromSource(Se(e,n),i));case 3:case"end":return t.stop()}}),t)}))),dn.apply(this,arguments)}function gn(){return(gn=A(C.mark((function t(e,n){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ln.fromSource(Re(e),n));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vn(){return(vn=A(C.mark((function t(e,n){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ln.fromSource(Te(e),n));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function In(){return(In=A(C.mark((function t(e,n){return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ln.fromSource(Ge(e),n));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pn(){return pn=A(C.mark((function t(e){var n,i,r,o,s,a=arguments;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:[],i=a.length>2&&void 0!==a[2]?a[2]:{},r=a.length>3?a[3]:void 0,t.next=5,ln.fromSource(Me(e,i),r);case 5:return o=t.sent,t.next=8,Promise.all(n.map((function(t){return ln.fromSource(Me(t,i))})));case 8:return s=t.sent,t.abrupt("return",new cn(o,s));case 10:case"end":return t.stop()}}),t)}))),pn.apply(this,arguments)}var yn=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(){return y(this,n),e.apply(this,arguments)}return h(n,[{key:"decodeBlock",value:function(t){return t}}]),n}(tn),wn=Object.freeze({__proto__:null,default:yn});function Cn(t,e){for(var n=e.length-1;n>=0;n--)t.push(e[n]);return t}var Bn=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(){return y(this,n),e.apply(this,arguments)}return h(n,[{key:"decodeBlock",value:function(t){return function(t){for(var e=new Uint16Array(4093),n=new Uint8Array(4093),i=0;i<=257;i++)e[i]=4096,n[i]=i;var r=258,o=9,s=0;function a(){r=258,o=9}function A(t){var e=function(t,e,n){var i=e%8,r=Math.floor(e/8),o=8-i,s=e+n-8*(r+1),a=8*(r+2)-(e+n),A=8*(r+2)-e;if(a=Math.max(0,a),r>=t.length)return 257;var u=t[r]&Math.pow(2,8-i)-1,h=u<<=n-o;if(r+1<t.length){var l=t[r+1]>>>a;h+=l<<=Math.max(0,n-A)}if(s>8&&r+2<t.length){var c=8*(r+3)-(e+n);h+=t[r+2]>>>c}return h}(t,s,o);return s+=o,e}function u(t,i){return n[r]=i,e[r]=t,++r-1}function h(t){for(var i=[],r=t;4096!==r;r=e[r])i.push(n[r]);return i}var l=[];a();for(var c,f=new Uint8Array(t),d=A(f);257!==d;){if(256===d){for(a(),d=A(f);256===d;)d=A(f);if(257===d)break;if(d>256)throw new Error("corrupted code at scanline ".concat(d));Cn(l,h(d)),c=d}else if(d<r){var g=h(d);Cn(l,g),u(c,g[g.length-1]),c=d}else{var v=h(c);if(!v)throw new Error("Bogus entry. Not in dictionary, ".concat(c," / ").concat(r,", position: ").concat(s));Cn(l,v),l.push(v[v.length-1]),u(c,v[v.length-1]),c=d}r+1>=Math.pow(2,o)&&(12===o?c=void 0:o++),d=A(f)}return new Uint8Array(l)}(t).buffer}}]),n}(tn),En=Object.freeze({__proto__:null,default:Bn}),mn=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),Qn=4017,kn=799,bn=3406,_n=2276,xn=1567,Dn=3784,Sn=5793,Mn=2896;function $n(t,e){for(var n=0,i=[],r=16;r>0&&!t[r-1];)--r;i.push({children:[],index:0});for(var o,s=i[0],a=0;a<r;a++){for(var A=0;A<t[a];A++){for((s=i.pop()).children[s.index]=e[n];s.index>0;)s=i.pop();for(s.index++,i.push(s);i.length<=a;)i.push(o={children:[],index:0}),s.children[s.index]=o.children,s=o;n++}a+1<r&&(i.push(o={children:[],index:0}),s.children[s.index]=o.children,s=o)}return i[0].children}function Rn(t,e,n,i,r,o,s,a,A){var u=n.mcusPerLine,h=n.progressive,l=e,c=e,d=0,g=0;function v(){if(g>0)return g--,d>>g&1;if(255===(d=t[c++])){var e=t[c++];if(e)throw new Error("unexpected marker: ".concat((d<<8|e).toString(16)))}return g=7,d>>>7}function I(t){for(var e,n=t;null!==(e=v());){if("number"==typeof(n=n[e]))return n;if("object"!==f(n))throw new Error("invalid huffman sequence")}return null}function p(t){for(var e=t,n=0;e>0;){var i=v();if(null===i)return;n=n<<1|i,--e}return n}function y(t){var e=p(t);return e>=1<<t-1?e:e+(-1<<t)+1}var w,C=0,B=0;function E(t,e,n,i,r){var o=n%u,s=(n/u|0)*t.v+i,a=o*t.h+r;e(t,t.blocks[s][a])}function m(t,e,n){var i=n/t.blocksPerLine|0,r=n%t.blocksPerLine;e(t,t.blocks[i][r])}var Q,k,b,_,x,D,S=i.length;D=h?0===o?0===a?function(t,e){var n=I(t.huffmanTableDC),i=0===n?0:y(n)<<A;t.pred+=i,e[0]=t.pred}:function(t,e){e[0]|=v()<<A}:0===a?function(t,e){if(C>0)C--;else for(var n=o,i=s;n<=i;){var r=I(t.huffmanTableAC),a=15&r,u=r>>4;if(0===a){if(u<15){C=p(u)+(1<<u)-1;break}n+=16}else e[mn[n+=u]]=y(a)*(1<<A),n++}}:function(t,e){for(var n=o,i=s,r=0;n<=i;){var a=mn[n],u=e[a]<0?-1:1;switch(B){case 0:var h=I(t.huffmanTableAC),l=15&h;if(r=h>>4,0===l)r<15?(C=p(r)+(1<<r),B=4):(r=16,B=1);else{if(1!==l)throw new Error("invalid ACn encoding");w=y(l),B=r?2:3}continue;case 1:case 2:e[a]?e[a]+=(v()<<A)*u:0==--r&&(B=2===B?3:0);break;case 3:e[a]?e[a]+=(v()<<A)*u:(e[a]=w<<A,B=0);break;case 4:e[a]&&(e[a]+=(v()<<A)*u)}n++}4===B&&0==--C&&(B=0)}:function(t,e){var n=I(t.huffmanTableDC),i=0===n?0:y(n);t.pred+=i,e[0]=t.pred;for(var r=1;r<64;){var o=I(t.huffmanTableAC),s=15&o,a=o>>4;if(0===s){if(a<15)break;r+=16}else e[mn[r+=a]]=y(s),r++}};var M,$,R=0;$=1===S?i[0].blocksPerLine*i[0].blocksPerColumn:u*n.mcusPerColumn;for(var F=r||$;R<$;){for(k=0;k<S;k++)i[k].pred=0;if(C=0,1===S)for(Q=i[0],x=0;x<F;x++)m(Q,D,R),R++;else for(x=0;x<F;x++){for(k=0;k<S;k++){var G=Q=i[k],L=G.h,N=G.v;for(b=0;b<N;b++)for(_=0;_<L;_++)E(Q,D,R,b,_)}if(++R===$)break}if(g=0,(M=t[c]<<8|t[c+1])<65280)throw new Error("marker was not found");if(!(M>=65488&&M<=65495))break;c+=2}return c-l}function Fn(t,e){var n=[],i=e.blocksPerLine,r=e.blocksPerColumn,o=i<<3,s=new Int32Array(64),a=new Uint8Array(64);function A(t,n,i){var r,o,s,a,A,u,h,l,c,f,d=e.quantizationTable,g=i;for(f=0;f<64;f++)g[f]=t[f]*d[f];for(f=0;f<8;++f){var v=8*f;0!==g[1+v]||0!==g[2+v]||0!==g[3+v]||0!==g[4+v]||0!==g[5+v]||0!==g[6+v]||0!==g[7+v]?(r=Sn*g[0+v]+128>>8,o=Sn*g[4+v]+128>>8,s=g[2+v],a=g[6+v],A=Mn*(g[1+v]-g[7+v])+128>>8,l=Mn*(g[1+v]+g[7+v])+128>>8,u=g[3+v]<<4,h=g[5+v]<<4,c=r-o+1>>1,r=r+o+1>>1,o=c,c=s*Dn+a*xn+128>>8,s=s*xn-a*Dn+128>>8,a=c,c=A-h+1>>1,A=A+h+1>>1,h=c,c=l+u+1>>1,u=l-u+1>>1,l=c,c=r-a+1>>1,r=r+a+1>>1,a=c,c=o-s+1>>1,o=o+s+1>>1,s=c,c=A*_n+l*bn+2048>>12,A=A*bn-l*_n+2048>>12,l=c,c=u*kn+h*Qn+2048>>12,u=u*Qn-h*kn+2048>>12,h=c,g[0+v]=r+l,g[7+v]=r-l,g[1+v]=o+h,g[6+v]=o-h,g[2+v]=s+u,g[5+v]=s-u,g[3+v]=a+A,g[4+v]=a-A):(c=Sn*g[0+v]+512>>10,g[0+v]=c,g[1+v]=c,g[2+v]=c,g[3+v]=c,g[4+v]=c,g[5+v]=c,g[6+v]=c,g[7+v]=c)}for(f=0;f<8;++f){var I=f;0!==g[8+I]||0!==g[16+I]||0!==g[24+I]||0!==g[32+I]||0!==g[40+I]||0!==g[48+I]||0!==g[56+I]?(r=Sn*g[0+I]+2048>>12,o=Sn*g[32+I]+2048>>12,s=g[16+I],a=g[48+I],A=Mn*(g[8+I]-g[56+I])+2048>>12,l=Mn*(g[8+I]+g[56+I])+2048>>12,u=g[24+I],h=g[40+I],c=r-o+1>>1,r=r+o+1>>1,o=c,c=s*Dn+a*xn+2048>>12,s=s*xn-a*Dn+2048>>12,a=c,c=A-h+1>>1,A=A+h+1>>1,h=c,c=l+u+1>>1,u=l-u+1>>1,l=c,c=r-a+1>>1,r=r+a+1>>1,a=c,c=o-s+1>>1,o=o+s+1>>1,s=c,c=A*_n+l*bn+2048>>12,A=A*bn-l*_n+2048>>12,l=c,c=u*kn+h*Qn+2048>>12,u=u*Qn-h*kn+2048>>12,h=c,g[0+I]=r+l,g[56+I]=r-l,g[8+I]=o+h,g[48+I]=o-h,g[16+I]=s+u,g[40+I]=s-u,g[24+I]=a+A,g[32+I]=a-A):(c=Sn*i[f+0]+8192>>14,g[0+I]=c,g[8+I]=c,g[16+I]=c,g[24+I]=c,g[32+I]=c,g[40+I]=c,g[48+I]=c,g[56+I]=c)}for(f=0;f<64;++f){var p=128+(g[f]+8>>4);n[f]=p<0?0:p>255?255:p}}for(var u=0;u<r;u++){for(var h=u<<3,l=0;l<8;l++)n.push(new Uint8Array(o));for(var c=0;c<i;c++){A(e.blocks[u][c],a,s);for(var f=0,d=c<<3,g=0;g<8;g++)for(var v=n[h+g],I=0;I<8;I++)v[d+I]=a[f++]}}return n}var Gn=function(){function t(){y(this,t),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return h(t,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(t){var e=0;function n(){var n=t[e]<<8|t[e+1];return e+=2,n}function i(t){var e,n,i=0,r=0;for(n in t.components)t.components.hasOwnProperty(n)&&(i<(e=t.components[n]).h&&(i=e.h),r<e.v&&(r=e.v));var o=Math.ceil(t.samplesPerLine/8/i),s=Math.ceil(t.scanLines/8/r);for(n in t.components)if(t.components.hasOwnProperty(n)){e=t.components[n];for(var a=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/i),A=Math.ceil(Math.ceil(t.scanLines/8)*e.v/r),u=o*e.h,h=s*e.v,l=[],c=0;c<h;c++){for(var f=[],d=0;d<u;d++)f.push(new Int32Array(64));l.push(f)}e.blocksPerLine=a,e.blocksPerColumn=A,e.blocks=l}t.maxH=i,t.maxV=r,t.mcusPerLine=o,t.mcusPerColumn=s}var r,o,s=n();if(65496!==s)throw new Error("SOI not found");for(s=n();65497!==s;){switch(s){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var a=(r=n(),o=t.subarray(e,e+r-2),e+=o.length,o);65504===s&&74===a[0]&&70===a[1]&&73===a[2]&&70===a[3]&&0===a[4]&&(this.jfif={version:{major:a[5],minor:a[6]},densityUnits:a[7],xDensity:a[8]<<8|a[9],yDensity:a[10]<<8|a[11],thumbWidth:a[12],thumbHeight:a[13],thumbData:a.subarray(14,14+3*a[12]*a[13])}),65518===s&&65===a[0]&&100===a[1]&&111===a[2]&&98===a[3]&&101===a[4]&&0===a[5]&&(this.adobe={version:a[6],flags0:a[7]<<8|a[8],flags1:a[9]<<8|a[10],transformCode:a[11]});break;case 65499:for(var A=n()+e-2;e<A;){var u=t[e++],h=new Int32Array(64);if(u>>4){if(u>>4!=1)throw new Error("DQT: invalid table spec");for(var l=0;l<64;l++)h[mn[l]]=n()}else for(var c=0;c<64;c++)h[mn[c]]=t[e++];this.quantizationTables[15&u]=h}break;case 65472:case 65473:case 65474:n();for(var f={extended:65473===s,progressive:65474===s,precision:t[e++],scanLines:n(),samplesPerLine:n(),components:{},componentsOrder:[]},d=t[e++],g=void 0,v=0;v<d;v++){g=t[e];var I=t[e+1]>>4,p=15&t[e+1],y=t[e+2];f.componentsOrder.push(g),f.components[g]={h:I,v:p,quantizationIdx:y},e+=3}i(f),this.frames.push(f);break;case 65476:for(var w=n(),C=2;C<w;){for(var B=t[e++],E=new Uint8Array(16),m=0,Q=0;Q<16;Q++,e++)E[Q]=t[e],m+=E[Q];for(var k=new Uint8Array(m),b=0;b<m;b++,e++)k[b]=t[e];C+=17+m,B>>4?this.huffmanTablesAC[15&B]=$n(E,k):this.huffmanTablesDC[15&B]=$n(E,k)}break;case 65501:n(),this.resetInterval=n();break;case 65498:n();for(var _=t[e++],x=[],D=this.frames[0],S=0;S<_;S++){var M=D.components[t[e++]],$=t[e++];M.huffmanTableDC=this.huffmanTablesDC[$>>4],M.huffmanTableAC=this.huffmanTablesAC[15&$],x.push(M)}var R=t[e++],F=t[e++],G=t[e++],L=Rn(t,e,D,x,this.resetInterval,R,F,G>>4,15&G);e+=L;break;case 65535:255!==t[e]&&e--;break;default:if(255===t[e-3]&&t[e-2]>=192&&t[e-2]<=254){e-=3;break}throw new Error("unknown JPEG marker ".concat(s.toString(16)))}s=n()}}},{key:"getResult",value:function(){var t=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length;for(var e=0;e<this.frames.length;e++)for(var n=this.frames[e].components,i=0,r=Object.keys(n);i<r.length;i++){var o=r[i];n[o].quantizationTable=this.quantizationTables[n[o].quantizationIdx],delete n[o].quantizationIdx}for(var s=t[0],a=s.components,A=s.componentsOrder,u=[],h=s.samplesPerLine,l=s.scanLines,c=0;c<A.length;c++){var f=a[A[c]];u.push({lines:Fn(0,f),scaleX:f.h/s.maxH,scaleY:f.v/s.maxV})}for(var d=new Uint8Array(h*l*u.length),g=0,v=0;v<l;++v)for(var I=0;I<h;++I)for(var p=0;p<u.length;++p){var y=u[p];d[g]=y.lines[0|v*y.scaleY][0|I*y.scaleX],++g}return d}}]),t}(),Ln=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(t){var i;return y(this,n),(i=e.call(this)).reader=new Gn,t.JPEGTables&&i.reader.parse(t.JPEGTables),i}return h(n,[{key:"decodeBlock",value:function(t){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(t)),this.reader.getResult().buffer}}]),n}(tn),Nn=Object.freeze({__proto__:null,default:Ln});function Un(t){for(var e=t.length;--e>=0;)t[e]=0}Un(new Array(576)),Un(new Array(60)),Un(new Array(512)),Un(new Array(256)),Un(new Array(29)),Un(new Array(30));var Tn=function(t,e,n,i){for(var r=65535&t,o=t>>>16&65535,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{o=o+(r=r+e[i++]|0)|0}while(--s);r%=65521,o%=65521}return r|o<<16},Pn=new Uint32Array(function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}()),qn=function(t,e,n,i){var r=Pn,o=i+n;t^=-1;for(var s=i;s<o;s++)t=t>>>8^r[255&(t^e[s])];return~t},On={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hn=0,zn=4,Kn=5,Vn=6,Jn=0,Yn=1,jn=2,Wn=-2,Xn=-3,Zn=-4,ti=-5,ei=8,ni=function(t,e){return{}.hasOwnProperty.call(t,e)},ii=function(t){for(var e=[].slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!==f(n))throw new TypeError(n+"must be non-object");for(var i in n)ni(n,i)&&(t[i]=n[i])}}return t},ri=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){ri=!1}for(var oi=new Uint8Array(256),si=0;si<256;si++)oi[si]=si>=252?6:si>=248?5:si>=240?4:si>=224?3:si>=192?2:1;oi[254]=oi[254]=1;var ai=function(t){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);var e,n,i,r,o,s=t.length,a=0;for(r=0;r<s;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),o=0,r=0;o<a;r++)55296==(64512&(n=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},Ai=function(t,e){var n,i,r=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));var o=new Array(2*r);for(i=0,n=0;n<r;){var s=t[n++];if(s<128)o[i++]=s;else{var a=oi[s];if(a>4)o[i++]=65533,n+=a-1;else{for(s&=2===a?31:3===a?15:7;a>1&&n<r;)s=s<<6|63&t[n++],a--;a>1?o[i++]=65533:s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|1023&s)}}}return function(t,e){if(e<65534&&t.subarray&&ri)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n}(o,i)},ui=function(t,e){(e=e||t.length)>t.length&&(e=t.length);for(var n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+oi[t[n]]>e?n:e},hi=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},li=function(t,e){var n,i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,C,B,E,m,Q,k=t.state;n=t.next_in,m=t.input,i=n+(t.avail_in-5),r=t.next_out,Q=t.output,o=r-(e-t.avail_out),s=r+(t.avail_out-257),a=k.dmax,A=k.wsize,u=k.whave,h=k.wnext,l=k.window,c=k.hold,f=k.bits,d=k.lencode,g=k.distcode,v=(1<<k.lenbits)-1,I=(1<<k.distbits)-1;t:do{f<15&&(c+=m[n++]<<f,f+=8,c+=m[n++]<<f,f+=8),p=d[c&v];e:for(;;){if(c>>>=y=p>>>24,f-=y,0==(y=p>>>16&255))Q[r++]=65535&p;else{if(!(16&y)){if(!(64&y)){p=d[(65535&p)+(c&(1<<y)-1)];continue e}if(32&y){k.mode=12;break t}t.msg="invalid literal/length code",k.mode=30;break t}w=65535&p,(y&=15)&&(f<y&&(c+=m[n++]<<f,f+=8),w+=c&(1<<y)-1,c>>>=y,f-=y),f<15&&(c+=m[n++]<<f,f+=8,c+=m[n++]<<f,f+=8),p=g[c&I];n:for(;;){if(c>>>=y=p>>>24,f-=y,!(16&(y=p>>>16&255))){if(!(64&y)){p=g[(65535&p)+(c&(1<<y)-1)];continue n}t.msg="invalid distance code",k.mode=30;break t}if(C=65535&p,f<(y&=15)&&(c+=m[n++]<<f,(f+=8)<y&&(c+=m[n++]<<f,f+=8)),(C+=c&(1<<y)-1)>a){t.msg="invalid distance too far back",k.mode=30;break t}if(c>>>=y,f-=y,C>(y=r-o)){if((y=C-y)>u&&k.sane){t.msg="invalid distance too far back",k.mode=30;break t}if(B=0,E=l,0===h){if(B+=A-y,y<w){w-=y;do{Q[r++]=l[B++]}while(--y);B=r-C,E=Q}}else if(h<y){if(B+=A+h-y,(y-=h)<w){w-=y;do{Q[r++]=l[B++]}while(--y);if(B=0,h<w){w-=y=h;do{Q[r++]=l[B++]}while(--y);B=r-C,E=Q}}}else if(B+=h-y,y<w){w-=y;do{Q[r++]=l[B++]}while(--y);B=r-C,E=Q}for(;w>2;)Q[r++]=E[B++],Q[r++]=E[B++],Q[r++]=E[B++],w-=3;w&&(Q[r++]=E[B++],w>1&&(Q[r++]=E[B++]))}else{B=r-C;do{Q[r++]=Q[B++],Q[r++]=Q[B++],Q[r++]=Q[B++],w-=3}while(w>2);w&&(Q[r++]=Q[B++],w>1&&(Q[r++]=Q[B++]))}break}}break}}while(n<i&&r<s);n-=w=f>>3,c&=(1<<(f-=w<<3))-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<s?s-r+257:257-(r-s),k.hold=c,k.bits=f},ci=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),fi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),di=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gi=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),vi=function(t,e,n,i,r,o,s,a){var A,u,h,l,c,f,d,g,v,I=a.bits,p=0,y=0,w=0,C=0,B=0,E=0,m=0,Q=0,k=0,b=0,_=null,x=0,D=new Uint16Array(16),S=new Uint16Array(16),M=null,$=0;for(p=0;p<=15;p++)D[p]=0;for(y=0;y<i;y++)D[e[n+y]]++;for(B=I,C=15;C>=1&&0===D[C];C--);if(B>C&&(B=C),0===C)return r[o++]=20971520,r[o++]=20971520,a.bits=1,0;for(w=1;w<C&&0===D[w];w++);for(B<w&&(B=w),Q=1,p=1;p<=15;p++)if(Q<<=1,(Q-=D[p])<0)return-1;if(Q>0&&(0===t||1!==C))return-1;for(S[1]=0,p=1;p<15;p++)S[p+1]=S[p]+D[p];for(y=0;y<i;y++)0!==e[n+y]&&(s[S[e[n+y]]++]=y);if(0===t?(_=M=s,f=19):1===t?(_=ci,x-=257,M=fi,$-=257,f=256):(_=di,M=gi,f=-1),b=0,y=0,p=w,c=o,E=B,m=0,h=-1,l=(k=1<<B)-1,1===t&&k>852||2===t&&k>592)return 1;for(;;){d=p-m,s[y]<f?(g=0,v=s[y]):s[y]>f?(g=M[$+s[y]],v=_[x+s[y]]):(g=96,v=0),A=1<<p-m,w=u=1<<E;do{r[c+(b>>m)+(u-=A)]=d<<24|g<<16|v}while(0!==u);for(A=1<<p-1;b&A;)A>>=1;if(0!==A?(b&=A-1,b+=A):b=0,y++,0==--D[p]){if(p===C)break;p=e[n+s[y]]}if(p>B&&(b&l)!==h){for(0===m&&(m=B),c+=w,Q=1<<(E=p-m);E+m<C&&!((Q-=D[E+m])<=0);)E++,Q<<=1;if(k+=1<<E,1===t&&k>852||2===t&&k>592)return 1;r[h=b&l]=B<<24|E<<16|c-o}}return 0!==b&&(r[c+b]=p-m<<24|64<<16),a.bits=B,0},Ii=zn,pi=Kn,yi=Vn,wi=Jn,Ci=Yn,Bi=jn,Ei=Wn,mi=Xn,Qi=Zn,ki=ti,bi=ei,_i=12,xi=30,Di=function(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)};function Si(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Mi,$i,Ri=function(t){if(!t||!t.state)return Ei;var e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,wi},Fi=function(t){if(!t||!t.state)return Ei;var e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ri(t)},Gi=function(t,e){var n;if(!t||!t.state)return Ei;var i=t.state;return e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Ei:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Fi(t))},Li=function(t,e){if(!t)return Ei;var n=new Si;t.state=n,n.window=null;var i=Gi(t,e);return i!==wi&&(t.state=null),i},Ni=!0,Ui=function(t){if(Ni){Mi=new Int32Array(512),$i=new Int32Array(32);for(var e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(vi(1,t.lens,0,288,Mi,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;vi(2,t.lens,0,32,$i,0,t.work,{bits:5}),Ni=!1}t.lencode=Mi,t.lenbits=9,t.distcode=$i,t.distbits=5},Ti=function(t,e,n,i){var r,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),o.window.set(e.subarray(n-i,n-i+r),o.wnext),(i-=r)?(o.window.set(e.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},Pi={inflateReset:Fi,inflateReset2:Gi,inflateResetKeep:Ri,inflateInit:function(t){return Li(t,15)},inflateInit2:Li,inflate:function(t,e){var n,i,r,o,s,a,A,u,h,l,c,f,d,g,v,I,p,y,w,C,B,E,m,Q,k=0,b=new Uint8Array(4),_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Ei;(n=t.state).mode===_i&&(n.mode=13),s=t.next_out,r=t.output,A=t.avail_out,o=t.next_in,i=t.input,a=t.avail_in,u=n.hold,h=n.bits,l=a,c=A,E=wi;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;h<16;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(2&n.wrap&&35615===u){n.check=0,b[0]=255&u,b[1]=u>>>8&255,n.check=qn(n.check,b,2,0),u=0,h=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=xi;break}if((15&u)!==bi){t.msg="unknown compression method",n.mode=xi;break}if(h-=4,B=8+(15&(u>>>=4)),0===n.wbits)n.wbits=B;else if(B>n.wbits){t.msg="invalid window size",n.mode=xi;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=512&u?10:_i,u=0,h=0;break;case 2:for(;h<16;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(n.flags=u,(255&n.flags)!==bi){t.msg="unknown compression method",n.mode=xi;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=xi;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(b[0]=255&u,b[1]=u>>>8&255,n.check=qn(n.check,b,2,0)),u=0,h=0,n.mode=3;case 3:for(;h<32;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.head&&(n.head.time=u),512&n.flags&&(b[0]=255&u,b[1]=u>>>8&255,b[2]=u>>>16&255,b[3]=u>>>24&255,n.check=qn(n.check,b,4,0)),u=0,h=0,n.mode=4;case 4:for(;h<16;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(b[0]=255&u,b[1]=u>>>8&255,n.check=qn(n.check,b,2,0)),u=0,h=0,n.mode=5;case 5:if(1024&n.flags){for(;h<16;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(b[0]=255&u,b[1]=u>>>8&255,n.check=qn(n.check,b,2,0)),u=0,h=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((f=n.length)>a&&(f=a),f&&(n.head&&(B=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+f),B)),512&n.flags&&(n.check=qn(n.check,i,f,o)),a-=f,o+=f,n.length-=f),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break t;f=0;do{B=i[o+f++],n.head&&B&&n.length<65536&&(n.head.name+=String.fromCharCode(B))}while(B&&f<a);if(512&n.flags&&(n.check=qn(n.check,i,f,o)),a-=f,o+=f,B)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break t;f=0;do{B=i[o+f++],n.head&&B&&n.length<65536&&(n.head.comment+=String.fromCharCode(B))}while(B&&f<a);if(512&n.flags&&(n.check=qn(n.check,i,f,o)),a-=f,o+=f,B)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;h<16;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(u!==(65535&n.check)){t.msg="header crc mismatch",n.mode=xi;break}u=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=_i;break;case 10:for(;h<32;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}t.adler=n.check=Di(u),u=0,h=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=s,t.avail_out=A,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,Bi;t.adler=n.check=1,n.mode=_i;case _i:if(e===pi||e===yi)break t;case 13:if(n.last){u>>>=7&h,h-=7&h,n.mode=27;break}for(;h<3;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}switch(n.last=1&u,h-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Ui(n),n.mode=20,e===yi){u>>>=2,h-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=xi}u>>>=2,h-=2;break;case 14:for(u>>>=7&h,h-=7&h;h<32;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=xi;break}if(n.length=65535&u,u=0,h=0,n.mode=15,e===yi)break t;case 15:n.mode=16;case 16:if(f=n.length){if(f>a&&(f=a),f>A&&(f=A),0===f)break t;r.set(i.subarray(o,o+f),s),a-=f,o+=f,A-=f,s+=f,n.length-=f;break}n.mode=_i;break;case 17:for(;h<14;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(n.nlen=257+(31&u),u>>>=5,h-=5,n.ndist=1+(31&u),u>>>=5,h-=5,n.ncode=4+(15&u),u>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=xi;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;h<3;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.lens[_[n.have++]]=7&u,u>>>=3,h-=3}for(;n.have<19;)n.lens[_[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,m={bits:n.lenbits},E=vi(0,n.lens,0,19,n.lencode,0,n.work,m),n.lenbits=m.bits,E){t.msg="invalid code lengths set",n.mode=xi;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;I=(k=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,p=65535&k,!((v=k>>>24)<=h);){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(p<16)u>>>=v,h-=v,n.lens[n.have++]=p;else{if(16===p){for(Q=v+2;h<Q;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(u>>>=v,h-=v,0===n.have){t.msg="invalid bit length repeat",n.mode=xi;break}B=n.lens[n.have-1],f=3+(3&u),u>>>=2,h-=2}else if(17===p){for(Q=v+3;h<Q;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}h-=v,B=0,f=3+(7&(u>>>=v)),u>>>=3,h-=3}else{for(Q=v+7;h<Q;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}h-=v,B=0,f=11+(127&(u>>>=v)),u>>>=7,h-=7}if(n.have+f>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=xi;break}for(;f--;)n.lens[n.have++]=B}}if(n.mode===xi)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=xi;break}if(n.lenbits=9,m={bits:n.lenbits},E=vi(1,n.lens,0,n.nlen,n.lencode,0,n.work,m),n.lenbits=m.bits,E){t.msg="invalid literal/lengths set",n.mode=xi;break}if(n.distbits=6,n.distcode=n.distdyn,m={bits:n.distbits},E=vi(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,m),n.distbits=m.bits,E){t.msg="invalid distances set",n.mode=xi;break}if(n.mode=20,e===yi)break t;case 20:n.mode=21;case 21:if(a>=6&&A>=258){t.next_out=s,t.avail_out=A,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,li(t,c),s=t.next_out,r=t.output,A=t.avail_out,o=t.next_in,i=t.input,a=t.avail_in,u=n.hold,h=n.bits,n.mode===_i&&(n.back=-1);break}for(n.back=0;I=(k=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,p=65535&k,!((v=k>>>24)<=h);){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(I&&!(240&I)){for(y=v,w=I,C=p;I=(k=n.lencode[C+((u&(1<<y+w)-1)>>y)])>>>16&255,p=65535&k,!(y+(v=k>>>24)<=h);){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}u>>>=y,h-=y,n.back+=y}if(u>>>=v,h-=v,n.back+=v,n.length=p,0===I){n.mode=26;break}if(32&I){n.back=-1,n.mode=_i;break}if(64&I){t.msg="invalid literal/length code",n.mode=xi;break}n.extra=15&I,n.mode=22;case 22:if(n.extra){for(Q=n.extra;h<Q;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;I=(k=n.distcode[u&(1<<n.distbits)-1])>>>16&255,p=65535&k,!((v=k>>>24)<=h);){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(!(240&I)){for(y=v,w=I,C=p;I=(k=n.distcode[C+((u&(1<<y+w)-1)>>y)])>>>16&255,p=65535&k,!(y+(v=k>>>24)<=h);){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}u>>>=y,h-=y,n.back+=y}if(u>>>=v,h-=v,n.back+=v,64&I){t.msg="invalid distance code",n.mode=xi;break}n.offset=p,n.extra=15&I,n.mode=24;case 24:if(n.extra){for(Q=n.extra;h<Q;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=xi;break}n.mode=25;case 25:if(0===A)break t;if(f=c-A,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=xi;break}f>n.wnext?(f-=n.wnext,d=n.wsize-f):d=n.wnext-f,f>n.length&&(f=n.length),g=n.window}else g=r,d=s-n.offset,f=n.length;f>A&&(f=A),A-=f,n.length-=f;do{r[s++]=g[d++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===A)break t;r[s++]=n.length,A--,n.mode=21;break;case 27:if(n.wrap){for(;h<32;){if(0===a)break t;a--,u|=i[o++]<<h,h+=8}if(c-=A,t.total_out+=c,n.total+=c,c&&(t.adler=n.check=n.flags?qn(n.check,r,c,s-c):Tn(n.check,r,c,s-c)),c=A,(n.flags?u:Di(u))!==n.check){t.msg="incorrect data check",n.mode=xi;break}u=0,h=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;h<32;){if(0===a)break t;a--,u+=i[o++]<<h,h+=8}if(u!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=xi;break}u=0,h=0}n.mode=29;case 29:E=Ci;break t;case xi:E=mi;break t;case 31:return Qi;default:return Ei}return t.next_out=s,t.avail_out=A,t.next_in=o,t.avail_in=a,n.hold=u,n.bits=h,(n.wsize||c!==t.avail_out&&n.mode<xi&&(n.mode<27||e!==Ii))&&Ti(t,t.output,t.next_out,c-t.avail_out),l-=t.avail_in,c-=t.avail_out,t.total_in+=l,t.total_out+=c,n.total+=c,n.wrap&&c&&(t.adler=n.check=n.flags?qn(n.check,r,c,t.next_out-c):Tn(n.check,r,c,t.next_out-c)),t.data_type=n.bits+(n.last?64:0)+(n.mode===_i?128:0)+(20===n.mode||15===n.mode?256:0),(0===l&&0===c||e===Ii)&&E===wi&&(E=ki),E},inflateEnd:function(t){if(!t||!t.state)return Ei;var e=t.state;return e.window&&(e.window=null),t.state=null,wi},inflateGetHeader:function(t,e){if(!t||!t.state)return Ei;var n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,wi):Ei},inflateSetDictionary:function(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?Ei:11===n.mode&&Tn(1,e,i,0)!==n.check?mi:Ti(t,e,i,i)?(n.mode=31,Qi):(n.havedict=1,wi):Ei},inflateInfo:"pako inflate (from Nodeca project)"},qi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Oi={}.toString,Hi=Hn,zi=zn,Ki=Jn,Vi=Yn,Ji=jn,Yi=Wn,ji=Xn,Wi=Zn;function Xi(t){this.options=ii({chunkSize:65536,windowBits:15,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hi,this.strm.avail_out=0;var n=Pi.inflateInit2(this.strm,e.windowBits);if(n!==Ki)throw new Error(On[n]);if(this.header=new qi,Pi.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=ai(e.dictionary):"[object ArrayBuffer]"===Oi.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Pi.inflateSetDictionary(this.strm,e.dictionary))!==Ki))throw new Error(On[n])}Xi.prototype.push=function(t,e){var n,i,r,o=this.strm,s=this.options.chunkSize,a=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?zi:Hi,"[object ArrayBuffer]"===Oi.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(s),o.next_out=0,o.avail_out=s),(n=Pi.inflate(o,i))===Ji&&a&&((n=Pi.inflateSetDictionary(o,a))===Ki?n=Pi.inflate(o,i):n===ji&&(n=Ji));o.avail_in>0&&n===Vi&&o.state.wrap>0&&0!==t[o.next_in];)Pi.inflateReset(o),n=Pi.inflate(o,i);switch(n){case Yi:case ji:case Ji:case Wi:return this.onEnd(n),this.ended=!0,!1}if(r=o.avail_out,o.next_out&&(0===o.avail_out||n===Vi))if("string"===this.options.to){var A=ui(o.output,o.next_out),u=o.next_out-A,h=Ai(o.output,A);o.next_out=u,o.avail_out=s-u,u&&o.output.set(o.output.subarray(A,A+u),0),this.onData(h)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(n!==Ki||0!==r){if(n===Vi)return n=Pi.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},Xi.prototype.onData=function(t){this.chunks.push(t)},Xi.prototype.onEnd=function(t){t===Ki&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(t){for(var e=0,n=0,i=t.length;n<i;n++)e+=t[n].length;for(var r=new Uint8Array(e),o=0,s=0,a=t.length;o<a;o++){var A=t[o];r.set(A,s),s+=A.length}return r}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Zi=function(t,e){var n=new Xi(e);if(n.push(t),n.err)throw n.msg||On[n.err];return n.result},tr=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(){return y(this,n),e.apply(this,arguments)}return h(n,[{key:"decodeBlock",value:function(t){return Zi(new Uint8Array(t)).buffer}}]),n}(tn),er=Object.freeze({__proto__:null,default:tr}),nr=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(){return y(this,n),e.apply(this,arguments)}return h(n,[{key:"decodeBlock",value:function(t){for(var e=new DataView(t),n=[],i=0;i<t.byteLength;++i){var r=e.getInt8(i);if(r<0){var o=e.getUint8(i+1);r=-r;for(var s=0;s<=r;++s)n.push(o);i+=1}else{for(var a=0;a<=r;++a)n.push(e.getUint8(i+a+1));i+=r+1}}return new Uint8Array(n).buffer}}]),n}(tn),ir=Object.freeze({__proto__:null,default:nr}),rr={exports:{}};!function(t){!function(){var e,n,i,r,o,s,a,A,u=(e={defaultNoDataValue:-34027999387901484e22,decode:function(t,s){var a=(s=s||{}).encodedMaskData||null===s.encodedMaskData,A=o(t,s.inputOffset||0,a),u=null!==s.noDataValue?s.noDataValue:e.defaultNoDataValue,h=n(A,s.pixelType||Float32Array,s.encodedMaskData,u,s.returnMask),l={width:A.width,height:A.height,pixelData:h.resultPixels,minValue:h.minValue,maxValue:A.pixels.maxValue,noDataValue:u};return h.resultMask&&(l.maskData=h.resultMask),s.returnEncodedMask&&A.mask&&(l.encodedMaskData=A.mask.bitset?A.mask.bitset:null),s.returnFileInfo&&(l.fileInfo=i(A),s.computeUsedBitDepths&&(l.fileInfo.bitDepths=r(A))),l}},n=function(t,e,n,i,r){var o,a,A,u=0,h=t.pixels.numBlocksX,l=t.pixels.numBlocksY,c=Math.floor(t.width/h),f=Math.floor(t.height/l),d=2*t.maxZError,g=Number.MAX_VALUE;n=n||(t.mask?t.mask.bitset:null),a=new e(t.width*t.height),r&&n&&(A=new Uint8Array(t.width*t.height));for(var v,I,p=new Float32Array(c*f),y=0;y<=l;y++){var w=y!==l?f:t.height%l;if(0!==w)for(var C=0;C<=h;C++){var B=C!==h?c:t.width%h;if(0!==B){var E,m,Q,k,b=y*t.width*f+C*c,_=t.width-B,x=t.pixels.blocks[u];if(x.encoding<2?(0===x.encoding?E=x.rawData:(s(x.stuffedData,x.bitsPerPixel,x.numValidPixels,x.offset,d,p,t.pixels.maxValue),E=p),m=0):Q=2===x.encoding?0:x.offset,n)for(I=0;I<w;I++){for(7&b&&(k=n[b>>3],k<<=7&b),v=0;v<B;v++)7&b||(k=n[b>>3]),128&k?(A&&(A[b]=1),g=g>(o=x.encoding<2?E[m++]:Q)?o:g,a[b++]=o):(A&&(A[b]=0),a[b++]=i),k<<=1;b+=_}else if(x.encoding<2)for(I=0;I<w;I++){for(v=0;v<B;v++)g=g>(o=E[m++])?o:g,a[b++]=o;b+=_}else for(g=g>Q?Q:g,I=0;I<w;I++){for(v=0;v<B;v++)a[b++]=Q;b+=_}if(1===x.encoding&&m!==x.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:a,resultMask:A,minValue:g}},i=function(t){return{fileIdentifierString:t.fileIdentifierString,fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:t.noDataValue}}},r=function(t){for(var e=t.pixels.numBlocksX*t.pixels.numBlocksY,n={},i=0;i<e;i++){var r=t.pixels.blocks[i];0===r.encoding?n.float32=!0:1===r.encoding?n[r.bitsPerPixel]=!0:n[0]=!0}return Object.keys(n)},o=function(t,e,n){var i={},r=new Uint8Array(t,e,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;e+=10;var o=new DataView(t,e,24);if(i.fileVersion=o.getInt32(0,!0),i.imageType=o.getInt32(4,!0),i.height=o.getUint32(8,!0),i.width=o.getUint32(12,!0),i.maxZError=o.getFloat64(16,!0),e+=24,!n)if(o=new DataView(t,e,16),i.mask={},i.mask.numBlocksY=o.getUint32(0,!0),i.mask.numBlocksX=o.getUint32(4,!0),i.mask.numBytes=o.getUint32(8,!0),i.mask.maxValue=o.getFloat32(12,!0),e+=16,i.mask.numBytes>0){var s=new Uint8Array(Math.ceil(i.width*i.height/8)),a=(o=new DataView(t,e,i.mask.numBytes)).getInt16(0,!0),A=2,u=0;do{if(a>0)for(;a--;)s[u++]=o.getUint8(A++);else{var h=o.getUint8(A++);for(a=-a;a--;)s[u++]=h}a=o.getInt16(A,!0),A+=2}while(A<i.mask.numBytes);if(-32768!==a||u<s.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=s,e+=i.mask.numBytes}else!(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));o=new DataView(t,e,16),i.pixels={},i.pixels.numBlocksY=o.getUint32(0,!0),i.pixels.numBlocksX=o.getUint32(4,!0),i.pixels.numBytes=o.getUint32(8,!0),i.pixels.maxValue=o.getFloat32(12,!0),e+=16;var l=i.pixels.numBlocksX,c=i.pixels.numBlocksY,f=l+(i.width%l>0?1:0),d=c+(i.height%c>0?1:0);i.pixels.blocks=new Array(f*d);for(var g=0,v=0;v<d;v++)for(var I=0;I<f;I++){var p=0,y=t.byteLength-e;o=new DataView(t,e,Math.min(10,y));var w={};i.pixels.blocks[g++]=w;var C=o.getUint8(0);if(p++,w.encoding=63&C,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==C&&2!==C){if(C>>=6,w.offsetType=C,2===C)w.offset=o.getInt8(1),p++;else if(1===C)w.offset=o.getInt16(1,!0),p+=2;else{if(0!==C)throw"Invalid block offset type";w.offset=o.getFloat32(1,!0),p+=4}if(1===w.encoding)if(C=o.getUint8(p),p++,w.bitsPerPixel=63&C,C>>=6,w.numValidPixelsType=C,2===C)w.numValidPixels=o.getUint8(p),p++;else if(1===C)w.numValidPixels=o.getUint16(p,!0),p+=2;else{if(0!==C)throw"Invalid valid pixel count type";w.numValidPixels=o.getUint32(p,!0),p+=4}}var B;if(e+=p,3!==w.encoding)if(0===w.encoding){var E=(i.pixels.numBytes-1)/4;if(E!==Math.floor(E))throw"uncompressed block has invalid length";B=new ArrayBuffer(4*E),new Uint8Array(B).set(new Uint8Array(t,e,4*E));var m=new Float32Array(B);w.rawData=m,e+=4*E}else if(1===w.encoding){var Q=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),k=Math.ceil(Q/4);B=new ArrayBuffer(4*k),new Uint8Array(B).set(new Uint8Array(t,e,Q)),w.stuffedData=new Uint32Array(B),e+=Q}}else e++}return i.eofOffset=e,i},s=function(t,e,n,i,r,o,s){var a,A,u,h=(1<<e)-1,l=0,c=0,f=Math.ceil((s-i)/r),d=4*t.length-Math.ceil(e*n/8);for(t[t.length-1]<<=8*d,a=0;a<n;a++){if(0===c&&(u=t[l++],c=32),c>=e)A=u>>>c-e&h,c-=e;else{var g=e-c;A=(u&h)<<g&h,A+=(u=t[l++])>>>(c=32-g)}o[a]=A<f?i+A*r:s}return o},e),h=function(){var t=function(t,e,n,i,r,o,s,a){var A,u,h,l,c,f=(1<<n)-1,d=0,g=0,v=4*t.length-Math.ceil(n*i/8);if(t[t.length-1]<<=8*v,r)for(A=0;A<i;A++)0===g&&(h=t[d++],g=32),g>=n?(u=h>>>g-n&f,g-=n):(u=(h&f)<<(l=n-g)&f,u+=(h=t[d++])>>>(g=32-l)),e[A]=r[u];else for(c=Math.ceil((a-o)/s),A=0;A<i;A++)0===g&&(h=t[d++],g=32),g>=n?(u=h>>>g-n&f,g-=n):(u=(h&f)<<(l=n-g)&f,u+=(h=t[d++])>>>(g=32-l)),e[A]=u<c?o+u*s:a},e=function(t,e,n,i,r,o,s,a){var A,u,h,l,c=(1<<n)-1,f=0,d=0,g=0;if(r)for(A=0;A<i;A++)0===d&&(h=t[f++],d=32,g=0),d>=n?(u=h>>>g&c,d-=n,g+=n):(u=h>>>g&c,d=32-(l=n-d),u|=((h=t[f++])&(1<<l)-1)<<n-l,g=l),e[A]=r[u];else{var v=Math.ceil((a-o)/s);for(A=0;A<i;A++)0===d&&(h=t[f++],d=32,g=0),d>=n?(u=h>>>g&c,d-=n,g+=n):(u=h>>>g&c,d=32-(l=n-d),u|=((h=t[f++])&(1<<l)-1)<<n-l,g=l),e[A]=u<v?o+u*s:a}return e},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(t){for(var e=65535,n=65535,i=t.length,r=Math.floor(i/2),o=0;r;){var s=r>=359?359:r;r-=s;do{e+=t[o++]<<8,n+=e+=t[o++]}while(--s);e=(65535&e)+(e>>>16),n=(65535&n)+(n>>>16)}return 1&i&&(n+=e+=t[o]<<8),((n=(65535&n)+(n>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(t,e){var n=e.ptr,i=new Uint8Array(t,n,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,i),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;n+=6;var o,s=new DataView(t,n,8),a=s.getInt32(0,!0);if(r.fileVersion=a,n+=4,a>=3&&(r.checksum=s.getUint32(4,!0),n+=4),s=new DataView(t,n,12),r.height=s.getUint32(0,!0),r.width=s.getUint32(4,!0),n+=8,a>=4?(r.numDims=s.getUint32(8,!0),n+=4):r.numDims=1,s=new DataView(t,n,40),r.numValidPixel=s.getUint32(0,!0),r.microBlockSize=s.getInt32(4,!0),r.blobSize=s.getInt32(8,!0),r.imageType=s.getInt32(12,!0),r.maxZError=s.getFloat64(16,!0),r.zMin=s.getFloat64(24,!0),r.zMax=s.getFloat64(32,!0),n+=40,e.headerInfo=r,e.ptr=n,a>=3&&(o=a>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(t,n-o,r.blobSize-14))!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(t,e){var n=e.headerInfo,i=this.getDataTypeArray(n.imageType),r=n.numDims*this.getDataTypeSize(n.imageType),o=this.readSubArray(t,e.ptr,i,r),s=this.readSubArray(t,e.ptr+r,i,r);e.ptr+=2*r;var a,A=!0;for(a=0;a<n.numDims;a++)if(o[a]!==s[a]){A=!1;break}return n.minValues=o,n.maxValues=s,A},readSubArray:function(t,e,n,i){var r;if(n===Uint8Array)r=new Uint8Array(t,e,i);else{var o=new ArrayBuffer(i);new Uint8Array(o).set(new Uint8Array(t,e,i)),r=new n(o)}return r},readMask:function(t,e){var n,i,r=e.ptr,o=e.headerInfo,s=o.width*o.height,a=o.numValidPixel,A=new DataView(t,r,4),u={};if(u.numBytes=A.getUint32(0,!0),r+=4,(0===a||s===a)&&0!==u.numBytes)throw"invalid mask";if(0===a)n=new Uint8Array(Math.ceil(s/8)),u.bitset=n,i=new Uint8Array(s),e.pixels.resultMask=i,r+=u.numBytes;else if(u.numBytes>0){n=new Uint8Array(Math.ceil(s/8));var h=(A=new DataView(t,r,u.numBytes)).getInt16(0,!0),l=2,c=0,f=0;do{if(h>0)for(;h--;)n[c++]=A.getUint8(l++);else for(f=A.getUint8(l++),h=-h;h--;)n[c++]=f;h=A.getInt16(l,!0),l+=2}while(l<u.numBytes);if(-32768!==h||c<n.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(s);var d=0,g=0;for(g=0;g<s;g++)7&g?(d=n[g>>3],d<<=7&g):d=n[g>>3],128&d&&(i[g]=1);e.pixels.resultMask=i,u.bitset=n,r+=u.numBytes}return e.ptr=r,e.mask=u,!0},readDataOneSweep:function(t,e,i,r){var o,s=e.ptr,a=e.headerInfo,A=a.numDims,u=a.width*a.height,h=a.imageType,l=a.numValidPixel*n.getDataTypeSize(h)*A,c=e.pixels.resultMask;if(i===Uint8Array)o=new Uint8Array(t,s,l);else{var f=new ArrayBuffer(l);new Uint8Array(f).set(new Uint8Array(t,s,l)),o=new i(f)}if(o.length===u*A)e.pixels.resultPixels=r?n.swapDimensionOrder(o,u,A,i,!0):o;else{e.pixels.resultPixels=new i(u*A);var d=0,g=0,v=0,I=0;if(A>1){if(r){for(g=0;g<u;g++)if(c[g])for(I=g,v=0;v<A;v++,I+=u)e.pixels.resultPixels[I]=o[d++]}else for(g=0;g<u;g++)if(c[g])for(I=g*A,v=0;v<A;v++)e.pixels.resultPixels[I+v]=o[d++]}else for(g=0;g<u;g++)c[g]&&(e.pixels.resultPixels[g]=o[d++])}return s+=l,e.ptr=s,!0},readHuffmanTree:function(t,e){var r=this.HUFFMAN_LUT_BITS_MAX,o=new DataView(t,e.ptr,16);if(e.ptr+=16,o.getInt32(0,!0)<2)throw"unsupported Huffman version";var s=o.getInt32(4,!0),a=o.getInt32(8,!0),A=o.getInt32(12,!0);if(a>=A)return!1;var u=new Uint32Array(A-a);n.decodeBits(t,e,u);var h,l,c,f,d=[];for(h=a;h<A;h++)d[l=h-(h<s?0:s)]={first:u[h-a],second:null};var g=t.byteLength-e.ptr,v=Math.ceil(g/4),I=new ArrayBuffer(4*v);new Uint8Array(I).set(new Uint8Array(t,e.ptr,g));var p,y=new Uint32Array(I),w=0,C=0;for(p=y[0],h=a;h<A;h++)(f=d[l=h-(h<s?0:s)].first)>0&&(d[l].second=p<<w>>>32-f,32-w>=f?32===(w+=f)&&(w=0,p=y[++C]):(w+=f-32,p=y[++C],d[l].second|=p>>>32-w));var B,E=0,m=new i;for(h=0;h<d.length;h++)void 0!==d[h]&&(E=Math.max(E,d[h].first));B=E>=r?r:E;var Q,k,b,_,x,D=[];for(h=a;h<A;h++)if((f=d[l=h-(h<s?0:s)].first)>0)if(Q=[f,l],f<=B)for(k=d[l].second<<B-f,b=1<<B-f,c=0;c<b;c++)D[k|c]=Q;else for(k=d[l].second,x=m,_=f-1;_>=0;_--)k>>>_&1?(x.right||(x.right=new i),x=x.right):(x.left||(x.left=new i),x=x.left),0!==_||x.val||(x.val=Q[1]);return{decodeLut:D,numBitsLUTQick:B,numBitsLUT:E,tree:m,stuffedData:y,srcPtr:C,bitPos:w}},readHuffman:function(t,e,i,r){var o,s,a,A,u,h,l,c,f,d=e.headerInfo.numDims,g=e.headerInfo.height,v=e.headerInfo.width,I=v*g,p=this.readHuffmanTree(t,e),y=p.decodeLut,w=p.tree,C=p.stuffedData,B=p.srcPtr,E=p.bitPos,m=p.numBitsLUTQick,Q=p.numBitsLUT,k=0===e.headerInfo.imageType?128:0,b=e.pixels.resultMask,_=0;E>0&&(B++,E=0);var x,D=C[B],S=1===e.encodeMode,M=new i(I*d),$=M;if(d<2||S){for(x=0;x<d;x++)if(d>1&&($=new i(M.buffer,I*x,I),_=0),e.headerInfo.numValidPixel===v*g)for(c=0,h=0;h<g;h++)for(l=0;l<v;l++,c++){if(s=0,u=A=D<<E>>>32-m,32-E<m&&(u=A|=C[B+1]>>>64-E-m),y[u])s=y[u][1],E+=y[u][0];else for(u=A=D<<E>>>32-Q,32-E<Q&&(u=A|=C[B+1]>>>64-E-Q),o=w,f=0;f<Q;f++)if(!(o=A>>>Q-f-1&1?o.right:o.left).left&&!o.right){s=o.val,E=E+f+1;break}E>=32&&(E-=32,D=C[++B]),a=s-k,S?(a+=l>0?_:h>0?$[c-v]:_,a&=255,$[c]=a,_=a):$[c]=a}else for(c=0,h=0;h<g;h++)for(l=0;l<v;l++,c++)if(b[c]){if(s=0,u=A=D<<E>>>32-m,32-E<m&&(u=A|=C[B+1]>>>64-E-m),y[u])s=y[u][1],E+=y[u][0];else for(u=A=D<<E>>>32-Q,32-E<Q&&(u=A|=C[B+1]>>>64-E-Q),o=w,f=0;f<Q;f++)if(!(o=A>>>Q-f-1&1?o.right:o.left).left&&!o.right){s=o.val,E=E+f+1;break}E>=32&&(E-=32,D=C[++B]),a=s-k,S?(l>0&&b[c-1]?a+=_:h>0&&b[c-v]?a+=$[c-v]:a+=_,a&=255,$[c]=a,_=a):$[c]=a}}else for(c=0,h=0;h<g;h++)for(l=0;l<v;l++)if(c=h*v+l,!b||b[c])for(x=0;x<d;x++,c+=I){if(s=0,u=A=D<<E>>>32-m,32-E<m&&(u=A|=C[B+1]>>>64-E-m),y[u])s=y[u][1],E+=y[u][0];else for(u=A=D<<E>>>32-Q,32-E<Q&&(u=A|=C[B+1]>>>64-E-Q),o=w,f=0;f<Q;f++)if(!(o=A>>>Q-f-1&1?o.right:o.left).left&&!o.right){s=o.val,E=E+f+1;break}E>=32&&(E-=32,D=C[++B]),a=s-k,$[c]=a}e.ptr=e.ptr+4*(B+1)+(E>0?4:0),e.pixels.resultPixels=M,d>1&&!r&&(e.pixels.resultPixels=n.swapDimensionOrder(M,I,d,i))},decodeBits:function(n,i,r,o,s){var a=i.headerInfo,A=a.fileVersion,u=0,h=n.byteLength-i.ptr>=5?5:n.byteLength-i.ptr,l=new DataView(n,i.ptr,h),c=l.getUint8(0);u++;var f=c>>6,d=0===f?4:3-f,g=(32&c)>0,v=31&c,I=0;if(1===d)I=l.getUint8(u),u++;else if(2===d)I=l.getUint16(u,!0),u+=2;else{if(4!==d)throw"Invalid valid pixel count type";I=l.getUint32(u,!0),u+=4}var p,y,w,C,B,E,m,Q,k,b=2*a.maxZError,_=a.numDims>1?a.maxValues[s]:a.zMax;if(g){for(i.counter.lut++,Q=l.getUint8(u),u++,C=Math.ceil((Q-1)*v/8),B=Math.ceil(C/4),y=new ArrayBuffer(4*B),w=new Uint8Array(y),i.ptr+=u,w.set(new Uint8Array(n,i.ptr,C)),m=new Uint32Array(y),i.ptr+=C,k=0;Q-1>>>k;)k++;C=Math.ceil(I*k/8),B=Math.ceil(C/4),y=new ArrayBuffer(4*B),(w=new Uint8Array(y)).set(new Uint8Array(n,i.ptr,C)),p=new Uint32Array(y),i.ptr+=C,E=A>=3?function(t,e,n,i,r,o){var s,a=(1<<e)-1,A=0,u=0,h=0,l=0,c=0,f=0,d=[],g=Math.ceil((o-i)/r);for(u=0;u<n;u++)0===l&&(s=t[A++],l=32,f=0),l>=e?(c=s>>>f&a,l-=e,f+=e):(c=s>>>f&a,l=32-(h=e-l),c|=((s=t[A++])&(1<<h)-1)<<e-h,f=h),d[u]=c<g?i+c*r:o;return d.unshift(i),d}(m,v,Q-1,o,b,_):function(t,e,n,i,r,o){var s,a=(1<<e)-1,A=0,u=0,h=0,l=0,c=0,f=[],d=4*t.length-Math.ceil(e*n/8);t[t.length-1]<<=8*d;var g=Math.ceil((o-i)/r);for(u=0;u<n;u++)0===l&&(s=t[A++],l=32),l>=e?(c=s>>>l-e&a,l-=e):(c=(s&a)<<(h=e-l)&a,c+=(s=t[A++])>>>(l=32-h)),f[u]=c<g?i+c*r:o;return f.unshift(i),f}(m,v,Q-1,o,b,_),A>=3?e(p,r,k,I,E):t(p,r,k,I,E)}else i.counter.bitstuffer++,k=v,i.ptr+=u,k>0&&(C=Math.ceil(I*k/8),B=Math.ceil(C/4),y=new ArrayBuffer(4*B),(w=new Uint8Array(y)).set(new Uint8Array(n,i.ptr,C)),p=new Uint32Array(y),i.ptr+=C,A>=3?null==o?function(t,e,n,i){var r,o,s,a,A=(1<<n)-1,u=0,h=0,l=0;for(r=0;r<i;r++)0===h&&(s=t[u++],h=32,l=0),h>=n?(o=s>>>l&A,h-=n,l+=n):(o=s>>>l&A,h=32-(a=n-h),o|=((s=t[u++])&(1<<a)-1)<<n-a,l=a),e[r]=o}(p,r,k,I):e(p,r,k,I,!1,o,b,_):null==o?function(t,e,n,i){var r,o,s,a,A=(1<<n)-1,u=0,h=0,l=4*t.length-Math.ceil(n*i/8);for(t[t.length-1]<<=8*l,r=0;r<i;r++)0===h&&(s=t[u++],h=32),h>=n?(o=s>>>h-n&A,h-=n):(o=(s&A)<<(a=n-h)&A,o+=(s=t[u++])>>>(h=32-a)),e[r]=o}(p,r,k,I):t(p,r,k,I,!1,o,b,_))},readTiles:function(t,e,i,r){var o=e.headerInfo,s=o.width,a=o.height,A=s*a,u=o.microBlockSize,h=o.imageType,l=n.getDataTypeSize(h),c=Math.ceil(s/u),f=Math.ceil(a/u);e.pixels.numBlocksY=f,e.pixels.numBlocksX=c,e.pixels.ptr=0;var d,g,v,I,p,y,w,C,B,E,m=0,Q=0,k=0,b=0,_=0,x=0,D=0,S=0,M=0,$=0,R=0,F=0,G=0,L=0,N=0,U=new i(u*u),T=a%u||u,P=s%u||u,q=o.numDims,O=e.pixels.resultMask,H=e.pixels.resultPixels,z=o.fileVersion>=5?14:15,K=o.zMax;for(k=0;k<f;k++)for(_=k!==f-1?u:T,b=0;b<c;b++)for($=k*s*u+b*u,R=s-(x=b!==c-1?u:P),C=0;C<q;C++){if(q>1?(E=H,$=k*s*u+b*u,H=new i(e.pixels.resultPixels.buffer,A*C*l,A),K=o.maxValues[C]):E=null,D=t.byteLength-e.ptr,g={},N=0,S=(d=new DataView(t,e.ptr,Math.min(10,D))).getUint8(0),N++,B=o.fileVersion>=5?4&S:0,M=S>>6&255,(S>>2&z)!=(b*u>>3&z))throw"integrity issue";if(B&&0===C)throw"integrity issue";if((p=3&S)>3)throw e.ptr+=N,"Invalid block encoding ("+p+")";if(2!==p)if(0===p){if(B)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=N,F=(F=_*x*l)<(G=t.byteLength-e.ptr)?F:G,v=new ArrayBuffer(F%l==0?F:F+l-F%l),new Uint8Array(v).set(new Uint8Array(t,e.ptr,F)),I=new i(v),L=0,O)for(m=0;m<_;m++){for(Q=0;Q<x;Q++)O[$]&&(H[$]=I[L++]),$++;$+=R}else for(m=0;m<_;m++){for(Q=0;Q<x;Q++)H[$++]=I[L++];$+=R}e.ptr+=L*l}else if(y=n.getDataTypeUsed(B&&h<6?4:h,M),w=n.getOnePixel(g,N,y,d),N+=n.getDataTypeSize(y),3===p)if(e.ptr+=N,e.counter.constantoffset++,O)for(m=0;m<_;m++){for(Q=0;Q<x;Q++)O[$]&&(H[$]=B?Math.min(K,E[$]+w):w),$++;$+=R}else for(m=0;m<_;m++){for(Q=0;Q<x;Q++)H[$]=B?Math.min(K,E[$]+w):w,$++;$+=R}else if(e.ptr+=N,n.decodeBits(t,e,U,w,C),N=0,B)if(O)for(m=0;m<_;m++){for(Q=0;Q<x;Q++)O[$]&&(H[$]=U[N++]+E[$]),$++;$+=R}else for(m=0;m<_;m++){for(Q=0;Q<x;Q++)H[$]=U[N++]+E[$],$++;$+=R}else if(O)for(m=0;m<_;m++){for(Q=0;Q<x;Q++)O[$]&&(H[$]=U[N++]),$++;$+=R}else for(m=0;m<_;m++){for(Q=0;Q<x;Q++)H[$++]=U[N++];$+=R}else{if(B)if(O)for(m=0;m<_;m++)for(Q=0;Q<x;Q++)O[$]&&(H[$]=E[$]),$++;else for(m=0;m<_;m++)for(Q=0;Q<x;Q++)H[$]=E[$],$++;e.counter.constant++,e.ptr+=N}}q>1&&!r&&(e.pixels.resultPixels=n.swapDimensionOrder(e.pixels.resultPixels,A,q,i))},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:n.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(t,e){var n=t.headerInfo.zMax,i=t.headerInfo.zMin,r=t.headerInfo.maxValues,o=t.headerInfo.numDims,s=t.headerInfo.height*t.headerInfo.width,a=0,A=0,u=0,h=t.pixels.resultMask,l=t.pixels.resultPixels;if(h)if(o>1){if(e)for(a=0;a<o;a++)for(u=a*s,n=r[a],A=0;A<s;A++)h[A]&&(l[u+A]=n);else for(A=0;A<s;A++)if(h[A])for(u=A*o,a=0;a<o;a++)l[u+o]=r[a]}else for(A=0;A<s;A++)h[A]&&(l[A]=n);else if(o>1&&i!==n)if(e)for(a=0;a<o;a++)for(u=a*s,n=r[a],A=0;A<s;A++)l[u+A]=n;else for(A=0;A<s;A++)for(u=A*o,a=0;a<o;a++)l[u+a]=r[a];else for(A=0;A<s*o;A++)l[A]=n},getDataTypeArray:function(t){var e;switch(t){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(t){var e;switch(t){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(t,e){if(null==e)return!1;var n;switch(t){case 0:n=e>=-128&&e<=127;break;case 1:n=e>=0&&e<=255;break;case 2:n=e>=-32768&&e<=32767;break;case 3:n=e>=0&&e<=65536;break;case 4:n=e>=-2147483648&&e<=2147483647;break;case 5:n=e>=0&&e<=4294967296;break;case 6:n=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:n=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:n=!1}return n},getDataTypeSize:function(t){var e=0;switch(t){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=t}return e},getDataTypeUsed:function(t,e){var n=t;switch(t){case 2:case 4:n=t-e;break;case 3:case 5:n=t-2*e;break;case 6:n=0===e?t:1===e?2:1;break;case 7:n=0===e?t:t-2*e+1;break;default:n=t}return n},getOnePixel:function(t,e,n,i){var r=0;switch(n){case 0:r=i.getInt8(e);break;case 1:r=i.getUint8(e);break;case 2:r=i.getInt16(e,!0);break;case 3:r=i.getUint16(e,!0);break;case 4:r=i.getInt32(e,!0);break;case 5:r=i.getUInt32(e,!0);break;case 6:r=i.getFloat32(e,!0);break;case 7:r=i.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return r},swapDimensionOrder:function(t,e,n,i,r){var o=0,s=0,a=0,A=0,u=t;if(n>1)if(u=new i(e*n),r)for(o=0;o<e;o++)for(A=o,a=0;a<n;a++,A+=e)u[A]=t[s++];else for(o=0;o<e;o++)for(A=o,a=0;a<n;a++,A+=e)u[s++]=t[A];return u}},i=function(t,e,n){this.val=t,this.left=e,this.right=n},r={decode:function(t,e){var i=(e=e||{}).noDataValue,r=0,o={};o.ptr=e.inputOffset||0,o.pixels={},n.readHeaderInfo(t,o);var s=o.headerInfo,a=s.fileVersion,A=n.getDataTypeArray(s.imageType);if(a>5)throw"unsupported lerc version 2."+a;n.readMask(t,o),s.numValidPixel===s.width*s.height||o.pixels.resultMask||(o.pixels.resultMask=e.maskData);var u=s.width*s.height;o.pixels.resultPixels=new A(u*s.numDims),o.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var h,l=!e.returnPixelInterleavedDims;if(0!==s.numValidPixel)if(s.zMax===s.zMin)n.constructConstantSurface(o,l);else if(a>=4&&n.checkMinMaxRanges(t,o))n.constructConstantSurface(o,l);else{var c=new DataView(t,o.ptr,2),f=c.getUint8(0);if(o.ptr++,f)n.readDataOneSweep(t,o,A,l);else if(a>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var d=c.getUint8(1);if(o.ptr++,o.encodeMode=d,d>2||a<4&&d>1)throw"Invalid Huffman flag "+d;d?n.readHuffman(t,o,A,l):n.readTiles(t,o,A,l)}else n.readTiles(t,o,A,l)}o.eofOffset=o.ptr,e.inputOffset?(h=o.headerInfo.blobSize+e.inputOffset-o.ptr,Math.abs(h)>=1&&(o.eofOffset=e.inputOffset+o.headerInfo.blobSize)):(h=o.headerInfo.blobSize-o.ptr,Math.abs(h)>=1&&(o.eofOffset=o.headerInfo.blobSize));var g={width:s.width,height:s.height,pixelData:o.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:o.pixels.resultMask};if(o.pixels.resultMask&&n.isValidPixelValue(s.imageType,i)){var v=o.pixels.resultMask;for(r=0;r<u;r++)v[r]||(g.pixelData[r]=i);g.noDataValue=i}return o.noDataValue=i,e.returnFileInfo&&(g.fileInfo=n.formatFileInfo(o)),g},getBandCount:function(t){for(var e=0,i=0,r={ptr:0,pixels:{}};i<t.byteLength-58;)n.readHeaderInfo(t,r),i+=r.headerInfo.blobSize,e++,r.ptr=i;return e}};return r}(),l=(a=new ArrayBuffer(4),A=new Uint8Array(a),new Uint32Array(a)[0]=1,1===A[0]),c={decode:function(t,e){if(!l)throw"Big endian system is not supported.";var n,i,r=(e=e||{}).inputOffset||0,o=new Uint8Array(t,r,10),s=String.fromCharCode.apply(null,o);if("CntZImage"===s.trim())n=u,i=1;else{if("Lerc2"!==s.substring(0,5))throw"Unexpected file identifier string: "+s;n=h,i=2}for(var a,A,c,f,d,g,v=0,I=t.byteLength-10,p=[],y={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},w=0;r<I;){var C=n.decode(t,{inputOffset:r,encodedMaskData:a,maskData:c,returnMask:0===v,returnEncodedMask:0===v,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});r=C.fileInfo.eofOffset,c=C.maskData,0===v&&(a=C.encodedMaskData,y.width=C.width,y.height=C.height,y.dimCount=C.dimCount||1,y.pixelType=C.pixelType||C.fileInfo.pixelType,y.mask=c),i>1&&(c&&p.push(c),C.fileInfo.mask&&C.fileInfo.mask.numBytes>0&&w++),v++,y.pixels.push(C.pixelData),y.statistics.push({minValue:C.minValue,maxValue:C.maxValue,noDataValue:C.noDataValue,dimStats:C.dimStats})}if(i>1&&w>1){for(g=y.width*y.height,y.bandMasks=p,(c=new Uint8Array(g)).set(p[0]),f=1;f<p.length;f++)for(A=p[f],d=0;d<g;d++)c[d]=c[d]&A[d];y.maskData=c}return y}};t.exports?t.exports=c:this.Lerc=c}()}(rr);var or,sr,ar,Ar=rr.exports,ur={env:{emscripten_notify_memory_growth:function(t){ar=new Uint8Array(sr.exports.memory.buffer)}}},hr=function(){function t(){y(this,t)}return h(t,[{key:"init",value:function(){return or||(or="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+lr).then((function(t){return t.arrayBuffer()})).then((function(t){return WebAssembly.instantiate(t,ur)})).then(this._n):WebAssembly.instantiate(Buffer.from(lr,"base64"),ur).then(this._n))}},{key:"_init",value:function(t){sr=t.instance,ur.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!sr)throw new Error("ZSTDDecoder: Await .init() before decoding.");var n=t.byteLength,i=sr.exports.malloc(n);ar.set(t,i),e=e||Number(sr.exports.ZSTD_findDecompressedSize(i,n));var r=sr.exports.malloc(e),o=sr.exports.ZSTD_decompress(r,e,i,n),s=ar.slice(r,r+o);return sr.exports.free(i),sr.exports.free(r),s}}]),t}(),lr="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",cr=new hr,fr=function(t){c(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(n);function n(t){var i;return y(this,n),(i=e.call(this)).planarConfiguration=void 0!==t.PlanarConfiguration?t.PlanarConfiguration:1,i.samplesPerPixel=void 0!==t.SamplesPerPixel?t.SamplesPerPixel:1,i.addCompression=t.LercParameters[rt.AddCompression],i}return h(n,[{key:"decodeBlock",value:function(t){switch(this.addCompression){case ot.None:break;case ot.Deflate:t=Zi(new Uint8Array(t)).buffer;break;case ot.Zstandard:t=cr.decode(new Uint8Array(t)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return Ar.decode(t,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),n}(tn),dr=Object.freeze({__proto__:null,zstd:cr,default:fr}),gr=function(t){c(i,t);var e,n=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=v(t);if(e){var r=v(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}(i);function i(){var t;if(y(this,i),t=n.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return t}return h(i,[{key:"decode",value:(e=A(C.mark((function t(e,n){var i,r,o,s;return C.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new Blob([n]),t.next=3,createImageBitmap(i);case 3:return r=t.sent,"undefined"!=typeof document?((o=document.createElement("canvas")).width=r.width,o.height=r.height):o=new OffscreenCanvas(r.width,r.height),(s=o.getContext("2d")).drawImage(r,0,0),t.abrupt("return",s.getImageData(0,0,r.width,r.height).data.buffer);case 8:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})}]),i}(tn),vr=Object.freeze({__proto__:null,default:gr}),Ir=Worker,pr=Object.freeze({__proto__:null,create:function(){var t='function A(A,e,t,i,r,I,g){try{var n=A[I](g),a=n.value}catch(A){return void t(A)}n.done?e(a):Promise.resolve(a).then(i,r)}function e(e){return function(){var t=this,i=arguments;return new Promise((function(r,I){var g=e.apply(t,i);function n(e){A(g,r,I,n,a,"next",e)}function a(e){A(g,r,I,n,a,"throw",e)}n(void 0)}))}}function t(A){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},t(A)}var i={exports:{}};!function(A){var e=function(A){var e,i=Object.prototype,r=i.hasOwnProperty,I="function"==typeof Symbol?Symbol:{},g=I.iterator||"@@iterator",n=I.asyncIterator||"@@asyncIterator",a=I.toStringTag||"@@toStringTag";function o(A,e,t){return Object.defineProperty(A,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),A[e]}try{o({},"")}catch(A){o=function(A,e,t){return A[e]=t}}function B(A,e,t,i){var r=e&&e.prototype instanceof h?e:h,I=Object.create(r.prototype),g=new S(i||[]);return I._invoke=function(A,e,t){var i=Q;return function(r,I){if(i===s)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw I;return R()}for(t.method=r,t.arg=I;;){var g=t.delegate;if(g){var n=m(g,t);if(n){if(n===c)continue;return n}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(i===Q)throw i=f,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);i=s;var a=C(A,e,t);if("normal"===a.type){if(i=t.done?f:E,a.arg===c)continue;return{value:a.arg,done:t.done}}"throw"===a.type&&(i=f,t.method="throw",t.arg=a.arg)}}}(A,t,g),I}function C(A,e,t){try{return{type:"normal",arg:A.call(e,t)}}catch(A){return{type:"throw",arg:A}}}A.wrap=B;var Q="suspendedStart",E="suspendedYield",s="executing",f="completed",c={};function h(){}function l(){}function u(){}var w={};o(w,g,(function(){return this}));var d=Object.getPrototypeOf,D=d&&d(d(v([])));D&&D!==i&&r.call(D,g)&&(w=D);var y=u.prototype=h.prototype=Object.create(w);function k(A){["next","throw","return"].forEach((function(e){o(A,e,(function(A){return this._invoke(e,A)}))}))}function p(A,e){function i(I,g,n,a){var o=C(A[I],A,g);if("throw"!==o.type){var B=o.arg,Q=B.value;return Q&&"object"===t(Q)&&r.call(Q,"__await")?e.resolve(Q.__await).then((function(A){i("next",A,n,a)}),(function(A){i("throw",A,n,a)})):e.resolve(Q).then((function(A){B.value=A,n(B)}),(function(A){return i("throw",A,n,a)}))}a(o.arg)}var I;this._invoke=function(A,t){function r(){return new e((function(e,r){i(A,t,e,r)}))}return I=I?I.then(r,r):r()}}function m(A,t){var i=A.iterator[t.method];if(i===e){if(t.delegate=null,"throw"===t.method){if(A.iterator.return&&(t.method="return",t.arg=e,m(A,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return c}var r=C(i,A.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var I=r.arg;return I?I.done?(t[A.resultName]=I.value,t.next=A.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,c):I:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function G(A){var e={tryLoc:A[0]};1 in A&&(e.catchLoc=A[1]),2 in A&&(e.finallyLoc=A[2],e.afterLoc=A[3]),this.tryEntries.push(e)}function F(A){var e=A.completion||{};e.type="normal",delete e.arg,A.completion=e}function S(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(G,this),this.reset(!0)}function v(A){if(A){var t=A[g];if(t)return t.call(A);if("function"==typeof A.next)return A;if(!isNaN(A.length)){var i=-1,I=function t(){for(;++i<A.length;)if(r.call(A,i))return t.value=A[i],t.done=!1,t;return t.value=e,t.done=!0,t};return I.next=I}}return{next:R}}function R(){return{value:e,done:!0}}return l.prototype=u,o(y,"constructor",u),o(u,"constructor",l),l.displayName=o(u,a,"GeneratorFunction"),A.isGeneratorFunction=function(A){var e="function"==typeof A&&A.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},A.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,u):(A.__proto__=u,o(A,a,"GeneratorFunction")),A.prototype=Object.create(y),A},A.awrap=function(A){return{__await:A}},k(p.prototype),o(p.prototype,n,(function(){return this})),A.AsyncIterator=p,A.async=function(e,t,i,r,I){void 0===I&&(I=Promise);var g=new p(B(e,t,i,r),I);return A.isGeneratorFunction(t)?g:g.next().then((function(A){return A.done?A.value:g.next()}))},k(y),o(y,a,"Generator"),o(y,g,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),A.keys=function(A){var e=[];for(var t in A)e.push(t);return e.reverse(),function t(){for(;e.length;){var i=e.pop();if(i in A)return t.value=i,t.done=!1,t}return t.done=!0,t}},A.values=v,S.prototype={constructor:S,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!A)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if("throw"===A.type)throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var t=this;function i(i,r){return n.type="throw",n.arg=A,t.next=i,r&&(t.method="next",t.arg=e),!!r}for(var I=this.tryEntries.length-1;I>=0;--I){var g=this.tryEntries[I],n=g.completion;if("root"===g.tryLoc)return i("end");if(g.tryLoc<=this.prev){var a=r.call(g,"catchLoc"),o=r.call(g,"finallyLoc");if(a&&o){if(this.prev<g.catchLoc)return i(g.catchLoc,!0);if(this.prev<g.finallyLoc)return i(g.finallyLoc)}else if(a){if(this.prev<g.catchLoc)return i(g.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return i(g.finallyLoc)}}}},abrupt:function(A,e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var I=i;break}}I&&("break"===A||"continue"===A)&&I.tryLoc<=e&&e<=I.finallyLoc&&(I=null);var g=I?I.completion:{};return g.type=A,g.arg=e,I?(this.method="next",this.next=I.finallyLoc,c):this.complete(g)},complete:function(A,e){if("throw"===A.type)throw A.arg;return"break"===A.type||"continue"===A.type?this.next=A.arg:"return"===A.type?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):"normal"===A.type&&e&&(this.next=e),c},finish:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===A)return this.complete(t.completion,t.afterLoc),F(t),c}},catch:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===A){var i=t.completion;if("throw"===i.type){var r=i.arg;F(t)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(A,t,i){return this.delegate={iterator:v(A),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=e),c}},A}(A.exports);try{regeneratorRuntime=e}catch(A){"object"===("undefined"==typeof globalThis?"undefined":t(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(i);var r=i.exports,I=new Map;function g(A,e){Array.isArray(A)||(A=[A]),A.forEach((function(A){return I.set(A,e)}))}function n(A){return a.apply(this,arguments)}function a(){return(a=e(r.mark((function A(e){var t,i;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:if(t=I.get(e.Compression)){A.next=3;break}throw new Error("Unknown compression method identifier: ".concat(e.Compression));case 3:return A.next=5,t();case 5:return i=A.sent,A.abrupt("return",new i(e));case 7:case"end":return A.stop()}}),A)})))).apply(this,arguments)}g([void 0,1],(function(){return Promise.resolve().then((function(){return y})).then((function(A){return A.default}))})),g(5,(function(){return Promise.resolve().then((function(){return F})).then((function(A){return A.default}))})),g(6,(function(){throw new Error("old style JPEG compression is not supported.")})),g(7,(function(){return Promise.resolve().then((function(){return N})).then((function(A){return A.default}))})),g([8,32946],(function(){return Promise.resolve().then((function(){return OA})).then((function(A){return A.default}))})),g(32773,(function(){return Promise.resolve().then((function(){return _A})).then((function(A){return A.default}))})),g(34887,(function(){return Promise.resolve().then((function(){return le})).then(function(){var A=e(r.mark((function A(e){return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,e.zstd.init();case 2:return A.abrupt("return",e);case 3:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}()).then((function(A){return A.default}))})),g(50001,(function(){return Promise.resolve().then((function(){return de})).then((function(A){return A.default}))}));var o=globalThis;function B(A,e){if(!(A instanceof e))throw new TypeError("Cannot call a class as a function")}function C(A,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(A,i.key,i)}}function Q(A,e,t){return e&&C(A.prototype,e),t&&C(A,t),A}function E(A,e){return E=Object.setPrototypeOf||function(A,e){return A.__proto__=e,A},E(A,e)}function s(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(e&&e.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),e&&E(A,e)}function f(A,e){if(e&&("object"===t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(A){if(void 0===A)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return A}(A)}function c(A){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},c(A)}function h(A,e){var t=A.length-e,i=0;do{for(var r=e;r>0;r--)A[i+e]+=A[i],i++;t-=e}while(t>0)}function l(A,e,t){for(var i=0,r=A.length,I=r/t;r>e;){for(var g=e;g>0;--g)A[i+e]+=A[i],++i;r-=e}for(var n=A.slice(),a=0;a<I;++a)for(var o=0;o<t;++o)A[t*a+o]=n[(t-o-1)*I+a]}function u(A,e,t,i,r,I){if(!e||1===e)return A;for(var g=0;g<r.length;++g){if(r[g]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(r[g]!==r[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var n=r[0]/8,a=2===I?1:r.length,o=0;o<i&&!(o*a*t*n>=A.byteLength);++o){var B=void 0;if(2===e){switch(r[0]){case 8:B=new Uint8Array(A,o*a*t*n,a*t*n);break;case 16:B=new Uint16Array(A,o*a*t*n,a*t*n/2);break;case 32:B=new Uint32Array(A,o*a*t*n,a*t*n/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(r[0]," bits per sample."))}h(B,a)}else 3===e&&l(B=new Uint8Array(A,o*a*t*n,a*t*n),a,n)}return A}o.addEventListener("message",function(){var A=e(r.mark((function A(e){var t,i,I,g,a,B;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return t=e.data,i=t.id,I=t.fileDirectory,g=t.buffer,A.next=3,n(I);case 3:return a=A.sent,A.next=6,a.decode(I,g);case 6:B=A.sent,o.postMessage({decoded:B,id:i},[B]);case 8:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}());var w=function(){function A(){B(this,A)}var t;return Q(A,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n,a;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.decodeBlock(t);case 2:if(i=A.sent,1===(I=e.Predictor||1)){A.next=9;break}return g=!e.StripOffsets,n=g?e.TileWidth:e.ImageWidth,a=g?e.TileLength:e.RowsPerStrip||e.ImageLength,A.abrupt("return",u(i,I,n,a,e.BitsPerSample,e.PlanarConfiguration));case 9:return A.abrupt("return",i);case 10:case"end":return A.stop()}}),A,this)}))),function(A,e){return t.apply(this,arguments)})}]),A}();function d(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var D=function(A){s(t,w);var e=d(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return A}}]),t}(),y=Object.freeze({__proto__:null,default:D});function k(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}function p(A,e){for(var t=e.length-1;t>=0;t--)A.push(e[t]);return A}function m(A){for(var e=new Uint16Array(4093),t=new Uint8Array(4093),i=0;i<=257;i++)e[i]=4096,t[i]=i;var r=258,I=9,g=0;function n(){r=258,I=9}function a(A){var e=function(A,e,t){var i=e%8,r=Math.floor(e/8),I=8-i,g=e+t-8*(r+1),n=8*(r+2)-(e+t),a=8*(r+2)-e;if(n=Math.max(0,n),r>=A.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var o=A[r]&Math.pow(2,8-i)-1,B=o<<=t-I;if(r+1<A.length){var C=A[r+1]>>>n;B+=C<<=Math.max(0,t-a)}if(g>8&&r+2<A.length){var Q=8*(r+3)-(e+t);B+=A[r+2]>>>Q}return B}(A,g,I);return g+=I,e}function o(A,i){return t[r]=i,e[r]=A,++r-1}function B(A){for(var i=[],r=A;4096!==r;r=e[r])i.push(t[r]);return i}var C=[];n();for(var Q,E=new Uint8Array(A),s=a(E);257!==s;){if(256===s){for(n(),s=a(E);256===s;)s=a(E);if(257===s)break;if(s>256)throw new Error("corrupted code at scanline ".concat(s));p(C,B(s)),Q=s}else if(s<r){var f=B(s);p(C,f),o(Q,f[f.length-1]),Q=s}else{var c=B(Q);if(!c)throw new Error("Bogus entry. Not in dictionary, ".concat(Q," / ").concat(r,", position: ").concat(g));p(C,c),C.push(c[c.length-1]),o(Q,c[c.length-1]),Q=s}r+1>=Math.pow(2,I)&&(12===I?Q=void 0:I++),s=a(E)}return new Uint8Array(C)}var G=function(A){s(t,w);var e=k(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return m(A).buffer}}]),t}(),F=Object.freeze({__proto__:null,default:G});function S(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var v=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function R(A,e){for(var t=0,i=[],r=16;r>0&&!A[r-1];)--r;i.push({children:[],index:0});for(var I,g=i[0],n=0;n<r;n++){for(var a=0;a<A[n];a++){for((g=i.pop()).children[g.index]=e[t];g.index>0;)g=i.pop();for(g.index++,i.push(g);i.length<=n;)i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I;t++}n+1<r&&(i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I)}return i[0].children}function U(A,e,i,r,I,g,n,a,o){var B=i.mcusPerLine,C=i.progressive,Q=e,E=e,s=0,f=0;function c(){if(f>0)return f--,s>>f&1;if(255===(s=A[E++])){var e=A[E++];if(e)throw new Error("unexpected marker: ".concat((s<<8|e).toString(16)))}return f=7,s>>>7}function h(A){for(var e,i=A;null!==(e=c());){if("number"==typeof(i=i[e]))return i;if("object"!==t(i))throw new Error("invalid huffman sequence")}return null}function l(A){for(var e=A,t=0;e>0;){var i=c();if(null===i)return;t=t<<1|i,--e}return t}function u(A){var e=l(A);return e>=1<<A-1?e:e+(-1<<A)+1}var w=0;var d,D=0;function y(A,e,t,i,r){var I=t%B,g=(t/B|0)*A.v+i,n=I*A.h+r;e(A,A.blocks[g][n])}function k(A,e,t){var i=t/A.blocksPerLine|0,r=t%A.blocksPerLine;e(A,A.blocks[i][r])}var p,m,G,F,S,R,U=r.length;R=C?0===g?0===a?function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t)<<o;A.pred+=i,e[0]=A.pred}:function(A,e){e[0]|=c()<<o}:0===a?function(A,e){if(w>0)w--;else for(var t=g,i=n;t<=i;){var r=h(A.huffmanTableAC),I=15&r,a=r>>4;if(0===I){if(a<15){w=l(a)+(1<<a)-1;break}t+=16}else e[v[t+=a]]=u(I)*(1<<o),t++}}:function(A,e){for(var t=g,i=n,r=0;t<=i;){var I=v[t],a=e[I]<0?-1:1;switch(D){case 0:var B=h(A.huffmanTableAC),C=15&B;if(r=B>>4,0===C)r<15?(w=l(r)+(1<<r),D=4):(r=16,D=1);else{if(1!==C)throw new Error("invalid ACn encoding");d=u(C),D=r?2:3}continue;case 1:case 2:e[I]?e[I]+=(c()<<o)*a:0==--r&&(D=2===D?3:0);break;case 3:e[I]?e[I]+=(c()<<o)*a:(e[I]=d<<o,D=0);break;case 4:e[I]&&(e[I]+=(c()<<o)*a)}t++}4===D&&0==--w&&(D=0)}:function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t);A.pred+=i,e[0]=A.pred;for(var r=1;r<64;){var I=h(A.huffmanTableAC),g=15&I,n=I>>4;if(0===g){if(n<15)break;r+=16}else e[v[r+=n]]=u(g),r++}};var L,b,M=0;b=1===U?r[0].blocksPerLine*r[0].blocksPerColumn:B*i.mcusPerColumn;for(var N=I||b;M<b;){for(m=0;m<U;m++)r[m].pred=0;if(w=0,1===U)for(p=r[0],S=0;S<N;S++)k(p,R,M),M++;else for(S=0;S<N;S++){for(m=0;m<U;m++){var x=p=r[m],J=x.h,q=x.v;for(G=0;G<q;G++)for(F=0;F<J;F++)y(p,R,M,G,F)}if(++M===b)break}if(f=0,(L=A[E]<<8|A[E+1])<65280)throw new Error("marker was not found");if(!(L>=65488&&L<=65495))break;E+=2}return E-Q}function L(A,e){var t=[],i=e.blocksPerLine,r=e.blocksPerColumn,I=i<<3,g=new Int32Array(64),n=new Uint8Array(64);function a(A,t,i){var r,I,g,n,a,o,B,C,Q,E,s=e.quantizationTable,f=i;for(E=0;E<64;E++)f[E]=A[E]*s[E];for(E=0;E<8;++E){var c=8*E;0!==f[1+c]||0!==f[2+c]||0!==f[3+c]||0!==f[4+c]||0!==f[5+c]||0!==f[6+c]||0!==f[7+c]?(r=5793*f[0+c]+128>>8,I=5793*f[4+c]+128>>8,g=f[2+c],n=f[6+c],a=2896*(f[1+c]-f[7+c])+128>>8,C=2896*(f[1+c]+f[7+c])+128>>8,o=f[3+c]<<4,Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+128>>8,g=1567*g-3784*n+128>>8,n=Q,Q=a-(B=f[5+c]<<4)+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+c]=r+C,f[7+c]=r-C,f[1+c]=I+B,f[6+c]=I-B,f[2+c]=g+o,f[5+c]=g-o,f[3+c]=n+a,f[4+c]=n-a):(Q=5793*f[0+c]+512>>10,f[0+c]=Q,f[1+c]=Q,f[2+c]=Q,f[3+c]=Q,f[4+c]=Q,f[5+c]=Q,f[6+c]=Q,f[7+c]=Q)}for(E=0;E<8;++E){var h=E;0!==f[8+h]||0!==f[16+h]||0!==f[24+h]||0!==f[32+h]||0!==f[40+h]||0!==f[48+h]||0!==f[56+h]?(r=5793*f[0+h]+2048>>12,I=5793*f[32+h]+2048>>12,g=f[16+h],n=f[48+h],a=2896*(f[8+h]-f[56+h])+2048>>12,C=2896*(f[8+h]+f[56+h])+2048>>12,o=f[24+h],Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+2048>>12,g=1567*g-3784*n+2048>>12,n=Q,Q=a-(B=f[40+h])+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+h]=r+C,f[56+h]=r-C,f[8+h]=I+B,f[48+h]=I-B,f[16+h]=g+o,f[40+h]=g-o,f[24+h]=n+a,f[32+h]=n-a):(Q=5793*i[E+0]+8192>>14,f[0+h]=Q,f[8+h]=Q,f[16+h]=Q,f[24+h]=Q,f[32+h]=Q,f[40+h]=Q,f[48+h]=Q,f[56+h]=Q)}for(E=0;E<64;++E){var l=128+(f[E]+8>>4);t[E]=l<0?0:l>255?255:l}}for(var o=0;o<r;o++){for(var B=o<<3,C=0;C<8;C++)t.push(new Uint8Array(I));for(var Q=0;Q<i;Q++){a(e.blocks[o][Q],n,g);for(var E=0,s=Q<<3,f=0;f<8;f++)for(var c=t[B+f],h=0;h<8;h++)c[s+h]=n[E++]}}return t}var b=function(){function A(){B(this,A),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return Q(A,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(A){var e=0;function t(){var t=A[e]<<8|A[e+1];return e+=2,t}function i(A){var e,t,i=0,r=0;for(t in A.components)A.components.hasOwnProperty(t)&&(i<(e=A.components[t]).h&&(i=e.h),r<e.v&&(r=e.v));var I=Math.ceil(A.samplesPerLine/8/i),g=Math.ceil(A.scanLines/8/r);for(t in A.components)if(A.components.hasOwnProperty(t)){e=A.components[t];for(var n=Math.ceil(Math.ceil(A.samplesPerLine/8)*e.h/i),a=Math.ceil(Math.ceil(A.scanLines/8)*e.v/r),o=I*e.h,B=g*e.v,C=[],Q=0;Q<B;Q++){for(var E=[],s=0;s<o;s++)E.push(new Int32Array(64));C.push(E)}e.blocksPerLine=n,e.blocksPerColumn=a,e.blocks=C}A.maxH=i,A.maxV=r,A.mcusPerLine=I,A.mcusPerColumn=g}var r,I,g=t();if(65496!==g)throw new Error("SOI not found");for(g=t();65497!==g;){switch(g){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var n=(r=void 0,I=void 0,r=t(),I=A.subarray(e,e+r-2),e+=I.length,I);65504===g&&74===n[0]&&70===n[1]&&73===n[2]&&70===n[3]&&0===n[4]&&(this.jfif={version:{major:n[5],minor:n[6]},densityUnits:n[7],xDensity:n[8]<<8|n[9],yDensity:n[10]<<8|n[11],thumbWidth:n[12],thumbHeight:n[13],thumbData:n.subarray(14,14+3*n[12]*n[13])}),65518===g&&65===n[0]&&100===n[1]&&111===n[2]&&98===n[3]&&101===n[4]&&0===n[5]&&(this.adobe={version:n[6],flags0:n[7]<<8|n[8],flags1:n[9]<<8|n[10],transformCode:n[11]});break;case 65499:for(var a=t()+e-2;e<a;){var o=A[e++],B=new Int32Array(64);if(o>>4==0)for(var C=0;C<64;C++){B[v[C]]=A[e++]}else{if(o>>4!=1)throw new Error("DQT: invalid table spec");for(var Q=0;Q<64;Q++){B[v[Q]]=t()}}this.quantizationTables[15&o]=B}break;case 65472:case 65473:case 65474:t();for(var E={extended:65473===g,progressive:65474===g,precision:A[e++],scanLines:t(),samplesPerLine:t(),components:{},componentsOrder:[]},s=A[e++],f=void 0,c=0;c<s;c++){f=A[e];var h=A[e+1]>>4,l=15&A[e+1],u=A[e+2];E.componentsOrder.push(f),E.components[f]={h:h,v:l,quantizationIdx:u},e+=3}i(E),this.frames.push(E);break;case 65476:for(var w=t(),d=2;d<w;){for(var D=A[e++],y=new Uint8Array(16),k=0,p=0;p<16;p++,e++)y[p]=A[e],k+=y[p];for(var m=new Uint8Array(k),G=0;G<k;G++,e++)m[G]=A[e];d+=17+k,D>>4==0?this.huffmanTablesDC[15&D]=R(y,m):this.huffmanTablesAC[15&D]=R(y,m)}break;case 65501:t(),this.resetInterval=t();break;case 65498:t();for(var F=A[e++],S=[],L=this.frames[0],b=0;b<F;b++){var M=L.components[A[e++]],N=A[e++];M.huffmanTableDC=this.huffmanTablesDC[N>>4],M.huffmanTableAC=this.huffmanTablesAC[15&N],S.push(M)}var x=A[e++],J=A[e++],q=A[e++],Y=U(A,e,L,S,this.resetInterval,x,J,q>>4,15&q);e+=Y;break;case 65535:255!==A[e]&&e--;break;default:if(255===A[e-3]&&A[e-2]>=192&&A[e-2]<=254){e-=3;break}throw new Error("unknown JPEG marker ".concat(g.toString(16)))}g=t()}}},{key:"getResult",value:function(){var A=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var e=0;e<this.frames.length;e++)for(var t=this.frames[e].components,i=0,r=Object.keys(t);i<r.length;i++){var I=r[i];t[I].quantizationTable=this.quantizationTables[t[I].quantizationIdx],delete t[I].quantizationIdx}for(var g=A[0],n=g.components,a=g.componentsOrder,o=[],B=g.samplesPerLine,C=g.scanLines,Q=0;Q<a.length;Q++){var E=n[a[Q]];o.push({lines:L(0,E),scaleX:E.h/g.maxH,scaleY:E.v/g.maxV})}for(var s=new Uint8Array(B*C*o.length),f=0,c=0;c<C;++c)for(var h=0;h<B;++h)for(var l=0;l<o.length;++l){var u=o[l];s[f]=u.lines[0|c*u.scaleY][0|h*u.scaleX],++f}return s}}]),A}(),M=function(A){s(t,w);var e=S(t);function t(A){var i;return B(this,t),(i=e.call(this)).reader=new b,A.JPEGTables&&i.reader.parse(A.JPEGTables),i}return Q(t,[{key:"decodeBlock",value:function(A){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(A)),this.reader.getResult().buffer}}]),t}(),N=Object.freeze({__proto__:null,default:M});function x(A){for(var e=A.length;--e>=0;)A[e]=0}x(new Array(576)),x(new Array(60)),x(new Array(512)),x(new Array(256)),x(new Array(29)),x(new Array(30));var J=function(A,e,t,i){for(var r=65535&A|0,I=A>>>16&65535|0,g=0;0!==t;){t-=g=t>2e3?2e3:t;do{I=I+(r=r+e[i++]|0)|0}while(--g);r%=65521,I%=65521}return r|I<<16|0},q=new Uint32Array(function(){for(var A,e=[],t=0;t<256;t++){A=t;for(var i=0;i<8;i++)A=1&A?3988292384^A>>>1:A>>>1;e[t]=A}return e}()),Y=function(A,e,t,i){var r=q,I=i+t;A^=-1;for(var g=i;g<I;g++)A=A>>>8^r[255&(A^e[g])];return-1^A},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},O=function(A,e){return Object.prototype.hasOwnProperty.call(A,e)},P=function(A){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!==t(i))throw new TypeError(i+"must be non-object");for(var r in i)O(i,r)&&(A[r]=i[r])}}return A},T=function(A){for(var e=0,t=0,i=A.length;t<i;t++)e+=A[t].length;for(var r=new Uint8Array(e),I=0,g=0,n=A.length;I<n;I++){var a=A[I];r.set(a,g),g+=a.length}return r},V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){V=!1}for(var _=new Uint8Array(256),X=0;X<256;X++)_[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;_[254]=_[254]=1;var Z=function(A){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(A);var e,t,i,r,I,g=A.length,n=0;for(r=0;r<g;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),n+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(n),I=0,r=0;I<n;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),t<128?e[I++]=t:t<2048?(e[I++]=192|t>>>6,e[I++]=128|63&t):t<65536?(e[I++]=224|t>>>12,e[I++]=128|t>>>6&63,e[I++]=128|63&t):(e[I++]=240|t>>>18,e[I++]=128|t>>>12&63,e[I++]=128|t>>>6&63,e[I++]=128|63&t);return e},j=function(A,e){var t,i,r=e||A.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(A.subarray(0,e));var I=new Array(2*r);for(i=0,t=0;t<r;){var g=A[t++];if(g<128)I[i++]=g;else{var n=_[g];if(n>4)I[i++]=65533,t+=n-1;else{for(g&=2===n?31:3===n?15:7;n>1&&t<r;)g=g<<6|63&A[t++],n--;n>1?I[i++]=65533:g<65536?I[i++]=g:(g-=65536,I[i++]=55296|g>>10&1023,I[i++]=56320|1023&g)}}}return function(A,e){if(e<65534&&A.subarray&&V)return String.fromCharCode.apply(null,A.length===e?A:A.subarray(0,e));for(var t="",i=0;i<e;i++)t+=String.fromCharCode(A[i]);return t}(I,i)},W=function(A,e){(e=e||A.length)>A.length&&(e=A.length);for(var t=e-1;t>=0&&128==(192&A[t]);)t--;return t<0||0===t?e:t+_[A[t]]>e?t:e};var z=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$=function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=A.state;t=A.next_in,k=A.input,i=t+(A.avail_in-5),r=A.next_out,p=A.output,I=r-(e-A.avail_out),g=r+(A.avail_out-257),n=m.dmax,a=m.wsize,o=m.whave,B=m.wnext,C=m.window,Q=m.hold,E=m.bits,s=m.lencode,f=m.distcode,c=(1<<m.lenbits)-1,h=(1<<m.distbits)-1;A:do{E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=s[Q&c];e:for(;;){if(Q>>>=u=l>>>24,E-=u,0===(u=l>>>16&255))p[r++]=65535&l;else{if(!(16&u)){if(0==(64&u)){l=s[(65535&l)+(Q&(1<<u)-1)];continue e}if(32&u){m.mode=12;break A}A.msg="invalid literal/length code",m.mode=30;break A}w=65535&l,(u&=15)&&(E<u&&(Q+=k[t++]<<E,E+=8),w+=Q&(1<<u)-1,Q>>>=u,E-=u),E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=f[Q&h];t:for(;;){if(Q>>>=u=l>>>24,E-=u,!(16&(u=l>>>16&255))){if(0==(64&u)){l=f[(65535&l)+(Q&(1<<u)-1)];continue t}A.msg="invalid distance code",m.mode=30;break A}if(d=65535&l,E<(u&=15)&&(Q+=k[t++]<<E,(E+=8)<u&&(Q+=k[t++]<<E,E+=8)),(d+=Q&(1<<u)-1)>n){A.msg="invalid distance too far back",m.mode=30;break A}if(Q>>>=u,E-=u,d>(u=r-I)){if((u=d-u)>o&&m.sane){A.msg="invalid distance too far back",m.mode=30;break A}if(D=0,y=C,0===B){if(D+=a-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}else if(B<u){if(D+=a+B-u,(u-=B)<w){w-=u;do{p[r++]=C[D++]}while(--u);if(D=0,B<w){w-=u=B;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}}else if(D+=B-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}for(;w>2;)p[r++]=y[D++],p[r++]=y[D++],p[r++]=y[D++],w-=3;w&&(p[r++]=y[D++],w>1&&(p[r++]=y[D++]))}else{D=r-d;do{p[r++]=p[D++],p[r++]=p[D++],p[r++]=p[D++],w-=3}while(w>2);w&&(p[r++]=p[D++],w>1&&(p[r++]=p[D++]))}break}}break}}while(t<i&&r<g);t-=w=E>>3,Q&=(1<<(E-=w<<3))-1,A.next_in=t,A.next_out=r,A.avail_in=t<i?i-t+5:5-(t-i),A.avail_out=r<g?g-r+257:257-(r-g),m.hold=Q,m.bits=E},AA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),eA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),tA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),iA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),rA=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E,s,f,c,h=n.bits,l=0,u=0,w=0,d=0,D=0,y=0,k=0,p=0,m=0,G=0,F=null,S=0,v=new Uint16Array(16),R=new Uint16Array(16),U=null,L=0;for(l=0;l<=15;l++)v[l]=0;for(u=0;u<i;u++)v[e[t+u]]++;for(D=h,d=15;d>=1&&0===v[d];d--);if(D>d&&(D=d),0===d)return r[I++]=20971520,r[I++]=20971520,n.bits=1,0;for(w=1;w<d&&0===v[w];w++);for(D<w&&(D=w),p=1,l=1;l<=15;l++)if(p<<=1,(p-=v[l])<0)return-1;if(p>0&&(0===A||1!==d))return-1;for(R[1]=0,l=1;l<15;l++)R[l+1]=R[l]+v[l];for(u=0;u<i;u++)0!==e[t+u]&&(g[R[e[t+u]]++]=u);if(0===A?(F=U=g,E=19):1===A?(F=AA,S-=257,U=eA,L-=257,E=256):(F=tA,U=iA,E=-1),G=0,u=0,l=w,Q=I,y=D,k=0,B=-1,C=(m=1<<D)-1,1===A&&m>852||2===A&&m>592)return 1;for(;;){s=l-k,g[u]<E?(f=0,c=g[u]):g[u]>E?(f=U[L+g[u]],c=F[S+g[u]]):(f=96,c=0),a=1<<l-k,w=o=1<<y;do{r[Q+(G>>k)+(o-=a)]=s<<24|f<<16|c|0}while(0!==o);for(a=1<<l-1;G&a;)a>>=1;if(0!==a?(G&=a-1,G+=a):G=0,u++,0==--v[l]){if(l===d)break;l=e[t+g[u]]}if(l>D&&(G&C)!==B){for(0===k&&(k=D),Q+=w,p=1<<(y=l-k);y+k<d&&!((p-=v[y+k])<=0);)y++,p<<=1;if(m+=1<<y,1===A&&m>852||2===A&&m>592)return 1;r[B=G&C]=D<<24|y<<16|Q-I|0}}return 0!==G&&(r[Q+G]=l-k<<24|64<<16|0),n.bits=D,0},IA=H.Z_FINISH,gA=H.Z_BLOCK,nA=H.Z_TREES,aA=H.Z_OK,oA=H.Z_STREAM_END,BA=H.Z_NEED_DICT,CA=H.Z_STREAM_ERROR,QA=H.Z_DATA_ERROR,EA=H.Z_MEM_ERROR,sA=H.Z_BUF_ERROR,fA=H.Z_DEFLATED,cA=function(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)};function hA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var lA,uA,wA=function(A){if(!A||!A.state)return CA;var e=A.state;return A.total_in=A.total_out=e.total=0,A.msg="",e.wrap&&(A.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,aA},dA=function(A){if(!A||!A.state)return CA;var e=A.state;return e.wsize=0,e.whave=0,e.wnext=0,wA(A)},DA=function(A,e){var t;if(!A||!A.state)return CA;var i=A.state;return e<0?(t=0,e=-e):(t=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?CA:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,dA(A))},yA=function(A,e){if(!A)return CA;var t=new hA;A.state=t,t.window=null;var i=DA(A,e);return i!==aA&&(A.state=null),i},kA=!0,pA=function(A){if(kA){lA=new Int32Array(512),uA=new Int32Array(32);for(var e=0;e<144;)A.lens[e++]=8;for(;e<256;)A.lens[e++]=9;for(;e<280;)A.lens[e++]=7;for(;e<288;)A.lens[e++]=8;for(rA(1,A.lens,0,288,lA,0,A.work,{bits:9}),e=0;e<32;)A.lens[e++]=5;rA(2,A.lens,0,32,uA,0,A.work,{bits:5}),kA=!1}A.lencode=lA,A.lenbits=9,A.distcode=uA,A.distbits=5},mA=function(A,e,t,i){var r,I=A.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),i>=I.wsize?(I.window.set(e.subarray(t-I.wsize,t),0),I.wnext=0,I.whave=I.wsize):((r=I.wsize-I.wnext)>i&&(r=i),I.window.set(e.subarray(t-i,t-i+r),I.wnext),(i-=r)?(I.window.set(e.subarray(t-i,t),0),I.wnext=i,I.whave=I.wsize):(I.wnext+=r,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=r))),0},GA={inflateReset:dA,inflateReset2:DA,inflateResetKeep:wA,inflateInit:function(A){return yA(A,15)},inflateInit2:yA,inflate:function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=0,G=new Uint8Array(4),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!A||!A.state||!A.output||!A.input&&0!==A.avail_in)return CA;12===(t=A.state).mode&&(t.mode=13),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,C=n,Q=a,y=aA;A:for(;;)switch(t.mode){case 1:if(0===t.wrap){t.mode=13;break}for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(2&t.wrap&&35615===o){t.check=0,G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0),o=0,B=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&o)<<8)+(o>>8))%31){A.msg="incorrect header check",t.mode=30;break}if((15&o)!==fA){A.msg="unknown compression method",t.mode=30;break}if(B-=4,D=8+(15&(o>>>=4)),0===t.wbits)t.wbits=D;else if(D>t.wbits){A.msg="invalid window size",t.mode=30;break}t.dmax=1<<t.wbits,A.adler=t.check=1,t.mode=512&o?10:12,o=0,B=0;break;case 2:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.flags=o,(255&t.flags)!==fA){A.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){A.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=o>>8&1),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=3;case 3:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.time=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,G[2]=o>>>16&255,G[3]=o>>>24&255,t.check=Y(t.check,G,4,0)),o=0,B=0,t.mode=4;case 4:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.xflags=255&o,t.head.os=o>>8),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=5;case 5:if(1024&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length=o,t.head&&(t.head.extra_len=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((E=t.length)>n&&(E=n),E&&(t.head&&(D=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(I,I+E),D)),512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,t.length-=E),t.length))break A;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.name+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.comment+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(65535&t.check)){A.msg="header crc mismatch",t.mode=30;break}o=0,B=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),A.adler=t.check=0,t.mode=12;break;case 10:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}A.adler=t.check=cA(o),o=0,B=0,t.mode=11;case 11:if(0===t.havedict)return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,BA;A.adler=t.check=1,t.mode=12;case 12:if(e===gA||e===nA)break A;case 13:if(t.last){o>>>=7&B,B-=7&B,t.mode=27;break}for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}switch(t.last=1&o,B-=1,3&(o>>>=1)){case 0:t.mode=14;break;case 1:if(pA(t),t.mode=20,e===nA){o>>>=2,B-=2;break A}break;case 2:t.mode=17;break;case 3:A.msg="invalid block type",t.mode=30}o>>>=2,B-=2;break;case 14:for(o>>>=7&B,B-=7&B;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if((65535&o)!=(o>>>16^65535)){A.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&o,o=0,B=0,t.mode=15,e===nA)break A;case 15:t.mode=16;case 16:if(E=t.length){if(E>n&&(E=n),E>a&&(E=a),0===E)break A;r.set(i.subarray(I,I+E),g),n-=E,I+=E,a-=E,g+=E,t.length-=E;break}t.mode=12;break;case 17:for(;B<14;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.nlen=257+(31&o),o>>>=5,B-=5,t.ndist=1+(31&o),o>>>=5,B-=5,t.ncode=4+(15&o),o>>>=4,B-=4,t.nlen>286||t.ndist>30){A.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.lens[F[t.have++]]=7&o,o>>>=3,B-=3}for(;t.have<19;)t.lens[F[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},y=rA(0,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(l<16)o>>>=c,B-=c,t.lens[t.have++]=l;else{if(16===l){for(p=c+2;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o>>>=c,B-=c,0===t.have){A.msg="invalid bit length repeat",t.mode=30;break}D=t.lens[t.have-1],E=3+(3&o),o>>>=2,B-=2}else if(17===l){for(p=c+3;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=3+(7&(o>>>=c)),o>>>=3,B-=3}else{for(p=c+7;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=11+(127&(o>>>=c)),o>>>=7,B-=7}if(t.have+E>t.nlen+t.ndist){A.msg="invalid bit length repeat",t.mode=30;break}for(;E--;)t.lens[t.have++]=D}}if(30===t.mode)break;if(0===t.lens[256]){A.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,k={bits:t.lenbits},y=rA(1,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},y=rA(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,y){A.msg="invalid distances set",t.mode=30;break}if(t.mode=20,e===nA)break A;case 20:t.mode=21;case 21:if(n>=6&&a>=258){A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,$(A,Q),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,12===t.mode&&(t.back=-1);break}for(t.back=0;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(h&&0==(240&h)){for(u=c,w=h,d=l;h=(m=t.lencode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,t.length=l,0===h){t.mode=26;break}if(32&h){t.back=-1,t.mode=12;break}if(64&h){A.msg="invalid literal/length code",t.mode=30;break}t.extra=15&h,t.mode=22;case 22:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;h=(m=t.distcode[o&(1<<t.distbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(0==(240&h)){for(u=c,w=h,d=l;h=(m=t.distcode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,64&h){A.msg="invalid distance code",t.mode=30;break}t.offset=l,t.extra=15&h,t.mode=24;case 24:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.offset+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){A.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(0===a)break A;if(E=Q-a,t.offset>E){if((E=t.offset-E)>t.whave&&t.sane){A.msg="invalid distance too far back",t.mode=30;break}E>t.wnext?(E-=t.wnext,s=t.wsize-E):s=t.wnext-E,E>t.length&&(E=t.length),f=t.window}else f=r,s=g-t.offset,E=t.length;E>a&&(E=a),a-=E,t.length-=E;do{r[g++]=f[s++]}while(--E);0===t.length&&(t.mode=21);break;case 26:if(0===a)break A;r[g++]=t.length,a--,t.mode=21;break;case 27:if(t.wrap){for(;B<32;){if(0===n)break A;n--,o|=i[I++]<<B,B+=8}if(Q-=a,A.total_out+=Q,t.total+=Q,Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,g-Q):J(t.check,r,Q,g-Q)),Q=a,(t.flags?o:cA(o))!==t.check){A.msg="incorrect data check",t.mode=30;break}o=0,B=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(4294967295&t.total)){A.msg="incorrect length check",t.mode=30;break}o=0,B=0}t.mode=29;case 29:y=oA;break A;case 30:y=QA;break A;case 31:return EA;default:return CA}return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,(t.wsize||Q!==A.avail_out&&t.mode<30&&(t.mode<27||e!==IA))&&mA(A,A.output,A.next_out,Q-A.avail_out),C-=A.avail_in,Q-=A.avail_out,A.total_in+=C,A.total_out+=Q,t.total+=Q,t.wrap&&Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,A.next_out-Q):J(t.check,r,Q,A.next_out-Q)),A.data_type=t.bits+(t.last?64:0)+(12===t.mode?128:0)+(20===t.mode||15===t.mode?256:0),(0===C&&0===Q||e===IA)&&y===aA&&(y=sA),y},inflateEnd:function(A){if(!A||!A.state)return CA;var e=A.state;return e.window&&(e.window=null),A.state=null,aA},inflateGetHeader:function(A,e){if(!A||!A.state)return CA;var t=A.state;return 0==(2&t.wrap)?CA:(t.head=e,e.done=!1,aA)},inflateSetDictionary:function(A,e){var t,i=e.length;return A&&A.state?0!==(t=A.state).wrap&&11!==t.mode?CA:11===t.mode&&J(1,e,i,0)!==t.check?QA:mA(A,e,i,i)?(t.mode=31,EA):(t.havedict=1,aA):CA},inflateInfo:"pako inflate (from Nodeca project)"};var FA=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},SA=Object.prototype.toString,vA=H.Z_NO_FLUSH,RA=H.Z_FINISH,UA=H.Z_OK,LA=H.Z_STREAM_END,bA=H.Z_NEED_DICT,MA=H.Z_STREAM_ERROR,NA=H.Z_DATA_ERROR,xA=H.Z_MEM_ERROR;function JA(A){this.options=P({chunkSize:65536,windowBits:15,to:""},A||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||A&&A.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var t=GA.inflateInit2(this.strm,e.windowBits);if(t!==UA)throw new Error(K[t]);if(this.header=new FA,GA.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Z(e.dictionary):"[object ArrayBuffer]"===SA.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=GA.inflateSetDictionary(this.strm,e.dictionary))!==UA))throw new Error(K[t])}function qA(A,e){var t=new JA(e);if(t.push(A),t.err)throw t.msg||K[t.err];return t.result}JA.prototype.push=function(A,e){var t,i,r,I=this.strm,g=this.options.chunkSize,n=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?RA:vA,"[object ArrayBuffer]"===SA.call(A)?I.input=new Uint8Array(A):I.input=A,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(g),I.next_out=0,I.avail_out=g),(t=GA.inflate(I,i))===bA&&n&&((t=GA.inflateSetDictionary(I,n))===UA?t=GA.inflate(I,i):t===NA&&(t=bA));I.avail_in>0&&t===LA&&I.state.wrap>0&&0!==A[I.next_in];)GA.inflateReset(I),t=GA.inflate(I,i);switch(t){case MA:case NA:case bA:case xA:return this.onEnd(t),this.ended=!0,!1}if(r=I.avail_out,I.next_out&&(0===I.avail_out||t===LA))if("string"===this.options.to){var a=W(I.output,I.next_out),o=I.next_out-a,B=j(I.output,a);I.next_out=o,I.avail_out=g-o,o&&I.output.set(I.output.subarray(a,a+o),0),this.onData(B)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(t!==UA||0!==r){if(t===LA)return t=GA.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},JA.prototype.onData=function(A){this.chunks.push(A)},JA.prototype.onEnd=function(A){A===UA&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};var YA={Inflate:JA,inflate:qA,inflateRaw:function(A,e){return(e=e||{}).raw=!0,qA(A,e)},ungzip:qA,constants:H}.inflate;function KA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var HA=function(A){s(t,w);var e=KA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return YA(new Uint8Array(A)).buffer}}]),t}(),OA=Object.freeze({__proto__:null,default:HA});function PA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var TA,VA=function(A){s(t,w);var e=PA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){for(var e=new DataView(A),t=[],i=0;i<A.byteLength;++i){var r=e.getInt8(i);if(r<0){var I=e.getUint8(i+1);r=-r;for(var g=0;g<=r;++g)t.push(I);i+=1}else{for(var n=0;n<=r;++n)t.push(e.getUint8(i+n+1));i+=r+1}}return new Uint8Array(t).buffer}}]),t}(),_A=Object.freeze({__proto__:null,default:VA}),XA={exports:{}};TA=XA,\n/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */\nfunction(){var A,e,t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c=(A={defaultNoDataValue:-34027999387901484e22,decode:function(I,g){var n=(g=g||{}).encodedMaskData||null===g.encodedMaskData,a=r(I,g.inputOffset||0,n),o=null!==g.noDataValue?g.noDataValue:A.defaultNoDataValue,B=e(a,g.pixelType||Float32Array,g.encodedMaskData,o,g.returnMask),C={width:a.width,height:a.height,pixelData:B.resultPixels,minValue:B.minValue,maxValue:a.pixels.maxValue,noDataValue:o};return B.resultMask&&(C.maskData=B.resultMask),g.returnEncodedMask&&a.mask&&(C.encodedMaskData=a.mask.bitset?a.mask.bitset:null),g.returnFileInfo&&(C.fileInfo=t(a),g.computeUsedBitDepths&&(C.fileInfo.bitDepths=i(a))),C}},e=function(A,e,t,i,r){var g,n,a,o=0,B=A.pixels.numBlocksX,C=A.pixels.numBlocksY,Q=Math.floor(A.width/B),E=Math.floor(A.height/C),s=2*A.maxZError,f=Number.MAX_VALUE;t=t||(A.mask?A.mask.bitset:null),n=new e(A.width*A.height),r&&t&&(a=new Uint8Array(A.width*A.height));for(var c,h,l=new Float32Array(Q*E),u=0;u<=C;u++){var w=u!==C?E:A.height%C;if(0!==w)for(var d=0;d<=B;d++){var D=d!==B?Q:A.width%B;if(0!==D){var y,k,p,m,G=u*A.width*E+d*Q,F=A.width-D,S=A.pixels.blocks[o];if(S.encoding<2?(0===S.encoding?y=S.rawData:(I(S.stuffedData,S.bitsPerPixel,S.numValidPixels,S.offset,s,l,A.pixels.maxValue),y=l),k=0):p=2===S.encoding?0:S.offset,t)for(h=0;h<w;h++){for(7&G&&(m=t[G>>3],m<<=7&G),c=0;c<D;c++)7&G||(m=t[G>>3]),128&m?(a&&(a[G]=1),f=f>(g=S.encoding<2?y[k++]:p)?g:f,n[G++]=g):(a&&(a[G]=0),n[G++]=i),m<<=1;G+=F}else if(S.encoding<2)for(h=0;h<w;h++){for(c=0;c<D;c++)f=f>(g=y[k++])?g:f,n[G++]=g;G+=F}else for(f=f>p?p:f,h=0;h<w;h++){for(c=0;c<D;c++)n[G++]=p;G+=F}if(1===S.encoding&&k!==S.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:n,resultMask:a,minValue:f}},t=function(A){return{fileIdentifierString:A.fileIdentifierString,fileVersion:A.fileVersion,imageType:A.imageType,height:A.height,width:A.width,maxZError:A.maxZError,eofOffset:A.eofOffset,mask:A.mask?{numBlocksX:A.mask.numBlocksX,numBlocksY:A.mask.numBlocksY,numBytes:A.mask.numBytes,maxValue:A.mask.maxValue}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,numBytes:A.pixels.numBytes,maxValue:A.pixels.maxValue,noDataValue:A.noDataValue}}},i=function(A){for(var e=A.pixels.numBlocksX*A.pixels.numBlocksY,t={},i=0;i<e;i++){var r=A.pixels.blocks[i];0===r.encoding?t.float32=!0:1===r.encoding?t[r.bitsPerPixel]=!0:t[0]=!0}return Object.keys(t)},r=function(A,e,t){var i={},r=new Uint8Array(A,e,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;e+=10;var I=new DataView(A,e,24);if(i.fileVersion=I.getInt32(0,!0),i.imageType=I.getInt32(4,!0),i.height=I.getUint32(8,!0),i.width=I.getUint32(12,!0),i.maxZError=I.getFloat64(16,!0),e+=24,!t)if(I=new DataView(A,e,16),i.mask={},i.mask.numBlocksY=I.getUint32(0,!0),i.mask.numBlocksX=I.getUint32(4,!0),i.mask.numBytes=I.getUint32(8,!0),i.mask.maxValue=I.getFloat32(12,!0),e+=16,i.mask.numBytes>0){var g=new Uint8Array(Math.ceil(i.width*i.height/8)),n=(I=new DataView(A,e,i.mask.numBytes)).getInt16(0,!0),a=2,o=0;do{if(n>0)for(;n--;)g[o++]=I.getUint8(a++);else{var B=I.getUint8(a++);for(n=-n;n--;)g[o++]=B}n=I.getInt16(a,!0),a+=2}while(a<i.mask.numBytes);if(-32768!==n||o<g.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=g,e+=i.mask.numBytes}else 0==(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));I=new DataView(A,e,16),i.pixels={},i.pixels.numBlocksY=I.getUint32(0,!0),i.pixels.numBlocksX=I.getUint32(4,!0),i.pixels.numBytes=I.getUint32(8,!0),i.pixels.maxValue=I.getFloat32(12,!0),e+=16;var C=i.pixels.numBlocksX,Q=i.pixels.numBlocksY,E=C+(i.width%C>0?1:0),s=Q+(i.height%Q>0?1:0);i.pixels.blocks=new Array(E*s);for(var f=0,c=0;c<s;c++)for(var h=0;h<E;h++){var l=0,u=A.byteLength-e;I=new DataView(A,e,Math.min(10,u));var w={};i.pixels.blocks[f++]=w;var d=I.getUint8(0);if(l++,w.encoding=63&d,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==d&&2!==d){if(d>>=6,w.offsetType=d,2===d)w.offset=I.getInt8(1),l++;else if(1===d)w.offset=I.getInt16(1,!0),l+=2;else{if(0!==d)throw"Invalid block offset type";w.offset=I.getFloat32(1,!0),l+=4}if(1===w.encoding)if(d=I.getUint8(l),l++,w.bitsPerPixel=63&d,d>>=6,w.numValidPixelsType=d,2===d)w.numValidPixels=I.getUint8(l),l++;else if(1===d)w.numValidPixels=I.getUint16(l,!0),l+=2;else{if(0!==d)throw"Invalid valid pixel count type";w.numValidPixels=I.getUint32(l,!0),l+=4}}var D;if(e+=l,3!==w.encoding)if(0===w.encoding){var y=(i.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";D=new ArrayBuffer(4*y),new Uint8Array(D).set(new Uint8Array(A,e,4*y));var k=new Float32Array(D);w.rawData=k,e+=4*y}else if(1===w.encoding){var p=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),m=Math.ceil(p/4);D=new ArrayBuffer(4*m),new Uint8Array(D).set(new Uint8Array(A,e,p)),w.stuffedData=new Uint32Array(D),e+=p}}else e++}return i.eofOffset=e,i},I=function(A,e,t,i,r,I,g){var n,a,o,B=(1<<e)-1,C=0,Q=0,E=Math.ceil((g-i)/r),s=4*A.length-Math.ceil(e*t/8);for(A[A.length-1]<<=8*s,n=0;n<t;n++){if(0===Q&&(o=A[C++],Q=32),Q>=e)a=o>>>Q-e&B,Q-=e;else{var f=e-Q;a=(o&B)<<f&B,a+=(o=A[C++])>>>(Q=32-f)}I[n]=a<E?i+a*r:g}return I},A),h=(g=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E=(1<<t)-1,s=0,f=0,c=4*A.length-Math.ceil(t*i/8);if(A[A.length-1]<<=8*c,r)for(a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=r[o];else for(Q=Math.ceil((n-I)/g),a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=o<Q?I+o*g:n},n=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=[],s=4*A.length-Math.ceil(e*t/8);A[A.length-1]<<=8*s;var f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32),C>=e?(Q=g>>>C-e&n,C-=e):(Q=(g&n)<<(B=e-C)&n,Q+=(g=A[a++])>>>(C=32-B)),E[o]=Q<f?i+Q*r:I;return E.unshift(i),E},a=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q=(1<<t)-1,E=0,s=0,f=0;if(r)for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=r[o];else{var c=Math.ceil((n-I)/g);for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=o<c?I+o*g:n}return e},o=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=0,s=[],f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32,E=0),C>=e?(Q=g>>>E&n,C-=e,E+=e):(Q=g>>>E&n,C=32-(B=e-C),Q|=((g=A[a++])&(1<<B)-1)<<e-B,E=B),s[o]=Q<f?i+Q*r:I;return s.unshift(i),s},B=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=4*A.length-Math.ceil(t*i/8);for(A[A.length-1]<<=8*C,r=0;r<i;r++)0===B&&(g=A[o++],B=32),B>=t?(I=g>>>B-t&a,B-=t):(I=(g&a)<<(n=t-B)&a,I+=(g=A[o++])>>>(B=32-n)),e[r]=I;return e},C=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=0;for(r=0;r<i;r++)0===B&&(g=A[o++],B=32,C=0),B>=t?(I=g>>>C&a,B-=t,C+=t):(I=g>>>C&a,B=32-(n=t-B),I|=((g=A[o++])&(1<<n)-1)<<t-n,C=n),e[r]=I;return e},Q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(A){for(var e=65535,t=65535,i=A.length,r=Math.floor(i/2),I=0;r;){var g=r>=359?359:r;r-=g;do{e+=A[I++]<<8,t+=e+=A[I++]}while(--g);e=(65535&e)+(e>>>16),t=(65535&t)+(t>>>16)}return 1&i&&(t+=e+=A[I]<<8),((t=(65535&t)+(t>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(A,e){var t=e.ptr,i=new Uint8Array(A,t,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,i),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;t+=6;var I,g=new DataView(A,t,8),n=g.getInt32(0,!0);if(r.fileVersion=n,t+=4,n>=3&&(r.checksum=g.getUint32(4,!0),t+=4),g=new DataView(A,t,12),r.height=g.getUint32(0,!0),r.width=g.getUint32(4,!0),t+=8,n>=4?(r.numDims=g.getUint32(8,!0),t+=4):r.numDims=1,g=new DataView(A,t,40),r.numValidPixel=g.getUint32(0,!0),r.microBlockSize=g.getInt32(4,!0),r.blobSize=g.getInt32(8,!0),r.imageType=g.getInt32(12,!0),r.maxZError=g.getFloat64(16,!0),r.zMin=g.getFloat64(24,!0),r.zMax=g.getFloat64(32,!0),t+=40,e.headerInfo=r,e.ptr=t,n>=3&&(I=n>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(A,t-I,r.blobSize-14))!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(A,e){var t=e.headerInfo,i=this.getDataTypeArray(t.imageType),r=t.numDims*this.getDataTypeSize(t.imageType),I=this.readSubArray(A,e.ptr,i,r),g=this.readSubArray(A,e.ptr+r,i,r);e.ptr+=2*r;var n,a=!0;for(n=0;n<t.numDims;n++)if(I[n]!==g[n]){a=!1;break}return t.minValues=I,t.maxValues=g,a},readSubArray:function(A,e,t,i){var r;if(t===Uint8Array)r=new Uint8Array(A,e,i);else{var I=new ArrayBuffer(i);new Uint8Array(I).set(new Uint8Array(A,e,i)),r=new t(I)}return r},readMask:function(A,e){var t,i,r=e.ptr,I=e.headerInfo,g=I.width*I.height,n=I.numValidPixel,a=new DataView(A,r,4),o={};if(o.numBytes=a.getUint32(0,!0),r+=4,(0===n||g===n)&&0!==o.numBytes)throw"invalid mask";if(0===n)t=new Uint8Array(Math.ceil(g/8)),o.bitset=t,i=new Uint8Array(g),e.pixels.resultMask=i,r+=o.numBytes;else if(o.numBytes>0){t=new Uint8Array(Math.ceil(g/8));var B=(a=new DataView(A,r,o.numBytes)).getInt16(0,!0),C=2,Q=0,E=0;do{if(B>0)for(;B--;)t[Q++]=a.getUint8(C++);else for(E=a.getUint8(C++),B=-B;B--;)t[Q++]=E;B=a.getInt16(C,!0),C+=2}while(C<o.numBytes);if(-32768!==B||Q<t.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(g);var s=0,f=0;for(f=0;f<g;f++)7&f?(s=t[f>>3],s<<=7&f):s=t[f>>3],128&s&&(i[f]=1);e.pixels.resultMask=i,o.bitset=t,r+=o.numBytes}return e.ptr=r,e.mask=o,!0},readDataOneSweep:function(A,e,t,i){var r,I=e.ptr,g=e.headerInfo,n=g.numDims,a=g.width*g.height,o=g.imageType,B=g.numValidPixel*Q.getDataTypeSize(o)*n,C=e.pixels.resultMask;if(t===Uint8Array)r=new Uint8Array(A,I,B);else{var E=new ArrayBuffer(B);new Uint8Array(E).set(new Uint8Array(A,I,B)),r=new t(E)}if(r.length===a*n)e.pixels.resultPixels=i?Q.swapDimensionOrder(r,a,n,t,!0):r;else{e.pixels.resultPixels=new t(a*n);var s=0,f=0,c=0,h=0;if(n>1){if(i){for(f=0;f<a;f++)if(C[f])for(h=f,c=0;c<n;c++,h+=a)e.pixels.resultPixels[h]=r[s++]}else for(f=0;f<a;f++)if(C[f])for(h=f*n,c=0;c<n;c++)e.pixels.resultPixels[h+c]=r[s++]}else for(f=0;f<a;f++)C[f]&&(e.pixels.resultPixels[f]=r[s++])}return I+=B,e.ptr=I,!0},readHuffmanTree:function(A,e){var t=this.HUFFMAN_LUT_BITS_MAX,i=new DataView(A,e.ptr,16);if(e.ptr+=16,i.getInt32(0,!0)<2)throw"unsupported Huffman version";var r=i.getInt32(4,!0),I=i.getInt32(8,!0),g=i.getInt32(12,!0);if(I>=g)return!1;var n=new Uint32Array(g-I);Q.decodeBits(A,e,n);var a,o,B,C,s=[];for(a=I;a<g;a++)s[o=a-(a<r?0:r)]={first:n[a-I],second:null};var f=A.byteLength-e.ptr,c=Math.ceil(f/4),h=new ArrayBuffer(4*c);new Uint8Array(h).set(new Uint8Array(A,e.ptr,f));var l,u=new Uint32Array(h),w=0,d=0;for(l=u[0],a=I;a<g;a++)(C=s[o=a-(a<r?0:r)].first)>0&&(s[o].second=l<<w>>>32-C,32-w>=C?32===(w+=C)&&(w=0,l=u[++d]):(w+=C-32,l=u[++d],s[o].second|=l>>>32-w));var D=0,y=0,k=new E;for(a=0;a<s.length;a++)void 0!==s[a]&&(D=Math.max(D,s[a].first));y=D>=t?t:D;var p,m,G,F,S,v=[];for(a=I;a<g;a++)if((C=s[o=a-(a<r?0:r)].first)>0)if(p=[C,o],C<=y)for(m=s[o].second<<y-C,G=1<<y-C,B=0;B<G;B++)v[m|B]=p;else for(m=s[o].second,S=k,F=C-1;F>=0;F--)m>>>F&1?(S.right||(S.right=new E),S=S.right):(S.left||(S.left=new E),S=S.left),0!==F||S.val||(S.val=p[1]);return{decodeLut:v,numBitsLUTQick:y,numBitsLUT:D,tree:k,stuffedData:u,srcPtr:d,bitPos:w}},readHuffman:function(A,e,t,i){var r,I,g,n,a,o,B,C,E,s=e.headerInfo.numDims,f=e.headerInfo.height,c=e.headerInfo.width,h=c*f,l=this.readHuffmanTree(A,e),u=l.decodeLut,w=l.tree,d=l.stuffedData,D=l.srcPtr,y=l.bitPos,k=l.numBitsLUTQick,p=l.numBitsLUT,m=0===e.headerInfo.imageType?128:0,G=e.pixels.resultMask,F=0;y>0&&(D++,y=0);var S,v=d[D],R=1===e.encodeMode,U=new t(h*s),L=U;if(s<2||R){for(S=0;S<s;S++)if(s>1&&(L=new t(U.buffer,h*S,h),F=0),e.headerInfo.numValidPixel===c*f)for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(g+=B>0?F:o>0?L[C-c]:F,g&=255,L[C]=g,F=g):L[C]=g}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++)if(G[C]){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(B>0&&G[C-1]?g+=F:o>0&&G[C-c]?g+=L[C-c]:g+=F,g&=255,L[C]=g,F=g):L[C]=g}}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++)if(C=o*c+B,!G||G[C])for(S=0;S<s;S++,C+=h){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,L[C]=g}e.ptr=e.ptr+4*(D+1)+(y>0?4:0),e.pixels.resultPixels=U,s>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(U,h,s,t))},decodeBits:function(A,e,t,i,r){var I=e.headerInfo,Q=I.fileVersion,E=0,s=A.byteLength-e.ptr>=5?5:A.byteLength-e.ptr,f=new DataView(A,e.ptr,s),c=f.getUint8(0);E++;var h=c>>6,l=0===h?4:3-h,u=(32&c)>0,w=31&c,d=0;if(1===l)d=f.getUint8(E),E++;else if(2===l)d=f.getUint16(E,!0),E+=2;else{if(4!==l)throw"Invalid valid pixel count type";d=f.getUint32(E,!0),E+=4}var D,y,k,p,m,G,F,S,v,R=2*I.maxZError,U=I.numDims>1?I.maxValues[r]:I.zMax;if(u){for(e.counter.lut++,S=f.getUint8(E),E++,p=Math.ceil((S-1)*w/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),k=new Uint8Array(y),e.ptr+=E,k.set(new Uint8Array(A,e.ptr,p)),F=new Uint32Array(y),e.ptr+=p,v=0;S-1>>>v;)v++;p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,G=Q>=3?o(F,w,S-1,i,R,U):n(F,w,S-1,i,R,U),Q>=3?a(D,t,v,d,G):g(D,t,v,d,G)}else e.counter.bitstuffer++,v=w,e.ptr+=E,v>0&&(p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,Q>=3?null==i?C(D,t,v,d):a(D,t,v,d,!1,i,R,U):null==i?B(D,t,v,d):g(D,t,v,d,!1,i,R,U))},readTiles:function(A,e,t,i){var r=e.headerInfo,I=r.width,g=r.height,n=I*g,a=r.microBlockSize,o=r.imageType,B=Q.getDataTypeSize(o),C=Math.ceil(I/a),E=Math.ceil(g/a);e.pixels.numBlocksY=E,e.pixels.numBlocksX=C,e.pixels.ptr=0;var s,f,c,h,l,u,w,d,D,y,k=0,p=0,m=0,G=0,F=0,S=0,v=0,R=0,U=0,L=0,b=0,M=0,N=0,x=0,J=0,q=new t(a*a),Y=g%a||a,K=I%a||a,H=r.numDims,O=e.pixels.resultMask,P=e.pixels.resultPixels,T=r.fileVersion>=5?14:15,V=r.zMax;for(m=0;m<E;m++)for(F=m!==E-1?a:Y,G=0;G<C;G++)for(L=m*I*a+G*a,b=I-(S=G!==C-1?a:K),d=0;d<H;d++){if(H>1?(y=P,L=m*I*a+G*a,P=new t(e.pixels.resultPixels.buffer,n*d*B,n),V=r.maxValues[d]):y=null,v=A.byteLength-e.ptr,f={},J=0,R=(s=new DataView(A,e.ptr,Math.min(10,v))).getUint8(0),J++,D=r.fileVersion>=5?4&R:0,U=R>>6&255,(R>>2&T)!=(G*a>>3&T))throw"integrity issue";if(D&&0===d)throw"integrity issue";if((l=3&R)>3)throw e.ptr+=J,"Invalid block encoding ("+l+")";if(2!==l)if(0===l){if(D)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=J,M=(M=F*S*B)<(N=A.byteLength-e.ptr)?M:N,c=new ArrayBuffer(M%B==0?M:M+B-M%B),new Uint8Array(c).set(new Uint8Array(A,e.ptr,M)),h=new t(c),x=0,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=h[x++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=h[x++];L+=b}e.ptr+=x*B}else if(u=Q.getDataTypeUsed(D&&o<6?4:o,U),w=Q.getOnePixel(f,J,u,s),J+=Q.getDataTypeSize(u),3===l)if(e.ptr+=J,e.counter.constantoffset++,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=D?Math.min(V,y[L]+w):w),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=D?Math.min(V,y[L]+w):w,L++;L+=b}else if(e.ptr+=J,Q.decodeBits(A,e,q,w,d),J=0,D)if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]+y[L]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=q[J++]+y[L],L++;L+=b}else if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=q[J++];L+=b}else{if(D)if(O)for(k=0;k<F;k++)for(p=0;p<S;p++)O[L]&&(P[L]=y[L]),L++;else for(k=0;k<F;k++)for(p=0;p<S;p++)P[L]=y[L],L++;e.counter.constant++,e.ptr+=J}}H>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(e.pixels.resultPixels,n,H,t))},formatFileInfo:function(A){return{fileIdentifierString:A.headerInfo.fileIdentifierString,fileVersion:A.headerInfo.fileVersion,imageType:A.headerInfo.imageType,height:A.headerInfo.height,width:A.headerInfo.width,numValidPixel:A.headerInfo.numValidPixel,microBlockSize:A.headerInfo.microBlockSize,blobSize:A.headerInfo.blobSize,maxZError:A.headerInfo.maxZError,pixelType:Q.getPixelType(A.headerInfo.imageType),eofOffset:A.eofOffset,mask:A.mask?{numBytes:A.mask.numBytes}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,maxValue:A.headerInfo.zMax,minValue:A.headerInfo.zMin,noDataValue:A.noDataValue}}},constructConstantSurface:function(A,e){var t=A.headerInfo.zMax,i=A.headerInfo.zMin,r=A.headerInfo.maxValues,I=A.headerInfo.numDims,g=A.headerInfo.height*A.headerInfo.width,n=0,a=0,o=0,B=A.pixels.resultMask,C=A.pixels.resultPixels;if(B)if(I>1){if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)B[a]&&(C[o+a]=t);else for(a=0;a<g;a++)if(B[a])for(o=a*I,n=0;n<I;n++)C[o+I]=r[n]}else for(a=0;a<g;a++)B[a]&&(C[a]=t);else if(I>1&&i!==t)if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)C[o+a]=t;else for(a=0;a<g;a++)for(o=a*I,n=0;n<I;n++)C[o+n]=r[n];else for(a=0;a<g*I;a++)C[a]=t},getDataTypeArray:function(A){var e;switch(A){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(A){var e;switch(A){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(A,e){if(null==e)return!1;var t;switch(A){case 0:t=e>=-128&&e<=127;break;case 1:t=e>=0&&e<=255;break;case 2:t=e>=-32768&&e<=32767;break;case 3:t=e>=0&&e<=65536;break;case 4:t=e>=-2147483648&&e<=2147483647;break;case 5:t=e>=0&&e<=4294967296;break;case 6:t=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:t=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:t=!1}return t},getDataTypeSize:function(A){var e=0;switch(A){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=A}return e},getDataTypeUsed:function(A,e){var t=A;switch(A){case 2:case 4:t=A-e;break;case 3:case 5:t=A-2*e;break;case 6:t=0===e?A:1===e?2:1;break;case 7:t=0===e?A:A-2*e+1;break;default:t=A}return t},getOnePixel:function(A,e,t,i){var r=0;switch(t){case 0:r=i.getInt8(e);break;case 1:r=i.getUint8(e);break;case 2:r=i.getInt16(e,!0);break;case 3:r=i.getUint16(e,!0);break;case 4:r=i.getInt32(e,!0);break;case 5:r=i.getUInt32(e,!0);break;case 6:r=i.getFloat32(e,!0);break;case 7:r=i.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return r},swapDimensionOrder:function(A,e,t,i,r){var I=0,g=0,n=0,a=0,o=A;if(t>1)if(o=new i(e*t),r)for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[a]=A[g++];else for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[g++]=A[a];return o}},E=function(A,e,t){this.val=A,this.left=e,this.right=t},{decode:function(A,e){var t=(e=e||{}).noDataValue,i=0,r={};r.ptr=e.inputOffset||0,r.pixels={},Q.readHeaderInfo(A,r);var I=r.headerInfo,g=I.fileVersion,n=Q.getDataTypeArray(I.imageType);if(g>5)throw"unsupported lerc version 2."+g;Q.readMask(A,r),I.numValidPixel===I.width*I.height||r.pixels.resultMask||(r.pixels.resultMask=e.maskData);var a=I.width*I.height;r.pixels.resultPixels=new n(a*I.numDims),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var o,B=!e.returnPixelInterleavedDims;if(0!==I.numValidPixel)if(I.zMax===I.zMin)Q.constructConstantSurface(r,B);else if(g>=4&&Q.checkMinMaxRanges(A,r))Q.constructConstantSurface(r,B);else{var C=new DataView(A,r.ptr,2),E=C.getUint8(0);if(r.ptr++,E)Q.readDataOneSweep(A,r,n,B);else if(g>1&&I.imageType<=1&&Math.abs(I.maxZError-.5)<1e-5){var s=C.getUint8(1);if(r.ptr++,r.encodeMode=s,s>2||g<4&&s>1)throw"Invalid Huffman flag "+s;s?Q.readHuffman(A,r,n,B):Q.readTiles(A,r,n,B)}else Q.readTiles(A,r,n,B)}r.eofOffset=r.ptr,e.inputOffset?(o=r.headerInfo.blobSize+e.inputOffset-r.ptr,Math.abs(o)>=1&&(r.eofOffset=e.inputOffset+r.headerInfo.blobSize)):(o=r.headerInfo.blobSize-r.ptr,Math.abs(o)>=1&&(r.eofOffset=r.headerInfo.blobSize));var f={width:I.width,height:I.height,pixelData:r.pixels.resultPixels,minValue:I.zMin,maxValue:I.zMax,validPixelCount:I.numValidPixel,dimCount:I.numDims,dimStats:{minValues:I.minValues,maxValues:I.maxValues},maskData:r.pixels.resultMask};if(r.pixels.resultMask&&Q.isValidPixelValue(I.imageType,t)){var c=r.pixels.resultMask;for(i=0;i<a;i++)c[i]||(f.pixelData[i]=t);f.noDataValue=t}return r.noDataValue=t,e.returnFileInfo&&(f.fileInfo=Q.formatFileInfo(r)),f},getBandCount:function(A){for(var e=0,t=0,i={ptr:0,pixels:{}};t<A.byteLength-58;)Q.readHeaderInfo(A,i),t+=i.headerInfo.blobSize,e++,i.ptr=t;return e}}),l=(s=new ArrayBuffer(4),f=new Uint8Array(s),new Uint32Array(s)[0]=1,1===f[0]),u={decode:function(A,e){if(!l)throw"Big endian system is not supported.";var t,i,r=(e=e||{}).inputOffset||0,I=new Uint8Array(A,r,10),g=String.fromCharCode.apply(null,I);if("CntZImage"===g.trim())t=c,i=1;else{if("Lerc2"!==g.substring(0,5))throw"Unexpected file identifier string: "+g;t=h,i=2}for(var n,a,o,B,C,Q,E=0,s=A.byteLength-10,f=[],u={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},w=0;r<s;){var d=t.decode(A,{inputOffset:r,encodedMaskData:n,maskData:o,returnMask:0===E,returnEncodedMask:0===E,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});r=d.fileInfo.eofOffset,o=d.maskData,0===E&&(n=d.encodedMaskData,u.width=d.width,u.height=d.height,u.dimCount=d.dimCount||1,u.pixelType=d.pixelType||d.fileInfo.pixelType,u.mask=o),i>1&&(o&&f.push(o),d.fileInfo.mask&&d.fileInfo.mask.numBytes>0&&w++),E++,u.pixels.push(d.pixelData),u.statistics.push({minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,dimStats:d.dimStats})}if(i>1&&w>1){for(Q=u.width*u.height,u.bandMasks=f,(o=new Uint8Array(Q)).set(f[0]),B=1;B<f.length;B++)for(a=f[B],C=0;C<Q;C++)o[C]=o[C]&a[C];u.maskData=o}return u}};TA.exports?TA.exports=u:this.Lerc=u}();var ZA,jA,WA,zA=XA.exports,$A={env:{emscripten_notify_memory_growth:function(A){WA=new Uint8Array(jA.exports.memory.buffer)}}},Ae=function(){function A(){B(this,A)}return Q(A,[{key:"init",value:function(){return ZA||(ZA="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+ee).then((function(A){return A.arrayBuffer()})).then((function(A){return WebAssembly.instantiate(A,$A)})).then(this._init):WebAssembly.instantiate(Buffer.from(ee,"base64"),$A).then(this._init))}},{key:"_init",value:function(A){jA=A.instance,$A.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(A){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!jA)throw new Error("ZSTDDecoder: Await .init() before decoding.");var t=A.byteLength,i=jA.exports.malloc(t);WA.set(A,i),e=e||Number(jA.exports.ZSTD_findDecompressedSize(i,t));var r=jA.exports.malloc(e),I=jA.exports.ZSTD_decompress(r,e,i,t),g=WA.slice(r,r+I);return jA.exports.free(i),jA.exports.free(r),g}}]),A}(),ee="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",te={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ie={};for(var re in te)te.hasOwnProperty(re)&&(ie[te[re]]=parseInt(re,10));ie.BitsPerSample,ie.ExtraSamples,ie.SampleFormat,ie.StripByteCounts,ie.StripOffsets,ie.StripRowCounts,ie.TileByteCounts,ie.TileOffsets,ie.SubIFDs;var Ie={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ge={};for(var ne in Ie)Ie.hasOwnProperty(ne)&&(ge[Ie[ne]]=parseInt(ne,10));var ae=1,oe=0,Be=1,Ce=2,Qe={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Ee={};for(var se in Qe)Qe.hasOwnProperty(se)&&(Ee[Qe[se]]=parseInt(se,10));function fe(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var ce=new Ae,he=function(A){s(t,w);var e=fe(t);function t(A){var i;return B(this,t),(i=e.call(this)).planarConfiguration=void 0!==A.PlanarConfiguration?A.PlanarConfiguration:1,i.samplesPerPixel=void 0!==A.SamplesPerPixel?A.SamplesPerPixel:1,i.addCompression=A.LercParameters[ae],i}return Q(t,[{key:"decodeBlock",value:function(A){switch(this.addCompression){case oe:break;case Be:A=YA(new Uint8Array(A)).buffer;break;case Ce:A=ce.decode(new Uint8Array(A)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return zA.decode(A,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),t}(),le=Object.freeze({__proto__:null,zstd:ce,default:he});function ue(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var we=function(A){s(I,w);var t,i=ue(I);function I(){var A;if(B(this,I),A=i.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return A}return Q(I,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return i=new Blob([t]),A.next=3,createImageBitmap(i);case 3:return I=A.sent,"undefined"!=typeof document?((g=document.createElement("canvas")).width=I.width,g.height=I.height):g=new OffscreenCanvas(I.width,I.height),(n=g.getContext("2d")).drawImage(I,0,0),A.abrupt("return",n.getImageData(0,0,I.width,I.height).data.buffer);case 8:case"end":return A.stop()}}),A)}))),function(A,e){return t.apply(this,arguments)})}]),I}(),de=Object.freeze({__proto__:null,default:we});';return new Ir("undefined"!=typeof Buffer?"data:application/javascript;base64,"+Buffer.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}});t.BaseClient=ue,t.BaseDecoder=tn,t.BaseResponse=Ae,t.GeoTIFF=ln,t.GeoTIFFImage=Dt,t.MultiGeoTIFF=cn,t.Pool=Ft,t.addDecoder=pt,t.default=ln,t.fromArrayBuffer=function(t,e){return gn.apply(this,arguments)},t.fromBlob=function(t,e){return In.apply(this,arguments)},t.fromCustomClient=function(t){return dn.apply(this,arguments)},t.fromFile=function(t,e){return vn.apply(this,arguments)},t.fromUrl=function(t){return fn.apply(this,arguments)},t.fromUrls=function(t){return pn.apply(this,arguments)},t.getDecoder=yt,t.globals=ut,t.rgb=vt,t.setLogger=function(){arguments.length>0&&void 0!==arguments[0]||new je},t.writeArrayBuffer=function(t,e){return function(t,e){var n,i,r,o;"number"==typeof t[0]?(n=e.height||e.ImageLength,r=e.width||e.ImageWidth,i=t.length/(n*r),o=t):(i=t.length,n=t[0].length,r=t[0][0].length,o=[],Wt(n,(function(e){Wt(r,(function(n){Wt(i,(function(i){o.push(t[i][e][n])}))}))}))),e.ImageLength=n,delete e.height,e.ImageWidth=r,delete e.width,e.BitsPerSample||(e.BitsPerSample=Wt(i,(function(){return 8}))),Ye.forEach((function(t){var n=t[0];if(!e[n]){var i=t[1];e[n]=i}})),e.PhotometricInterpretation||(e.PhotometricInterpretation=3===e.BitsPerSample.length?2:1),e.SamplesPerPixel||(e.SamplesPerPixel=[i]),e.StripByteCounts||(e.StripByteCounts=[i*n*r]),e.ModelPixelScale||(e.ModelPixelScale=[360/r,180/n,0]),e.SampleFormat||(e.SampleFormat=Wt(i,(function(){return 1}))),e.hasOwnProperty("GeographicTypeGeoKey")||e.hasOwnProperty("ProjectedCSTypeGeoKey")||(e.GeographicTypeGeoKey=4326,e.ModelTiepoint=[0,0,0,-180,90,0],e.GeogCitationGeoKey="WGS 84",e.GTModelTypeGeoKey=2);var s=Object.keys(e).filter((function(t){return Yt(t,"GeoKey")})).sort((function(t,e){return ze[t]-ze[e]}));if(!e.GeoAsciiParams){var a="";s.forEach((function(t){var n=Number(ze[t]);"ASCII"===W[n]&&(a+="".concat(e[t].toString(),"\0"))})),a.length>0&&(e.GeoAsciiParams=a)}if(!e.GeoKeyDirectory){var A=[1,1,0,s.length];s.forEach((function(t){var n,i,r,o=Number(ze[t]);A.push(o),"SHORT"===W[o]?(n=1,i=0,r=e[t]):"GeogCitationGeoKey"===t&&(n=e.GeoAsciiParams.length,i=Number(ze.GeoAsciiParams),r=0),A.push(i),A.push(n),A.push(r)})),e.GeoKeyDirectory=A}var u,h=Pe(s);try{for(h.s();!(u=h.n()).done;){var l=u.value;e.hasOwnProperty(l)&&delete e[l]}}catch(t){h.e(t)}finally{h.f()}["Compression","ExtraSamples","GeographicTypeGeoKey","GTModelTypeGeoKey","GTRasterTypeGeoKey","ImageLength","ImageWidth","Orientation","PhotometricInterpretation","ProjectedCSTypeGeoKey","PlanarConfiguration","ResolutionUnit","SamplesPerPixel","XPosition","YPosition","RowsPerStrip"].forEach((function(t){var n;e[t]&&(e[t]=(n=e[t],Array.isArray(n)?n:[n]))}));var c=function(t){var e={};for(var n in t)"StripOffsets"!==n&&(e[ze[n]]=t[n]);return e}(e),f=function(t,e,n,i){if(null==n)throw new Error("you passed into encodeImage a width of type ".concat(n));if(null==e)throw new Error("you passed into encodeImage a width of type ".concat(e));var r={256:[e],257:[n],273:[Ve],278:[n],305:"geotiff.js"};if(i)for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var s=new Uint8Array(function(t){var e=new Uint8Array(Ve),n=4,i=Je;e[0]=77,e[1]=77,e[3]=42;var r=8;if(i.writeUint(e,n,r),n+=4,t.forEach((function(n,o){var s=function(t,e,n,i){var r=n,o=Object.keys(i).filter((function(t){return null!=t&&"undefined"!==t}));t.writeUshort(e,r,o.length);var s,a=(r+=2)+12*o.length+4,A=Pe(o);try{var u=function(){var n=s.value,o=null;"number"==typeof n?o=n:"string"==typeof n&&(o=parseInt(n,10));var A=W[o],u=Ke[A];if(null==A||void 0===A||void 0===A)throw new Error("unknown type of tag: ".concat(o));var h=i[n];if(void 0===h)throw new Error("failed to get value for key ".concat(n));"ASCII"===A&&"string"==typeof h&&!1===Yt(h,"\0")&&(h+="\0");var l=h.length;t.writeUshort(e,r,o),r+=2,t.writeUshort(e,r,u),r+=2,t.writeUint(e,r,l);var c=[-1,1,1,2,4,8,0,0,0,0,0,0,8][u]*l,f=r+=4;c>4&&(t.writeUint(e,r,a),f=a),"ASCII"===A?t.writeASCII(e,f,h):"SHORT"===A?Wt(l,(function(n){t.writeUshort(e,f+2*n,h[n])})):"LONG"===A?Wt(l,(function(n){t.writeUint(e,f+4*n,h[n])})):"RATIONAL"===A?Wt(l,(function(n){t.writeUint(e,f+8*n,Math.round(1e4*h[n])),t.writeUint(e,f+8*n+4,1e4)})):"DOUBLE"===A&&Wt(l,(function(n){t.writeDouble(e,f+8*n,h[n])})),c>4&&(a+=c+=1&c),r+=4};for(A.s();!(s=A.n()).done;)u()}catch(t){A.e(t)}finally{A.f()}return[r,a]}(i,e,r,n);r=s[1],o<t.length-1&&i.writeUint(e,s[0],r)})),e.slice)return e.slice(0,r).buffer;for(var o=new Uint8Array(r),s=0;s<r;s++)o[s]=e[s];return o.buffer}([r])),a=new Uint8Array(t),A=r[277],u=new Uint8Array(Ve+e*n*A);return Wt(s.length,(function(t){u[t]=s[t]})),function(t,e){for(var n=t.length,i=0;i<n;i++)e(t[i],i)}(a,(function(t,e){u[Ve+e]=t})),u.buffer}(o,r,n,c);return f}(t,e)},Object.defineProperty(t,"mn",{value:!0})}(e)}(0,lI.exports)),lI.exports);class fI{url;zoom;Lf={};constructor(t){this.url=t?.url,this.zoom=t?.zoom||17}async sample(t,e){try{const n=function(t,e,n){const i=Math.pow(2,n),r=360/i,o=180/i;return[n,Math.floor(t/r)+i/2,i/2-Math.ceil(e/o)]}(t,e,this.zoom),i=n.join("_")+".tif",r=this.url.endsWith("/")?this.url+i:this.url+"/"+i;let o=this.Lf[r];o||(o=this.Nf(r));const s=await o;s||delete this.Lf[r];const{ModelPixelScale:a,ModelTiepoint:A}=s.fileDirectory;let[u,h,l]=a,[c,f,d,g,v,I]=A;h=-h;const p=[-g/u,1/u,0,-v/h,0,1/h],[y,w]=function(t,e,n,i=!1){const r=t=>i?0|t:t;return[r(n[0]+n[1]*t+n[2]*e),r(n[3]+n[4]*t+n[5]*e)]}(t,e,p,!0),C=await s.readRasters(),{width:B,0:E}=C,m=E[y+w*B];if(-9999===m)return;return m}catch(t){return}}Nf(t){const e=fetch(t).then((t=>t.arrayBuffer())).then((t=>cI.fromArrayBuffer(t))).then((t=>t.getImage())).catch((t=>null));return this.Lf[t]=e,e}}var dI=2*Math.PI;class gI{zn;Uf;Tf;Pf;qf;Of;Hf;zf;Kf;Vf;Jf;Yf=0;Ae;jf;Wf;Xf;Zf;td;ed;nd;rd;Hn;od;sd=0;constructor(t,e,n){this.od=n;var i=void 0===(e=e||{}).title?"joystick":e.title,r=void 0===e.width?0:e.width,o=void 0===e.height?0:e.height;this.jf=void 0===e.internalFillColor?"rgba(255,255,255,0.4)":e.internalFillColor,this.Wf=void 0===e.internalLineWidth?2:e.internalLineWidth,this.Xf=void 0===e.internalStrokeColor?"rgba(255,255,255,0.6)":e.internalStrokeColor,this.Zf=void 0===e.externalLineWidth?2:e.externalLineWidth,this.td=void 0===e.externalStrokeColor?"rgba(255,255,255,0.3)":e.externalStrokeColor,this.ed=void 0===e.autoReturnToCenter||e.autoReturnToCenter;var s=t;s.style.touchAction="none";var a=document.createElement("canvas");this.zn=a,a.style.width="100%",a.id=i,0===r&&(r=s.clientWidth),0===o&&(o=s.clientHeight),a.width=r,a.height=o,s.appendChild(a),this.Hn=t,this.Ae=a.getContext("2d"),this.nd=a.width/4-12,this.Of=this.nd+20,this.rd=this.nd+30,this.Pf=a.width/2,this.qf=a.height/2,this.Kf=a.width/10,this.Vf=-1*this.Kf,this.Hf=a.height/10,this.zf=-1*this.Hf,this.Uf=this.Pf,this.Tf=this.qf,this.Hn.style.display="none",this.ad(),this.Ad(),this.Jf=null,this.ud=this.ud.bind(this),this.hd=this.hd.bind(this),this.ld=this.ld.bind(this),this.fd=this.fd.bind(this),this.dd=this.dd.bind(this),this.gd=this.gd.bind(this)}ad=()=>{this.Ae.beginPath(),this.Ae.arc(this.Pf,this.qf,this.rd,0,dI,!1),this.Ae.shadowBlur=5,this.Ae.shadowColor="white",this.Ae.lineWidth=this.Zf,this.Ae.strokeStyle=this.td,this.Ae.stroke()};Ad=()=>{this.Ae.beginPath();const t=this.Uf-this.Pf,e=this.Tf-this.qf,n=(t**2+e**2)**.5;if(n>this.Of){const i=this.Of/n;this.Uf=i*t+this.Pf,this.Tf=i*e+this.qf}this.Ae.arc(this.Uf,this.Tf,this.nd,0,dI,!1);var i=this.Ae.createRadialGradient(this.Pf,this.qf,5,this.Pf,this.qf,200);i.addColorStop(0,this.jf),i.addColorStop(1,this.Xf),this.Ae.shadowBlur=5,this.Ae.shadowColor="white",this.Ae.fillStyle=i,this.Ae.fill(),this.Ae.lineWidth=this.Wf,this.Ae.strokeStyle=this.Xf,this.Ae.stroke()};fd(t){this.Yf=1,this.Jf=t.targetTouches[0].identifier}dd(t){1===this.Yf&&(this.Uf=t.targetTouches[0].pageX,this.Tf=t.targetTouches[0].pageY,"BODY"===this.zn.offsetParent.tagName.toUpperCase()?(this.Uf-=this.zn.offsetLeft,this.Tf-=this.zn.offsetTop):(this.Uf-=this.zn.offsetParent.offsetLeft,this.Tf-=this.zn.offsetParent.offsetTop),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.ad(),this.Ad())}gd(t){t.changedTouches[0].identifier===this.Jf&&(this.Yf=0,this.ed&&(this.Uf=this.Pf,this.Tf=this.qf),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.ad(),this.Ad())}ud(t){t.stopPropagation(),this.Yf=1}hd(t){1===this.Yf&&(t.stopPropagation(),this.Uf=t.pageX,this.Tf=t.pageY,"BODY"===this.zn.offsetParent.tagName.toUpperCase()?(this.Uf-=this.zn.offsetLeft,this.Tf-=this.zn.offsetTop):(this.Uf-=this.zn.offsetParent.offsetLeft,this.Tf-=this.zn.offsetParent.offsetTop),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.ad(),this.Ad())}ld(t){this.Yf=0,this.ed&&(this.Uf=this.Pf,this.Tf=this.qf),this.Ae.clearRect(0,0,this.zn.width,this.zn.height),this.ad(),this.Ad()}open(){"ontouchstart"in document.documentElement?(this.zn.addEventListener("touchstart",this.fd,!0),document.addEventListener("touchmove",this.dd,!0),document.addEventListener("touchend",this.gd,!0)):(this.zn.addEventListener("mousedown",this.ud,!0),document.addEventListener("mousemove",this.hd,!0),document.addEventListener("mouseup",this.ld,!0)),this.Hn.style.display="block",this.sd=window.setInterval((()=>{this.od({x:this.GetX(),y:this.GetY()})}),50)}close(){"ontouchstart"in document.documentElement?(this.zn.removeEventListener("touchstart",this.fd),document.removeEventListener("touchmove",this.dd),document.removeEventListener("touchend",this.gd)):(this.zn.removeEventListener("mousedown",this.ud),document.removeEventListener("mousemove",this.hd),document.removeEventListener("mouseup",this.ld)),this.Hn.style.display="none",clearInterval(this.sd),this.sd=0}getCardinalDirection(){let t="",e=this.Uf-this.Pf,n=this.Tf-this.qf;return n>=this.zf&&n<=this.Hf&&(t="C"),n<this.zf&&(t="N"),n>this.Hf&&(t="S"),e<this.Vf&&("C"===t?t="W":t+="W"),e>this.Kf&&("C"===t?t="E":t+="E"),t}GetWidth(){return this.zn.width}GetHeight(){return this.zn.height}GetPosX(){return this.Uf}GetPosY(){return this.Tf}GetX(){return parseFloat(((this.Uf-this.Pf)/this.Of*100).toFixed())}GetY(){return parseFloat(((this.Tf-this.qf)/this.Of*100*-1).toFixed())}GetDir(){return this.getCardinalDirection()}}class vI{zr="closed";mo;jh;Ul;vd=new e.Cartesian2;Id=new e.Cartesian2;wc;el;pd;yd;ns=new pc(1,1,.01);wd;Cd;Bd;nl=0;Ed=0;md=-10;Qd;kd;constructor(t){t.buffer=t.buffer||.2,t.speed=t.speed||1,t.steeringSpeed=t.steeringSpeed||10,t.lookingMode=t.lookingMode||"scene",t.fixSpeedByHeight=null==t.fixSpeedByHeight||t.fixSpeedByHeight,this.mo=t;const e=t.viewer.canvas;e.setAttribute("tabindex","0"),e.onclick=function(){e.focus()},this.el=[],this.wc=new r.ScreenSpaceEventHandler(e),this.rl=this.rl.bind(this),this.il=this.il.bind(this),this.ol=this.ol.bind(this),this.bd();const n=document.createElement("div");n.style.cssText="width:150px;height:150px;position:absolute;bottom:50px;left:0;border-radius:100%",this.wd=n,this.yd=new gI(n,{width:150,height:150,externalLineWidth:1,internalLineWidth:1},this._d.bind(this))}_d(t){if(t.x||t.y){const e=r.Cartographic.fromCartesian(this.mo.viewer.camera.positionWC,void 0,this.xd);let n=.05*this.mo.speed;this.mo.fixSpeedByHeight&&(n*=Math.max(1.8,e.height-this.mo.yunjingLayer.getBaseHeight())/2),this.move([t.x,t.y,0],n,!0)}}bd(){const t=this.mo.yunjingLayer.getTileSetUrl(),e=t.lastIndexOf("/"),n=t.substring(0,e)+"/boxes.json";fetch(n).then((t=>{t.json().then((t=>{this.pd=t,this.pd.codes=new Set(this.pd.codes.split(";"))})).catch((t=>{}))})).catch((t=>{}))}Dd(t){let e=this.mo.yunjingLayer.getEnuCenter();const n={},i=[];t.forEach((t=>{const o=[(t[0]+t[3])/2,(t[1]+t[4])/2,(t[2]+t[5])/2],s=[Math.abs(t[0]-t[3])/1,Math.abs(t[1]-t[4])/1,Math.abs(t[2]-t[5])/1];let a=jl(new r.Cartesian3(...o),e),A=Wl(a);const u=`${Math.round(t[0]/5)}_${Math.round(t[1]/5)}`,h={bbox:t,center:A,alt:t[5],ecef:a,size:s,radius:Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2])/2};n[u]?n[u].push(h):n[u]=[h],i.push(h)}));const o=[],s=i.length;for(let t=0;t<s;t++){const{center:e,size:n,alt:s}=i[t],a=new r.Cartesian3(...n),A=r.Matrix4.multiplyByTranslation(r.Transforms.eastNorthUpToFixedFrame(r.Cartesian3.fromDegrees(e.lng,e.lat,e.height)),new r.Cartesian3(0,0,0),new r.Matrix4),u=new r.GeometryInstance({geometry:r.BoxGeometry.fromDimensions({vertexFormat:r.VertexFormat.POSITION_AND_NORMAL,dimensions:a}),modelMatrix:A,attributes:{color:r.ColorGeometryInstanceAttribute.fromColor(new r.Color(1,(150-Math.min(150,s))/150,(150-Math.min(150,s))/150,1))}});o.push(u)}this.mo.viewer.scene.primitives.add(new r.Primitive({geometryInstances:o,appearance:new r.PerInstanceColorAppearance({translucent:!1,closed:!0})}))}static Zh=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyA","KeyS","KeyD","KeyW","KeyQ","KeyE"];open(){if("openning"==this.zr)return;this.zr="openning";const t=this.mo.viewer,n=t.scene;n.screenSpaceCameraController.enableRotate=!1,n.screenSpaceCameraController.enableTranslate=!1,n.screenSpaceCameraController.enableZoom=!1,n.screenSpaceCameraController.enableLook=!1,n.screenSpaceCameraController.Sd/=3,this.vd.x=this.vd.y=0,this.Id.x=this.Id.y=0,this.Ul={inertiaing:!1,looking:!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1,dragging:!1,noObstacleAvoidance:!1};const i=this.wc,o=-1!==navigator.userAgent.toLowerCase().indexOf("mobile"),s=t=>{this.Ul.inertiaing=!1,this.Ul.looking=!0,this.Ul.dragging=!1,this.Id.x=this.vd.x=t.position.x,this.Id.y=this.vd.y=t.position.y},a=()=>{this.Ul.inertiaing=!1,this.Ul.looking=!1,this.Ul.dragging=!1,this.jh=void 0},A=t=>{this.Ul.inertiaing=!1,this.Ul.dragging=!0,this.Ul.looking=!1,this.Id.x=this.vd.x=t.position.x,this.Id.y=this.vd.y=t.position.y;const n=this.mo.viewer.camera,i=r.Cartographic.fromCartesian(n.positionWC,void 0,this.xd),o=new e.Cartesian3(0,0,-(i.height-this.mo.yunjingLayer.getBaseHeight()));this.ns.zo(new e.Cartesian3,o),this.Cd=this.fs(this.Id),this.Ed=(new Date).getTime(),this.Bd=void 0},u=()=>{if(this.Ul.dragging=!1,this.Bd&&(new Date).getTime()-this.Ed<10){this.Ul.inertiaing=!0;const t=this.mo.viewer.camera,n=r.Cartographic.fromCartesian(t.positionWC,void 0,this.xd);let i=this.md;this.mo.fixSpeedByHeight&&(i*=Math.max(1.8,n.height-this.mo.yunjingLayer.getBaseHeight())/2);const o=this.Bd,s=e.Cartesian2.magnitude(this.Bd);let a=s/Math.abs(i);a=Math.min(1,a),i=-s/a;const A=(o.x<0?-1:1)*Math.abs(o.x/s)*i,u=(o.y<0?-1:1)*Math.abs(o.y/s)*i;this.Qd=A,this.kd=u}else this.Bd=void 0;this.jh=void 0},h=t=>{(this.Ul.looking||this.Ul.dragging)&&(this.Id=r.Cartesian2.clone(t.endPosition,this.Id)),(this.Ul.dragging||this.Ul?.inertiaing)&&this.Md()},l=this.mo.viewer.camera,c=t=>{if(this.Ul.inertiaing=!1,t.distance){if(t.distance.startPosition.y===t.distance.endPosition.y)return;t=5*(t.distance.endPosition.y-t.distance.startPosition.y)}const e=r.Cartographic.fromCartesian(l.positionWC,void 0,this.xd),n=this.mo.yunjingLayer.getEnuCenter();if(!n)return;let i=Math.max(1.8,e.height-this.mo.yunjingLayer.getBaseHeight())*t/1e3;l.pitch&&(i=Math.min(i,(e.height-this.mo.yunjingLayer.getMinHeight())/Math.sin(-l.pitch)));const o=new r.Cartesian3;r.Cartesian3.add(l.positionWC,r.Cartesian3.multiplyByScalar(l.directionWC,i,o),o);const s=Yl(o,n,this.$d);this.Rd(s)&&l.setView({destination:o,orientation:{heading:l.heading,pitch:l.pitch,roll:0}})};i.setInputAction(c,r.ScreenSpaceEventType.WHEEL),i.setInputAction(c,r.ScreenSpaceEventType.PINCH_MOVE),i.setInputAction(c,r.ScreenSpaceEventType.WHEEL,r.KeyboardEventModifier.SHIFT),document.addEventListener("keydown",this.il,!1),document.addEventListener("keyup",this.ol,!1),this.nl=requestAnimationFrame(this.rl),o?(t._element.appendChild(this.wd),this.yd.open(),i.setInputAction(s,r.ScreenSpaceEventType.LEFT_DOWN),i.setInputAction(a,r.ScreenSpaceEventType.LEFT_UP),i.setInputAction(h,r.ScreenSpaceEventType.MOUSE_MOVE)):(i.setInputAction(s,r.ScreenSpaceEventType.RIGHT_DOWN),i.setInputAction(s,r.ScreenSpaceEventType.RIGHT_DOWN,r.KeyboardEventModifier.SHIFT),i.setInputAction(a,r.ScreenSpaceEventType.RIGHT_UP),i.setInputAction(a,r.ScreenSpaceEventType.RIGHT_UP,r.KeyboardEventModifier.SHIFT),i.setInputAction(A,r.ScreenSpaceEventType.LEFT_DOWN),i.setInputAction(A,r.ScreenSpaceEventType.LEFT_DOWN,r.KeyboardEventModifier.SHIFT),i.setInputAction(u,r.ScreenSpaceEventType.LEFT_UP),i.setInputAction(u,r.ScreenSpaceEventType.LEFT_UP,r.KeyboardEventModifier.SHIFT),i.setInputAction(h,r.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(h,r.ScreenSpaceEventType.MOUSE_MOVE,r.KeyboardEventModifier.SHIFT));const f=new e.Quaternion,d=new e.Matrix3,g=new e.Cartesian3;return l.rotate=(t,n)=>{if(n){const i=this.mo.yunjingLayer.getEnuCenter(),o=n,s=e.Quaternion.fromAxisAngle(t,-o,f),a=e.Matrix3.fromQuaternion(s,d);e.Matrix3.multiplyByVector(a,l.position,g);const A=l._actualTransform;r.Matrix4.multiplyByPoint(A,g,g);const u=Yl(g,i,this.$d);if(!this.Rd(u))return}r.Camera.prototype.rotate.call(l,t,n)},this}close(){const t=-1!==navigator.userAgent.toLowerCase().indexOf("mobile");document.removeEventListener("keydown",this.il),document.removeEventListener("keyup",this.ol),this.nl&&cancelAnimationFrame(this.nl),this.el=[],this.jh=void 0;const e=this.mo.viewer,n=e.scene;n.screenSpaceCameraController.enableRotate=!0,n.screenSpaceCameraController.enableTranslate=!0,n.screenSpaceCameraController.enableZoom=!0,n.screenSpaceCameraController.enableTilt=!0,n.screenSpaceCameraController.enableLook=!0,n.screenSpaceCameraController.Sd*=3;const i=this.wc;t?(e._element.removeChild(this.wd),this.yd.close(),i.removeInputAction(r.ScreenSpaceEventType.LEFT_DOWN),i.removeInputAction(r.ScreenSpaceEventType.LEFT_UP),i.removeInputAction(r.ScreenSpaceEventType.MOUSE_MOVE)):(i.removeInputAction(r.ScreenSpaceEventType.RIGHT_DOWN),i.removeInputAction(r.ScreenSpaceEventType.RIGHT_DOWN,r.KeyboardEventModifier.SHIFT),i.removeInputAction(r.ScreenSpaceEventType.RIGHT_UP),i.removeInputAction(r.ScreenSpaceEventType.RIGHT_UP,r.KeyboardEventModifier.SHIFT),i.removeInputAction(r.ScreenSpaceEventType.LEFT_DOWN),i.removeInputAction(r.ScreenSpaceEventType.LEFT_DOWN,r.KeyboardEventModifier.SHIFT),i.removeInputAction(r.ScreenSpaceEventType.LEFT_UP),i.removeInputAction(r.ScreenSpaceEventType.LEFT_UP,r.KeyboardEventModifier.SHIFT),i.removeInputAction(r.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(r.ScreenSpaceEventType.MOUSE_MOVE,r.KeyboardEventModifier.SHIFT)),i.removeInputAction(r.ScreenSpaceEventType.WHEEL),i.removeInputAction(r.ScreenSpaceEventType.PINCH_MOVE),i.removeInputAction(r.ScreenSpaceEventType.WHEEL,r.KeyboardEventModifier.SHIFT),this.mo.viewer.camera.rotate=r.Camera.prototype.rotate}il(t){this.Ul.inertiaing=!1,"Shift"!=t.key?-1!==vI.Zh.indexOf(t.code)&&-1==this.el.indexOf(t.code)&&this.el.push(t.code):this.Ul.noObstacleAvoidance=!0}ol(t){if("Shift"==t.key)return void(this.Ul.noObstacleAvoidance=!1);const e=-1!==vI.Zh.indexOf(t.code),n=this.el.indexOf(t.code);e&&-1!==n&&this.el.splice(n,1),this.jh=void 0}Fd=new r.Ray;fs(t){const n=this.mo.viewer.camera,i=r.Cartographic.fromCartesian(n.positionWC,void 0,this.xd),o=[180*i.longitude/Math.PI,180*i.latitude/Math.PI,i.height],s=n.getPickRay(t,this.Fd),a=e.Cartesian3.add(s.origin,s.direction,s.origin),A=new e.Cartesian3;e.Cartesian3.normalize(Yl(a,o,a),A);const u=new e.Cartesian3(0,0,-(i.height-this.mo.yunjingLayer.getBaseHeight()));return this.ns.zo(new e.Cartesian3,u),this.ns.Ko(A,!0)}xd=new r.Cartographic;Md(){const t=(new Date).getTime(),n=this.mo.yunjingLayer.getEnuCenter();if(!this.el.length&&!this.Ul?.looking&&this.Ul?.dragging&&n){const i=this.mo.viewer.camera,o=r.Cartographic.fromCartesian(i.positionWC,void 0,this.xd);this.vd.x=this.Id.x,this.vd.y=this.Id.y;const s=this.fs(this.Id);if(this.Cd){const a=e.Cartesian3.subtract(s,this.Cd,this.$d);if(a.x||a.y){this.Bd=e.Cartesian2.multiplyByScalar(a,1e3/(t-this.Ed),this.Bd||new e.Cartesian2);const s=r.Math.toDegrees(o.longitude),A=r.Math.toDegrees(o.latitude),u=r.Cartesian3.fromElements(-a.x,-a.y,0,this.$d);let h=new e.Cartesian3;h=jl(u,[s,A,o.height],void 0,h);const l=Wl(h),c=zl([l.lng,l.lat,o.height],n);this.Rd(c)||(h.x=i.positionWC.x,h.y=i.positionWC.y,h.z=i.positionWC.z),i.setView({destination:e.Cartesian3.fromDegrees(l.lng,l.lat,o.height,void 0,h),orientation:{heading:i.heading,pitch:i.pitch,roll:0}})}else this.Bd=void 0}this.Cd=s,this.Ed=t}}rl(){this.nl=0;const t=this.mo.yunjingLayer.getEnuCenter();if(t){const n=this.mo.viewer.camera,i=r.Cartographic.fromCartesian(n.positionWC,void 0,this.xd);if(this.el.length||this.Ul?.looking){let e=0,o=0,s=0;if(this.el.length){const t=(new Date).getTime();if(this.jh&&t-this.jh){let r=(t-this.jh)/1e3*this.mo.speed;this.mo.fixSpeedByHeight&&(r*=Math.max(1.8,i.height-this.mo.yunjingLayer.getBaseHeight())/2);let a=0;switch(this.el.sort().join(",")){case"ArrowUp":case"KeyW":a=0;break;case"ArrowDown":case"KeyS":a=180;break;case"ArrowLeft":case"KeyA":a=-90;break;case"ArrowRight":case"KeyD":a=90;break;case"ArrowDown,ArrowLeft":case"KeyA,KeyS":a=-135;break;case"ArrowDown,ArrowRight":case"KeyD,KeyS":a=135;break;case"ArrowLeft,ArrowUp":case"KeyA,KeyW":a=-45;break;case"ArrowRight,ArrowUp":case"KeyD,KeyW":a=45;break;case"KeyQ":a=0,s=1;break;case"KeyE":a=0,s=-1}a=n.heading+a*Math.PI/180,e=Math.sin(a)*r,o=Math.cos(a)*r,s&&(s*=r,e=o=0)}this.jh=t}else this.jh=void 0;let a=0,A=0;const u=this.mo.viewer.canvas,h=u.clientWidth,l=u.clientHeight,c=(this.Id.x-this.vd.x)/h,f=-(this.Id.y-this.vd.y)/l,d=30;a=c*d*Math.PI/180*2,A=f*d*Math.PI/180,"scene"==this.mo.lookingMode&&(a=-a,A=-A),this.vd.x=this.Id.x,this.vd.y=this.Id.y;const g=r.Math.toDegrees(i.longitude),v=r.Math.toDegrees(i.latitude);let I=jl(new r.Cartesian3(e,o,s),[g,v,i.height]);const p=Yl(I,t);this.Rd(p)||(I=n.positionWC),n.setView({destination:I,orientation:{heading:n.heading+a,pitch:Math.max(-90,Math.min(this.mo.yunjingLayer.getMaxPitch(),n.pitch+A)),roll:0}})}else if(this.Ul?.inertiaing&&this.Bd){const o=(new Date).getTime(),s=this.Bd,a=this.Qd,A=this.kd;let u;u=Math.abs(a)>Math.abs(A)?Math.abs(s.x)/Math.abs(a):Math.abs(s.y)/Math.abs(A);let h,l,c=(o-this.Ed)/1e3;if(c>=u&&(c=u),h=s.x*c+.5*a*c*c,l=s.y*c+.5*A*c*c,this.Bd.x=s.x+a*c,this.Bd.y=s.y+A*c,h||l){const o=r.Math.toDegrees(i.longitude),s=r.Math.toDegrees(i.latitude);let a=jl(r.Cartesian3.fromElements(-h,-l,0,this.$d),[o,s,i.height],void 0,new e.Cartesian3);const A=Yl(a,t,this.$d);this.Rd(A)||(a.x=n.positionWC.x,a.y=n.positionWC.y,a.z=n.positionWC.z),n.setView({destination:a,orientation:{heading:n.heading,pitch:n.pitch,roll:0}})}else this.Ul.inertiaing=!1,this.Bd=void 0;this.Ed=o}}this.nl=requestAnimationFrame(this.rl)}move(t,e,n=!0){t instanceof r.Cartesian3||(t=new r.Cartesian3(t[0],t[1],t[2])),t=r.Cartesian3.normalize(t,t);const i=this.mo.viewer.camera,o=r.Matrix3.fromRotationZ(-i.heading),s=this.mo.yunjingLayer.getEnuCenter();r.Matrix3.multiplyByVector(o,t,t);const a=t.x*e,A=t.y*e,u=t.z*e,h=r.Cartographic.fromCartesian(i.positionWC,void 0,this.xd),l=r.Math.toDegrees(h.longitude),c=r.Math.toDegrees(h.latitude);let f=jl(new r.Cartesian3(a,A,u),[l,c,h.height]);const d=Yl(f,s);n&&!this.Rd(d)||i.setView({destination:f,orientation:{heading:i.heading,pitch:i.pitch,roll:0}})}Gd(t){if(!this.pd||this.Ul.noObstacleAvoidance)return!1;const e=this.mo.buffer;if(this.pd.isCode){const e=this.pd.dis,n=0,i=Math.floor((t.x-n)/e),r=Math.floor((t.x+n)/e),o=Math.floor((t.y-n)/e),s=Math.floor((t.y+n)/e),a=Math.floor((t.z-n)/e),A=Math.floor((t.z+n)/e);for(let t=i;t<=r;t+=1)for(let e=o;e<=s;e+=1)for(let n=a;n<=A;n+=1){const i=`${t}_${e}_${n}`;if(this.pd.codes.has(i))return!0}return!1}return this.pd.find(((n,i)=>{const r=t.x;if(r>=n[0]-e&&r<=n[3]+e){const i=t.y;if(i>=n[1]-e&&i<=n[4]+e){const i=t.z;if(i>=n[2]-e&&i<=n[5]+e)return!0}}}))}$d=new e.Cartesian3;Ld=new e.Cartesian3;Rd(t){const e=Yl(this.mo.viewer.camera.positionWC,this.mo.yunjingLayer.getEnuCenter(),this.Ld);return!!this.Gd(e)||!this.Gd(t)}}const II={YunJingLayer:fc,CameraLayer:Cc,AMapTerrain:o,AMapSatelliteLayer:s,ENU2ECEF:jl,ECEF2ENU:Yl,ECEF2LLA:Wl,ModelEntity:ld,ModelAnimationPath:cd,AnimationPath:cd,AMapTraffic:hd,SinglePick:nc,SinglePlane:ic,FixedLineViewControl:vd,CameraAnimation:pd,CameraAnimationPath:yd,CameraAnimationStatus:t.CameraAnimationStatus,TrackPoint:Bd,FirstViewControl:Id,RangingTool:Ed,TrafficHistoryLayer:Fd,RoadNetLayer:Gd,TrafficLayer:Od,PoiLayer:uI,MonomerLayer:cc,MonomerDrawLayer:zd,FirstPersonInteraction:vI,LLA2ENU:zl,TerrainSampler:fI};window.YunJing=II,t.AMapSatelliteLayer=s,t.AMapTerrain=o,t.AMapTraffic=hd,t.AnimationPath=cd,t.CameraAnimation=pd,t.CameraAnimationPath=yd,t.CameraLayer=Cc,t.ECEF2ENU=Yl,t.ECEF2LLA=Wl,t.ENU2ECEF=jl,t.FirstPersonInteraction=vI,t.FirstViewControl=Id,t.FixedLineViewControl=vd,t.LLA2ENU=zl,t.ModelAnimationPath=cd,t.ModelEntity=ld,t.MonomerDrawLayer=zd,t.MonomerLayer=cc,t.PoiLayer=uI,t.RangingTool=Ed,t.RoadNetLayer=Gd,t.SinglePick=nc,t.SinglePlane=ic,t.TerrainSampler=fI,t.TrackPoint=Bd,t.TrafficHistoryLayer=Fd,t.TrafficLayer=Od,t.YunJingLayer=fc}({},Cesium);
